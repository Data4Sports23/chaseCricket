
package com.data4sports.chasecricket.activities;

//import android.app.AlertDialog;

import android.app.ProgressDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.SharedPreferences;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.os.Build;
import android.os.Bundle;
import android.preference.PreferenceManager;
import android.support.v7.app.AlertDialog;
import android.support.v7.app.AppCompatActivity;
import android.text.InputType;
import android.util.Log;
import android.view.Gravity;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.Window;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.LinearLayout;
import android.widget.PopupWindow;
import android.widget.RadioButton;
import android.widget.RadioGroup;
import android.widget.TextView;
import android.widget.Spinner;
import android.widget.Toast;

import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.JsonObjectRequest;

import com.data4sports.chasecricket.R;
import com.data4sports.chasecricket.applicationConstants.AppConstants;
import com.data4sports.chasecricket.models.Batsman;
import com.data4sports.chasecricket.models.Bowler;
import com.data4sports.chasecricket.models.Constants;
import com.data4sports.chasecricket.models.Events;
import com.data4sports.chasecricket.models.ExtraCard;
import com.data4sports.chasecricket.models.FOW;
import com.data4sports.chasecricket.models.Match;
import com.data4sports.chasecricket.models.MatchNotes;
import com.data4sports.chasecricket.models.MatchOfficials;
import com.data4sports.chasecricket.models.MyApplicationClass;
import com.data4sports.chasecricket.models.Partnership;
import com.data4sports.chasecricket.models.Penalty;
import com.data4sports.chasecricket.models.Player;
import com.data4sports.chasecricket.models.Substitution;
import com.data4sports.chasecricket.models.Undo;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.text.DecimalFormat;
import java.util.ArrayList;
import java.util.Arrays;

import io.realm.Realm;
import io.realm.RealmConfiguration;
import io.realm.RealmResults;
import io.realm.Sort;
import io.realm.exceptions.RealmException;
import io.realm.exceptions.RealmPrimaryKeyConstraintException;

/**
 * Updated on 19/04/2021
 */
public class ScoringActivity extends AppCompatActivity
        implements View.OnClickListener {//, CompoundButton.OnCheckedChangeListener {

//    private static boolean RUN_ONCE = true, score = true;

    TextView tvTeamA, tvTeamB, tvMatchType, tvTotalRuns, tvTotalWicket, tvPlayingOver, tvPlayingInnings,
            tvRemainingRunsText, tvRemainingRuns, tvRemainingOversBallsText, tvRemainingOversBalls,
            tvBattingTeam, tvFieldingTeam, tvPlayer1, tvPlayer2, tvBowler, tvBowler2, player1Selected,
            player2Selected, tvPlayer1Runs, tvPlayer2Runs, tvPlayer1Balls, tvPlayer2Balls, tvdiv,
            tvBowlerOver, tvBowlerMO, tvBowlerRuns, tvBowlerWicket, tvBowlerOver2, tvBowlerMO2,
            tvBowlerRuns2, tvBowlerWicket2, tvCurrentOver, tvCommentry, tv_outType, tv_outBatsman,
            tv_fielder, tv_crossed, tv_extraType, tv_com, tv_extra, tvExtrasType, tvExtrasCom,
            tv_team, tvExtraRuns, tvExtraRunsOffBat, tvExtraCom, tvServerSync/*, tv_extra_penalty, tv_out_penalty*/;

    Button btnUndo, btnSwap, btnScore, btnOut, btnExtras, btnHash, btnCom, btn1, btn2, btn3, btn4,
            btn6, btn0, btnP, btnWagonWheel, btnInterval, /*btnSession,*/
            btnChangeBatsman, btnChangeBowler,
            btn_out_Type, btn_out_batsman, btn_out_fielder, btn_out_next, btn_out_crossed,
            btn_out_extra_type, btn_out_com, /*btn_out_penalty,*/
            btn_out_extra, btn_teamB, interval_ok,
            interval_cancel, session_ok, session_cancel, btn_extra_type, btn_extra_runs_off_bat,
            btn_extra_com, btn_extra_next/*, btn_extra_penalty*/;

    EditText interval_et, session_et, et_out_run, et_runsOffBat_out, et_extra_run_out,
            et_runsOffBat_extra, et_extra_run_extra;

    Spinner interval_sp, session_sp;
    //    ToggleButton btn_crossed;

    LinearLayout ll_batsman, ll_fielder, ll_crossed, ll_remainings, ll_extras, ll_extra, ll_ballcount,
            ll_extra_runs, /*ll_penalty, */
            ll_extra_extra;
//    LinearLayout ll_extra, ll_extra_runs, ll_penalty;

    CheckBox cb_ball_count;

    int lastBallType = -1, ballExtra = 0, out_run = 0, matchid, flag = 0, i_flag = 0, ve_flag = 0,
            outType = -1, ballType = -1, runsOffBat = 0, t = 0, extraType = -1, extra = 0, checkedItem = -1,
            penaltyType = 0, penaltyRunTeam, extraRun = 0, session_click = 0, ttt = 0, bowlerID,
            player1ID, player2ID, preBowlerID = 0, replacedBowlerID = 0, replacedBowlerOver = 0,
            replacedBowlerBall = 0, intervalID = 0, sessionID = 0, /*totalOver,*/
            ballsPerOver, currentRuns,
            remainingRuns, remainingBalls, lastRun = 0, leadingRuns = 0, wicket = 0, totalExtras = 0,
            so_inninngs1Runs = 0, so_inninngs2Runs = 0, revisedTarget = 0, player1Runs, player2Runs,
            psRuns = 0, psBalls = 0, p1CR = 0, p1CB = 0, p2CR = 0, p2CB = 0, ps1ID = 0, ps2ID = 0, psOver = 0,
            player1Balls, player2Balls, totalBalls = 0, builderText, battingOrder = 0, bowlerBalls,
            bowlerMO, bowlerWicket, bowlerDots, bowlerF4s, bowlerS6s, bowlerWide, bowlerNoBall,
            preBowlerBalls, preBowlerRun, preBowlerMO, preBowlerWicket, hashScore, ball = 0,
            preInningsRuns = 0, innings1Runs = 0, innings2Runs = 0, innings3Runs = 0, innings4Runs = 0,
            runs, ecByes = 0, ecLB = 0, ecNoball = 0, ecWide = 0, ecPenlaty = 0, penaltyTeam = 0,
            player1Dots = 0, player1F4s = 0, player1S6s = 0, player2Dots = 0, player2F4s = 0,
            player2S6s = 0, bowlerOver = 0, preBowlerOver = 0, fieldingTeamNo, lastPreBowlerID = 0,
            battingTeamNo, player_count = 0, playerA = 0, playerB = 0, subst = 0, bwRun = 0, mo = 0, undoID = 0, player_in_id = 0,
            noballRun = 0, wideRun = 0, penaltyRun = 0, eventID = 0, currentInnings = 0, player_out_id = 0,
            totalInnings = 0, n = 0, nonStrikerDots, nonStrikerF4s, nonStrikerS6s, penaltyBallCount = 0,
            strID, nstrID, strikerRuns, strikerBalls, strikerDots, strikerF4s, strikerS6s, nonStrikerRuns,
            nonStrikerBalls, stroke_direction = -1, lastEventID, uinngs, uptype, urun, ubtype, uetype,
            uerun, uout = -1, upteam, team = 0, sout_id = 0, sin_id = 0, undoLastEventID = 0,
            temp_team = 0, subID = 0, pp_id = 0, sub_new_bowler_id = 0, dismissedPlayrID = 0,
            lastBowler = 0, count = 0, undo_count = 0, disPID = 0, lunch_flag = 0, tea_flag = 0, dinner_flag = 0;

    boolean forceSwap = false, bye = false, lb = false, noBall = false, wide = false, byeNB = false,
            resetBowler = false, lbNB = false, runsOffBatNB = false, boundaryNB = false, efo = false,
            endOfInnings = false, crossed = false, noneNB = false, undo_balltype_7 = false, tA = false,
            interval = false, session = false, firstbowler = false, multi = false, newFlag = false,
            maiden = false, boundary = false, out = false, extras = false, /*confirm_out = false,*/
            confirm_extras = false, tB = false, strikerPlaying = true,
            concussion = false, strikerOut = false, strike = false, wheel = false, endOfOver = false,
            penalty = false, ballCount = false, UNDO_LIMIT = false, freeHit = false, inningsNotStarted = false,
            RUN_ONCE = false, score = false, allOUT = false, retired = false, SET_OVER = false,
            SUPER_OVER = false, batting = false, fielding = false, playerSelected = false, endOfMatch = false,
            continueBatting = false, initialize = false, new_bowler = false, eventSync = false,
            just_started = false, single = false, first_batsman = false, endOfDay = false, inning_started = false,
            declared = false, checkFreeHit = false, substitute, followon = false, newPartnership = false,
            lastOut = false, new_innings = false, undo = false, pre_out = false, substitution = false,
            bowball = false, batsball = false, power = false, endOver = false, other = false,
            pre_interval = false, callBowlerAlert = false, out_ball_not_count = false, outextras = true,
            lastWicket = false, absent = false, wk_flag = false, force_end_over = false;

    ExtraCard extraCard;

    PopupWindow popupOUT, popupExtra, popupInterval;//, popupSession;

    ArrayList<String> intervalList, sessionList, fieldersList;

    static String bats = "", fielderPlayer = "", dismissedPlayer = "", teamName, oldNAme, fielderPlayerID = null;

    SharedPreferences sharedPreferences;
    SharedPreferences.Editor editor;

    private ProgressDialog progress;

    String matchID, teamA, teamB, battingTeam, fieldingTeam, player1, player2, bowler, preBowler = null,
            token, firstBattingTeam, matchtype, innings, tossWinner, decision, ubowler, replacedBowler = null,
            unonstriker, unewbatsman, uprebowler, status = null, post_temp = null, oType = "", eType = "",
            commentary, newBatsman, str = "", dso = "", modified = "", udisplay = "", text = "",
            wwRegion = "", string = "", tem = "", striker, nonStriker, replacedPlayer, matchNote = "",
            message = "", sessionType = null, wicketkeeper = null, wheelRegion = null, endMessage = "";

    float currentOver, remainingOver, tco, tbo, tpbo, tro, reduced_overs, totalOver, serverSync;

    Realm realm;

    ImageButton back, btn_out_back, btn_extra_back;

    final String[] fielders = new String[20];

    ArrayList<Integer> dismissedList, retiredList;

    float y = 0.0f;
    LinearLayout linearLayout;

    ArrayList lastOverList;

    JSONArray jsonEventArray, tempArray, jsonUndoArray;

    AlertDialog.Builder substitutionBuilder, matchOverBuilder, teamBuilder, addNoteBuilder, comBuilder,
            penaltyBalllCountDialog, penaltyDialog, boundryDialog, noballBuilder, extraTypeBuilder,
            outComBuilder, outExtraTypeBuilder, fielderBuilder, selectDismissedBuilder, outtypeBuilder,
            replaceBatsmanBuilder, boundaryAlert, addRunsBuilder, declarationBuilder, bowlerBuilder,
            batsmanBuilder;

    AlertDialog matchTieAlert, inningsAlert, allOutAlert, powerPlayDialog, forceEndInningsAlert,
            forceEndOverAlert, retiredAlert, confirmAlert, outOfPlayerAlert, bowlerAlert, firstBowlerAlert,
            allottedInningsAlert, endOfInningsAlert, overCompleteAlert, matchOverAlert, swapAlert;

    String[] fielderss;

    boolean[] checkedFielders;

    private boolean isChecked = false, FORFEIT = false, CONCEDE = false, limited_over = false,
            rain_rule = false, remaining_absent = false, target_achieved = false;

    RadioButton rb_crossed, rb_not_crossed;

    int wk_id = 0, wk_position = 0, keeper_position = 0, pre_wk_id = 0, pre_wk_position = 0,
            forfeit_innings = 0, forfeit_team = 0, conceded_team = 0, forceEndingType = 0,
            newBatsID = 0, max_opb = 0, b_over = 0;/*, conceded_innings = 0*/

    RealmConfiguration config;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE);
        setContentView(R.layout.activity_scoring);

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        lastOverList = new ArrayList();
        linearLayout = findViewById(R.id.linearLayoutScore);

//        getActionBar().setDisplayHomeAsUpEnabled(true);
        /*getActionBar().setCustomView();*//*

        getSupportActionBar().setDisplayOptions(ActionBar.DISPLAY_SHOW_CUSTOM);
        getSupportActionBar().setDisplayShowCustomEnabled(true);
        getSupportActionBar().setCustomView(R.layout.custom_action_bar_layout);
        View view =getSupportActionBar().getCustomView();

        back = (ImageButton)view.findViewById(R.id.action_bar_back);

        back.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                *//*finish();*//*
                Log.e("scoring", "oncreate, back button pressd");
            }
        });

       /* ImageButton imageButton2= (ImageButton)view.findViewById(R.id.action_bar_forward);

        imageButton2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Toast.makeText(getApplicationContext(),"Forward Button is clicked",Toast.LENGTH_LONG).show();
            }
        });*/

        assignViews();


        Log.e("SCoring", "oncreate, SET_OVER : " + SET_OVER);
        getFromSP();

        runOnce();
        if (!RUN_ONCE) {

            Log.e("SCoring", "oncreate, initializeVariables 1");
            initializeVariables();

            if (SET_OVER && (runs == 0)) {// || (runs == 0)){

                Log.e("SCoring", "oncreate, SET_OVER : " + SET_OVER);
                setOver(537);                   // for setting the over after displaying Wagon wheel
            }

        }

        btnUndo.setOnClickListener(this);
        btnSwap.setOnClickListener(this);
        btnScore.setOnClickListener(this);

        btnOut.setOnClickListener(this);
        btnExtras.setOnClickListener(this);
        btnHash.setOnClickListener(this);
        btnCom.setOnClickListener(this);

        btn1.setOnClickListener(this);
        btn2.setOnClickListener(this);
        btn3.setOnClickListener(this);
        btn4.setOnClickListener(this);
        btn6.setOnClickListener(this);
        btn0.setOnClickListener(this);
        btnP.setOnClickListener(this);

        btnWagonWheel.setOnClickListener(this);
        btnInterval.setOnClickListener(this);
        btnChangeBatsman.setOnClickListener(this);
        btnChangeBowler.setOnClickListener(this);
    }


    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.btn_undo:
                Log.d("undo", "button pressed");
                Events events = realm.where(Events.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).findAll().last();

                Log.d("undo", "events : " + events);
                if ((currentOver < 0.0f) || (events == null)) {
                    btnUndo.setEnabled(false);
                    initializeBowler();
                    syncBowler();

                } else {
                    btnUndo.setEnabled(true);
                    undo();
                }
                break;

            case R.id.btn_swap:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);
                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "swap pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    forceSwap = true;
                    changeStriker();
                }
                break;

            case R.id.btn_score:
                displayScoreCard(false, false);
                break;

            case R.id.btn_out:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;
                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;+
                            sessionType = "SS3";
                        }

                    }

                    else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "out pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    out = true;
                    playerOUT();
                }

                break;

            case R.id.btn_extras:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    }

                    else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "extras pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    extras = true;
                    setExtra();
                }
                break;

            case R.id.btn_hash:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;
                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    } else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "hash pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    addRuns();
                }
                break;

            case R.id.btn_com:
                setCommentry();
                break;

            case R.id.btn_one:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    } else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "one pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    Log.d("ball", "1 : " + ball + ", ballsPerOver : " + ballsPerOver);
                    displayOver(1);
                }
                break;

            case R.id.btn_two:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    } else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021
                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "two pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    displayOver(2);
                }
                break;

            case R.id.btn_three:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    } else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "three pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    displayOver(3);
                }
                break;

            case R.id.btn_four:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    } else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "four pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    displayOver(4);
                }
                break;

            case R.id.btn_six:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    } else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "six pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    displayOver(6);
                }
                break;

            case R.id.btn_zero:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);

/*
                if (UNDO_LIMIT) {
                    UNDO_LIMIT = false;

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }

                    } else {

                        if (currentInnings == 1) {

                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);
                    setMatchStatus(sessionType, sessionID);
                }
*/
                checkUndoLimit();   // Added on 28/04/2021

                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "zero pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    displayOver(0);
                }
                break;

            case R.id.btn_wagon_wheel:
                break;

            case R.id.btn_interval:

                Log.d("enable", "interval : " + interval + ", endOfDay : " + endOfDay);
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);
                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "interval pressed");
                    // added on 06/05/2020
                    if (undo)
                        callEndOfOverAlert();
                } else {
                    if (interval || endOfDay) {
                        if (interval)
                            enableButtons(1);
                        else if (endOfDay)
                            enableButtons(2);
                        if (i_flag == 1 || callBowlerAlert) {
                            if (pre_out) {
                                Log.d("interval", "enable 1, pre_out : " + pre_out);
                            } else {
                                i_flag = 0;
                                selectBowlerAlertDialog();
                            }
                        }
                    } else
                        setInterval(0);
                }
                break;


            case R.id.btn_change_batsman:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);
                if (allOUT || endOfInnings || endOfMatch) {
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "change batsman pressed");
                } else {
                    replaceBatsman(false);
                }
                break;

            case R.id.btn_change_bowler:
                Log.d("scoring", "allOUT : " + allOUT + ", endOfInnings : " + endOfInnings + ", endOfMatch : " + endOfMatch);
                if (allOUT || endOfInnings || endOfMatch) {
//                    alert(); COMMENTED ON 08/03/2021
                    displayAlert(endMessage, 1);
                } else if (endOver) {
                    Log.d("endOver", "change bowler pressed");
                } else {
                    changeBowler(0);
                }
                break;

            case R.id.rb_not_crossed:
                crossed = false;
                Log.d("scoring", "onClick, rb_not_crossed crossed : " + crossed);
                break;

            case R.id.rb_crossed:
                crossed = true;
                Log.d("scoring", "onClick, rb_crossed crossed : " + crossed);
                if (outType == 2)
                    btn_out_batsman.setVisibility(View.VISIBLE);

                else if (outType == 3 || outType == 8) {
                    ll_extra.setVisibility(View.VISIBLE);
                }
                break;

            default:
                break;
        }
    }


    private void runOnce() {
        Log.e("Scoring", "inside run once,  RUN_ONCE : " + RUN_ONCE);
        Log.e("Scoring", "runonce,  SET_OVER : " + SET_OVER);
        Log.e("Scoring", "runonce,  status : " + status);


        if (RUN_ONCE) {
            RUN_ONCE = false;
            Log.d("Scoring", "inside run once");

             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);

            dismissedList = new ArrayList<Integer>();
            retiredList = new ArrayList<Integer>();
            extraCard = new ExtraCard();

            jsonEventArray = new JSONArray();
            tempArray = new JSONArray();
            jsonUndoArray = new JSONArray();

            inning_started = true;

            initializeVariables();
            Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();

            if (SUPER_OVER) {

                newBowler(bowlerID, 0);
                syncBatsmann(strID, 0, null, false, -1, false, false, false);
                syncBatsmann(nstrID, 0, null, false, -1, false, false, false);

                if (currentInnings == 99)
                    ll_remainings.setVisibility(View.GONE);

            } else {

                Log.d("Test", " Bowler : " + bowler);

                newBowler(bowlerID, 0);
                syncBatsmann(strID, 0, null, false, -1, false, false, false);
                syncBatsmann(nstrID, 0, null, false, -1, false, false, false);
//
                Log.d("Scoring", "runOnce, bowler  : " + bowler);
                Log.d("Scoring", "runOnce, next bowler  : " + preBowler);

                tossWinner = match.getToss_winner();
                decision = match.getDecision();

                if (currentInnings == 1 || currentInnings == 99)
                    ll_remainings.setVisibility(View.GONE);

                else
                    ll_remainings.setVisibility(View.VISIBLE);

                Log.e("Scoring", "runonce, remainingBalls : " + remainingBalls);
                Log.e("Scoring", "runonce, totalInnings : " + totalInnings);

                // commented on 04/05/2020
                /*if (currentInnings == 1) {
                    sessionType = "MS";
                    sessionID = 6;
                    setMatchStatus(sessionType, sessionID);
                }
                else*/
                //commented on 05/06/2020
//                    setMatchStatus(match.getStatus(), match.getStatusId());

                addsToBatsman(battingTeamNo, currentInnings);
            }
            updateMatch(matchid, false);

            Log.d("power", "runOnce, new_innings : " + new_innings);
            Log.d("power", "runOnce, matchtype : " + matchtype);
            Log.d("power", "runOnce, innings : " + innings);
            if (new_innings && !(innings.matches("multi"))) {
                    /*(!(matchtype.matches("Test")) ||
                         !((matchtype.matches("Custom")) && (innings.matches("multi"))))) {*/

                AlertDialog ppDialog = new AlertDialog.Builder(ScoringActivity.this).create();
                ppDialog.setIcon(R.drawable.ball);
                ppDialog.setCancelable(false);
                ppDialog.setTitle("Do you want to enter PowerPlay details?");
                ppDialog.setButton(AlertDialog.BUTTON_POSITIVE, "Ok",
                        new DialogInterface.OnClickListener() {
                            public void onClick(DialogInterface dialog, int which) {
                                dialog.dismiss();
                                setPowerPlay();
                            }
                        });
                ppDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "Cancel",
                        new DialogInterface.OnClickListener() {
                            @Override
                            public void onClick(DialogInterface dialog, int which) {
                                dialog.dismiss();
                            }
                        });

                ppDialog.show();

            }

        }


    }


    void assignViews() {

        tvTeamA = findViewById(R.id.txt_teamA_scoring);
        tvTeamB = findViewById(R.id.txt_teamB_scoring);
        tvMatchType = findViewById(R.id.txt_matchType_scoring);

        ll_remainings = findViewById(R.id.layout_remainings);

        tvTotalRuns = findViewById(R.id.txt_total_runs);
        tvTotalWicket = findViewById(R.id.txt_total_wicket);
        tvdiv = findViewById(R.id.backslash);
        tvPlayingOver = findViewById(R.id.txt_playing_overs);
        tvPlayingInnings = findViewById(R.id.txt_total_innings);
        tvRemainingRunsText = findViewById(R.id.txt_remaining_runs1);
        tvRemainingRuns = findViewById(R.id.txt_remaining_runs);
        tvRemainingOversBallsText = findViewById(R.id.txt_remaining_over_balls1);
        tvRemainingOversBalls = findViewById(R.id.txt_remaining_over_balls2);

        tvBattingTeam = findViewById(R.id.txt_batting_team_score);
        tvFieldingTeam = findViewById(R.id.txt_bowling_team_score);

        tvPlayer1 = findViewById(R.id.txt_player1);
        tvPlayer2 = findViewById(R.id.txt_player2);
        player1Selected = findViewById(R.id.player1_selected);
        player2Selected = findViewById(R.id.player2_selected);

        tvPlayer1Runs = findViewById(R.id.txt_player1_runs);
        tvPlayer2Runs = findViewById(R.id.txt_player2_runs);
        tvPlayer1Balls = findViewById(R.id.txt_player1_faced_balls);
        tvPlayer2Balls = findViewById(R.id.txt_player2_faced_balls);

        tvBowler = findViewById(R.id.txt_bowler);
        tvBowlerOver = findViewById(R.id.txt_bowler_overs);
        tvBowlerMO = findViewById(R.id.txt_bowler_MO);
        tvBowlerRuns = findViewById(R.id.txt_bowler_runs);
        tvBowlerWicket = findViewById(R.id.txt_bowler_wicket);

        tvBowler2 = findViewById(R.id.txt_bowler2);
        tvBowlerOver2 = findViewById(R.id.txt_bowler_overs2);
        tvBowlerMO2 = findViewById(R.id.txt_bowler_MO2);
        tvBowlerRuns2 = findViewById(R.id.txt_bowler_runs2);
        tvBowlerWicket2 = findViewById(R.id.txt_bowler_wicket2);

        tvCurrentOver = findViewById(R.id.txt_current_over);
        tvCommentry = findViewById(R.id.txt_com_display);

        btnUndo = findViewById(R.id.btn_undo);
        btnSwap = findViewById(R.id.btn_swap);
        btnScore = findViewById(R.id.btn_score);

        btnOut = findViewById(R.id.btn_out);
        btnExtras = findViewById(R.id.btn_extras);
        btnHash = findViewById(R.id.btn_hash);
        btnCom = findViewById(R.id.btn_com);

        btn1 = findViewById(R.id.btn_one);
        btn2 = findViewById(R.id.btn_two);
        btn3 = findViewById(R.id.btn_three);
        btn4 = findViewById(R.id.btn_four);
        btn6 = findViewById(R.id.btn_six);
        btn0 = findViewById(R.id.btn_zero);
        btnP = findViewById(R.id.btn_p);

        btnWagonWheel = findViewById(R.id.btn_wagon_wheel);
        btnInterval = findViewById(R.id.btn_interval);
//        btnSession = findViewById(R.id.btn_session);
        btnChangeBatsman = findViewById(R.id.btn_change_batsman);
        btnChangeBowler = findViewById(R.id.btn_change_bowler);

        tvServerSync = findViewById(R.id.txt_sync_display);
    }


    // get the required values from SharedPreferences

    void getFromSP() {

        sharedPreferences = PreferenceManager.getDefaultSharedPreferences(this);
        token = sharedPreferences.getString("user_token", null);
        matchid = sharedPreferences.getInt("sp_match_id", 0);
        matchID = sharedPreferences.getString("sp_match_ID", null);
        Log.v("scoring", " getFromSP, matchid : " + matchid);
        Log.v("scoring", " getFromSP, matchID : " + matchID);
        teamA = sharedPreferences.getString("sp_teamA", null);
        teamB = sharedPreferences.getString("sp_teamB", null);
        innings = sharedPreferences.getString("sp_innings", null);
        battingTeam = sharedPreferences.getString("sp_batting_team", null);
        fieldingTeam = sharedPreferences.getString("sp_fielding_team", null);
        battingTeamNo = sharedPreferences.getInt("sp_batting_team_no", 0);
        fieldingTeamNo = sharedPreferences.getInt("sp_fielding_team_no", 0);
        player1 = sharedPreferences.getString("sp_striker", null);
        player2 = sharedPreferences.getString("sp_non_striker", null);
        player1ID = sharedPreferences.getInt("sp_striker_id", 0);
        player2ID = sharedPreferences.getInt("sp_non_striker_id", 0);
        totalInnings = sharedPreferences.getInt("sp_total_innings", 0);
        player_count = sharedPreferences.getInt("sp_player_count", 0);
        striker = player1;
        nonStriker = player2;
        strID = player1ID;
        nstrID = player2ID;
        ps1ID = player1ID;
        ps2ID = player2ID;
        Log.v("scoring", " getFromSP, player1ID : " + player1ID);
        Log.v("scoring", " getFromSP, player2ID : " + player2ID);
        Log.v("scoring", " getFromSP, ps1ID : " + ps1ID);
        Log.v("scoring", " getFromSP, ps2ID : " + ps2ID);
        bowler = sharedPreferences.getString("sp_bowler", null);
//        nextBowler = sharedPreferences.getString("sp_next_bowler", null);
        bowlerID = sharedPreferences.getInt("sp_bowler_id", 0);
        Log.d("BOWLER", "getFromSP, bowlerID : " + bowlerID);
//        nextBowlerID = sharedPreferences.getInt("sp_next_bowler_id", 0);
//        SUPER_OVER = sharedPreferences.getBoolean("SUPER_OVER", false);
//        wagon_wheel = sharedPreferences.getBoolean("sp_wagon_wheel", false);
        just_started = sharedPreferences.getBoolean("sp_just_started", false);
        status = sharedPreferences.getString("sp_status", null);

//        setInnings();


        Log.v("scoring", " getFromSP, innings : " + innings);

        matchtype = sharedPreferences.getString("sp_match_type", null);
//        totalOver = sharedPreferences.getInt("sp_over", 0);
        ballsPerOver = sharedPreferences.getInt("sp_balls", 0);
        currentInnings = sharedPreferences.getInt("sp_current_innings", 0);
        noballRun = sharedPreferences.getInt("sp_noball_value", 0);
        wideRun = sharedPreferences.getInt("sp_wide_value", 0);
        penaltyRun = sharedPreferences.getInt("sp_penalty_value", 0);
        Log.d("Scoring", "getFromSP(), noballRun : " + noballRun);
        Log.d("Scoring", "getFromSP(), wideRun : " + wideRun);
        Log.d("Scoring", "getFromSP(), penaltyRun : " + penaltyRun);
        if (fieldingTeamNo == 1) {
            wicketkeeper = sharedPreferences.getString("sp_wkA", null);
            wk_id = sharedPreferences.getInt("sp_wkA_id", 0);
        } else if (fieldingTeamNo == 2) {
            wicketkeeper = sharedPreferences.getString("sp_wkB", null);
            wk_id = sharedPreferences.getInt("sp_wkB_id", 0);
        }

        keeper_position = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", fieldingTeamNo).
                equalTo("retired", false).
                equalTo("retired_concussion", false).
                equalTo("playerID", wk_id).findFirst().getWicketkeeping_position();

        battingOrder = sharedPreferences.getInt("sp_batting_order", 0);
        Log.d("battingOrder", "" + battingOrder);

        Intent i = getIntent();
//        status = i.getStringExtra("status");
        RUN_ONCE = i.getBooleanExtra("runonce", false);
        initialize = i.getBooleanExtra("initialize", false);
        score = i.getBooleanExtra("score", false);
        inningsNotStarted = i.getBooleanExtra("inningsnotstarted", false);
        SET_OVER = i.getBooleanExtra("SET_OVER", false);
        eventID = i.getIntExtra("eventId", 0);
        firstbowler = i.getBooleanExtra("first_bowler", false);
        first_batsman = i.getBooleanExtra("first_batsman", false);
        interval = i.getBooleanExtra("interval", false);
        session = i.getBooleanExtra("session", false);

        new_innings = i.getBooleanExtra("new_innings", false);

//        just_started = i.getBooleanExtra("just_started", false);

        // for substitution
        concussion = i.getBooleanExtra("concussion", false);
        batting = i.getBooleanExtra("batting", false);
        fielding = i.getBooleanExtra("fielding", false);
        sout_id = i.getIntExtra("sout_id", 0);
        sin_id = i.getIntExtra("sin_id", 0);
        new_bowler = i.getBooleanExtra("new_bowler", false);
        Log.d("new_bowler", " getFromSP from match, new_bowler : " + new_bowler);
        substitution = i.getBooleanExtra("substitution", false);
        subID = i.getIntExtra("subID", 0);
        ballType = i.getIntExtra("ballType", 0);
        pp_id = i.getIntExtra("p_id", 0);

        // new Bowler if substitution
        if (substitution) {
            bowlerID = i.getIntExtra("bowler_id", 0);
            bowler = i.getStringExtra("bowler");
        }

//        wheel = i.getBooleanExtra("wheel", false);
        power = i.getBooleanExtra("power", false);
        efo = i.getBooleanExtra("efo", false);
        wheelRegion = i.getStringExtra("wagon_wheel");
        stroke_direction = i.getIntExtra("stroke_direction", -1);
//        eventID = i.getIntExtra("eventId", 0);


        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
        Log.v("scoring", " getFromSP from match, matchid : " + matchid);
        Log.v("scoring", " getFromSP from match, matchID : " + matchID);
        Log.d("eventId", " scoring getFromSP from match,  : " + eventID);
        totalInnings = match.getTotalInnings();
        wheel = match.isWagonwheel();
        limited_over = match.isLimited_overs();
        Log.d("wheel", " scoring getFromSP from match,  : " + wheel);
        Log.d("wheel", " scoring getFromSP from match, wheelRegion : " + wheelRegion);
        Log.d("wheel", " scoring getFromSP from match,stroke_direction  : " + stroke_direction);
//        if (totalInnings == 4 && (currentInnings == 3 || currentInnings == 4))
        followon = match.isFollowon();
        SUPER_OVER = match.isSUPER_OVER();
        sessionID = match.getStatusId();
        innings = match.getInnings();
        totalOver = match.getOver();
        if (currentInnings > 1) {

            innings1Runs = match.getInnings1Runs();
            innings2Runs = match.getInnings2Runs();
            innings3Runs = match.getInnings3Runs();
            innings4Runs = match.getInnings4Runs();

            if (currentInnings == 2 && innings.matches("single")) {

                preInningsRuns = innings1Runs;
            }

            if (SUPER_OVER) {

                if (currentInnings == 99)
                    so_inninngs1Runs = match.getSuper_over_innings1runs();
                else if (currentInnings == 100) {
                    so_inninngs1Runs = match.getSuper_over_innings1runs();
                    so_inninngs2Runs = match.getSuper_over_innings2runs();
                }
                Log.d("so_inninngs1Runs", "getFromSP()1 : " + so_inninngs1Runs);
            }
        }


        if (interval)
            disableButtons(-1);

    }


    void initializeVariables() {
        int dismissedPlayerID = 0;

//        Log.d("Scoring", "inside initializeVariables()");
        ++ttt;
        Log.d("Scoring", "initializeVariables(), ttt : " + ttt);
        Log.d("Scoring", "initializeVariables(), status : " + status);
        Log.d("Scoring", "initializeVariables(), matchid : " + matchid);
        Log.d("Scoring", "initializeVariables(), matchID : " + matchID);
        Log.d("sessionID", "initializeVariables(), sessionID : " + sessionID);


        Log.d("status", "initializeVariables(), status : " + status);
//        setPlayerRuns();


//        displayProgress();

        if (status.matches("resume")) {

//            displayProgress();

            dismissedList = new ArrayList<Integer>();
            retiredList = new ArrayList<Integer>();
            jsonEventArray = new JSONArray();
            jsonUndoArray = new JSONArray();


            Events events = realm.where(Events.class).
                    equalTo("matchid", matchid).findAll().last();

            Log.d("Scoring", "initializeVariables, lastEvent : " + events);

            if (events != null) {

                if (events.getBallType() > 0) {

                    Log.d("Scoring", "initializeVariables, wheel : " + wheel);

                    if (wheel) {
                        Log.d("wheel", "initializeVariables, wheel : " + wheel);
                        Log.d("wheel", "initializeVariables, eventID : " + eventID);
                        Log.d("wheel", "initializeVariables, wheelRegion : " + wheelRegion);
                        Log.d("wheel", "initializeVariables, stroke_direction : " + stroke_direction);


                        if (eventID > 0)
                            saveWagonWheelRegion(eventID, wheelRegion, stroke_direction);

                    /*if (efo)
                        callEndOfOverAlert();*/
                    /*final int sync = realm.where(Events.class).
                            equalTo("eventID", eventID).
                            equalTo("matchid", matchid).findFirst().getSyncstatus();
                    if (sync == 0)*/
                        // commented on 08/07/2020  ----(B)
                    /*if (isNetworkAvailable()) {                     // added on 27/04/20
//                    jsonEventArray.put(setEventJSON(events));     // commented on 05/06/2020
                        resetJSONEventArray();                      // added on 05/06/2020
                        ---till here            -----(B)*/


                        Log.d("internet", "scoring, initializeVariables, isNetworkAvailable() : " + isNetworkAvailable());
                        // commented on 27/04/20
                        // if (isNetworkAvailable()) {
                        // added on 07/07/2020
//                        if (jsonUndoArray.length() > 0)


                        if (isNetworkAvailable())
                            post(1);


//                            postUndoJSON();
//                        else
//                            postJSON(matchid, matchID, false);
//                    }
                    } else if (substitution && ballType > 0) {

                        Log.d("eventId", "initializeVariables, : " + events.getEventID());
                        Log.d("eventId", "initializeVariables, : " + events);
                        // commented on 29/04/2020
//                    updateSubstitution(events.getEventID(), substitution, power, subID, pp_id, ballType);

//                    substitution = false;
                        if (isNetworkAvailable()) {                     // added on 27/04/20
//                    jsonEventArray.put(setEventJSON(events));     // commented on 05/06/2020
//                        resetJSONEventArray();                      // added on 05/06/2020

                            Log.d("internet", "scoring, initializeVariables, substitution");
//                    if (isNetworkAvailable()) {   // commented on 27/04/20

                            // commented on 08/07/2020  -----(C)
                        /*// added on 07/07/2020
                        if (jsonUndoArray.length() > 0)
                            postUndoJSON();
                        else
                            postJSON(matchid, matchID, false);
                            // till here           ------(C)  */
                            // added on 08/07/2020
                            post(2);
                        }
                    } else if (power) {//events.getEventID() == 21 ||
                        //events.getEventID() == 22 || events.getEventID() == 23) {//power && ballType > 0) {

                        Log.d("eventId", "initializeVariables, power : " + events.getEventID());
                        Log.d("eventId", "initializeVariables, power : " + events);
//                    updateSubstitution(events.getEventID(), substitution, power, subID, pp_id, ballType);     // commented on 14/05/2020

                        power = false;

                        // commeneted on 08/07/2020   ------- (D)
                        /*
                    if (isNetworkAvailable()) {                     // added on 27/04/20
//                    jsonEventArray.put(setEventJSON(events));     // commented on 05/06/2020
                        resetJSONEventArray();                      // added on 05/06/2020

                    Log.d("internet", "scoring, initializeVariables, substitution");
//                    if (isNetworkAvailable()) {       // commented on 27/04/20

                        // added on 07/07/2020
                        if (jsonUndoArray.length() > 0)
                            postUndoJSON();
                        else
                            postJSON(matchid, matchID, false);

                           // till here                ------ (D)  */
                        // added on 08/07/2020
                        post(3);
//                    }
                    }

                /*else {
                    resetJSONEventArray();
                    if (isNetworkAvailable())
                        postJSON(matchid, matchID,false);
                }*/

                    Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();

                    Log.e("Scoring", "initializeVariables, match : " + match);

                    currentInnings = events.getInnings();
                    teamA = match.getTeamA();
                    teamB = match.getTeamB();
                    matchtype = match.getMatchType();
                    innings = match.getInnings();
                    max_opb = match.getMax_opb();
                    limited_over = match.isLimited_overs();
                    Log.e("Scoring", "initializeVariables, innings : " + innings);
                    ballsPerOver = match.getBalls();
//                    player_count = match.getPlayer();
                    playerA = match.getPlayerA();
                    playerB = match.getPlayerB();

                    if (!SUPER_OVER) {
                        totalOver = match.getOver();
                        /* COMMENTED ON 01/03/2021
                        if (battingTeamNo == 1) {
                            player_count = match.getPlayerA();
                            subst = match.getSubstA();
                        }
                        else if (battingTeamNo == 2) {
                            player_count = match.getPlayerB();
                            subst = match.getSubstB();
                        }*/
                    } else {
                        totalOver = 1f;
                        player_count = 3;
                        subst = 0;
                    }
                    tossWinner = match.getToss_winner();
                    decision = match.getDecision();
                    totalInnings = match.getTotalInnings();
                    noballRun = match.getNoballrun();
                    wideRun = match.getWiderun();
                    penaltyRun = match.getPenaltyrun();
                    revisedTarget = match.getRevisedTarget();
                    sessionID = match.getStatusId();
                    sessionType = match.getStatus();

                /*penaltyRun = realm.where(Match.class).
                        equalTo("matchid", matchid).findFirst().getPenaltyrun();
                noballRun = realm.where(Match.class).
                        equalTo("matchid", matchid).findFirst().getNoballrun();
                wideRun = realm.where(Match.class).
                        equalTo("matchid", matchid).findFirst().getWiderun();*/

                    penaltyRun = match.getPenaltyrun();
                    noballRun = match.getNoballrun();
                    wideRun = match.getWiderun();

                    Log.e("sessionID", "resume, sessionID : " + sessionID);

                    if (events.getUndoArray() != null) {
                        try {
                            jsonUndoArray = new JSONArray(events.getUndoArray());
                        } catch (JSONException e) {
                            e.printStackTrace();
                        }
                    } else {
                        jsonUndoArray = new JSONArray();
                    }


                    Log.e("undo", "resume, jsonUndoArray : " + jsonUndoArray);

                    currentRuns = events.getTotalRuns();
                    wicket = events.getWicket();
                    ball = events.getCurrentOverBalls();
                    Log.e("Scoring", "resume, ball : " + ball);
                    totalBalls = events.getBalls();
                    currentOver = events.getOvers();
                    endOfDay = events.isEndOfDay();
                    lastBallType = events.getBallType();
                    pre_out = events.isPre_out();
                    callBowlerAlert = events.isCallBowlerAlert();
                    ball = events.getCurrentOverBalls();

                    if (currentOver > 1f) {
                        lastBowler = realm.where(Events.class).
                                equalTo("matchid", matchid).
                                equalTo("ballType", 6).
                                findAll().last().getBowlerID();
                    }

                    if (currentInnings == 2)
                        preInningsRuns = events.getPreInningsRuns();

                    if (endOfDay) {

                    /*//commented on 30/04/2020
                    session_click = 0;
                    btnSession.setText("START SESSION1");
                    session = true;
                    sessionEnable(session);*/

                        // added on 30/04/2020
                        btnInterval.setText("START DAY");
                        btnInterval.setEnabled(true);
                        disableButtons(2);
                    }

                    player1ID = events.getPlayer1ID();
                    player2ID = events.getPlayer2ID();

                    //added on 29/04/2020
                    //===========================================
                    if ((events.getBallType() == 18 || events.getBallType() == 19) && events.getDismissedPlayerID() != 0) {

                        if (events.getStrikerID() == events.getDismissedPlayerID())
                            strID = events.getDisNewBatsmanID();

                        else if (events.getNonStrikerID() == events.getDismissedPlayerID())
                            nstrID = events.getDisNewBatsmanID();

                    } else {
                        //===================================================
                        strID = events.getStrikerID();
                        nstrID = events.getNonStrikerID();
                    }

                    // UPDATED ON 01/03/2021
                    wk_id = events.getWkID(); //wk_player.getPlayerID();
                    keeper_position = events.getWk_position();  //wk_player.getWicketkeeping_position();
                    pre_wk_id = events.getPreWkID();
                    pre_wk_position = events.getPreWk_position();

                    Player wk_player = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", events.getFieldingTeamNo()).
                            equalTo("wicketKeeper", true).
                            equalTo("new_wk", true).
                            equalTo("playerID", wk_id).findFirst();

                    if (wk_player != null) {
                        wicketkeeper = wk_player.getPlayerName();
                    }

                    serverSync();

                    // Added on 28/04/2021
                    lunch_flag = events.getLunch_flag();
                    tea_flag = events.getTea_flag();
                    dinner_flag = events.getDinner_flag();
                    // till here


                    Log.d("new_bowler", "initializeVaribales, new_bowler : " + new_bowler);
                    Log.d("new_bowler", "initializeVaribales, substitution : " + substitution);
                    Log.d("new_bowler", "initializeVaribales, bowlerID : " + bowlerID);
                    Log.d("new_bowler", "initializeVaribales, bowler : " + bowler);
                    Log.d("new_bowler", "initializeVaribales, events.getBowlerID() : " + events.getBowlerID());
                    Log.d("new_bowler", "initializeVaribales, preBowlerID : " + preBowlerID);
                    if (new_bowler && substitution) {

                        substitution = false;

                        ballType = 6;
                        Log.e("Scoring", "selectBowlerAlertDialog, bowlerAlert, RETURN, ballType : " + ballType);
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                                wicket, ball, 0, preInningsRuns, remainingRuns, remainingBalls,
                                remainingOver, leadingRuns, innings1Runs, innings2Runs, innings3Runs,
                                innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                                strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID,
                                bwRun, bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/preBowlerID,
                                preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                                0, ballType, -1, 0, -1, 0,
                                null, 0, 0, 0, 0,
                                false, 0, commentary, bowlerID,/*preBowlerID,*/ mo, maiden,
                                modified, udisplay, tco, tbo, tpbo, 0, sessionType, sessionID,
                                false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                                so_inninngs1Runs, so_inninngs2Runs, false, freeHit,
                                false, inning_started, 0, 0,
                                0, null, pre_out, callBowlerAlert, wk_id,
                                keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);


                        newBowler(bowlerID, preBowlerID);
                    } else
                        bowlerID = events.getBowlerID();
                    preBowlerID = events.getPrevBowlerID();
                    if (preBowlerID <= 0) {
                        tvBowler2.setVisibility(View.INVISIBLE);
                        tvBowlerOver2.setVisibility(View.INVISIBLE);
                        tvBowlerRuns2.setVisibility(View.INVISIBLE);
                        tvBowlerMO2.setVisibility(View.INVISIBLE);
                        tvBowlerWicket2.setVisibility(View.INVISIBLE);
                    } else {
                        tvBowler2.setVisibility(View.VISIBLE);
                        tvBowlerOver2.setVisibility(View.VISIBLE);
                        tvBowlerRuns2.setVisibility(View.VISIBLE);
                        tvBowlerMO2.setVisibility(View.VISIBLE);
                        tvBowlerWicket2.setVisibility(View.VISIBLE);
                    }
                    lastPreBowlerID = events.getLastPreBowlerID();
                    dismissedPlayerID = events.getDismissedPlayerID();
                    newBatsID = events.getDisNewBatsmanID();
                    if (newBatsID > 0) {
                        Player player = realm.where(Player.class).
                                equalTo("matchid", matchid).
                                equalTo("playerID", newBatsID).findFirst();
                        if (player != null) {
                            newBatsman = player.getPlayerName();
                        }
                    }
//                pre_out = events.isPre_out();
                    dismissedPlayrID = dismissedPlayerID;
                    fielderPlayerID = events.getFielderID();


                    if (lastBallType == 3 && dismissedPlayerID > 0) {

                        out = true;
                        if (events.getOutType() == 10)
                            newPartnership = true;
                    /*else
                        newPartnership = false;*/
                        dismissedPlayerDetails(dismissedPlayerID);
                    } else {


                        // get partnership details
                        Partnership partnership = realm.where(Partnership.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("wicket", wicket + 1).findFirst();

                        if (partnership != null) {
                            psRuns = partnership.getPartnershipRuns();
                            psBalls = partnership.getPartnershipBalls();
                            psOver = partnership.getPartnershipOver();
                            ps1ID = partnership.getPlayer1ID();
                            p1CR = partnership.getPlayer1ContributionRuns();
                            p1CB = partnership.getPlayer1ContributionBalls();
                            ps2ID = partnership.getPlayer2ID();
                            p2CR = partnership.getPlayer2ContributionRuns();
                            p2CB = partnership.getPlayer2ContributionBalls();
                        } else {

                            psRuns = 0;
                            psBalls = 0;
                            psOver = 0;
//                    ps1ID = 0;
                            p1CR = 0;
                            p1CB = 0;
//                    ps2ID = 0;
                            p2CR = 0;
                            p2CB = 0;
                        }
                    }


                    if (lastBallType == 4 || lastBallType == 5)
                        selectBowlerAlertDialog();

                    else if (lastBallType == 12) {
                        if (events.getIntervalId() == 7)
                            interval = false;
                        else
                            interval = true;
                    }

                    if (interval)
                        disableButtons(-1);

                    if (currentInnings == 1 || currentInnings == 99) {
                        ll_remainings.setVisibility(View.GONE);
                        remainingRuns = 0;
                        remainingBalls = 0;
                        remainingOver = 0;
                        leadingRuns = 0;
                    } else {
                        ll_remainings.setVisibility(View.VISIBLE);

                        remainingRuns = events.getRemainingRuns();
                        leadingRuns = events.getLeadingRuns();

                        if (!innings.matches("multi")) {
                            remainingBalls = events.getRemainingBalls();
                            remainingOver = events.getRemainingOvers();
                        }

                    /*if (innings.matches("multi") && leadingRuns > 0 && remainingRuns < 0)
                        leadingRuns = events.getLeadingRuns();*/
                    }
                    Log.e("Scoring", "initializeVariables, resume, leadingRuns : " + leadingRuns);
                    Log.e("Scoring", "initializeVariables, resume, remainingRuns : " + remainingRuns);
                    Log.e("Scoring", "initializeVariables, resume, remainingBalls : " + remainingBalls);
                    Log.e("Scoring", "initializeVariables, resume, remainingOver : " + remainingOver);
                    Log.e("Scoring", "initializeVariables, resume, status : " + status);
                    Log.e("Scoring", "initializeVariables, resume, totalInnings : " + totalInnings);

                    if (concussion) {

                        if (batting) {

                            if (player1ID == sout_id)
                                player1ID = sin_id;

                            else if (player2ID == sout_id)
                                player2ID = sin_id;

                            if (strID == sout_id)
                                strID = sin_id;

                            else if (nstrID == sout_id)
                                nstrID = sin_id;

                            if (ps1ID == sout_id) {
                                ps1ID = sin_id;
                                p1CR = 0;
                                p1CB = 0;
                                p2CR = 0;
                                p2CB = 0;
                                psRuns = 0;
                                psBalls = 0;
                                psOver = 0;
                            } else if (ps2ID == sout_id) {
                                ps2ID = sin_id;
                                p1CR = 0;
                                p1CB = 0;
                                p2CR = 0;
                                p2CB = 0;
                                psRuns = 0;
                                psBalls = 0;
                                psOver = 0;
                            }

                        } else if (fielding) {

                            if (bowlerID == sout_id)
                                bowlerID = sin_id;

                            if (preBowlerID > 0 && preBowlerID == sout_id)
                                preBowlerID = sin_id;

//                        if (nextBowlerID > 0 && nextBowlerID == sout_id)
//                            nextBowFFlerID = sin_id;
                        }

                    }

                    Player player = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            /*equalTo("team", battingTeamNo).*/
                                    equalTo("playerID", player1ID).findFirst();

                    Log.d("player", "player1ID : " + player1ID + ", player : " + player);

                    if (player != null) {


                        player1 = player.getPlayerName();
                    }

                    player = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            /*equalTo("team", battingTeamNo).*/
                                    equalTo("playerID", player2ID).findFirst();

                    Log.d("player", "player2ID : " + player2ID + ", player : " + player);

                    if (player != null) {


                        player2 = player.getPlayerName();
                    }

                    //commented on 15/05/2020
                /*player1 = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", battingTeamNo).
                            equalTo("playerID", player1ID).findFirst().getPlayerName();

                player2 = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", battingTeamNo).
                        equalTo("playerID", player2ID).findFirst().getPlayerName();*/

                    if (strID == player1ID && nstrID == player2ID) {

                        striker = player1;
                        nonStriker = player2;
                    } else if (strID == player2ID && nstrID == player1ID) {

                        striker = player2;
                        nonStriker = player1;
                    }

                    Log.d("BOWLER", "initializeVariables, bowlerID : " + bowlerID);

                    if (bowlerID > 0) {

                    /*bowler = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", fieldingTeamNo).
                            equalTo("playerID", bowlerID).findFirst().getPlayerName();*/

                        Player bowler_player = realm.where(Player.class).
                                equalTo("matchid", matchid).
                                /* equalTo("team", fieldingTeamNo).*/
                                        equalTo("playerID", bowlerID).findFirst();

                        Log.d("BOWLER", "initializeVariables, bowler_player : " + bowler_player);

                        if (bowler_player != null) {
                            bowler = bowler_player.getPlayerName();
                        }

                        Bowler bowller = realm.where(Bowler.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                /*equalTo("team", fieldingTeamNo).*/
                                        equalTo("playerID", bowlerID).findFirst();

                        Log.d("BOWLER", "initializeVariables, fieldingTeamNo : " + fieldingTeamNo);
                        Log.d("BOWLER", "initializeVariables, bowller : " + bowller);

                        if (bowller != null) {

                            bwRun = bowller.getRuns();
                            bowlerBalls = bowller.getBalls();
                            bowlerOver = bowller.getOver();
                            bowlerWicket = bowller.getWicket();
                            bowlerDots = bowller.getDots();
                            bowlerF4s = bowller.getF4s();
                            bowlerS6s = bowller.getS6s();
                            bowlerNoBall = bowller.getNoBalls();
                            bowlerWide = bowller.getWides();
                            bowlerMO = bowller.getMaidenOver();
                        }
                    }

//                if (nextBowlerID != 0) {
//                    nextBowler = realm.where(Player.class).
//                            equalTo("matchid", matchid).
//                            equalTo("team", fieldingTeamNo).
//                            equalTo("playerID", nextBowlerID).findFirst().getPlayerName();
//
//                    preBowler = "";
//                }

                    if (preBowlerID != 0) {
                    /*preBowler = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", fieldingTeamNo).
                            equalTo("playerID", preBowlerID).findFirst().getPlayerName();*/

                        Player pre_bowler_player = realm.where(Player.class).
                                equalTo("matchid", matchid).
                                /* equalTo("team", fieldingTeamNo).*/
                                        equalTo("playerID", preBowlerID).findFirst();

                        if (pre_bowler_player != null) {
                            Log.d("BOWLER", "initializeVariables, pre_bowler_player : " + pre_bowler_player);
                            preBowler = pre_bowler_player.getPlayerName();
                        } else
                            Log.d("BOWLER", "initializeVariables, pre_bowler_player = null");

                        Bowler bowller = realm.where(Bowler.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                /* equalTo("team", fieldingTeamNo).*/
                                        equalTo("playerID", preBowlerID).findFirst();

                        if (bowller != null) {
                            preBowlerRun = bowller.getRuns();
                            preBowlerBalls = bowller.getBalls();
                            preBowlerOver = bowller.getOver();
                            preBowlerWicket = bowller.getWicket();
                            preBowlerMO = bowller.getMaidenOver();
                        }
                    }

                    battingTeamNo = events.getBattingTeamNo();
                    fieldingTeamNo = events.getFieldingTeamNo();
                    modified = events.getCurrentOver();
                    udisplay = events.getUndoDisplay();


                    maiden = events.isMaidenOver();
                    mo = events.getMo();

                    if (battingTeamNo == 1) {
                        battingTeam = teamA;
                        fieldingTeam = teamB;
                    } else if (battingTeamNo == 2) {
                        battingTeam = teamB;
                        fieldingTeam = teamA;
                    }

                    Batsman batsman = realm.where(Batsman.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", battingTeamNo).
                            equalTo("batsman_pID", player1ID).findFirst();

//                    Log.e("Scoring", "initializeVariables, player1Runs : " + batsman);

                    if (batsman.getRuns() == 0)
                        player1Runs = 0;
                    else
                        player1Runs = batsman.getRuns();
                    if (batsman.getBalls() == 0)
                        player1Balls = 0;
                    else
                        player1Balls = batsman.getBalls();
                    if (batsman.getDots() == 0)
                        player1Dots = 0;
                    else
                        player1Dots = batsman.getDots();
                    if (batsman.getF4s() == 0)
                        player1F4s = 0;
                    else
                        player1F4s = batsman.getF4s();
                    if (batsman.getS6s() == 0)
                        player1S6s = 0;
                    else
                        player1S6s = batsman.getS6s();

//                    RealmResults<Batsman> b_r = realm.where(Batsman.class).
//                            equalTo("matchid", matchid).
//                            equalTo("innings", currentInnings).
//                            equalTo("team", battingTeamNo).findAll();
//
//                    for (Batsman b : b_r) {
//
////                        Log.e("Scroing", "batsman : " + b + "\n\n");
//                    }

                    batsman = realm.where(Batsman.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", battingTeamNo).
                            equalTo("batsman_pID", player2ID).findFirst();

//                    Log.e("Scoring", "initializeVariables, player2Runs Run : " + batsman);

                    if (batsman.getRuns() == 0)
                        player2Runs = 0;
                    else
                        player2Runs = batsman.getRuns();
                    if (batsman.getBalls() == 0)
                        player2Balls = 0;
                    else
                        player2Balls = batsman.getBalls();
                    if (batsman.getDots() == 0)
                        player2Dots = 0;
                    else
                        player2Dots = batsman.getDots();
                    if (batsman.getF4s() == 0)
                        player2F4s = 0;
                    else
                        player2F4s = batsman.getF4s();
                    if (batsman.getS6s() == 0)
                        player2S6s = 0;
                    else
                        player2S6s = batsman.getS6s();


                    if (strID == player1ID) {

                        striker = player1;
                        strikerRuns = player1Runs;
                        strikerBalls = player1Balls;
                        strikerDots = player1Dots;
                        strikerF4s = player1F4s;
                        strikerS6s = player1S6s;
                        nonStriker = player2;
                        nonStrikerRuns = player2Runs;
                        nonStrikerBalls = player2Balls;
                        nonStrikerDots = player2Dots;
                        nonStrikerF4s = player2F4s;
                        nonStrikerS6s = player2S6s;
                        player1Selected.setVisibility(View.VISIBLE);
                        player2Selected.setVisibility(View.GONE);

                    } else if (nstrID == player1ID) {

                        striker = player2;
                        strikerRuns = player2Runs;
                        strikerBalls = player2Balls;
                        strikerDots = player2Dots;
                        strikerF4s = player2F4s;
                        strikerS6s = player2S6s;
                        nonStriker = player1;
                        nonStrikerRuns = player1Runs;
                        nonStrikerBalls = player1Balls;
                        nonStrikerDots = player1Dots;
                        nonStrikerF4s = player1F4s;
                        nonStrikerS6s = player1S6s;
                        player1Selected.setVisibility(View.GONE);
                        player2Selected.setVisibility(View.VISIBLE);
                    }


                    lastRun = events.getCurrentRun();
                    if (lastRun == 3 || lastRun == 1)
                        swap();

                    ExtraCard extraCard = realm.where(ExtraCard.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).findFirst();
                    if (extraCard != null)
                        totalExtras = extraCard.getByes() +
                                extraCard.getLb() +
                                extraCard.getWide() +
                                extraCard.getNoBall() +
                                extraCard.getPenalty();

                    else
                        totalExtras = 0;

                    RealmResults<FOW> f_results = realm.where(FOW.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).findAll();

                    dismissedList.clear();

                    for (FOW fow : f_results) {
                        dismissedList.add(fow.getDismissedPlayerID());
                    }

                    retiredList.clear();

                    RealmResults<Batsman> r_result = realm.where(Batsman.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", battingTeamNo).
                            equalTo("retired", true).findAll();

                    for (Batsman bats : r_result) {

                        retiredList.add(bats.getBatsman_pID());
                    }

                    if (currentInnings == 1 || currentInnings == 99)
                        ll_remainings.setVisibility(View.GONE);

                    else {
                        ll_remainings.setVisibility(View.VISIBLE);

                        /*if (remainingRuns == 0 && innings.matches("multi")) {

                            if(currentInnings == 2) {

                                int fi = realm.where(Events.class).
                                        equalTo("matchid", matchid).
                                        equalTo("innings", 1).findAll().last().getTotalRuns();

                                leadingRuns = events.getTotalRuns() - fi;

                            }

                            else if (currentInnings == 3) {


                                int fi = realm.where(Events.class).
                                        equalTo("matchid", matchid).
                                        equalTo("innings", 1).findAll().last().getTotalRuns();

                                int si = realm.where(Events.class).
                                        equalTo("matchid", matchid).
                                        equalTo("innings", 2).findAll().last().getTotalRuns();

                                leadingRuns = (fi + events.getTotalRuns()) - si;

                            }
                        }*/
                    }

                    Log.e("Scoring", "initializeVariables, resume, remainingRuns : " + remainingRuns);
                    Log.e("Scoring", "initializeVariables, resume, leadingRuns : " + leadingRuns);


                    if (innings.matches("multi") || totalOver == 1000) {

                        tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                        tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                    } else {
                        tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                        tvRemainingOversBalls.setVisibility(View.VISIBLE);

                        if (/*leadingRuns > 0 ||*/ remainingRuns == 0) {
                            tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                            tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                        } else if (remainingRuns > 0) {
                            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                            tvRemainingOversBalls.setVisibility(View.VISIBLE);
                        }
                    }

                    if (ball >= ballsPerOver) {
                        endOfOver = true;
                        callEndOfOverAlert();
                    }

                    if (events.getBallType() == 10 || events.getBallType() == 9) {
                        callEndOfInnings(0);
                    }


                } else {
                    if (!realm.isInTransaction()) {
                        realm.beginTransaction();
                    }

                    events.deleteFromRealm();
                    realm.commitTransaction();

                    // calling initialization again
                    initializeVariables();

                }
            } else {

                Log.e("scoring", "Event is null");
            }
            setDisplay(false);
        } else if (status.matches("start")) {

            Log.d("Scoring", "initialize, status start, player_count : " + player_count);

            if (initialize) {

                initialize = false;

                player1Runs = 0;
                player2Runs = 0;
                player1Balls = 0;
                player2Balls = 0;
                player1Dots = 0;
                player2Dots = 0;
                player1F4s = 0;
                player2F4s = 0;
                player1S6s = 0;
                player2S6s = 0;

                strikerRuns = 0;
                strikerBalls = 0;
                strikerDots = 0;
                strikerF4s = 0;
                strikerS6s = 0;
                nonStrikerRuns = 0;
                nonStrikerBalls = 0;
                nonStrikerDots = 0;
                nonStrikerF4s = 0;
                nonStrikerS6s = 0;

                hashScore = 0;
                ball = 0;
                currentOver = 0f;
                totalBalls = 0;
                builderText = 0;
                totalExtras = 0;

                initializeBowler();

                preBowlerRun = 0;
                preBowlerBalls = 0;
                preBowlerOver = 0;
                preBowlerMO = 0;
                preBowlerWicket = 0;
                modified = "";
                udisplay = "";

                psRuns = 0;
                psBalls = 0;
                psOver = 0;
                p1CR = 0;
                p1CB = 0;
                p2CB = 0;
                p2CR = 0;
                ballType = 15;

                reduced_overs = 0f;

                // commented on 05/05/2020
                /*if (currentInnings == 1)
                    sessionID = 12;
                else {
                    sessionID = realm.where(Match.class).equalTo("matchid", matchid).findFirst().getStatusId();
                    sessionType = realm.where(Match.class).equalTo("matchid", matchid).findFirst().getStatus();
                }*/
//                sessionType =


                Log.d("scoring", "initializeVariables, currentInnings : " + currentInnings);

                if (currentInnings == 1 || currentInnings == 99) {

                    remainingRuns = 0;
                    remainingBalls = 0;
                    leadingRuns = 0;
//                    totalRuns = 0;
                    currentRuns = 0;
                    strikerRuns = 0;
                    strikerBalls = 0;
                    strikerF4s = 0;
                    strikerS6s = 0;
                    nonStrikerF4s = 0;
                    nonStrikerS6s = 0;
                    nonStrikerRuns = 0;
                    nonStrikerBalls = 0;

                    ll_remainings.setVisibility(View.GONE);

                    syncPartnership(wicket + 1, false, 0, false, false);

                    newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball, 0,
                            preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                            innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                            fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                            nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                            bowlerBalls, bowlerWicket, preBowlerID, preBowlerRun, preBowlerOver,
                            preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                            -1, 0, -1, 0, null,
                            0, 0, 0, 0, false,
                            0, null, -1, 0, false,
                            modified, udisplay, tco, tbo, tpbo, -1, sessionType, sessionID,
                            false,/* jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                            so_inninngs1Runs, so_inninngs2Runs, false, false,
                            false, inning_started, 0, 0,
                            0, null, pre_out, callBowlerAlert, wk_id,
                            keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                            forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);

                    if (innings.matches("single")) {

                        if (sessionID == 6) {
                            sessionID = 12;
                            sessionType = "SS1";
                        } else if (sessionID == 7) {
                            sessionID = 8;
                            sessionType = "SS2";
                        } else if (sessionID == 9) {
                            sessionID = 10;
                            sessionType = "SS3";
                        }
                    } else {

                        if (currentInnings == 1) {
                            if (sessionID == 6) {
                                sessionID = 12;
                                sessionType = "SS1";
                            }
                        }
                    }

                    Log.d("session", " runOnce 1, sessionType : " + sessionType);
                    Log.d("session", " runOnce 1, sessionID : " + sessionID);

                    // Added on 28/04/2021
                    lunch_flag = 0;
                    tea_flag = 0;
                    dinner_flag = 0;
                    // === till here
                    setMatchStatus(sessionType, sessionID);
                } else {

                    setSessionFlags();  // Added on 28/04/2021

                    if (SUPER_OVER) {

                        if (currentInnings == 100) {

                           /* RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 99).
                                    equalTo("forTeam", fieldingTeamNo).findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        remainingRuns = remainingRuns - penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }*/

//                            Events events = realm.where(Events.class).
//                                    equalTo("matchid", matchid).
//                                    equalTo("innings", 99).findAll().last();
//                            if (events.getSuper_over_innings1runs() > 0) {
//                                remainingRuns = events.getSuper_over_innings1runs();
//                                preInningsRuns = remainingRuns;
//                            }
//                            else
//                                if (events.getPreInningsRuns() > 0) {
//                                    remainingRuns = events.getPreInningsRuns();
//                                    preInningsRuns = remainingRuns;
//                            }

                            Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
                            so_inninngs1Runs = match.getSuper_over_innings1runs();
                            remainingRuns = so_inninngs1Runs;
                            preInningsRuns = remainingRuns;
                            if (remainingRuns > 0)
                                leadingRuns = remainingRuns * (-1);
                            ++remainingRuns;
                            remainingOver = totalOver;
                            remainingBalls = ballsPerOver;
                            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                            tvRemainingOversBalls.setVisibility(View.VISIBLE);
                            tvRemainingOversBallsText.setText(", Balls : ");
                            Log.e("Scoring", "initializaVariable, remainingBalls : " + remainingBalls);
                            tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                            ballType = 15;      // innings started
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 100, remainingRuns : " + remainingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 100, remainingOver : " + remainingOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 100, remainingBalls : " + remainingBalls);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 100, leadingRuns : " + leadingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 100, totalOver : " + totalOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 100, ballsPerOver : " + ballsPerOver);
                            Log.d("so_inninngs1Runs", "initializeVariables2 , : " + so_inninngs1Runs);
                            Log.d("sessionID", "sessionID 2 , : " + sessionID);

                            // moved here on 31/07/2020
                            RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 99).
                                    equalTo("forTeam", fieldingTeamNo).findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        remainingRuns = remainingRuns - penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }   //============= till here

                            syncPartnership(wicket + 1, false, 0, false, false);

                            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket,
                                    ball, 0, preInningsRuns, remainingRuns, remainingBalls, remainingOver,
                                    leadingRuns, innings1Runs, innings2Runs, innings3Runs, innings4Runs,
                                    battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID, strikerRuns,
                                    strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID,
                                    bwRun, bowlerOver, bowlerBalls, bowlerWicket, preBowlerID, preBowlerRun,
                                    preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0,
                                    ballType, -1, 0, -1, 0,
                                    null, 0, 0, 0, 0,
                                    false, 0, null, -1, 0,
                                    false, modified, udisplay, tco, tbo, tpbo, -1,
                                    sessionType, sessionID, false,/* jsonEventArray, jsonUndoArray,*/
                                    endOfDay, SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, false,
                                    false, false, inning_started, 0,
                                    0, 0, null, pre_out, callBowlerAlert,
                                    wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                    forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                    tea_flag, dinner_flag);

                            // added on 05/05/2020
                            // need to cross check again due to SUPER_OVER
                            if (innings.matches("single")) {

                                if (sessionID == 6) {
                                    sessionID = 12;
                                    sessionType = "SS1";
                                } else if (sessionID == 7) {
                                    sessionID = 8;
                                    sessionType = "SS2";
                                } else if (sessionID == 9) {
                                    sessionID = 10;
                                    sessionType = "SS3";
                                }

                            } else {

                                if (currentInnings == 1) {

                                    if (sessionID == 6) {
                                        sessionID = 12;
                                        sessionType = "SS1";
                                    }
                                }
                            }

                            Log.d("session", " runOnce 1, sessionType : " + sessionType);
                            Log.d("session", " runOnce 1, sessionID : " + sessionID);
                            setMatchStatus(sessionType, sessionID);

                            updateMatch(matchid, false);
                        }
                    } else {
                        if (currentInnings == 4) {

                            /*RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 3).
                                    equalTo("forTeam", fieldingTeamNo).findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }*/


                            Events lastEvent = realm.where(Events.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 3).findAll().last();
                            remainingRuns = lastEvent.getLeadingRuns();
                            leadingRuns = remainingRuns * (-1);

                            innings3Runs = lastEvent.getInnings3Runs();
                            innings2Runs = lastEvent.getInnings2Runs();
                            innings1Runs = lastEvent.getInnings1Runs();


                            if (innings.matches("multi") && totalOver == 1000) {
                                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                                tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                            } else {
                                tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                tvRemainingOversBalls.setVisibility(View.VISIBLE);
                            }

                            remainingOver = totalOver;
//                            remainingBalls = totalOver * ballsPerOver;
                            int temp_tot = (int) totalOver;
                            float temp_diff = totalOver - temp_tot;
                            remainingBalls = (temp_tot * ballsPerOver) + (int) (temp_diff * 10);
                            ++remainingRuns;
//                        remainingRuns = temp + 1;

                            ballType = 15;      // innings started

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, remainingRuns : " + remainingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, remainingOver : " + remainingOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, remainingBalls : " + remainingBalls);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, leadingRuns : " + leadingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, totalOver : " + totalOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, ballsPerOver : " + ballsPerOver);
                            Log.d("so_inninngs1Runs", "initializeVariables3 , : " + so_inninngs1Runs);
                            Log.d("sessionID", "sessionID 3 , : " + sessionID);

                            // added here on 31/07/2020
                            RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 3).
                                    equalTo("forTeam", fieldingTeamNo).findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 4, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        remainingRuns = remainingRuns - penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }//======= till here

                            syncPartnership(wicket + 1, false, 0, false, false);

                            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                                    0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                    innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                    fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                    nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                    bowlerBalls, bowlerWicket, preBowlerID, preBowlerRun, preBowlerOver,
                                    preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                                    -1, 0, -1, 0, null,
                                    0, 0, 0, 0, false,
                                    0, null, -1, 0, false,
                                    modified, udisplay, tco, tbo, tpbo, -1, sessionType, sessionID,
                                    false, /*jsonEventArray, jsonUndoArray, */endOfDay, SUPER_OVER,
                                    so_inninngs1Runs, so_inninngs2Runs, false, false,
                                    false, inning_started, 0, 0,
                                    0, null, pre_out, callBowlerAlert, wk_id,
                                    keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                    forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                    tea_flag, dinner_flag);

                            // set session for multi innings
                            /*if (innings.matches("single")) {

                                if (sessionID == 6) {
                                    sessionID = 12;
                                    sessionType = "SS1";
                                } else if (sessionID == 7) {
                                    sessionID = 8;
                                    sessionType = "SS2";
                                } else if (sessionID == 9) {
                                    sessionID = 10;
                                    sessionType = "SS3";
                                }

                            }

                            else {

                                if (currentInnings == 1) {

                                    if (sessionID == 6) {
                                        sessionID = 12;
                                        sessionType = "SS1";
                                    }
                                }
                            }

                            Log.d("session", " runOnce 1, sessionType : " + sessionType);
                            Log.d("session", " runOnce 1, sessionID : " + sessionID);
                            setMatchStatus(sessionType, sessionID);*/

                            updateMatch(matchid, false);


                        } else if (currentInnings == 3) {


                            /*RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 2).
                                    equalTo("forTeam", fieldingTeamNo).findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }*/

                            int fi = realm.where(Events.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 1).findAll().last().getTotalRuns();

                            innings1Runs = realm.where(Events.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 1).findAll().last().getInnings1Runs();

                            Events lievnt = realm.where(Events.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 2).findAll().last();
                            innings2Runs = lievnt.getInnings2Runs();

//                        if (lievnt.getLeadingRuns() > 0 && lievnt.getRemainingRuns() <= 0) {
                            if (!followon) {
                                remainingRuns = lievnt.getLeadingRuns();
                                leadingRuns = remainingRuns * (-1);
                            } else {
                                remainingRuns = lievnt.getRemainingRuns();
                                leadingRuns = lievnt.getLeadingRuns();
                            }
//                        }

                       /* else if (lievnt.getRemainingRuns() > 0 && lievnt.getLeadingRuns() == 0) {

                            leadingRuns = lievnt.getRemainingRuns();
                            remainingRuns = 0;
                            tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                            tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                        }*/

                            if (innings.matches("multi") && totalOver == 1000) {

                                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                                tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                            } else {

                                tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                tvRemainingOversBalls.setVisibility(View.VISIBLE);
                            }

                            remainingOver = totalOver;
//                            remainingBalls = totalOver * ballsPerOver;
                            int temp_tot = (int) totalOver;
                            float temp_diff = totalOver - temp_tot;
                            remainingBalls = (temp_tot * ballsPerOver) + (int) (temp_diff * 10);

                            if ((leadingRuns > 0 || remainingRuns < 0) && (totalInnings == 4 || totalInnings == 100)) {
                                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                                tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                            } else {
                                tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                tvRemainingOversBalls.setVisibility(View.VISIBLE);
                            }

                            ballType = 15;      // innings started

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, remainingRuns : " + remainingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, remainingOver : " + remainingOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, remainingBalls : " + remainingBalls);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, leadingRuns : " + leadingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, totalOver : " + totalOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, ballsPerOver : " + ballsPerOver);
                            Log.d("so_inninngs1Runs", "initializeVariables4 , : " + so_inninngs1Runs);

                            Log.d("sessionID", "sessionID4 , : " + sessionID);

                            // moved here on 31/07/2020
                            RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 2).
                                    equalTo("forTeam", fieldingTeamNo).findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 3, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        remainingRuns = remainingRuns - penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }   // ======= till here

                            syncPartnership(wicket + 1, false, 0, false, false);

                            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                                    0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                    innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                    fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                    nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                    bowlerBalls, bowlerWicket, preBowlerID, preBowlerRun, preBowlerOver,
                                    preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                                    -1, 0, -1, 0, null,
                                    0, 0, 0, 0, false,
                                    0, null, -1, 0, false,
                                    modified, udisplay, tco, tbo, tpbo, -1, sessionType, sessionID,
                                    false,/* jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                                    so_inninngs1Runs, so_inninngs2Runs, false, false,
                                    false, inning_started, 0, 0,
                                    0, null, pre_out, callBowlerAlert, wk_id,
                                    keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                    forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                    tea_flag, dinner_flag);

                            // set session

                            updateMatch(matchid, false);

                        } else if (currentInnings == 2) {


                           /* RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    *//*equalTo("innings", 1).
                                    equalTo("forTeam", fieldingTeamNo).*//*findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }*/

//                            Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
//                        preInningsRuns = match.getInnings1Runs();

                            remainingRuns = realm.where(Events.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", 1).findAll().last().getTotalRuns();
//                            preInningsRuns = remainingRuns;
                            innings1Runs = remainingRuns;
                            if (remainingRuns > 0)
                                leadingRuns = remainingRuns * (-1);
                            remainingOver = totalOver;
//                            remainingBalls = totalOver * ballsPerOver;
                            int temp_tot = (int) totalOver;
                            float temp_diff = totalOver - temp_tot;
                            remainingBalls = (temp_tot * ballsPerOver) + (int) (temp_diff * 10);

                            if (innings.matches("multi") && totalOver == 1000) {
                                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                                tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                            } else {
                                tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                tvRemainingOversBalls.setVisibility(View.VISIBLE);
                            }


                            if (innings.matches("single") || totalInnings == 2)
                                ++remainingRuns;
                            else if (totalInnings == 4) {
                            /*++remainingRuns;
                            ++leadingRuns;*/
//                            if (/*remainingRuns <= 0 && */leadingRuns <= 0)
                                leadingRuns = remainingRuns * (-1);
                            }

                            ballType = 15;      // innings started
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, remainingRuns : " + remainingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, remainingOver : " + remainingOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, remainingBalls : " + remainingBalls);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, leadingRuns : " + leadingRuns);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, totalOver : " + totalOver);
                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, ballsPerOver : " + ballsPerOver);
                            Log.d("so_inninngs1Runs", "initializeVariables5 , : " + so_inninngs1Runs);
                            Log.d("sessionID", "sessionID 5 , : " + sessionID);

                            // moved here on 31/07/2020
                            RealmResults<Penalty> results = realm.where(Penalty.class).
                                    equalTo("matchid", matchid).
                                    /*equalTo("innings", 1).
                                    equalTo("forTeam", fieldingTeamNo).*/findAll();

                            Log.e("Scoring",
                                    "initializeVariables, start, innings = 2, penalty : " + results);

                            if (results.isLoaded()) {

                                for (Penalty penalty : results) {

                                    if (!penalty.isSync()) {

                                        currentRuns = currentRuns + penaltyRun;
                                        remainingRuns = remainingRuns - penaltyRun;
                                        psRuns = psRuns + penaltyRun;
                                        syncPenalty(penalty.getId(), true);
                                    }
                                }
                            }   //  ===== till here
                            syncPartnership(wicket + 1, false, 0, false, false);

                            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                                    0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                    innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                    fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                    nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                    bowlerBalls, bowlerWicket, preBowlerID, preBowlerRun, preBowlerOver,
                                    preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                                    -1, 0, -1, 0, null,
                                    0, 0, 0, 0, false,
                                    0, null, -1, 0, false,
                                    modified, udisplay, tco, tbo, tpbo, -1, sessionType, sessionID,
                                    false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                                    so_inninngs1Runs, so_inninngs2Runs, false, false,
                                    false, inning_started, 0, 0,
                                    0, null, pre_out, callBowlerAlert, wk_id,
                                    keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                    forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                    tea_flag, dinner_flag);

                            if (innings.matches("single")) {

                                if (sessionID == 6) {
                                    sessionID = 12;
                                    sessionType = "SS1";
                                } else if (sessionID == 7) {
                                    sessionID = 8;
                                    sessionType = "SS2";
                                } else if (sessionID == 9) {
                                    sessionID = 10;
                                    sessionType = "SS3";
                                }

                            } else {

                                if (currentInnings == 1) {

                                    if (sessionID == 6) {
                                        sessionID = 12;
                                        sessionType = "SS1";
                                    }
                                }
                            }

                            Log.d("session", " runOnce 1, sessionType : " + sessionType);
                            Log.d("session", " runOnce 1, sessionID : " + sessionID);
                            setMatchStatus(sessionType, sessionID);

                            updateMatch(matchid, false);

                        }


                        if (currentInnings == 1 || currentInnings == 99)
                            ll_remainings.setVisibility(View.GONE);

                        else {
                            ll_remainings.setVisibility(View.VISIBLE);
                            tvRemainingRuns.setVisibility(View.VISIBLE);

                            if (remainingRuns > 0)
                                tvRemainingRuns.setText(String.valueOf(remainingRuns));
//                        else if (leadingRuns > 0 && totalInnings == 4) {
                            if (leadingRuns > remainingRuns && totalInnings == 4) {
                                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                                tvRemainingRunsText.setText("Leading Runs : ");
                            }

                            if (innings.matches("multi") && totalOver == 1000) {
                                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                                tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                            } else {
                                tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                tvRemainingOversBalls.setVisibility(View.VISIBLE);
                            }

                            if (totalOver != 1000 || !matchtype.matches("Test")) {

                                if (remainingBalls >= 100) {
                                    tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                    tvRemainingOversBallsText.setText(", Overs : ");
                                    tvRemainingOversBalls.setVisibility(View.VISIBLE);
                                    tvRemainingOversBalls.setText(String.valueOf(remainingOver));
                                } else {
                                    tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                    tvRemainingOversBallsText.setText(", Balls : ");
                                    tvRemainingOversBalls.setVisibility(View.VISIBLE);
                                    Log.e("Scoring", "initializaVariable, remainingBalls : " + remainingBalls);
                                    tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                                }
                            }

                            Log.e("Scoring", "initializeVariables, start, leadingRuns : " + leadingRuns);
                            Log.e("Scoring", "initializeVariables, start, remainingRuns : " + remainingRuns);
                            Log.e("Scoring", "initializeVariables, start, remainingBalls : " + remainingBalls);
                            Log.e("Scoring", "initializeVariables, start, remainingOver : " + remainingOver);
                            Log.e("Scoring", "initializeVariables, start, totalOver : " + totalOver);
                            Log.e("Scoring", "initializeVariables, start, ballsPerOver : " + ballsPerOver);

                            if (innings.matches("single") || currentInnings == 4 || currentInnings == 100) {
                                tvRemainingRunsText.setText("Remaining Runs : ");
                            } else {
                                if (remainingRuns > 0) {
                                    if (currentInnings == 4)
                                        tvRemainingRunsText.setText("Remaining Runs : ");
                                    else
                                        tvRemainingRunsText.setText("Trial Runs : ");
                                } else {
                                    tvRemainingRunsText.setText("Lead Runs : ");
                                }
                            }
                        }

                    }
                }
            }
            setDisplay(true);
        }

        intervalList = new ArrayList<String>();
        sessionList = new ArrayList<String>();
        fieldersList = new ArrayList<String>();

        Log.e("Scoring", "initializeVariable, end & b4 setDisplay, status : " + status);
        Log.e("Scoring", "initializeVariables, end & b4 setDisplay, remainingRuns : " + remainingRuns);
        Log.e("Scoring", "initializeVariables, end & b4 setDisplay, remainingBalls : " + remainingBalls);
        Log.e("Scoring", "initializeVariables, end & b4 setDisplay, remainingOver : " + remainingOver);


    }


    void syncPenalty(int pid, boolean sync) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {

                    try {

                        Penalty penalty = bgRealm.where(Penalty.class).
                                equalTo("matchid", matchid).
                                equalTo("id", pid).findFirst();

                        if (penalty != null) {
                            penalty.setSync(sync);
                            bgRealm.copyToRealm(penalty);
                        }


//                        setExtraCard();

                        ExtraCard extraCard = bgRealm.where(ExtraCard.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).findFirst();

                        Log.d("Scoring", "setExtraCard, ExtraCard : " + extraCard);

                        if (extraCard == null) {

                            extraCard = new ExtraCard();
                            extraCard.setInnings(currentInnings);
                            extraCard.setMatchid(matchid);
                            extraCard.setMatchID(matchID);
                            extraCard.setTeam(battingTeamNo);
                        }
                        ecPenlaty = extraCard.getPenalty();
                        Log.d("scoring", "b4 p ; " + ecPenlaty);
//                        if (penaltyType == 1)
                        ++ecPenlaty;
                        Log.d("scoring", " p ; " + ecPenlaty);
                        extraCard.setPenalty(ecPenlaty);
                        bgRealm.insertOrUpdate(extraCard);

//                        remainingRuns = remainingRuns - penaltyRun;

                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


    void initializeBowler() {

        bowlerOver = 0;
        bowlerBalls = 0;
        bwRun = 0;
        bowlerMO = 0;
        bowlerWicket = 0;
        bowlerDots = 0;
        bowlerF4s = 0;
        bowlerS6s = 0;
        bowlerWide = 0;
        bowlerNoBall = 0;
        tvBowlerMO.setText(String.valueOf(bowlerMO));
        tvBowlerRuns.setText(String.valueOf(bwRun));
        tvBowlerOver.setText(String.valueOf(bowlerOver));
        tvBowlerWicket.setText(String.valueOf(bowlerWicket));
    }



    /*private void setInningsRuns(int innings, Events events) {

        if (innings == 1) {
            innings1Runs = events.getTotalRuns();
            innings2Runs = 0;
            innings3Runs = 0;
            innings4Runs = 0;
        }

        else
        if (innings == 2) {
            innings1Runs = events.getInnings1Runs();
            innings2Runs = events.getTotalRuns();
            innings3Runs = 0;
            innings4Runs = 0;
        }

        else
        if (innings == 3) {
            innings1Runs = events.getInnings1Runs();
            innings2Runs = events.getInnings2Runs();
            innings3Runs = events.getTotalRuns();
            innings4Runs = 0;
        }

        else
        if (innings == 4) {
            innings1Runs = events.getInnings1Runs();
            innings2Runs = events.getInnings2Runs();
            innings3Runs = events.getInnings3Runs();
            innings4Runs = events.getTotalRuns();
        }
    }*/


    private void setInningsRuns(int innings, int totalRuns) {

        if (innings == 1) {
            preInningsRuns = totalRuns;
            innings1Runs = totalRuns;
            innings2Runs = 0;
            innings3Runs = 0;
            innings4Runs = 0;
            so_inninngs1Runs = 0;
            so_inninngs2Runs = 0;
        } else if (innings == 2) {
            innings2Runs = totalRuns;
            innings3Runs = 0;
            innings4Runs = 0;
            so_inninngs1Runs = 0;
            so_inninngs2Runs = 0;
        } else if (innings == 3) {
            innings3Runs = totalRuns;
            innings4Runs = 0;
            so_inninngs1Runs = 0;
            so_inninngs2Runs = 0;
        } else if (innings == 4) {
            innings4Runs = totalRuns;
            so_inninngs1Runs = 0;
            so_inninngs2Runs = 0;
        } else if (innings == 99) {
            preInningsRuns = totalRuns;
            so_inninngs1Runs = totalRuns;
            so_inninngs2Runs = 0;
        } else if (innings == 100) {
            so_inninngs2Runs = totalRuns;
        }

        Log.d("so_inninngs1Runs", "setInningsRuns6 : " + so_inninngs1Runs);
    }


    // set the values to display

    void setDisplay(boolean first) {
        Log.d("setDisplay", "method called");

        tvTeamA.setText(teamA);
        tvTeamB.setText(teamB);

        if (SUPER_OVER) {
            checkMatchType("SUPER OVER");
        } else
            checkMatchType(matchtype);  // to check and set the match type

        tvTotalRuns.setText(String.valueOf(currentRuns));
        tvTotalWicket.setText(String.valueOf(wicket));
        tvPlayingOver.setText(String.valueOf(new DecimalFormat("##.#").format(currentOver)));

        if (currentInnings == 1)
            tvPlayingInnings.setText("1st innings");

        else if (currentInnings == 2)
            tvPlayingInnings.setText("2nd innings");

        else if (currentInnings == 3)
            tvPlayingInnings.setText("3rd innings");

        else if (currentInnings == 4)
            tvPlayingInnings.setText("4th innings");

        else if (currentInnings == 99)
            tvPlayingInnings.setText("SUPER OVER 1st innings");

        else if (currentInnings == 100)
            tvPlayingInnings.setText("SUPER OVER 2nd innings");

        Log.d("Scoring", "setDisplay, currentInnings : " + currentInnings);
        Log.d("Scoring", "setDisplay, leadingRuns : " + leadingRuns);
        Log.d("Scoring", "setDisplay, remainingRuns : " + remainingRuns);
        Log.d("Scoring", "setDisplay, remainingBalls, 1 : " + remainingBalls);
        Log.d("Scoring", "setDisplay, remainingOver : " + remainingOver);
        Log.d("Scoring", "setDisplay, first : " + first);


        if (currentInnings == 1 || currentInnings == 99)
            ll_remainings.setVisibility(View.GONE);

        else {
            ll_remainings.setVisibility(View.VISIBLE);

            if (innings.matches("single")) {
                tvRemainingRunsText.setText("Remaining Runs : ");
            } else if (innings.matches("multi")) {

                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                tvRemainingOversBalls.setVisibility(View.INVISIBLE);


                if (remainingRuns > 0 && leadingRuns <= 0) {

                    if (currentInnings == 4)
                        tvRemainingRunsText.setText("Remaining Runs : ");
                    else
                        tvRemainingRunsText.setText("Trial Runs : ");
//                    tvRemainingRuns.setText(String.valueOf(remainingRuns));
                } else if (innings.matches("multi") && leadingRuns > remainingRuns) {// && remainingRuns >= 0 && leadingRuns > 0) {
                    tvRemainingRunsText.setText("Leading Runs : ");
//                    if (remainingRuns < 0 && leadingRuns == 0)
//                        leadingRuns = leadingRuns - remainingRuns;
                }

            }


            if (remainingRuns > 0) {
                tvRemainingRuns.setText(String.valueOf(remainingRuns));
                /*if (first) {
                    if (remainingRuns <= 0 && leadingRuns <= 0)
                        leadingRuns = remainingRuns * (-1);
                }*/
            } else if (innings.matches("multi") && leadingRuns > remainingRuns) {

                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                tvRemainingRunsText.setText("Leading Runs : ");
            }


            Log.e("Scoring", "setDisplay, remainingBalls, 2 : " + remainingBalls);
            Log.e("Scoring", "setDisplay, leadingRuns, 2 : " + leadingRuns);

            if (remainingBalls > 100) {
                tvRemainingOversBallsText.setText(", Overs : ");
                tvRemainingOversBalls.setText(String.valueOf(new DecimalFormat("##.#").format(remainingOver)));
            } else {
                tvRemainingOversBallsText.setText(", Balls : ");
                Log.e("Scoring", "setDisplay, remainingBalls, 3 : " + remainingBalls);
                Log.e("Scoring", "setDisplay, leadingRuns, 3 : " + leadingRuns);
                tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
            }
        }


        if (innings.matches("multi") && totalOver == 1000) {
            tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
            tvRemainingOversBalls.setVisibility(View.INVISIBLE);
        } else if (innings.matches("single")) {
            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
            tvRemainingOversBalls.setVisibility(View.VISIBLE);
        }

        tvBattingTeam.setText(battingTeam);
        tvPlayer1.setText(player1);
        tvPlayer2.setText(player2);
        tvPlayer1Runs.setText(String.valueOf(player1Runs));
        tvPlayer2Runs.setText(String.valueOf(player2Runs));
        tvPlayer1Balls.setText(String.valueOf(player1Balls));
        tvPlayer2Balls.setText(String.valueOf(player2Balls));

        tvFieldingTeam.setText(fieldingTeam);
        tvBowler.setText(bowler);

        /*if (currentInnings != 99) {
            if (nextBowlerID != 0)
                tvBowler2.setText(nextBowler);
            else*/
        if (preBowlerID != 0)
            tvBowler2.setText(preBowler);
//        }

        tvBowlerOver.setText(String.valueOf(new
                DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
        tvBowlerMO.setText(String.valueOf(bowlerMO));
        tvBowlerRuns.setText(String.valueOf(bwRun));
        tvBowlerWicket.setText(String.valueOf(bowlerWicket));


        // for setting previous(& next) bowler details to display

        if (currentInnings != 99 && currentInnings != 100) {

            tvBowlerOver2.setText(String.valueOf(new
                    DecimalFormat("##.#").format(setOverDisplay(preBowlerOver, preBowlerBalls))));
            tvBowlerMO2.setText(String.valueOf(preBowlerMO));
            tvBowlerRuns2.setText(String.valueOf(preBowlerRun));
            tvBowlerWicket2.setText(String.valueOf(preBowlerWicket));


            /*if (currentInnings == 1 || currentInnings == 99)
                ll_remainings.setVisibility(View.GONE);

            else {

                if (innings.matches("multi") && totalOver == 1000) {
                    tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                    tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                }

                else {
                    tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                    tvRemainingOversBalls.setVisibility(View.VISIBLE);
                }

                ll_remainings.setVisibility(View.VISIBLE);

                if (tvRemainingOversBallsText.isShown()) {
                    if (remainingBalls > 100) {
                        tvRemainingOversBallsText.setText(", Overs : ");
                        tvRemainingOversBalls.setText(String.valueOf(new
                                DecimalFormat("##.#").format(remainingOver)));
                    }

                    else {
                        tvRemainingOversBallsText.setText(", Balls : ");
                        Log.e("Scoring", "initializaVariable, remainingBalls, 4 : "+remainingBalls);
                        tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                    }
                }

                if (innings.matches("single")){
                    tvRemainingRunsText.setText("Remaining Runs : ");
                    tvRemainingRuns.setText(String.valueOf(remainingRuns));
                }

                else {
                    if (remainingRuns > 0) {
                        tvRemainingRunsText.setText("Trial Runs : ");
                        tvRemainingRuns.setText(String.valueOf(remainingRuns));
                    }

                    else
                        tvRemainingRunsText.setText("Lead Runs : ");
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));

                    if (leadingRuns > 0 || remainingRuns == 0){
                        tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                        tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                        Log.d("Scoring", "setDisplay, remaining over/ball INVISIBLE");
                    }

                    else {
                        tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                        tvRemainingOversBalls.setVisibility(View.VISIBLE);
                        Log.d("Scoring", "setDisplay, remaining over/ball VISIBLE");
                    }
                }
            }*/
        }

        tvCurrentOver.setText(modified);
        Log.d("modified1", modified);
        Log.d("udisplay1", udisplay);

    }


    void checkMatchType(String matchtype) {
        String temp = "";

        if (matchtype != null) {

            Log.e("Scoring", "checkMatchType, matchtype : " + matchtype);

            if (matchtype.matches("Custom")) {

                temp = "" + totalOver + " overs";

                if (innings.matches("multi")) {//&& totalOver != 1000)
                    if (totalOver != 1000)
                        temp = temp + " Multi innings";
                    else
                        temp = "Multi innings";
                } else {

                    if (totalOver != 1000)
                        temp = temp + " Single innings";
                    else
                        temp = "Single innings";
                }


                /*if (totalOver < 1000)
                    matchtype.concat(String.valueOf(totalOver));

                if (innings.matches("single"))
                    matchtype.concat(" over single innings");

                else
                    matchtype.concat(" over multi innings");*/
            } else
                temp = matchtype;

            tvMatchType.setText(temp);

            Log.e("Scoring", "checkMatchType, totalOver : " + totalOver);
            Log.e("Scoring", "checkMatchType, matchtype : " + matchtype);

        }
    }


    void undo() {

        Log.d("undo", " method, currentOver : " + currentOver);
        int lo = 0;

        RealmResults<Events> results = realm.where(Events.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findAll();

        Events lastEvent = new Events();

        if (results.isEmpty()) {
            UNDO_LIMIT = true;
            inningsNotStarted = true;
        } else if (UNDO_LIMIT) {
            inningsNotStarted = true;
        } else {

            lastEvent = results.last();
            Log.d("lastEvent", "lastEvent, 1 : " + lastEvent);
            if (lastEvent.getBallType() == 15) {
                UNDO_LIMIT = true;
                inningsNotStarted = true;
            } else {

                UNDO_LIMIT = false;

                if (allOUT) {
                    allOUT = false;
                    endOfInnings = false;
                }

                if (endOfInnings)
                    endOfInnings = false;
            }
        }

        if (UNDO_LIMIT) {

            Log.d("Scoring", "undo, currentOver : " + currentOver);
            Log.d("Scoring", "undo, lastEvent : " + lastEvent);

            AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
            alertDialog.setIcon(R.drawable.ball);
            alertDialog.setCancelable(false);
            alertDialog.setTitle("Undo has reached limit");
            alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {
                            dialog.dismiss();
                            btnUndo.setEnabled(false);
                            initializeBowler();
                            syncBowler();
                            inningsNotStarted = true;

                            setExtraCard(/*UNDO_LIMIT*/);
                        }
                    });

            alertDialog.show();
        } else if (lastEvent != null && !UNDO_LIMIT) {

            lastEventID = lastEvent.getEventID();
            if (lastEvent.getSyncstatus() == 1)
                eventSync = true;
            else
                eventSync = false;
            uinngs = lastEvent.getInnings();
            undoLastEventID = lastEventID;


//           Log.d("Scoring", "undo, lastEventId : "+lastEventID);

//           Log.d("Scoring", "undo, uinngs : " + uinngs);

            lo = (int) lastEvent.getOvers();
            ubtype = lastEvent.getBallType();
            maiden = lastEvent.isMaidenOver();
            totalBalls = lastEvent.getBalls();
            currentOver = lastEvent.getOvers();
            remainingOver = lastEvent.getRemainingOvers();
            pre_out = lastEvent.isPre_out();
            // added on 06/05/2020
            resetRemainingOver();
            remainingRuns = lastEvent.getRemainingRuns();
            remainingBalls = lastEvent.getRemainingBalls();
            wk_id = lastEvent.getWkID();
            keeper_position = lastEvent.getWk_position();
            pre_wk_id = lastEvent.getPreWkID();
            pre_wk_position = lastEvent.getPreWk_position();
            Log.d("TEST", "undo, ubtype 1 = " + ubtype);
            Log.d("TEST", "undo, lastEvent 1 = " + lastEvent);
//           Log.d("Scoring", "undo, ubtype : " + ubtype);
//           Log.d("Scoring", "undo, lastEventID : " + lastEventID);

//           Toast.makeText(this, "Undo, ballType : " + ubtype, Toast.LENGTH_SHORT).show();


//           jsonUndoArray.put(lastEventID);
//           if (isNetworkAvailable())
//               postJSON(true);

            if (ubtype == 0) {
                Log.d("remainingOver", "ubtype = 0, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 0, 1 : " + remainingBalls);

//               setStrikerNonStriker(lastEvent);
//               setBowler(lastEvent);
                endOver = false;
                resetValues(lastEvent, ubtype);
                Log.d("remainingOver", "ubtype = 0, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 0, 2 : " + remainingBalls);
            }

            if (ubtype == 1) {
                Log.d("Scoring", "undo, ubtype : " + ubtype + ", events : " + lastEvent);

                Log.d("remainingOver", "ubtype = 1, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 1, 1 : " + remainingBalls);

                endOver = false;
                urun = lastEvent.getCurrentRun();

                setStrikerNonStriker(lastEvent);
                setBowler(lastEvent);

                ball = lastEvent.getCurrentOverBalls();
                --ball;

                currentRuns = lastEvent.getTotalRuns();
                currentRuns = currentRuns - urun;

                if (totalBalls > 0)
                    --totalBalls;
                else
                    totalBalls = 0;

//               bowlerOver = bowlerOver - 0.1f;
                if (currentOver >= 0.1f)
                    currentOver = currentOver - 0.1f;
                else
                    currentOver = 0f;

                if (currentInnings > 1 && currentInnings != 99) {

                  /* if (remainingRuns < 0) {
                       if (leadingRuns >= 0)
                           leadingRuns = leadingRuns - urun;

                       else if (leadingRuns < urun)
                           leadingRuns = urun - leadingRuns;
                   }

                   else// if (remainingRuns > 0)*/
                    remainingRuns = remainingRuns + urun;
                    leadingRuns = leadingRuns - urun;

                    ++remainingBalls;

                    remainingOver = remainingOver + 0.1f;
                    // added on 06/05/2020
                    resetRemainingOver();

                }

                if (strikerRuns >= urun)
                    strikerRuns = strikerRuns - urun;
                else
                    strikerRuns = 0;

                if (strikerBalls > 0)
                    --strikerBalls;
                else
                    strikerBalls = 0;

                // partnership details
                if (psRuns >= urun)
                    psRuns = psRuns - urun;
                else
                    psRuns = 0;

                if ((psBalls <= ballsPerOver) && (psBalls > 0))
                    --psBalls;
                else if (psBalls > ballsPerOver)
                    psBalls = psBalls - ballsPerOver;
                else if (psBalls == 0) {
                    psBalls = ballsPerOver - 1;
                    if (psOver > 0)
                        --psOver;
                    else
                        psOver = 0;
                }


                if (strID == ps1ID) {
                    if (p1CR >= urun)
                        p1CR = p1CR - urun;
                    else
                        p1CR = 0;
                    if (p1CB > 0)
                        --p1CB;
                    else
                        p1CB = 0;
                } else if (strID == ps2ID) {
                    if (p2CR >= urun)
                        p2CR = p2CR - urun;
                    else
                        p2CR = 0;
                    if (p2CB > 0)
                        --p2CB;
                    else
                        p2CB = 0;
                }

//               Log.d("undo", "ubtype : "+ubtype+", psRuns : "+psRuns + ", psBalls : " + psBalls
//                       + ", psOver : " + psOver + ", ballsPerOver : "+ ballsPerOver);
//               Log.d("undo", "strID : "+strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype);
//               Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : "+ p1CB);
//
//               Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : "+ p2CB);
//
                if (bwRun >= urun)
                    bwRun = bwRun - urun;
                else
                    bwRun = 0;
                // adding 04/05/2020
                if (mo >= urun)
                    mo = mo - urun;
                else
                    mo = 0;

                if (urun == 0) {

                    if (strikerDots > 0)
                        --strikerDots;
                    else
                        strikerDots = 0;

                    if (bowlerDots > 0)
                        --bowlerDots;
                    else
                        bowlerDots = 0;
                }

               /*// updated & commented on 06/05/2020
               if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                   --bowlerBalls;
               else if (bowlerBalls > ballsPerOver)
                   bowlerBalls = bowlerBalls - ballsPerOver;
               else if (bowlerBalls == 0) {
                   if (bowlerOver >= 1) {
                       bowlerBalls = ballsPerOver;
                       --bowlerOver;
                   }
                   else {
                       bowlerOver = 0;
                   }
               }*/

                // added on 06/05/2020
                undoBowlerOver();

                modified = lastEvent.getUndoDisplay();

                resetValues(lastEvent, ubtype);
                Log.d("remainingOver", "ubtype = 1, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 1, 2 : " + remainingBalls);
            } else if (ubtype == 2) {

                Log.d("Scoring", "undo 1, ubtype : " + ubtype + ", events : " + lastEvent);
                Log.d("remainingOver", "ubtype = 2, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 2, 1 : " + remainingBalls);

                endOver = false;
                urun = lastEvent.getCurrentRun();

                setStrikerNonStriker(lastEvent);
                setBowler(lastEvent);

                ball = lastEvent.getCurrentOverBalls();
                --ball;

                if (currentRuns > 0)
                    currentRuns = currentRuns - urun;
                else
                    currentRuns = 0;

                if (totalBalls > 0)
                    --totalBalls;
                else
                    totalBalls = 0;

                if (strikerRuns >= urun)
                    strikerRuns = strikerRuns - urun;
                else
                    strikerRuns = 0;

                if (strikerBalls > 0)
                    --strikerBalls;
                else
                    strikerBalls = 0;

                if (urun == 4) {

                    if (strikerF4s > 0)
                        --strikerF4s;
                    else
                        strikerF4s = 0;

                    if (bowlerF4s > 0)
                        --bowlerF4s;
                    else
                        bowlerF4s = 0;

                } else if (urun == 6) {

                    if (strikerS6s > 0)
                        --strikerS6s;
                    else
                        strikerS6s = 0;

                    if (bowlerS6s > 0)
                        --bowlerS6s;
                    else
                        bowlerS6s = 0;
                }


                // partnership details
                if (psRuns >= urun)
                    psRuns = psRuns - urun;
                else
                    psRuns = 0;

                if ((psBalls <= ballsPerOver) && (psBalls > 0))
                    --psBalls;
                else if (psBalls > ballsPerOver)
                    psBalls = psBalls - ballsPerOver;
                else if (psBalls == 0) {
                    psBalls = ballsPerOver - 1;
                    if (psOver > 0)
                        --psOver;
                    else
                        psOver = 0;
                }

                if (strID == ps1ID) {
                    if (p1CR >= urun)
                        p1CR = p1CR - urun;
                    else
                        p1CR = 0;
                    if (p1CB > 0)
                        --p1CB;
                    else
                        p1CB = 0;
                } else if (strID == ps2ID) {
                    if (p2CR >= urun)
                        p2CR = p2CR - urun;
                    else
                        p2CR = 0;
                    if (p2CB > 0)
                        --p2CB;
                    else
                        p2CB = 0;
                }


                Log.d("undo", "ubtype : " + ubtype + ", psRuns : " + psRuns + ", psBalls : " + psBalls
                        + ", psOver : " + psOver + ", ballsPerOver : " + ballsPerOver);
                Log.d("undo", "strID : " + strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype);
                Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);

                Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

//               bowlerOver = bowlerOver - 0.1f;
                if (currentOver >= 0.1f)
                    currentOver = currentOver - 0.1f;
                else
                    currentOver = 0;

                if (currentInnings > 1 && currentInnings < 99) {
                   /*if (remainingRuns < 0) {

                       if (leadingRuns >= 0)
                           leadingRuns = leadingRuns - urun;

                       else if (leadingRuns < urun)
                           leadingRuns = urun - leadingRuns;

                   }

                   else //if (remainingRuns > 0)*/
                    remainingRuns = remainingRuns + urun;
                    leadingRuns = leadingRuns - urun;

                    ++remainingBalls;
                    remainingOver = remainingOver + 0.1f;
                    // added on 06/05/2020
                    resetRemainingOver();
                }

                if (bwRun >= urun)
                    bwRun = bwRun - urun;
                else
                    bwRun = 0;

                // adding 04/05/2020
                if (mo >= urun)
                    mo = mo - urun;
                else
                    mo = 0;

               /*// commented on 06/05/2020
               if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                   --bowlerBalls;
               else if (bowlerBalls > ballsPerOver)
                   bowlerBalls = bowlerBalls - ballsPerOver;
               else if (bowlerBalls == 0) {
                   bowlerBalls = ballsPerOver;
                   --bowlerOver;
               }*/
                // added on 06/05/2020
                undoBowlerOver();


                modified = lastEvent.getUndoDisplay();

                resetValues(lastEvent, ubtype);
                Log.d("remainingOver", "ubtype = 2, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 2, 2 : " + remainingBalls);
            } else if (ubtype == 3) {

                Log.d("TEST", "undo, ubtype 2 = " + ubtype);
                resetOUT(lastEvent);

               /*Log.d("remainingOver", "ubtype = 3, 1 : " + remainingOver);
               Log.d("remainingBalls", "ubtype = 3, 1 : " + remainingBalls);

               endOver = false;
               out = false;
               uout = lastEvent.getOutType();
               uetype = lastEvent.getExtraType();
               urun = lastEvent.getCurrentRun();
               uerun = lastEvent.getExtraRuns();
               bowler = ubowler;
               Log.d("undo", "undo 1, ubtype : "+ubtype+", events : "+lastEvent+", uout : "+ uout);
               setStrikerNonStriker(lastEvent);
               Log.d("Scoring", "undo 2, ubtype : "+ubtype+", events : "+lastEvent);
               setBowler(lastEvent);
               Log.d("Scoring", "undo 3, ubtype : "+ubtype+", events : "+lastEvent);
               resetPartnership(lastEvent.getDismissedPlayerID());
               Log.d("Scoring", "undo 4, ubtype : "+ubtype+", events : "+lastEvent);

               if (uout != 10 && wicket > 0) {

                   if (wicket > 0)
                       --wicket;
                   else
                       wicket = 0;
               }



               if (allOUT) {
                   allOUT = false;
                   tvTotalWicket.setVisibility(View.VISIBLE);
                   tvdiv.setVisibility(View.VISIBLE);
                   endOfInnings = false;

                   // disabling all buttons in Scoring
//                    btnUndo.setEnabled(false);
                   btnSwap.setEnabled(true);
                   btnScore.setEnabled(true);
                   btnOut.setEnabled(true);
                   btnExtras.setEnabled(true);
                   btnHash.setEnabled(true);
//                    btnCom.setEnabled(false);
                   btn0.setEnabled(true);
                   btn1.setEnabled(true);
                   btn2.setEnabled(true);
                   btn3.setEnabled(true);
                   btn4.setEnabled(true);
                   btn6.setEnabled(true);
                   btnInterval.setEnabled(true);
                   btnChangeBatsman.setEnabled(true);
                   btnChangeBowler.setEnabled(true);
               }

               Log.d("Scoring", "undo, wicket : "+wicket+", allOUT : "+allOUT);

               if (uout >= 0 && uout <= 5 && uout != 2) {
                   removeFromFOW(lastEvent.getDismissedPlayerID());



                   if (bowlerWicket > 0)
                       --bowlerWicket;
                   else
                       bowlerWicket = 0;

                   if (strikerBalls > 0)
                       --strikerBalls;
                   else
                       strikerBalls = 0;

                   // partnership details
                   if (psRuns >= urun)
                       psRuns = psRuns - urun;
                   else
                       psRuns = 0;

                   if ((psBalls <= ballsPerOver) && (psBalls > 0))
                       --psBalls;
                   else if (psBalls > ballsPerOver)
                       psBalls = psBalls - ballsPerOver;
                   else if (psBalls == 0) {
                       psBalls = ballsPerOver - 1;
                       if (psOver > 0)
                           --psOver;
                       else
                           psOver = 0;
                   }



                   if (strID == ps1ID) {
                       if (p1CB > 0)
                           --p1CB;
                       else
                           p1CB = 0;
                   } else if (strID == ps2ID) {
                       if (p2CB > 0)
                           --p2CB;
                       else
                           p2CB = 0;
                   }


                   if (uetype != 4) {

                       *//*// commented on 06/05/2020
                       if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                           --bowlerBalls;
                       else if (bowlerBalls > ballsPerOver)
                           bowlerBalls = bowlerBalls - ballsPerOver;
                       else if (bowlerBalls == 0) {
                           bowlerBalls = ballsPerOver;
                           --bowlerOver;
                       }*//*

                       // added on 06/05/2020
                       undoBowlerOver();

                   }

                   if (totalBalls > 0)
                       --totalBalls;
                   else
                       totalBalls = 0;

                   ball = lastEvent.getCurrentOverBalls();

                   if ((ball <= ballsPerOver) && (ball > 0))
                       --ball;
                   else if (ball > ballsPerOver)
                       ball = ball - ballsPerOver;
//                   else if (ball == 0)
//                       ball = ballsPerOver;
//                   --ball;

//                   bowlerOver = bowlerOver - 0.1f;
                   if (currentOver >= 0.1f)
                       currentOver = currentOver - 0.1f;
                   else
                       currentOver = 0f;

                   if (currentRuns >= urun)
                       currentRuns = currentRuns - urun;

                   else
                       currentRuns = 0;

                   if ((urun % 2) != 0)
                       swap();

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                   if (uetype > -1)
                       undoExtra();

                   if (currentInnings > 1 && currentInnings < 99){

                           remainingRuns = remainingRuns + urun;
                       leadingRuns = leadingRuns - urun;

                       ++remainingBalls;
                       remainingOver = remainingOver + 0.1f;
                       // added on 06/05/2020
                       resetRemainingOver();
                   }

                   Log.d("undo", "ubtype : "+ubtype+", psRuns : "+psRuns + ", psBalls : " + psBalls
                           + ", psOver : " + psOver + ", ballsPerOver : "+ ballsPerOver);
                   Log.d("undo", "strID : "+strID + ", urun: " + urun + ", uerun : " + uerun +
                           ", uetype : " + uetype + ", uout : " + uout);
                   Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : "+ p1CB);

                   Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : "+ p2CB);
               }

               else if (uout == 2) {

                   removeFromFOW(lastEvent.getDismissedPlayerID());

                   if (uetype != 4) {

                       *//*// commented on 06/05/2020
                       if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                           --bowlerBalls;
                       else if (bowlerBalls > ballsPerOver)
                           bowlerBalls = bowlerBalls - ballsPerOver;
                       else if (bowlerBalls == 0) {
                           bowlerBalls = ballsPerOver;
                           --bowlerOver;
                       }*//*

                       // added on 06/05/2020
                       undoBowlerOver();
                   }

                   if (totalBalls > 0)
                       --totalBalls;
                   else
                       totalBalls = 0;

                   ball = lastEvent.getCurrentOverBalls();

                   if ((ball <= ballsPerOver) && (ball > 0))
                       --ball;
                   else if (ball > ballsPerOver)
                       ball = ball - ballsPerOver;
//                   else if (ball == 0)
//                       ball = ballsPerOver;
                   *//*--ball;*//*

//                   bowlerOver = bowlerOver - 0.1f;
                   if (currentOver >= 0.1f)
                       currentOver = currentOver - 0.1f;
                   else
                       currentOver = 0f;

                   if (strikerBalls > 0)
                       --strikerBalls;
                   else
                       strikerBalls = 0;

                   if ((psBalls <= ballsPerOver) && (psBalls > 0))
                       --psBalls;
                   else if (psBalls > ballsPerOver)
                       psBalls = psBalls - ballsPerOver;
                   else if (psBalls == 0) {
                       psBalls = ballsPerOver - 1;
                       if (psOver > 0)
                           --psOver;
                       else
                           psOver = 0;
                   }

                   if (strID == ps1ID) {
                       if (p1CB > 0)
                           --p1CB;
                       else
                           p1CB = 0;
                   } else if (strID == ps2ID) {
                       if (p2CB > 0)
                           --p2CB;
                       else
                           p2CB = 0;
                   }

                   urun = lastEvent.getCurrentRun();

                   if (urun == 0) {

                       if (strikerDots > 0)
                           --strikerDots;
                       else
                           strikerDots = 0;

                       if (bowlerDots > 0)
                           --bowlerDots;
                       else
                           bowlerDots = 0;
                   }

                   else  {

                       if (strikerRuns >= urun)
                           strikerRuns = strikerRuns - urun;
                       else
                           strikerRuns = 0;

                       if (currentRuns >= urun)
                           currentRuns = currentRuns - urun;
                       else
                           currentRuns = 0;

                       if (bwRun >= urun)
                           bwRun = bwRun - urun;
                       else
                           bwRun = 0;

                       // adding 04/05/2020
                       if (mo >= urun)
                           mo = mo - urun;
                       else
                           mo = 0;

                       // partnership details
                       if (psRuns >= urun)
                           psRuns = psRuns - urun;
                       else
                           psRuns = 0;



                       if (strID == ps1ID) {
                           if (p1CR >= urun)
                               p1CR = p1CR - urun;
                           else
                               p1CR = 0;
                       } else if (strID == ps2ID) {
                           if (p2CR >= urun)
                               p2CR = p2CR - urun;
                           else
                               p2CR = 0;
                       }


                       if (urun == 4) {

                           if (strikerF4s > 0)
                               --strikerF4s;
                           else
                               strikerF4s = 0;

                           if (bowlerF4s > 0)
                               --bowlerF4s;
                           else
                               bowlerF4s = 0;
                       }

                       if (urun == 6) {

                           if (strikerS6s > 0)
                               --strikerS6s;
                           else
                               strikerS6s = 0;

                           if (bowlerS6s > 0)
                               --bowlerS6s;
                           else
                               bowlerS6s = 0;
                       }

                       if ((urun % 2) != 0)
                           swap();

                   }



                   if (uetype > -1)
                       undoExtra();

                  *//* if (uetype == 3 || uetype == 6) {

                       if (bwRun >= noballRun)
                           bwRun = bwRun - noballRun;
                       else
                           bwRun = 0;
                   }

                   else if (uetype == 2) {

                       if (bwRun >= (noballRun + urun))
                           bwRun = bwRun - noballRun - urun;
                       else
                           bwRun = 0;
                   }*//*

                   if (currentRuns >= (urun *//*+ uerun*//*))
                       currentRuns = currentRuns - urun*//* - uerun*//*;
                   else
                       currentRuns = 0;

                   if (currentInnings > 1 && currentInnings < 99){

                       /*if (remainingRuns < 0) {

                           if (leadingRuns >= 0)
                               leadingRuns = leadingRuns - urun;

                           else if (leadingRuns < urun)
                               remainingRuns = urun - leadingRuns;

                       }

                       else //if (remainingRuns > 0)*//*
                           remainingRuns = remainingRuns + urun;
                       leadingRuns = leadingRuns - urun;

                       ++remainingBalls;
                       remainingOver = remainingOver + 0.1f;
                       // added on 06/05/2020
                       resetRemainingOver();
                   }

                   Log.d("undo", "ubtype : "+ubtype+", psRuns : "+psRuns + ", psBalls : " + psBalls
                           + ", psOver : " + psOver + ", ballsPerOver : "+ ballsPerOver);
                   Log.d("undo", "strID : "+strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype + ", uout : " + uout);
                   Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : "+ p1CB);

                   Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : "+ p2CB);

               }

               else if (uout >= 6 && uout < 9) {

                   removeFromFOW(lastEvent.getDismissedPlayerID());
                   ball = lastEvent.getCurrentOverBalls();
                   if (currentRuns >= (urun/* + noballRun*//*))
                       currentRuns = currentRuns - urun /*- noballRun*//*;
                   else
                       currentRuns = 0;

                   if (psRuns >= urun)
                       psRuns = psRuns - urun;
                   else
                       psRuns = 0;

                   if (uout == 6 || uout == 8) {

                       if (uetype != 4) {

                           *//*// commented on 06/05/2020
                           if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                               --bowlerBalls;
                           else if (bowlerBalls > ballsPerOver)
                               bowlerBalls = bowlerBalls - ballsPerOver;
                           else if (bowlerBalls == 0) {
                               bowlerBalls = ballsPerOver;
                               --bowlerOver;
                           }*//*

                           // added on 06/05/2020
                           undoBowlerOver();
                       }

                       if ((psBalls <= ballsPerOver) && (psBalls > 0))
                           --psBalls;
                       else if (psBalls > ballsPerOver)
                           psBalls = psBalls - ballsPerOver;
                       else if (psBalls == 0) {
                           psBalls = ballsPerOver - 1;
                           if (psOver > 0)
                               --psOver;
                           else
                               psOver = 0;
                       }

//                       bowlerOver = bowlerOver - 0.1f;
                       if (totalBalls > 0)
                           --totalBalls;
                       else
                           totalBalls = 0;

                       if (currentOver >= 0.1f)
                           currentOver = currentOver - 0.1f;
                       else
                           currentOver = 0f;

                       if ((ball <= ballsPerOver) && (ball > 0))
                           --ball;
                       else if (ball > ballsPerOver)
                           ball = ball - ballsPerOver;
//                       else if (ball == 0)
//                           ball = ballsPerOver;

                       if (strikerBalls > 0)
                           --strikerBalls;
                       else
                           strikerBalls = 0;

                       if (ps1ID == strID) {
                           if (p1CB > 0)
                               --p1CB;
                           else
                               p1CB = 0;
                       }
                       else if (ps2ID == strID) {
                           if (p2CB > 0)
                               --p2CB;
                           else
                               p2CB = 0;
                       }

                   }

                   if (uetype > -1 && (uout == 6 || uout == 7)){
                       undoExtra();

                       *//*if (uetype == 3 || uetype == 6) {

                           if (bwRun >= noballRun)
                               bwRun = bwRun - noballRun;
                           else
                               bwRun = 0;
                       }

                       else if (uetype == 2) {

                           if (bwRun >= (noballRun + urun))
                               bwRun = bwRun - noballRun - urun;
                           else
                               bwRun = 0;
                       }*/

                      /* if (currentRuns >= (urun + noballRun))
                           currentRuns = currentRuns - urun - noballRun;
                       else
                           currentRuns = 0;*//*
                   }

                   if (currentInnings > 1 && currentInnings < 99){

                       /*if (remainingRuns < 0) {
                           if (leadingRuns > 0)
                               leadingRuns = leadingRuns - urun;

                           else if (leadingRuns < urun)
                               remainingRuns = urun - leadingRuns;
                       }

                       else //if (remainingRuns > 0)*//*
                           remainingRuns = remainingRuns + urun;
                       leadingRuns = leadingRuns - urun;

                       if (uout == 6 || uout == 8) {
                           ++remainingBalls;
                           remainingOver = remainingOver + 0.1f;
                           // added on 06/05/2020
                           resetRemainingOver();
                       }
                   }

                   Log.d("undo", "ubtype : "+ubtype+", psRuns : "+psRuns + ", psBalls : " + psBalls
                           + ", psOver : " + psOver + ", ballsPerOver : "+ ballsPerOver);
                   Log.d("undo", "strID : "+strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype + ", uout : " + uout);
                   Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : "+ p1CB);

                   Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : "+ p2CB);
               }

               else if (uout == 9 || uout == 11) {
                   removeFromFOW(lastEvent.getDismissedPlayerID());
               }

               else if (uout == 10){
                   resetRetire(lastEvent.getDismissedPlayerID());

               }

               else if (uout == 12){

                   removeFromFOW(lastEvent.getDismissedPlayerID());
                   ball = lastEvent.getCurrentOverBalls();
                   currentRuns = lastEvent.getTotalRuns();
                   totalBalls = lastEvent.getBalls();
                   currentOver = lastEvent.getOvers();
               }

               if (uout != 10 && uout != 11 && uout != 12)
                   modified = lastEvent.getUndoDisplay();

               if (dismissedList.size() > 0) {
                   for (int i = 0; i < dismissedList.size(); i++) {

                       if (dismissedList.get(i) == lastEvent.getDismissedPlayerID()) {
                           dismissedList.remove(i);
                       }
                   }
               }

               else
                   Log.e("Scoring", "undo, dismissedList.size : "+dismissedList.size());

               Log.e("Scoring", "undo, dismissedList : "+dismissedList);
               Log.e("Scoring", "undo, retiredList : "+retiredList);
               Batsman batsman = realm.where(Batsman.class).
                       equalTo("matchid", matchid).
                       equalTo("innings", currentInnings).
                       equalTo("team", battingTeamNo).
                       equalTo("batsman_pID", lastEvent.getDismissedPlayerID()).
                       findFirst();

               if (strID == 0){

                   strID = lastEvent.getDismissedPlayerID();
                   strikerBalls = lastEvent.getStrikerBalls();
                   strikerRuns = lastEvent.getStrikerRuns();
                   strikerDots = batsman.getDots();
                   strikerF4s = batsman.getF4s();
                   strikerS6s = batsman.getS6s();

               }

               else if (nstrID == 0) {

                   nstrID = lastEvent.getDismissedPlayerID();
                   nonStrikerBalls = lastEvent.getStrikerBalls();
                   nonStrikerRuns = lastEvent.getStrikerRuns();
                   nonStrikerDots = batsman.getDots();
                   nonStrikerF4s = batsman.getF4s();
                   nonStrikerS6s = batsman.getS6s();
               }

               if (player1ID == 0)
                   player1ID = lastEvent.getDismissedPlayerID();

               else if (player2ID == 0)
                   player2ID = lastEvent.getDismissedPlayerID();

/*               if (ps1ID == 0)
                   ps1ID = lastEvent.getDismissedPlayerID();

               else if (ps2ID == 0)
                   ps2ID = lastEvent.getDismissedPlayerID();*/


               /* commented on 21/01/2021

               resetValues(lastEvent, ubtype);

               Log.d("remainingOver", "ubtype = 3, 2 : " + remainingOver);
               Log.d("remainingBalls", "ubtype = 3, 2 : " + remainingBalls);*/
            }

            // Added on 20/004/2021
            else if (ubtype == 4) {

                Log.d("Scoring", "undo, ubtype : " + ubtype + ", events : " + lastEvent);

//               Log.d("remainingOver", "ubtype = 4, 1 : " + remainingOver);
//               Log.d("remainingBalls", "ubtype = 4, 1 : " + remainingBalls);

                remainingRuns = lastEvent.getRemainingRuns();
                remainingBalls = lastEvent.getRemainingBalls();
                remainingOver = lastEvent.getRemainingOvers();
               /* Commented on 20/04/2021
               // added on 06/05/2020
               resetRemainingOver();

               endOver = true;
               undo = true;*/

                setStrikerNonStriker(lastEvent);
                changeStriker();
                setBowler(lastEvent);

               /*  Commented on 20/04/2021
               if (bowlerBalls == 0) {
                   if (bowlerOver > 0)
                       --bowlerOver;
                   else
                       bowlerOver = 0;

                   if (bowlerOver >= 0)
                       bowlerBalls = ballsPerOver;
               }
//               else if (bowlerBalls > 0 && bowlerBalls <= ballsPerOver) {
//                   --bowlerBalls;
//               }
               else if (bowlerBalls > ballsPerOver) {
                   bowlerBalls = bowlerBalls - ballsPerOver;
                   if (bowlerOver > 0)
                       --bowlerOver;
                   else
                       bowlerOver = 0;
               }*/
//               bowlerOver = lastEvent.getTbo();
//               bowlerOver = lastEvent.getBowlerOver();


                totalBalls = lastEvent.getBalls();
//               ball = lastEvent.getCurrentOverBalls();
                ball = lastEvent.getCurrentOverBalls();
                currentOver = lastEvent.getOvers();
                currentRuns = lastEvent.getTotalRuns();

                Log.d("ball", "balltype 4 & 5, ball : " + ball);
                Log.d("undo", "balltype 4 & 5, bowlerOver : " + bowlerOver);
                Log.d("undo", "balltype 4 & 5, currentOver : " + currentOver);

//               endOfOver = false;  Commented on 20/04/2021
                maiden = lastEvent.isMaidenOver();
                if (maiden) {
                    if (bowlerMO > 0)
                        --bowlerMO;
                    else
                        bowlerMO = 0;
                }
                mo = lastEvent.getMo();
                modified = lastEvent.getCurrentOver();

               /*  Commented on 20/04/2021
               if (ball == ballsPerOver){
                   efo = true;
                   callEndOfOverAlert();
               }
               else
                   efo = false;*/

                resetValues(lastEvent, ubtype);

                Log.d("remainingOver", "ubtype = 4|5, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 4|5, 2 : " + remainingBalls);
            }

            // ==== till here (20/04/2021)


            else if (/*ubtype == 4 || */ubtype == 5) {   //Updated on 20/04/2021

                Log.d("Scoring", "undo, ubtype : " + ubtype + ", events : " + lastEvent);

                Log.d("remainingOver", "ubtype = 4|5, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 4|5, 1 : " + remainingBalls);

                remainingRuns = lastEvent.getRemainingRuns();
                remainingBalls = lastEvent.getRemainingBalls();
                remainingOver = lastEvent.getRemainingOvers();
                // added on 06/05/2020
                resetRemainingOver();

                endOver = true;
                undo = true;

                setStrikerNonStriker(lastEvent);
                changeStriker();
                setBowler(lastEvent);

                if (bowlerBalls == 0) {
                    if (bowlerOver > 0)
                        --bowlerOver;
                    else
                        bowlerOver = 0;

                    if (bowlerOver >= 0)
                        bowlerBalls = ballsPerOver;
                }
//               else if (bowlerBalls > 0 && bowlerBalls <= ballsPerOver) {
//                   --bowlerBalls;
//               }
                else if (bowlerBalls > ballsPerOver) {
                    bowlerBalls = bowlerBalls - ballsPerOver;
                    if (bowlerOver > 0)
                        --bowlerOver;
                    else
                        bowlerOver = 0;
                }
//               bowlerOver = lastEvent.getTbo();
//               bowlerOver = lastEvent.getBowlerOver();


                totalBalls = lastEvent.getBalls();
//               ball = lastEvent.getCurrentOverBalls();
                ball = lastEvent.getTemp_balls();
                currentOver = lastEvent.getTco();
                currentRuns = lastEvent.getTotalRuns();

                Log.d("ball", "balltype 4 & 5, ball : " + ball);
                Log.d("undo", "balltype 4 & 5, bowlerOver : " + bowlerOver);
                Log.d("undo", "balltype 4 & 5, currentOver : " + currentOver);

                endOfOver = false;
                maiden = lastEvent.isMaidenOver();
                if (maiden) {
                    if (bowlerMO > 0)
                        --bowlerMO;
                    else
                        bowlerMO = 0;
                }
                mo = lastEvent.getMo();
                modified = lastEvent.getUndoDisplay();

                if (ball == ballsPerOver) {
                    efo = true;
                    callEndOfOverAlert();
                } else
                    efo = false;

                resetValues(lastEvent, ubtype);

                Log.d("remainingOver", "ubtype = 4|5, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 4|5, 2 : " + remainingBalls);
            } else if (ubtype == 6) {

                Log.d("remainingOver", "ubtype = 6, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 6, 1 : " + remainingBalls);

                player_in_id = 0;
                endOver = false;
                Log.d("Scoring", "undo, ubtype : " + ubtype + ", events : " + lastEvent);
                int bid = lastEvent.getNewBowlerID();

                Bowler bow = realm.where(Bowler.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("team", fieldingTeamNo).
                        equalTo("playerID", bid).findFirst();
                Log.d("undobow", "bowler bt 6, : " + bow);
                if (bow != null) {

                    if ((bow.getBalls() == 0) && (bow.getRuns() == 0) &&
                            (bow.getNoBalls() == 0) && (bow.getWides() == 0)) {

                        if (!realm.isInTransaction()) {
                            realm.beginTransaction();
                        }

                        bow.deleteFromRealm();
                        realm.commitTransaction();
                    }
                }

               /*bowlerID = lastEvent.getPrevBowlerID();
               bowler = realm.where(Player.class).
                       equalTo("matchid", matchid).
                       equalTo("team", fieldingTeamNo).
                       equalTo("playerID", bowlerID).findFirst().getPlayerName();


               Log.e("Scoring", "Undo, bow : " + bow);

               setBowler(lastEvent);*/
                setStrikerNonStriker(lastEvent);

                currentOver = lastEvent.getOvers();

                Log.e("Scoring", "Undo, ubtype = " + ubtype + ", resetBowler : " + resetBowler);
                Log.e("Scoring", "Undo, currentOver : " + currentOver);

//               if (currentOver == 1.0f || currentOver == 0.6f){
//
//                   if (resetBowler){

                String temp = bowler;
                int tID = bowlerID;
                bowler = preBowler;
                bowlerID = preBowlerID;
//                       ===============================================================================================================


//                       ================================================================================================================
//                       bowlerNoBall = 0;
//                       bowlerWide = 0;

                Bowler bowler = realm.where(Bowler.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("team", fieldingTeamNo).
                        equalTo("playerID", bowlerID).findFirst();

                Log.d("undo", "bowler bt 6.1, : " + bow);

                Log.e("Scoring", "Undo, ubtype = " + ubtype + ", bowler : " + bowler);


                if (bowler != null) {

                    bwRun = bowler.getRuns();//lastEvent.getBowlerRuns();
                    bowlerBalls = bowler.getBalls();//lastEvent.getBowlerBalls();
                    bowlerOver = bowler.getOver();//lastEvent.getBowlerOver();
                    bowlerWicket = bowler.getWicket();//lastEvent.getBowlerWicket();
                    bowlerDots = bowler.getDots();
                    bowlerF4s = bowler.getF4s();
                    bowlerS6s = bowler.getS6s();
                    bowlerNoBall = bowler.getNoBalls();
                    bowlerWide = bowler.getWides();
                    bowlerMO = bowler.getMaidenOver();
                }

                if (currentOver == 1.0f || currentOver == 0.6f) {
                    preBowlerID = 0;
                    preBowler = null;
                } else if (lastPreBowlerID > 0) {
                    preBowlerID = lastPreBowlerID;
                    preBowler = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", fieldingTeamNo).
                            equalTo("playerID", preBowlerID).findFirst().getPlayerName();

                    Bowler pbow = realm.where(Bowler.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", fieldingTeamNo).
                            equalTo("playerID", bowlerID).findFirst();

                    Log.e("Scoring", "Undo, ubtype = " + ubtype + ", bowler : " + bowler);


                    if (bowler != null) {

                        preBowlerRun = pbow.getRuns();//lastEvent.getBowlerRuns();
                        preBowlerBalls = pbow.getBalls();//lastEvent.getBowlerBalls();
                        preBowlerOver = pbow.getOver();//lastEvent.getBowlerOver();
                        preBowlerWicket = pbow.getWicket();//lastEvent.getBowlerWicket();
//                               preBowlerDots = pbow.getDots();
//                               preBowlerF4s = pbow.getF4s();
//                               preBowlerS6s = pbow.getS6s();
//                               preBowlerNoball = pbow.getNoBalls();
//                               preBowlerWide = pbow.getWides();
                        preBowlerMO = pbow.getMaidenOver();
                    }
                }
//                       nextBowlerID = tID;
//                       nextBowler = temp;
//                   }
//               }

                modified = lastEvent.getCurrentOver();

                resetValues(lastEvent, ubtype);

                Log.d("remainingOver", "ubtype = 2, 6 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 2, 6 : " + remainingBalls);

                // added on 06/05/2020
                undo();
            } else if (ubtype == 7) {

                Log.d("Scoring", "undo, ubtype : " + ubtype + ", events : " + lastEvent);
                Log.d("remainingOver", "ubtype = 7, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 7, 1 : " + remainingBalls);
                endOver = false;
                int newBatsmanID = lastEvent.getDisNewBatsmanID();

                Log.d("undo", "ubtype : 7,  newBatsmanID : " + newBatsmanID);
                Log.d("undo", "ubtype : 7,  getDismissedPlayerID : " + lastEvent.getDismissedPlayerID());

                Batsman batsmann = realm.where(Batsman.class).
                        equalTo("matchid", matchid).
                        equalTo("team", battingTeamNo).
                        equalTo("innings", currentInnings).
                        equalTo("batsman_pID", newBatsmanID).findFirst();
/*
               Realm realm = null;
               try {
                    config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);*/
                realm.executeTransaction(new Realm.Transaction() {
                    @Override
                    public void execute(Realm bgRealm) {

                        try {

//                               if (!batsmann.isRetired()) {

                            if (batsmann != null) {

                                batsmann.setToBeBatted(true);
                                batsmann.setPlaying(false);
                                batsmann.setRetired(false);
                                batsmann.setRuns(0);
                                batsmann.setBalls(0);
                                batsmann.setS6s(0);
                                batsmann.setF4s(0);
                                batsmann.setOut(false);
                                batsmann.setBattingOrder(100);
//                                   bgRealm.insertOrUpdate(batsmann);
//                               }

                                bgRealm.copyToRealm(batsmann);
                            }
                            Log.d("batsmann", "after undo , ubtype = " + ubtype +

                                    ", batsmann : " + batsmann.toString());


                        } catch (RealmPrimaryKeyConstraintException e) {
                            Toast.makeText(getApplicationContext(),
                                    "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
               /*} catch (RealmException e) {
                   Log.d("test", "Exception : " + e);
               } finally {
                   if (realm != null) {
                       realm.close();
                   }
               }*/

               /*Realm realm = null;
               try {
                    config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                   realm.executeTransaction(new Realm.Transaction() {
                       @Override
                       public void execute(Realm bgrealm) {

                           try {

                               Batsman batsmann = bgrealm.where(Batsman.class).
                                       equalTo("matchid", matchid).
                                       equalTo("innings", currentInnings).
                                       equalTo("team", battingTeamNo).
                                       equalTo("batsman_pID", newBatsmanID).findFirst();

                               if (!batsmann.isRetired()) {

                                   batsmann.setToBeBatted(true);
                                   batsmann.setPlaying(false);
                                   batsmann.setRetired(false);
                                   batsmann.setRuns(0);
                                   batsmann.setBalls(0);
                                   batsmann.setS6s(0);
                                   batsmann.setF4s(0);
                                   batsmann.setOut(false);
                                   batsmann.setBattingOrder(100);
                                   bgrealm.copyToRealmOrUpdate(batsmann);
                               }

                               Log.d("Scoring", "undo, ubtype : "+ubtype+", batsmann : "+batsmann);

                           }
                           catch (RealmPrimaryKeyConstraintException e) {
                               Toast.makeText(getApplicationContext(),
                                       "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                           }
                       }
                   });
               }

               catch (RealmException e) {
                   Log.d("scoring", "onclick, Exception : " + e);
               }

               finally {
                   if (realm != null) {
                       realm.close();
                   }
               }*/

                 config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                Batsman batsman = realm.where(Batsman.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("team", battingTeamNo).
                        equalTo("batsman_pID", lastEvent.getDismissedPlayerID()).findFirst();

                if (batsman != null) {
                    Log.d("UNDO", " balltype 7, batsman is not null");

                    strID = lastEvent.getStrikerID();
                    nstrID = lastEvent.getNonStrikerID();
                    if (strID == newBatsmanID) {
                        strID = lastEvent.getDismissedPlayerID();
                        striker = realm.where(Player.class).
                                equalTo("matchid", matchid).
                                equalTo("team", battingTeamNo).
                                equalTo("playerID", strID).findFirst().getPlayerName();
                        strikerRuns = batsman.getRuns();
                        strikerBalls = batsman.getBalls();
                        strikerDots = batsman.getDots();
                        strikerF4s = batsman.getF4s();
                        strikerS6s = batsman.getS6s();

                    } else if (nstrID == newBatsmanID) {
                        nstrID = lastEvent.getDismissedPlayerID();
                        nonStriker = realm.where(Player.class).
                                equalTo("matchid", matchid).
                                equalTo("team", battingTeamNo).
                                equalTo("playerID", nstrID).findFirst().getPlayerName();
                        nonStrikerRuns = batsman.getRuns();
                        nonStrikerBalls = batsman.getBalls();
                        nonStrikerDots = batsman.getDots();
                        nonStrikerF4s = batsman.getF4s();
                        nonStrikerS6s = batsman.getS6s();
                    }


                    Log.d("undo", "1 ubtype : " + ubtype + ", newBatsmanID : " + newBatsmanID +
                            ", dismissedID : " + lastEvent.getDismissedPlayerID());
                    Log.d("undo", "1 ubtype : " + ubtype + ", strID : " + strID + ", strikerRuns : " + strikerRuns +
                            ", strikerBalls : " + strikerBalls + ", strikerDots : " + strikerDots + ", strikerF4s : " + strikerF4s +
                            ", strikerS6s : " + strikerS6s);

                    Log.d("undo", "1 ubtype : " + ubtype + ", nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                            ", nonStrikerBalls : " + nonStrikerBalls + ", nonStrikerDots : " + nonStrikerDots +
                            ", nonStrikerF4s : " + nonStrikerF4s + ", nonStrikerS6s : " + nonStrikerS6s);

                    Log.d("undo", "1 ubtype : " + ubtype + ", player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                            ", player1Balls : " + player1Balls + ", player1Dots : " + player1Dots +
                            ", player1F4s : " + player1F4s + ", player1S6s : " + player1S6s);

                    Log.d("undo", "1 ubtype : " + ubtype + ", player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                            ", player2Balls : " + player2Balls + ", player2Dots : " + player2Dots +
                            ", player2F4s : " + player2F4s + ", player2S6s : " + player2S6s);

                    if (player1ID == newBatsmanID)
                        player1ID = lastEvent.getDismissedPlayerID();
                    else if (player2ID == newBatsmanID)
                        player2ID = lastEvent.getDismissedPlayerID();

                    if (player1ID == strID && player2ID == nstrID) {
                        Log.d("undo", "3 player1ID : " + player1ID + ", newBatsmanID : " + newBatsmanID +
                                ", dismissedID : " + lastEvent.getDismissedPlayerID());

                        player1Runs = strikerRuns;
                        player1Balls = strikerBalls;
                        player1Dots = strikerDots;
                        player1F4s = strikerF4s;
                        player1S6s = strikerS6s;

                        player2Runs = nonStrikerRuns;
                        player2Balls = nonStrikerBalls;
                        player2Dots = nonStrikerDots;
                        player2F4s = nonStrikerF4s;
                        player2S6s = nonStrikerS6s;
                    } else if (player2ID == strID && player1ID == nstrID) {
                        Log.d("undo", "4 player2ID : " + player2ID + ", newBatsmanID : " + newBatsmanID +
                                ", dismissedID : " + lastEvent.getDismissedPlayerID());
                        player2Runs = strikerRuns;
                        player2Balls = strikerBalls;
                        player2Dots = strikerDots;
                        player2F4s = strikerF4s;
                        player2S6s = strikerS6s;

                        player1Runs = nonStrikerRuns;
                        player1Balls = nonStrikerBalls;
                        player1Dots = nonStrikerDots;
                        player1F4s = nonStrikerF4s;
                        player1S6s = nonStrikerS6s;
                    }

                    Log.d("undo", "2 ubtype : " + ubtype + ", newBatsmanID : " + newBatsmanID +
                            ", dismissedID : " + lastEvent.getDismissedPlayerID());
                    Log.d("undo", "2 strID : " + strID + ", strikerRuns : " + strikerRuns +
                            ", strikerBalls : " + strikerBalls + ", strikerDots : " + strikerDots + ", strikerF4s : " + strikerF4s +
                            ", strikerS6s : " + strikerS6s);

                    Log.d("undo", "2 nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                            ", nonStrikerBalls : " + nonStrikerBalls + ", nonStrikerDots : " + nonStrikerDots +
                            ", nonStrikerF4s : " + nonStrikerF4s + ", nonStrikerS6s : " + nonStrikerS6s);

                    Log.d("undo", "2 player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                            ", player1Balls : " + player1Balls + ", player1Dots : " + player1Dots +
                            ", player1F4s : " + player1F4s + ", player1S6s : " + player1S6s);

                    Log.d("undo", "2 player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                            ", player2Balls : " + player2Balls + ", player2Dots : " + player2Dots +
                            ", player2F4s : " + player2F4s + ", player2S6s : " + player2S6s);
                } else
                    Log.d("UNDO", " balltype 7, batsman is null");


                //resetting partnership

                if (ps1ID == newBatsmanID)
                    ps1ID = lastEvent.getDismissedPlayerID();
                else if (ps2ID == newBatsmanID)
                    ps2ID = lastEvent.getDismissedPlayerID();

                RealmResults<Partnership> results1 = realm.where(Partnership.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("wicket", (wicket + 1)).findAll();

                if (results1.isEmpty())
                    Log.d("Partnership", "undo ubtype 7, results1 : " + results1);
                else {
                    Partnership partnership1 = results1.last();
                    Log.d("Partnership", "undo ubtype 7, partnership1 : " + partnership1);

                    if (partnership1 != null) {
                        if (!realm.isInTransaction()) {
                            realm.beginTransaction();
                        }
                        partnership1.deleteFromRealm();
                        realm.commitTransaction();
                    }
                }

                RealmResults<Partnership> results2 = realm.where(Partnership.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).findAll();

                if (results2.isEmpty())
                    Log.d("Partnership", "undo ubtype 7, results2 : " + results2);
                else {
                    Partnership partnership = results2.last();
                    Log.d("Partnership", "undo ubtype 7, results2 : " + results2);
                    if (partnership.getDismissedPlayerID() == lastEvent.getDismissedPlayerID()) {

                        psRuns = partnership.getPartnershipRuns();
                        psBalls = partnership.getPartnershipBalls();
                        psOver = partnership.getPartnershipOver();

                        if (ps1ID == partnership.getPlayer1ID()) {
                            p1CB = partnership.getPlayer1ContributionBalls();
                            p1CR = partnership.getPlayer1ContributionRuns();
                        } else if (ps2ID == partnership.getPlayer1ID()) {
                            p2CB = partnership.getPlayer1ContributionBalls();
                            p2CR = partnership.getPlayer1ContributionRuns();
                        }

                        if (ps1ID == partnership.getPlayer2ID()) {
                            p1CB = partnership.getPlayer2ContributionBalls();
                            p1CR = partnership.getPlayer2ContributionRuns();
                        } else if (ps2ID == partnership.getPlayer2ID()) {
                            p2CB = partnership.getPlayer2ContributionBalls();
                            p2CR = partnership.getPlayer2ContributionRuns();
                        }
                    }
                }


//               modified = lastEvent.getCurrentOver();
//               udisplay = lastEvent.getUndoDisplay();
//               modified = lastEvent.getUndoDisplay();

                // commented on 11/05/2020
                /*resetOUT(lastEvent);*/
                Log.d("event", "undo ubtype = 7, lastEvent : " + lastEvent);

                // commented on 11/05/2020
               /*if (pre_interval)
                   resetValues(lastEvent, ubtype);*/

                pre_interval = false;

                Log.d("remainingOver", "ubtype = 7, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 7, 2 : " + remainingBalls);
//               resetOUT(lastEvent);

                resetValues(lastEvent, ubtype);
                undo();
            } else if (ubtype == 8) {

                Log.d("Scoring", "undo, ubtype : " + ubtype + ", events : " + lastEvent);

                Log.d("remainingOver", "ubtype = 8, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 8, 1 : " + remainingBalls);

                endOver = false;
                setStrikerNonStriker(lastEvent);
                setBowler(lastEvent);

                uetype = lastEvent.getExtraType();       // extra type
                uerun = lastEvent.getExtraRuns();        // extra run
                urun = lastEvent.getCurrentRun();        // run or runs off bat

                Log.d("undo", "ubtype : " + ubtype + ", uerun : " + uerun + ", urun : " + urun);

                if (uetype == 0 || uetype == 1) {

                    if ((uerun % 2) != 0)
                        swap();

                   /*// commented on 06/05/2020
                   if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                       --bowlerBalls;
                   else if (bowlerBalls > ballsPerOver)
                       bowlerBalls = bowlerBalls - ballsPerOver;
                   else if (bowlerBalls == 0) {
                       bowlerBalls = ballsPerOver;
                       --bowlerOver;
                   }*/

                    // added on 06/05/2020
                    undoBowlerOver();


//                   bowlerOver = bowlerOver - 0.1f;

                    if ((ball <= ballsPerOver) && (ball > 0))
                        --ball;
                    else if (ball > ballsPerOver)
                        ball = ball - ballsPerOver;
//                   else if (ball == 0)
//                       ball = ballsPerOver;


                    if (strikerBalls > 0)
                        --strikerBalls;
                    else
                        strikerBalls = 0;

                    if (totalBalls > 0)
                        --totalBalls;
                    else
                        totalBalls = 0;

                    if (currentOver >= 0.1f)
                        currentOver = currentOver - 0.1f;
                    else
                        currentOver = 0f;

                    if (currentRuns >= uerun)
                        currentRuns = currentRuns - uerun;
                    else
                        currentRuns = 0;

                    // partnership undo
                    if ((psBalls <= ballsPerOver) && (psBalls > 0))
                        --psBalls;
                    else if (psBalls > ballsPerOver)
                        psBalls = psBalls - ballsPerOver;
                    else if (psBalls == 0) {
                        psBalls = ballsPerOver - 1;
                        if (psOver > 0)
                            --psOver;
                        else
                            psOver = 0;
                    }

                    if (psRuns >= uerun)
                        psRuns = psRuns - uerun;
                    else
                        psRuns = 0;

                    if (ps1ID == strID) {
                        if (p1CB > 0)
                            --p1CB;
                        else
                            p1CB = 0;
                    } else if (ps2ID == strID) {
                        if (p2CB > 0)
                            --p2CB;
                        else
                            p2CB = 0;
                    }

                  /* Log.d("undo", "b4 swap, ubtype : "+ubtype+", uetype : "+uetype + ", strID : " + strID
                           + ", ps1ID : " + ps1ID + ", ps2ID : "+ ps2ID);*/


                    Log.d("undo", "after swap, ubtype : " + ubtype + ", uetype : " + uetype + ", strID : " + strID
                            + ", ps1ID : " + ps1ID + ", ps2ID : " + ps2ID + ", currentRuns : " + currentRuns +
                            ", currentOver : " + currentOver);

                    if (currentInnings > 1 && currentInnings < 99) {

                        remainingRuns = remainingRuns + uerun;
                        ++remainingBalls;
                        remainingOver = remainingOver + 0.1f;
                        // added on 06/05/2020
                        resetRemainingOver();
                    }

                    modified = lastEvent.getUndoDisplay();

                    Log.d("undo", "ubtype : " + ubtype + ", psRuns : " + psRuns + ", psBalls : " + psBalls
                            + ", psOver : " + psOver + ", ballsPerOver : " + ballsPerOver +
                            ", currentRuns : " + currentRuns + ", currentOver : " + currentOver);
                    Log.d("undo", "strID : " + strID + ", urun: " + urun + ", uerun : " + uerun +
                            ", uetype : " + uetype + ", uout : " + uout);
                    Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);

                    Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);
//                   tvCurrentOver.setText(modified);

                } else if (uetype == 2) {


                    if ((urun % 2) != 0)
                        swap();

                    if (bwRun >= (noballRun + urun))
                        bwRun = bwRun - noballRun - urun;
                    else
                        bwRun = 0;

                    // adding 04/05/2020
                    if (mo >= (noballRun + urun))
                        mo = mo - noballRun - urun;
                    else
                        mo = 0;

                    if (bowlerNoBall > 0)
                        --bowlerNoBall;
                    else
                        bowlerNoBall = 0;

//                       if (urun > 0) {
                    if (strikerBalls > 0)
                        --strikerBalls;
                    else
                        strikerBalls = 0;

                    if (strikerRuns >= urun)
                        strikerRuns = strikerRuns - urun;
                    else
                        strikerRuns = 0;

                    if (ps1ID == strID) {
                        if (p1CR >= urun)
                            p1CR = p1CR - urun;
                        else
                            p1CR = 0;

                        if (p1CB > 0)
                            --p1CB;
                        else
                            p1CB = 0;
                    } else if (ps2ID == strID) {
                        if (p2CR >= urun)
                            p2CR = p2CR - urun;
                        else
                            p2CR = 0;

                        if (p2CB > 0)
                            --p2CB;
                        else
                            p2CB = 0;

                    }

//                       }

                    if (currentRuns >= (noballRun + urun))
                        currentRuns = currentRuns - noballRun - urun;
                    else
                        currentRuns = 0;

                    if (psRuns >= (noballRun + urun))
                        psRuns = psRuns - (noballRun + urun);
                    else
                        psRuns = 0;


                    if (urun == 0) {

                        if (strikerDots > 0)
                            --strikerDots;
                        else
                            strikerDots = 0;

                        if (bowlerDots > 0)
                            --bowlerDots;
                        else
                            bowlerDots = 0;
                    } else if (urun == 4) {

                        if (bowlerF4s > 0)
                            --bowlerF4s;
                        else
                            bowlerF4s = 0;

                        if (strikerF4s > 0)
                            --strikerF4s;
                        else
                            strikerF4s = 0;
                    } else if (urun == 6) {

                        if (bowlerS6s > 0)
                            --bowlerS6s;
                        else
                            bowlerS6s = 0;

                        if (strikerS6s > 0)
                            --strikerS6s;
                        else
                            strikerS6s = 0;
                    }

                    if (currentInnings > 1 && currentInnings < 99) {
                        remainingRuns = remainingRuns + urun + noballRun;
                    }

                    modified = lastEvent.getUndoDisplay();


                    Log.d("undo", "ubtype : " + ubtype + ", psRuns : " + psRuns + ", psBalls : " + psBalls
                            + ", psOver : " + psOver + ", ballsPerOver : " + ballsPerOver);
                    Log.d("undo", "strID : " + strID + ", urun: " + urun + ", uerun : " + uerun +
                            ", uetype : " + uetype + ", uout : " + uout);

                    Log.d("undo", " player1ID : " + player1ID + ", player1Runs : " +
                            player1Runs + ", player1Balls : " + player1Balls);

                    Log.d("undo", " player2ID : " + player2ID + ", player2Runs : " +
                            player2Runs + ", player2Balls : " + player2Balls);

                    Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);

                    Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

                } else if (uetype == 3 || uetype == 6) {


                    if (((uerun - noballRun) % 2) != 0)
                        swap();

                    if (bowlerNoBall > 0)
                        --bowlerNoBall;
                    else
                        bowlerNoBall = 0;

                    if (strikerBalls > 0)
                        --strikerBalls;
                    else
                        strikerBalls = 0;

                    if (ps1ID == strID) {
                        if (p1CB > 0)
                            --p1CB;
                        else
                            p1CB = 0;
                    } else if (ps2ID == strID) {
                        if (p2CB > 0)
                            --p2CB;
                        else
                            p2CB = 0;
                    }

                    if (bwRun >= noballRun)
                        bwRun = bwRun - noballRun;
                    else
                        bwRun = 0;

                    // adding 04/05/2020
                    if (mo >= noballRun)
                        mo = mo - noballRun;
                    else
                        mo = 0;

                    if (currentRuns >= uerun)
                        currentRuns = currentRuns - uerun;
                    else
                        currentRuns = 0;

                    if (psRuns >= uerun)
                        psRuns = psRuns - uerun;
                    else
                        psRuns = 0;


                    if (currentInnings > 1 && currentInnings < 99) {
                        remainingRuns = remainingRuns + uerun;
                    }

                    modified = lastEvent.getUndoDisplay();

                    Log.d("undo", "ubtype : " + ubtype + ", psRuns : " + psRuns + ", psBalls : " + psBalls
                            + ", psOver : " + psOver + ", ballsPerOver : " + ballsPerOver);
                    Log.d("undo", "strID : " + strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype + ", uout : " + uout);
                    Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);

                    Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);
                } else if (uetype == 4) {

                    if (bowlerWide >= uerun)
                        bowlerWide = bowlerWide - uerun;
                    else
                        bowlerWide = 0;

                    if (currentRuns >= uerun)
                        currentRuns = currentRuns - uerun;
                    else
                        currentRuns = 0;

                    if (psRuns >= uerun)
                        psRuns = psRuns - uerun;
                    else
                        psRuns = 0;

                    if (bwRun >= uerun)
                        bwRun = bwRun - uerun;
                    else
                        bwRun = 0;

                    // added on 04/05/2020

                    if (mo >= uerun)
                        mo = mo - uerun;
                    else
                        mo = 0;


                    if (((uerun - wideRun) % 2) != 0)
                        swap();

                    if (currentInnings > 1 && currentInnings < 99) {
                        remainingRuns = remainingRuns + uerun;
                    }

                    modified = lastEvent.getUndoDisplay();

                    Log.d("undo", "ubtype : " + ubtype + ", psRuns : " + psRuns + ", psBalls : " + psBalls
                            + ", psOver : " + psOver + ", ballsPerOver : " + ballsPerOver);
                    Log.d("undo", "strID : " + strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype + ", uout : " + uout);
                    Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);

                    Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);
                } else if (uetype == 5) {

                    Log.d("undo", "lastEvent : " + lastEvent);

//                       uptype = lastEvent.getPenaltyType();
//                           upteam = lastEvent.getPenaltyRunTeam();

                    RealmResults<Penalty> result = realm.where(Penalty.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).findAll();

                    Log.d("undo", " Penalty : " + result);

                    if (results.isEmpty()) {

                    } else {
                        Penalty penaltylast = result.last();


                        if (penaltylast != null) {

                            uptype = penaltylast.getType();
                            boolean ballcount = penaltylast.isBallCount();
                            boolean ubowball = penaltylast.isBowball();
                            boolean ubatsball = penaltylast.isBatsball();
//                           setExtras();

//======================================================================================================================================

                            if (uptype == 1) {

//                savePenalty(penaltyType, penaltyRunTeam, true, battingTeamNo);
                                // didn't removed it when both undo & cancel
                                if (totalExtras >= penaltyRun)
                                    totalExtras = totalExtras - penaltyRun;
                                else
                                    totalExtras = 0;

                                if (currentRuns >= penaltyRun)
                                    currentRuns = currentRuns - penaltyRun;
                                else
                                    currentRuns = 0;

                                if (psRuns >= penaltyRun)
                                    psRuns = psRuns - penaltyRun;
                                else
                                    psRuns = 0;

                                setInningsRuns(currentInnings, currentRuns);

                                if (currentInnings > 1 && currentInnings != 99) {
                                    remainingRuns = remainingRuns + penaltyRun;
//                               if (leadingRuns < 0)
                                    leadingRuns = leadingRuns - penaltyRun;

                                }

                               /*if (currentInnings > 1 && currentInnings != 99) {
                                   ll_remainings.setVisibility(View.VISIBLE);
//                                        penaltyType = 1;
                                   leadingRuns = leadingRuns + penaltyRun;
                                   if (remainingRuns > 0) {

                                       remainingRuns = remainingRuns - penaltyRun;
//                                            leadingRuns = leadingRuns + penaltyRun;
                                       tvRemainingRuns.setText(String.valueOf(remainingRuns));

                                   }

                                   if (leadingRuns > remainingRuns && totalInnings == 4) {
                                       tvRemainingRuns.setText(String.valueOf(leadingRuns));
                                       tvRemainingRunsText.setText("Leading Runs : ");
                                   }
                               }
                               else {
                                   ll_remainings.setVisibility(View.GONE);
                               }*/
                            } else if (uptype == 2) {

                                // added on 31/07/2020


                                // commented on 31/07/2020

                              /* if (totalInnings == currentInnings) {
                                   remainingRuns = remainingRuns - penaltyRun;

                                   if (currentInnings == 2) {
                                       innings1Runs = innings1Runs - penaltyRun;
                                   }
                                   else {
                                       if (!followon)
                                           innings3Runs = innings3Runs - penaltyRun;
                                   }
                                   // didn't removed it when both undo & cancel
                               }

                               else if (SUPER_OVER) {

                                   remainingRuns = remainingRuns - penaltyRun;
                                   if (currentInnings == 100) {
                                       so_inninngs1Runs = so_inninngs1Runs - penaltyRun;
                                       Log.d("so_inninngs1Runs","setPenalty22 , : "+so_inninngs1Runs);
                                   }
                               }*/
                            }

//                           penalty;

                            if (ballcount) {

                                if (strikerBalls > 0)
                                    strikerBalls--;
                                else
                                    strikerBalls = 0;

                                if (strikerDots > 0)
                                    --strikerDots;
                                else
                                    strikerDots = 0;

                                if (ps1ID == strID) {
                                    if (p1CB > 0)
                                        --p1CB;
                                    else
                                        p1CB = 0;
                                } else if (ps2ID == strID) {
                                    if (p2CB > 0)
                                        --p2CB;
                                    else
                                        p2CB = 0;
                                }

                                if (ubowball) {

                                   /*// commented on 06/05/2020
                                   if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                                       --bowlerBalls;
                                   else if (bowlerBalls > ballsPerOver)
                                       bowlerBalls = bowlerBalls - ballsPerOver;
                                   else if (bowlerBalls == 0) {
                                       bowlerBalls = ballsPerOver;
                                       --bowlerOver;
                                   }*/

                                    // added on 06/05/2020
                                    undoBowlerOver();

                                    if (bowlerDots > 0)
                                        --bowlerDots;
                                    else
                                        bowlerDots = 0;
//                               bowlerOver = bowlerOver - 0.1f;

                                    if (totalBalls > 0)
                                        --totalBalls;
                                    else
                                        totalBalls = 0;

                                    if (currentOver >= 0.1f)
                                        currentOver = currentOver - 0.1f;
                                    else
                                        currentOver = 0;

                                    if ((psBalls <= ballsPerOver) && (psBalls > 0))
                                        --psBalls;
                                    else if (psBalls > ballsPerOver)
                                        psBalls = psBalls - ballsPerOver;
                                    else if (psBalls == 0) {
                                        psBalls = ballsPerOver - 1;
                                        if (psOver > 0)
                                            --psOver;
                                        else
                                            psOver = 0;
                                    }

                                    if (currentInnings > 1 && currentInnings < 99) {
                                        ++remainingBalls;
                                        remainingOver = remainingOver + 0.1f;
                                        // added on 06/05/2020
                                        resetRemainingOver();
                                    }
                                }
                            }


//                           ===========================
//                            ============================
//                           =============================
/*
                           if (ballcount) {

                               if (ubowball) {
                                   --bowlerBalls;
//                        bowlerOver = bowlerOver + 0.1f;
                                   setOver(0);

                                   penaltyBallCount = 1;
                                   if (striker.matches(player1)) {
                                       player1Balls++;
                                       strikerBalls = player1Balls;
                                       tvPlayer1Balls.setText(String.valueOf(player1Balls));
                                   }
                                   if (striker.matches(player2)) {
                                       player2Balls++;
                                       strikerBalls = player2Balls;
                                       tvPlayer2Balls.setText(String.valueOf(player2Balls));
                                   }

                                   if (strID == ps1ID) {
                                       ++p1CB;
                                   } else if (strID == ps2ID) {
                                       ++p2CB;
                                   }
                               } else if (batsball) {
                                   if (striker.matches(player1)) {
                                       player1Balls++;
                                       strikerBalls = player1Balls;
                                       tvPlayer1Balls.setText(String.valueOf(player1Balls));
                                   }
                                   if (striker.matches(player2)) {
                                       player2Balls++;
                                       strikerBalls = player2Balls;
                                       tvPlayer2Balls.setText(String.valueOf(player2Balls));
                                   }

                                   if (strID == ps1ID) {
                                       ++p1CB;
                                   } else if (strID == ps2ID) {
                                       ++p2CB;
                                   }
                               }
                           }
*/


//  =====================================================================================================================================

                            removeFromPenalty();
                        }
                    }


//                       if (uptype == 1) {//upteam == battingTeamNo) {
//
//                           currentRuns = currentRuns - penaltyRun;
//                           if (psRuns >= penaltyRun)
//                               psRuns = psRuns - penaltyRun;
//                           else
//                               psRuns = 0;
//
//                           if (currentInnings > 1 && currentInnings != 99){
//                               remainingRuns = remainingRuns + penaltyRun;
////                               if (leadingRuns < 0)
//                                   leadingRuns = leadingRuns - 5;
//
//                           }
//                       }

                       /*else {
                           uerun = 0;
                       }*/

//                       boolean ballcount = lastEvent.isPenaltyBallCount();
//                       int penaltyBallCount = lastEvent.getPenaltyBallCounted();
//                       if (ballcount) {
//
//                           if (strikerBalls > 0)
//                               strikerBalls--;
//                           else
//                               strikerBalls = 0;
//
//                           if (ps1ID == strID){
//                               if (p1CB > 0)
//                                   --p1CB;
//                               else
//                                   p1CB = 0;
//                           }
//                           else if (ps2ID == strID){
//                               if (p2CB > 0)
//                                   --p2CB;
//                               else
//                                   p2CB = 0;
//                           }
//
//                           if (penaltyBallCount == 1) {
//
//                               if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
//                                   --bowlerBalls;
//                               else if (bowlerBalls > ballsPerOver)
//                                   bowlerBalls = bowlerBalls - ballsPerOver;
//                               else if (bowlerBalls == 0) {
//                                   bowlerBalls = ballsPerOver;
//                                   --bowlerOver;
//                               }
////                               bowlerOver = bowlerOver - 0.1f;
//
//                               if (totalBalls > 0)
//                                   --totalBalls;
//                               else
//                                   totalBalls = 0;
//
//                               if (currentOver >= 0.1f)
//                                   currentOver = currentOver - 0.1f;
//                               else
//                                   currentOver = 0;
//
//                               if ((psBalls <= ballsPerOver) && (psBalls > 0))
//                                   --psBalls;
//                               else if (psBalls > ballsPerOver)
//                                   psBalls = psBalls - ballsPerOver;
//                               else if (psBalls == 0) {
//                                   psBalls = ballsPerOver - 1;
//                                   if (psOver > 0)
//                                       --psOver;
//                                   else
//                                       psOver = 0;
//                               }
//
//                               if (currentInnings > 1 && currentInnings < 99){
//                                   ++remainingBalls;
//                                   remainingOver = remainingOver + 0.1f;
//                               }
//                           }
//                       }

                    modified = lastEvent.getUndoDisplay();

                    Log.d("undo", "ubtype : " + ubtype + ", psRuns : " + psRuns + ", psBalls : " + psBalls
                            + ", psOver : " + psOver + ", ballsPerOver : " + ballsPerOver);
                    Log.d("undo", "strID : " + strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype + ", uout : " + uout);
                    Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);

                    Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);
                }

                setUndoExtraCard(uetype, uerun, urun);

//                   modified = lastEvent.getUndoDisplay();

                Log.d("currentRuns", "undo, : " + currentRuns);

                Log.d("undo", "ubtype : " + ubtype + ", psRuns : " + psRuns + ", psBalls : " + psBalls
                        + ", psOver : " + psOver + ", ballsPerOver : " + ballsPerOver);
                Log.d("undo", "strID : " + strID + ", urun: " + urun + ", uerun : " + uerun + ", uetype : " + uetype + ", uout : " + uout);
                Log.d("undo", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);

                Log.d("undo", " ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);


                resetValues(lastEvent, ubtype);
                Log.d("remainingOver", "ubtype = 8, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 8, 2 : " + remainingBalls);
            } else if (ubtype == 9 || ubtype == 10) {

                Log.d("remainingOver", "ubtype = 9|10, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 9|10, 1 : " + remainingBalls);
//               endOver = false;
                if (endOfInnings)
                    endOfInnings = false;
                resetValues(lastEvent, ubtype);
                undo();
                Log.d("remainingOver", "ubtype = 9|10, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 9|10, 2 : " + remainingBalls);
            }




           /*else if (ubtype == 11) {

               if (endOfMatch)
                   endOfMatch = false;
           }*/

            else if (ubtype == 12) {

                Log.d("remainingOver", "ubtype = 12, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 12, 1 : " + remainingBalls);

                Log.d("Scoring", "undo 1, ubtype : " + ubtype + ", events : " + lastEvent);

                endOver = false;
                setStrikerNonStriker(lastEvent);
                Log.d("Scoring", "undo 2, ubtype : " + ubtype + ", events : " + lastEvent);
                setBowler(lastEvent);
                Log.d("Scoring", "undo 3, ubtype : " + ubtype + ", events : " + lastEvent);

                modified = lastEvent.getUndoDisplay();
                int intervalId = lastEvent.getIntervalId();  // Added on 07/07/2021
                if (intervalId != 7)  // Added on 07/07/2021
                    enableButtons(3);  // Added on 07/07/2021

                Log.d("Scoring", "undo 4, ubtype : " + ubtype + ", events : " + lastEvent);
                resetValues(lastEvent, ubtype);
                Log.d("remainingOver", "ubtype = 12, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 12, 2 : " + remainingBalls);


                undo();
                // commented on 04/05/2020
               /*if (!realm.isInTransaction()) {
                   realm.beginTransaction();
               }

               lastEvent.deleteFromRealm();
               realm.commitTransaction();*/


                // commented on 30/04/2020
               /*// added on 27/04/20
               if (isNetworkAvailable()) {
                   jsonEventArray = new JSONArray();
                   resetJSONEventArray();
               }*/

                // commented on 04/05/2020
/*
               Events events = realm.where(Events.class).
                       equalTo("matchid", matchid).
                       equalTo("innings", currentInnings).findAll().last();
//                equalTo("innings", currentInnings).max("eventID");
//                equalTo("eventID",  (event.getEventID() - 1)).findFirst();
               Log.d("undo12", "events : " + events);
               if (events != null) {
                   if (events.getBallType() == 12) {

                       setStrikerNonStriker(events);
                       setBowler(events);

                       modified = events.getUndoDisplay();
                       resetValues(events);
                   }
               }
//               resetOUT(lastEvent);*/
            } else if (ubtype == 13) {

                // added on 20/01/21
                Events secondLastEvent = realm.where(Events.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("eventID", (lastEvent.getEventID() - 1)).
                        findFirst();

                if (secondLastEvent != null) {

                    Log.d("remainingBalls", "ubtype = 13, 3 secondLastEvent : " + secondLastEvent);
                    if (secondLastEvent.getBallType() == 15) {
                        UNDO_LIMIT = true;

                        // added on 21/01/21
                        AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
                        alertDialog.setIcon(R.drawable.ball);
                        alertDialog.setCancelable(false);
                        alertDialog.setTitle("Undo has reached limit");
                        alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                                new DialogInterface.OnClickListener() {
                                    public void onClick(DialogInterface dialog, int which) {
                                        dialog.dismiss();
                                        btnUndo.setEnabled(false);
                                        initializeBowler();
                                        syncBowler();
                                        inningsNotStarted = true;

                                        setExtraCard(/*UNDO_LIMIT*/);
                                    }
                                });

                        alertDialog.show();
                        // ============== till here-

                    }
                } else {
                    // ======== till here

                    Log.d("remainingOver", "ubtype = 13, 1 : " + remainingOver);
                    Log.d("remainingBalls", "ubtype = 13, 1 : " + remainingBalls);

                    endOver = false;
                    Log.d("Scoring", "undo 1, ubtype : " + ubtype + ", events : " + lastEvent);

                    setStrikerNonStriker(lastEvent);
                    Log.d("Scoring", "undo 2, ubtype : " + ubtype + ", events : " + lastEvent);
                    setBowler(lastEvent);
                    Log.d("Scoring", "undo 3, ubtype : " + ubtype + ", events : " + lastEvent);

                    sessionID = lastEvent.getSessionId();
                    String ss = lastEvent.getSession();
//                   setSession();
                    if (sessionID == 7 || sessionID == 9 || sessionID == 11) {

                        btnUndo.setEnabled(true);
                        btnSwap.setEnabled(true);
                        btnScore.setEnabled(true);
                        btnOut.setEnabled(true);
                        btnExtras.setEnabled(true);
                        btnHash.setEnabled(true);
                        btnCom.setEnabled(true);
                        btnP.setEnabled(true);
                        btn0.setEnabled(true);
                        btn1.setEnabled(true);
                        btn2.setEnabled(true);
                        btn3.setEnabled(true);
                        btn4.setEnabled(true);
                        btn6.setEnabled(true);
                        btnInterval.setEnabled(true);
                        btnChangeBatsman.setEnabled(true);
                        btnChangeBowler.setEnabled(true);
                    } else if (sessionID == 8 || sessionID == 10) {

//                       btnUndo.setEnabled(false);
                        btnSwap.setEnabled(false);
                        btnScore.setEnabled(false);
                        btnOut.setEnabled(false);
                        btnExtras.setEnabled(false);
                        btnHash.setEnabled(false);
//                           btnCom.setEnabled(false);
                        btnP.setEnabled(false);
                        btn0.setEnabled(false);
                        btn1.setEnabled(false);
                        btn2.setEnabled(false);
                        btn3.setEnabled(false);
                        btn4.setEnabled(false);
                        btn6.setEnabled(false);
                        btnInterval.setEnabled(false);
                        btnChangeBatsman.setEnabled(false);
                        btnChangeBowler.setEnabled(false);
                    }

//               if (sid > 6)
//                   --sid;

                    if (sessionID == 6) {
                        ss = "MS";
//                   btnSession.setText("END SESSION1");
                        session_click = 0;
                    } else if (sessionID == 7) {
                        ss = "SE1";
//                       btnSession.setText("START SESSION2");
                        session_click = 1;
                    } else if (sessionID == 8) {
                        ss = "SS2";
//                           btnSession.setText("END SESSION2");
                        session_click = 2;
                    } else if (sessionID == 9) {
                        ss = "SE2";
//                            btnSession.setText("START SESSION3");
                        session_click = 3;
                    } else if (sessionID == 10) {

                        ss = "SS3";
//                                btnSession.setText("END SESSION3");
                        session_click = 4;
                    } else if (sessionID == 11) {
                        ss = "SE3";
//                                btnSession.setText("END OF INNINGS");
                        session_click = 5;
                    }

                    Log.d("Scoring", "undo 4, ubtype : " + ubtype + ", events : " + lastEvent);
//               setMatchStatus(ss, sid);


                    resetValues(lastEvent, ubtype);
                    Log.d("remainingOver", "ubtype = 13, 2 : " + remainingOver);
                    Log.d("remainingBalls", "ubtype = 13, 2 : " + remainingBalls);

                    // Added on 28/04/2021
                    Events preEvents = realm.where(Events.class).
                            equalTo("matchid", matchid).
                            lessThan("eventID", lastEvent.getEventID()).
                            findAll().last();

                    if (preEvents != null) {
                        if (preEvents.getBallType() != 15)
                            undo();
                    }

                    // === till here
                }
            } else if (ubtype == 16) {

                Log.d("remainingOver", "ubtype = 16, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 16, 1 : " + remainingBalls);

                endOver = false;
                if (endOfDay)
                    endOfDay = false;
                // added on 04/05/2020
                resetValues(lastEvent, ubtype);
                enableButtons(2);  // Added on 07/07/2021
                Log.d("remainingOver", "ubtype = 16, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 16, 2 : " + remainingBalls);
                undo();
            } else if (ubtype == 17) {

                Log.d("remainingOver", "ubtype = 17, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 17, 1 : " + remainingBalls);
                endOver = false;
                resetValues(lastEvent, ubtype);
                Log.d("remainingOver", "ubtype = 17, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 17, 2 : " + remainingBalls);
                undo();

            } else if (ubtype == 18) {     //substitution

                // updation on 05/09/2020

                Log.d("remainingOver", "ubtype = 18, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 18, 1 : " + remainingBalls);

                endOver = false;
                setStrikerNonStriker(lastEvent);
                setBowler(lastEvent);

                int newbowlerid = lastEvent.getNewBowlerID();


                // added new code to delete record from Substitution table record

               /*Substitution substitution = realm.where(Substitution.class).
                       equalTo("matchid", matchid).
                       equalTo("team", fieldingTeamNo).
                       equalTo("innings", currentInnings).
                       equalTo("player_OUT_ID", bowlerID).
//                      equalTo("concussion", true).
                       findFirst();*/

                Substitution substitution = realm.where(Substitution.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        findAll().last();

                if (substitution != null) {


                    player_in_id = substitution.getPlayer_IN_ID();
                    temp_team = substitution.getTeam();

                    sub_new_bowler_id = substitution.getNew_bowler_id();
                    Log.d("sub", "ubtype = 19, player_in_id 2 : " + player_in_id);
                    Log.d("sub", "ubtype = 19, bowlerID 2 : " + bowlerID);
                    Log.d("sub", "ubtype = 19, temp_team 2 : " + temp_team);
                    Log.d("sub", "ubtype = 19, sub_new_bowler_id 2 : " + sub_new_bowler_id);

                    if (!realm.isInTransaction()) {
                        realm.beginTransaction();
                    }

                    substitution.deleteFromRealm();

                    realm.commitTransaction();
                }

                Realm realm = null;
                try {
                     config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                    realm.executeTransaction(new Realm.Transaction() {
                        @Override
                        public void execute(Realm bgrealm) {

                            try {

                                if (player_in_id > 0) {
                                    Player player = bgrealm.where(Player.class).
                                            equalTo("matchid", matchid).
//                                           equalTo("team", fieldingTeamNo).
        equalTo("playerID", player_in_id).findFirst();

                                    if (player != null) {
                                        player.setSubstitute(true);
                                        player.setPlaying(false);
                                        player.setRetired_concussion(false);    // added on 27/02/2021
                                        bgrealm.copyToRealmOrUpdate(player);
                                    }
                                }

                                if (player_out_id > 0) {
                                    Player player = bgrealm.where(Player.class).
                                            equalTo("matchid", matchid).
                                            equalTo("playerID", player_out_id).findFirst();

                                    if (player != null) {

                                        player.setSubstitute(false);
                                        player.setRetired(false);
                                        player.setPlaying(true);
                                        player.setRetired_concussion(false);    // added on 27/02/2021
                                        player.setRetired_innings(0);
                                        bgrealm.copyToRealmOrUpdate(player);
                                    }
                                }

                            } catch (RealmPrimaryKeyConstraintException e) {
                                Toast.makeText(getApplicationContext(),
                                        "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                            }
                        }
                    });
                } catch (RealmException e) {
                    Log.d("scoring", "onclick, Exception : " + e);
                } finally {
                    if (realm != null) {
                        realm.close();
                    }
                }

                if (bowlerID == sub_new_bowler_id) {


                    Bowler bow = realm.where(Bowler.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", fieldingTeamNo).
                            equalTo("playerID", sub_new_bowler_id).findFirst();
                    Log.d("undobow", "bowler bt 6, : " + bow);
                    if (bow != null) {

                        if ((bow.getBalls() == 0) && (bow.getRuns() == 0) &&
                                (bow.getNoBalls() == 0) && (bow.getWides() == 0)) {

                            if (!realm.isInTransaction()) {
                                realm.beginTransaction();
                            }

                            bow.deleteFromRealm();
                            realm.commitTransaction();
                        }
                    }
                }

                resetValues(lastEvent, ubtype);
                Log.d("remainingOver", "ubtype = 18, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 18, 2 : " + remainingBalls);
            } else if (ubtype == 19) {     //concussion

                Log.d("remainingOver", "ubtype = 19, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 19, 1 : " + remainingBalls);

                temp_team = 0;
                endOver = false;
                setStrikerNonStriker(lastEvent);
                setBowler(lastEvent);

                Substitution substitution = realm.where(Substitution.class).
                        equalTo("matchid", matchid).
//                       equalTo("team", battingTeamNo).
        equalTo("innings", currentInnings).
                                equalTo("subID", lastEvent.getSubstitutionID()).
//                equalTo("concussion", true).
        findFirst();

                if (substitution != null) {

                    player_in_id = substitution.getPlayer_IN_ID();
                    player_out_id = substitution.getPlayer_OUT_ID();
                    temp_team = substitution.getTeam();
                    sub_new_bowler_id = substitution.getNew_bowler_id();
                    Log.d("sub", "ubtype = 19, player_in_id 1 : " + player_in_id);
                    Log.d("sub", "ubtype = 19, player_out_id 1 : " + player_out_id);
                    Log.d("sub", "ubtype = 19, temp_team 1 : " + temp_team);
                    Log.d("sub", "ubtype = 19, sub_new_bowler_id 1 : " + sub_new_bowler_id);
                    Log.d("sub", "ubtype = 19, bowlerID 1 : " + bowlerID);

                    if (!realm.isInTransaction()) {
                        realm.beginTransaction();
                    }

                    substitution.deleteFromRealm();
                    realm.commitTransaction();
                }

                Realm realm = null;
                try {
                     config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                    realm.executeTransaction(new Realm.Transaction() {
                        @Override
                        public void execute(Realm bgrealm) {

                            try {

                                if (player_in_id > 0) {
                                    Player player = bgrealm.where(Player.class).
                                            equalTo("matchid", matchid).
//                                           equalTo("team", fieldingTeamNo).
        equalTo("playerID", player_in_id).findFirst();

                                    if (player != null) {

                                        player.setSubstitute(true);
                                        player.setPlaying(false);
                                        player.setRetired_concussion(false);    // added on 27/02/2021
                                        bgrealm.copyToRealmOrUpdate(player);
                                    }
                                }

                                if (player_out_id > 0) {
                                    Player player = bgrealm.where(Player.class).
                                            equalTo("matchid", matchid).
                                            equalTo("playerID", player_out_id).findFirst();

                                    if (player != null) {

                                        player.setSubstitute(false);
                                        player.setRetired(false);
                                        player.setPlaying(true);
                                        player.setRetired_concussion(false);    // added on 27/02/2021
                                        player.setRetired_innings(0);
                                        bgrealm.copyToRealmOrUpdate(player);
                                    }
                                }

                               /*if (temp_team == fieldingTeamNo) {//player_in_id == bowlerID) {

                                   Bowler bow = bgrealm.where(Bowler.class).
                                           equalTo("matchid", matchid).
                                           equalTo("innings", currentInnings).
                                           equalTo("playerID", player_in_id).findFirst();

                                   if (bow != null) {

                                       if (bow.getOver() == 0 && bow.getBalls() == 0 && bow.getRuns() == 0 &&
                                               bow.getWides() == 0 && bow.getNoBalls() == 0 && bow.getWicket() == 0 &&
                                               bow.getDots() == 0 && bow.getMaidenOver() == 0) {

                                           if (!bgrealm.isInTransaction()) {
                                               bgrealm.beginTransaction();
                                           }

                                           bow.deleteFromRealm();
                                           bgrealm.commitTransaction();
                                       }
                                   }
                               }

                               else if (temp_team == battingTeamNo) {//player_in_id == strID || player_in_id == nstrID) {

                                   Batsman bats = bgrealm.where(Batsman.class).
                                           equalTo("matchid", matchid).
                                           equalTo("innings", currentInnings).
                                           equalTo("batsman_pID", player_in_id).findFirst();

                                   if (bats != null) {
                                       if (bats.getBalls() == 0 && bats.getRuns() == 0 && bats.getDots() == 0
                                               && bats.getOutType() == -1) {

                                           if (!bgrealm.isInTransaction()) {
                                               bgrealm.beginTransaction();
                                           }

                                           bats.deleteFromRealm();
                                           bgrealm.commitTransaction();
                                       }

                                   }

                               }*/


                            } catch (RealmPrimaryKeyConstraintException e) {
                                Toast.makeText(getApplicationContext(),
                                        "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                            }
                        }
                    });

                    resetValues(lastEvent, ubtype);
                } catch (RealmException e) {
                    Log.d("scoring", "onclick, Exception : " + e);
                } finally {
                    if (realm != null) {
                        realm.close();
                    }
                }


                Log.d("sub", "ubtype = 19, player_in_id 2 : " + player_in_id);
                Log.d("sub", "ubtype = 19, bowlerID 2 : " + bowlerID);
                Log.d("sub", "ubtype = 19, temp_team 2 : " + temp_team);
                Log.d("sub", "ubtype = 19, fieldingTeamNo 2 : " + fieldingTeamNo);
                Log.d("sub", "ubtype = 19, sub_new_bowler_id 2 : " + sub_new_bowler_id);
                if (temp_team == fieldingTeamNo) {//
//                   if (sub_new_bowler_id == bowlerID) {


                    Bowler bow = realm.where(Bowler.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", fieldingTeamNo).
                            equalTo("playerID", sub_new_bowler_id).findFirst();

                    Log.d("sub", "ubtype = 19, bow 1 : " + bow);

                    if (bow != null) {

                        if ((bow.getOver() == 0 && bow.getBalls() == 0 && bow.getRuns() == 0 &&
                                bow.getWides() == 0 && bow.getNoBalls() == 0 && bow.getWicket() == 0 &&
                                bow.getDots() == 0 && bow.getMaidenOver() == 0)) {

                            if (!realm.isInTransaction()) {
                                realm.beginTransaction();
                            }

                            bow.deleteFromRealm();
                            realm.commitTransaction();
                        }
                    }
//                   }
                } else if (temp_team == battingTeamNo) {//player_in_id == strID || player_in_id == nstrID) {

                    Batsman bats = realm.where(Batsman.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("batsman_pID", player_in_id).findFirst();

                    if (bats != null) {
                        if (bats.getBalls() == 0 && bats.getRuns() == 0 && bats.getDots() == 0
                                && bats.getOutType() == -1) {

                            if (!realm.isInTransaction()) {
                                realm.beginTransaction();
                            }

                            bats.deleteFromRealm();
                            realm.commitTransaction();
                        }

                    }

                }
                Log.d("remainingOver", "ubtype = 19, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 19, 2 : " + remainingBalls);
//               final int player_in
            } else if (ubtype == 20) {

                Log.d("remainingOver", "ubtype = 20, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 20, 1 : " + remainingBalls);
                Log.d("ball", "ubtype = 20, 1 : " + ball);


                endOver = false;
                int t_innings = lastEvent.getInnings();
                remainingRuns = lastEvent.getRemainingRuns();
                remainingBalls = lastEvent.getRemainingBalls();
//               remainingOver = lastEvent.getReducedOver();


                Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
                if (match != null) {

                    remainingOver = match.getActual_over();
                    // added on 06/05/2020
                    resetRemainingOver();

                    if (match.isReducedOver()) {
                        totalOver = match.getActual_over();

                        Realm realm = null;
                        try {
                             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                            realm.executeTransaction(new Realm.Transaction() {
                                @Override
                                public void execute(Realm bgrealm) {

                                    try {

                                        if (totalOver > 0) {
                                            match.setOver(totalOver);
                                            match.setReducedOver(false);
                                            match.setAppliedRainRule(null);
                                            if (t_innings == 2)
                                                match.setReducedRuns(false);

                                            bgrealm.copyToRealmOrUpdate(match);
                                        }

                                    } catch (RealmPrimaryKeyConstraintException e) {
                                        Toast.makeText(getApplicationContext(),
                                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                                    }
                                }
                            });

                            // commneted on 05/05/2020
                           /*resetValues(lastEvent);
                           undo();*/
                        } catch (RealmException e) {
                            Log.d("scoring", "onclick, Exception : " + e);
                        } finally {
                            if (realm != null) {
                                realm.close();
                            }
                        }
                    }
                }

                // added on 05/05/2020
                resetValues(lastEvent, ubtype);

                Log.d("remainingOver", "ubtype = 20, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = 20, 2 : " + remainingBalls);

                undo();


            } else if (/*ubtype == -1 || */ubtype == 21 || ubtype == 22 || ubtype == 23) {

                Log.d("remainingOver", "ubtype = -1|21|22|23, 1 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = -1|21|22|23, 1 : " + remainingBalls);

                endOver = false;
                resetValues(lastEvent, ubtype);

                Log.d("remainingOver", "ubtype = -1|23|22|23, 2 : " + remainingOver);
                Log.d("remainingBalls", "ubtype = -1|21|22|23, 2 : " + remainingBalls);

                undo();
            }


            // ADDED ON 27/02/2021
            else if (ubtype == 24 || ubtype == 25) {

                wk_id = lastEvent.getWkID();
                keeper_position = lastEvent.getWk_position();

                Realm realm = null;
                try {
                     config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                    realm.executeTransaction(new Realm.Transaction() {
                        @Override
                        public void execute(Realm bgrealm) {

                            try {

                                Player player1 = bgrealm.where(Player.class).
                                        equalTo("matchid", matchid).
                                        equalTo("team", fieldingTeamNo).
                                        equalTo("playerID", wk_id).findFirst();

                                if (player1 != null) {
                                    if (player1.isNew_wk()) {

                                        player1.setWicketKeeper(false);
                                        player1.setNew_wk(false);
                                        wk_position = player1.getWicketkeeping_position();
                                        player1.setWicketkeeping_position(0);

                                        bgrealm.copyToRealmOrUpdate(player1);
                                        Log.d("Undo24", "player1 = " + player1);
                                    }
                                }

                                Player player2 = bgrealm.where(Player.class).
                                        equalTo("matchid", matchid).
                                        equalTo("team", fieldingTeamNo).
                                        equalTo("playerID", pre_wk_id).findFirst();

                                if (player2 != null) {

                                    if (player2.getWicketkeeping_position() == pre_wk_position &&
                                            !player2.isNew_wk()) {

                                        wicketkeeper = player2.getPlayerName();
                                        wk_id = player2.getPlayerID();
                                        player2.setNew_wk(true);
                                        player2.setOld_wk(false);
                                        keeper_position = player2.getWicketkeeping_position();

                                        bgrealm.copyToRealmOrUpdate(player2);
                                        Log.d("Undo24", "player2 = " + player2);
                                    }
                                }

                            } catch (RealmPrimaryKeyConstraintException e) {
                                Toast.makeText(getApplicationContext(),
                                        "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                            }
                        }
                    });
                } catch (RealmException e) {
                    Log.d("scoring", "onclick, Exception : " + e);
                } finally {
                    if (realm != null) {
                        realm.close();
                    }
                }

                Events preEvent = realm.where(Events.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("eventID", lastEvent.getEventID()).findFirst();

                if (preEvent != null) {

                    pre_wk_id = preEvent.getPreWkID();
                    pre_wk_position = preEvent.getPreWk_position();
                }

                resetValues(lastEvent, ubtype);

                undo();


            }



          /*    COMMENTED ON 20/01/2021
           // added on 20/01/2021
           else if (ubtype == 15) {

               endOver = false;
               Log.d("Scoring", "undo 11, ubtype : "+ubtype+", events : "+lastEvent);

               setStrikerNonStriker(lastEvent);
               Log.d("Scoring", "undo 12, ubtype : "+ubtype+", events : "+lastEvent);
               setBowler(lastEvent);
               Log.d("Scoring", "undo 13, ubtype : "+ubtype+", events : "+lastEvent);

               sessionID = lastEvent.getSessionId();
               String ss = lastEvent.getSession();
               UNDO_LIMIT = true;
           }*/

          /* resetJSONEventArray();


           Events events = realm.where(Events.class).
                   equalTo("matchid", matchid).
                   equalTo("innings", currentInnings).
                   findAll().last();

           Log.d("undo", "events 1 : " + events);

           if (events != null) {

               Log.d("undo", "eventSync : "+ eventSync + ", events 2 : " + events);
               // post undo
//               jsonUndoArray.put(setUndoArray(events, lastEventID));
               if (eventSync)
                   setUndoArray(events, lastEventID);

//               if (isNetworkAvailable())
//                   postJSON(true);

           }*/


        }




           /*else {

               AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
               alertDialog.setIcon(R.drawable.ball);
               alertDialog.setTitle("Undo has reached limit");
               alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                       new DialogInterface.OnClickListener() {
                           public void onClick(DialogInterface dialog, int which) {
                               dialog.dismiss();
                           }
                       });

               alertDialog.show();
           }*/

    }

    // added on 06/05/2020
    void undoBowlerOver() {

        if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
            --bowlerBalls;
        else if (bowlerBalls > ballsPerOver)
            bowlerBalls = bowlerBalls - ballsPerOver;
        else if (bowlerBalls == 0) {
            if (bowlerOver >= 1) {
//               bowlerBalls = ballsPerOver;  // commented on 11/05/2020
                --bowlerOver;
            } else {
                bowlerOver = 0;
            }

            // added on 11/05/2020
            if (bowlerOver >= 0)
                bowlerBalls = ballsPerOver;
        }
    }


    // addded on 27/06/2020
    public JSONObject setUndo(Undo undoObject) {

           /* int b = 0, lb = 0, wd = 0, nb = 0, p = 0, wk = 0;
            Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();*/


        // commented on 08/07/2020--(A)


        /*Undo undoObject = realm.where(Undo.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findFirst();*/

        Match match = realm.where(Match.class).
                equalTo("matchid", matchid).findFirst();


        int ub = 0, ulb = 0, uwd = 0, unb = 0, up = 0, uwk = 0;
        int preBowId = 0;


        //for bowler

        JSONObject jsoncurrentbowler = new JSONObject();
        try {
            // commented on  16/07/2020
//                jsoncurrentbowler.put("id", undoObject.getBowler_pID());
            // added on 16/07/2020
            jsoncurrentbowler.put("playerid", undoObject.getBowler_pID());
            jsoncurrentbowler.put("run", undoObject.getBowlerRuns());
            // commented on  16/07/2020
            jsoncurrentbowler.put("over", undoObject.getBowlerOver());
            jsoncurrentbowler.put("balls", undoObject.getBowlerBalls());
            jsoncurrentbowler.put("wicket", undoObject.getBowlerWicket());
                /*// added on 16/07/2020
                jsoncurrentbowler.put("over",
//                        new DecimalFormat("##.#").format(
//                                Float.parseFloat(
                         undoObject.getBowlerOver() + "." + undoObject.getBowlerBalls());*/
            jsoncurrentbowler.put("fours", undoObject.getBowlerF4s());
            jsoncurrentbowler.put("sixes", undoObject.getBowlerS6s());  // --- till here
            jsoncurrentbowler.put("dots", undoObject.getBowlerDots());//bow.getDots());
            jsoncurrentbowler.put("maiden", undoObject.getBowlerMO());//bow.getMaidenOver());
            jsoncurrentbowler.put("wide", undoObject.getBowlerWides());//bow.getWides());
            jsoncurrentbowler.put("noball", undoObject.getBowlerNoball());//bow.getNoBalls());

        } catch (JSONException e) {
            e.printStackTrace();
        }


        JSONObject jsonotherendbowler = new JSONObject();
        preBowId = undoObject.getPreBowler_pID();

        if (undoObject.getPreBowler_pID() != 0) {

            try {
                // commented on  16/07/2020
//                    jsonotherendbowler.put("id", undoObject.getPreBowler_pID());
                // added on  16/07/2020
                jsonotherendbowler.put("playerid", undoObject.getPreBowler_pID());
                jsonotherendbowler.put("run", undoObject.getPreBowlerRuns());
                // commented on  16/07/2020
                jsonotherendbowler.put("over", undoObject.getPreBowlerOver());
                jsonotherendbowler.put("balls", undoObject.getPreBowlerBalls());
                jsonotherendbowler.put("wicket", undoObject.getPreBowlerWicket());
                   /* // added on 16/07/2020
                    jsonotherendbowler.put("over",
//                            new DecimalFormat("##.#").format(
//                                    Float.parseFloat(
                            undoObject.getPreBowlerOver() + "." + undoObject.getPreBowlerBalls());*/
                jsonotherendbowler.put("fours", undoObject.getPreBowlerF4s());
                jsonotherendbowler.put("sixes", undoObject.getPreBowlerS6s());//------ till here
                jsonotherendbowler.put("dots", undoObject.getPreBowlerDots());//bow.getDots());
                jsonotherendbowler.put("maiden", undoObject.getPreBowlerMO());//bow.getMaidenOver());
                jsonotherendbowler.put("wide", undoObject.getPreBowlerWides());//bow.getWides());
                jsonotherendbowler.put("noball", undoObject.getPreBowlerNoball());//bow.getNoBalls());


            } catch (JSONException e) {
                e.printStackTrace();
            }
        } else {
            try {
                // commented on  16/07/2020
//                    jsonotherendbowler.put("id", 0);
                // added on  16/07/2020
                jsonotherendbowler.put("playerid", 0);
                jsonotherendbowler.put("run", 0);
                // commented on  16/07/2020
                jsonotherendbowler.put("over", 0);
                jsonotherendbowler.put("balls", 0);
                jsonotherendbowler.put("wicket", 0);
                // added on  16/07/2020
                jsonotherendbowler.put("over", 0.0);
                jsonotherendbowler.put("fours", 0);
                jsonotherendbowler.put("sixes", 0); //------ till here
                jsonotherendbowler.put("dots", 0);
                jsonotherendbowler.put("maiden", 0);
                jsonotherendbowler.put("wide", 0);
                jsonotherendbowler.put("noball", 0);

            } catch (JSONException e) {
                e.printStackTrace();
            }
        }


        JSONObject jsonbowler = new JSONObject();
        try {
            // commented on  16/07/2020
//                jsonbowler.put("current", jsoncurrentbowler);
            // added on  16/07/2020
            jsonbowler.put("firstend", jsoncurrentbowler);
            Log.d("TEST", "setUndo, jsonotherendbowler : " + jsonotherendbowler);
            Log.d("TEST", "setUndo, preBowId : " + preBowId);
//                if (preBowId > 0)
            jsonbowler.put("otherend", jsonotherendbowler);
        } catch (JSONException e) {
            e.printStackTrace();
        }


        // for batsman

        JSONObject jsonstriker = new JSONObject();
        try {
            // commented on 11/08/2020
//                jsonstriker.put("id", undoObject.getStriker_pID());
            // added on 11/08/2020
            jsonstriker.put("playerid", undoObject.getStriker_pID());
            // commented on 11/08/2020
//                jsonstriker.put("run", undoObject.getStrikerRuns());
            // added on 11/08/2020
            jsonstriker.put("score", undoObject.getStrikerRuns());
            jsonstriker.put("ball", undoObject.getStrikerBalls());

            if (undoObject.getStrikerBattingOrder() == 100)//bats.getBattingOrder() == 100)
                jsonstriker.put("battingorder", 0);
            else
                jsonstriker.put("battingorder", undoObject.getStrikerBattingOrder());//bats.getBattingOrder());
            jsonstriker.put("dots", undoObject.getStrikerDots());//bats.getDots());
            jsonstriker.put("fours", undoObject.getStrikerF4s());//bats.getF4s());
            jsonstriker.put("sixes", undoObject.getStrikerS6s());//bats.getS6s());
            // added on 11/07/2020 & updated 16/07/2020
            if (undoObject.getStrikerOutType() == -1)
                jsonstriker.put("outtype", "no");
            else
                jsonstriker.put("outtype",
                        setUndoOutType(undoObject.getStrikerOutType()));


        } catch (JSONException e) {
            e.printStackTrace();
        }

        JSONObject jsonnonstriker = new JSONObject();
        try {
            // commented on 11/08/2020
//                jsonnonstriker.put("id", undoObject.getNonStriker_pID());
            // added on 11/08/2020
            jsonnonstriker.put("playerid", undoObject.getNonStriker_pID());
            // commented on 11/08/2020
//                jsonnonstriker.put("run", undoObject.getNonStrikerRuns());
            // added on 11/08/2020
            jsonnonstriker.put("score", undoObject.getNonStrikerRuns());
            jsonnonstriker.put("ball", undoObject.getNonStrikerBalls());

            if (undoObject.getNonStrikerBattingOrder() == 100)//bats.getBattingOrder() == 100)
                jsonnonstriker.put("battingorder", 0);
            else
                jsonnonstriker.put("battingorder", undoObject.getNonStrikerBattingOrder());//bats.getBattingOrder());
            jsonnonstriker.put("dots", undoObject.getNonStrikerDots());//bats.getDots());
            jsonnonstriker.put("fours", undoObject.getNonStrikerF4s());//bats.getF4s());
            jsonnonstriker.put("sixes", undoObject.getNonStrikerS6s());//bats.getS6s());
            // added on 11/07/2020 & updated 16/07/2020
            if (undoObject.getNonStrikerOutType() == -1)
                jsonnonstriker.put("outtype", "no");
            else
                jsonnonstriker.put("outtype",
                        setUndoOutType(undoObject.getNonStrikerOutType()));

        } catch (JSONException e) {
            e.printStackTrace();
        }


        JSONObject jsonbatsman = new JSONObject();
        try {
            jsonbatsman.put("striker", jsonstriker);
            jsonbatsman.put("nonstriker", jsonnonstriker);

        } catch (JSONException e) {
            e.printStackTrace();
        }


        // for adding total extras on events

        ub = undoObject.getExtraBye();//extraCard.getByes();
        ulb = undoObject.getExtraLb();//extraCard.getLb();
        uwd = undoObject.getExtraWd();//extraCard.getWide();// * wideRun;
        unb = undoObject.getExtraNb();//extraCard.getNoBall();// * noballRun;
        up = undoObject.getExtraP();//extraCard.getPenalty();// * penaltyRun;

        JSONObject jsonExtra = new JSONObject();
        try {
            jsonExtra.put("inningsextras",
                    (ub +
                            ulb +
                            (uwd * match.getWiderun()) +
                            (unb * match.getNoballrun()) +
                            (up * match.getPenaltyrun())));
            jsonExtra.put("byes", ub);
            jsonExtra.put("legbyes", ulb);
            jsonExtra.put("wide", uwd);
            jsonExtra.put("noball", unb);
            jsonExtra.put("penalty", up);

        } catch (JSONException e) {
            e.printStackTrace();
        }


        // adding inningssummary

        JSONObject jsonSummery = new JSONObject();
        try {

            if (undoObject.isSUPER_OVER()) {
                if (undoObject.getInnings() == 99)
                    jsonSummery.put("innings", 1);
                else if (undoObject.getInnings() == 100)
                    jsonSummery.put("innings", 2);
            } else
                jsonSummery.put("innings", undoObject.getInnings());
            jsonSummery.put("totalovers", Double.parseDouble(
                    new DecimalFormat("###.#").format(undoObject.getTotalovers())));
            jsonSummery.put("totalscore", undoObject.getTotalscore());
            jsonSummery.put("totalwicket", undoObject.getTotalwicket());
            jsonSummery.put("extras", jsonExtra);
        } catch (JSONException e) {
            e.printStackTrace();
        }


        // adding over summary
        JSONObject jsonOverSummary = new JSONObject();
        try {
            jsonOverSummary.put("runs", undoObject.getOverScore());
        } catch (JSONException e) {
            e.printStackTrace();
        }


        // getting fielderIDs
        JSONArray arrayFielder = new JSONArray();
        if (undoObject.getOuttype() == 1 || undoObject.getOuttype() == 3)
            arrayFielder.put(Integer.parseInt(undoObject.getFielderids()));
        else if (undoObject.getOuttype() == 2) {

            String[] arrSplit = undoObject.getFielderids().split(", ");
            for (int i = 0; i < arrSplit.length; i++) {

                arrayFielder.put(arrSplit[i]);
            }
        }
        Log.d("fielderids", "setEventJSON, arrayFielder : " + arrayFielder);


        if ((undoObject.getBalltype() == 3) && (undoObject.getOuttype() != 10))//ballType == 3 && outType != 10)
            uwk = undoObject.getTotalwicket();//wicket;
        else
            uwk = undoObject.getTotalwicket() + 1;//wicket + 1;

        Log.d("Partnership", "setEventJSON : newPartnership : " + newPartnership);
        Log.d("Partnership", "setEventJSON : wicket : " + wicket);
        Log.d("Partnership", "setEventJSON : uwk : " + uwk);


        JSONObject jsonFOW = new JSONObject();

        try {

            jsonFOW.put("wicketno", undoObject.getP_wicket_no());//partnership.getWicket());
            jsonFOW.put("partnershipsequence", undoObject.getP_sequence_no());//partnership.getPartnershipSequence());
            jsonFOW.put("partnershipruns", undoObject.getP_run());//partnership.getPartnershipRuns());
            jsonFOW.put("partnershipballs", undoObject.getP_ball());//partnership.getPartnershipBalls());
            jsonFOW.put("partnershipover", undoObject.getP_over());//partnership.getPartnershipOver())));
            jsonFOW.put("player1id", undoObject.getP_p1Id());//partnership.getPlayer1ID());
            jsonFOW.put("player2id", undoObject.getP_p2Id());//partnership.getPlayer2ID());
            jsonFOW.put("dismissedplayerid", undoObject.getP_disId());//partnership.getDismissedPlayerID());
            jsonFOW.put("player1contributedruns", undoObject.getP_p1cr());//partnership.getPlayer1ContributionRuns());
            jsonFOW.put("player1contributedballs", undoObject.getP_p1cb());//partnership.getPlayer1ContributionBalls());
            jsonFOW.put("player2contributedruns", undoObject.getP_p2cr());//partnership.getPlayer2ContributionRuns());
            jsonFOW.put("player2contributedballs", undoObject.getP_p2cb());//partnership.getPlayer2ContributionBalls());

            if (undoObject.getBalltype() != 3) {
                jsonFOW.put("partnershipbroken", "no");
            } else {
                if (undoObject.getOuttype() == 10)
                    jsonFOW.put("partnershipbroken", "no");
                else if (undoObject.getOuttype() != 10)
                    jsonFOW.put("partnershipbroken", "yes");
            }

        } catch (JSONException e) {
            e.printStackTrace();
        }


        //adding session details
        JSONObject jsonSession = new JSONObject();
        try {
//            if (events.getBallType() == 13) {
            if (undoObject.getSessionId() == 7 || undoObject.getSessionId() == 9 || undoObject.getSessionId() == 11)
                jsonSession.put("type", "end");

            else if (undoObject.getSessionId() == 8 || undoObject.getSessionId() == 10 ||
                    undoObject.getSessionId() == 12 || undoObject.getSessionId() == 6)
                jsonSession.put("type", "start");

            if (undoObject.getSessionId() == 7 || undoObject.getSessionId() == 12 || undoObject.getSessionId() == 6)
                jsonSession.put("number", 1);
            else if (undoObject.getSessionId() == 8 || undoObject.getSessionId() == 9)
                jsonSession.put("number", 2);
            else if (undoObject.getSessionId() == 10 || undoObject.getSessionId() == 11)
                jsonSession.put("number", 3);

        } catch (JSONException e) {
            e.printStackTrace();
        }


        //adding interval details
        JSONObject jsonInterval = new JSONObject();
        try {
            if (undoObject.getBalltype() == 12)
                jsonInterval.put("id", undoObject.getIntervalId());
            else
                jsonInterval.put("id", 0);
        } catch (JSONException e) {
            e.printStackTrace();
        }

        // for substitution and concussion
        JSONObject jsonSubstitution = new JSONObject();
        if (undoObject.getBalltype() == 18 || undoObject.getBalltype() == 19) {

            try {

                jsonSubstitution.put("team", undoObject.getSub_team());//substitution.getTeam());
                jsonSubstitution.put("playerout_id", undoObject.getSub_playerout_id());//substitution.getPlayer_OUT_ID());
                jsonSubstitution.put("playerin_id", undoObject.getSub_playerin_id());//substitution.getPlayer_IN_ID());

            } catch (JSONException e) {
                e.printStackTrace();
            }
//            }
        }


        JSONObject jsonPowerplay = new JSONObject();

        try {
            jsonPowerplay.put("start_over", undoObject.getPower_start_over());//power.getStart());
            jsonPowerplay.put("end_over", undoObject.getPower_end_over());//power.getEnd());
            jsonPowerplay.put("type", null);//power.getType());
            jsonPowerplay.put("sequence", undoObject.getPower_sequence());//power.getCount());

        } catch (JSONException e) {
            e.printStackTrace();
        }


        JSONObject jsonInnings = new JSONObject();

        ub = undoObject.getExtraBye();
        ulb = undoObject.getExtraLb();
        uwd = undoObject.getExtraWd();
        unb = undoObject.getExtraNb();
        up = undoObject.getExtraP();


        try {
            jsonInnings.put("bye", undoObject.getExtraBye());
            jsonInnings.put("legbyes", undoObject.getExtraLb());
            jsonInnings.put("wide", undoObject.getExtraWd());
            jsonInnings.put("noball", undoObject.getExtraNb());
            jsonInnings.put("penalty", undoObject.getExtraP());
            jsonInnings.put("totalextras",
                    (ub +
                            ulb +
                            (uwd * match.getWiderun()) +
                            (unb * match.getNoballrun()) +
                            (up * match.getPenaltyrun())));
            jsonInnings.put("runs", undoObject.getRuns());
            jsonInnings.put("wicket", undoObject.getTotalwicket());
            jsonInnings.put("teamid", undoObject.getBatting_team());
            jsonInnings.put("over", Double.parseDouble(
                    new DecimalFormat("###.#").format(undoObject.getTotalovers())));
            jsonInnings.put("totalscore", undoObject.getTotalscore());
            jsonInnings.put("totalwicket", undoObject.getTotalwicket());

        } catch (JSONException e) {
            e.printStackTrace();
        }

        JSONObject jsonUndo = new JSONObject();
        try {
            jsonUndo.put("matchID", undoObject.getMatchID());
            jsonUndo.put("eventid", undoObject.getEventID());
            jsonUndo.put("superover", undoObject.isSUPER_OVER());
            if (undoObject.isSUPER_OVER()) {
                if (undoObject.getInnings() == 99)
                    jsonUndo.put("inningsnumber", 1);
                else if (undoObject.getInnings() == 100)
                    jsonUndo.put("inningsnumber", 2);
            } else
                jsonUndo.put("inningsnumber", undoObject.getInnings());
            jsonUndo.put("battingteam", undoObject.getBatting_team());
            jsonUndo.put("over", undoObject.getOver());
            jsonUndo.put("ball", undoObject.getBall());
            jsonUndo.put("strikerid", undoObject.getStriker_pID());
            jsonUndo.put("nonstrikerid", undoObject.getNonStriker_pID());
            jsonUndo.put("bowlerid", undoObject.getBowler_pID());
            jsonUndo.put("balltype", undoObject.getBalltype());
            jsonUndo.put("innings", jsonInnings);


            if (undoObject.getDismissedbatsmanid() <= 0)
                jsonUndo.put("dismissedbatsmanid", 0);
            else
                jsonUndo.put("dismissedbatsmanid", undoObject.getDismissedbatsmanid());
            jsonUndo.put("disnewbatsmanid", undoObject.getDisnewbatsmanid());
            jsonUndo.put("outtype", undoObject.getOuttype());

            if (arrayFielder.length() == 0) {
                Log.d("fielderids", "setEventJSON 2, arrayFielder : " + arrayFielder);
                Log.d("fielderids", "setEventJSON 2, arrayFielder.length() : " + arrayFielder.length());
                jsonUndo.put("fielderids", 0);
            } else if (arrayFielder.length() > 0) {
                jsonUndo.put("fielderids", arrayFielder);
            }


            jsonUndo.put("extratype", undoObject.getExtraType());
            jsonUndo.put("freehit", undoObject.isFreehit());
            if (undoObject.getPenaltytype() == 1 || undoObject.getPenaltytype() == 2)
                jsonUndo.put("penaltybool", 1);
            else
                jsonUndo.put("penaltybool", 0);

            jsonUndo.put("penaltytype", undoObject.getPenaltytype());
            jsonUndo.put("runs", undoObject.getRuns());
            // commented on 08/07/2020
//                jsonUndo.put("extras", undoObject.getExtras());

            if (undoObject.getPenaltytype() > 0)
                jsonUndo.put("penaltyrun", undoObject.getPenalty()); // updated (penalty as penaltyrun) on 0/07/2020
            else
                jsonUndo.put("penaltyrun", 0);// updated (penalty as penaltyrun) on 0/07/202


            if (undoObject.getCommentary() != null)//|| !undoObject.getCommentary().matches(""))
                jsonUndo.put("commentary", undoObject.getCommentary());
            else
                jsonUndo.put("commentary", 0);


            jsonUndo.put("strokedirection", undoObject.getStrokedirection());

            // commented on 11/08/2020
//                jsonUndo.put("bowler", jsonbowler);
//                jsonUndo.put("batsman", jsonbatsman);
            // added on 11/08/2020
            jsonUndo.put("bowling", jsonbowler);
            jsonUndo.put("batting", jsonbatsman);

//                jsonUndo.put("inningssummary", jsonSummery);  // commented on 08/07/2020
            // added on 08/07/2020
            jsonUndo.put("extras", jsonExtra);

            if (undoObject.getBalltype() == 4 || undoObject.getBalltype() == 5)
                jsonUndo.put("oversummary", jsonOverSummary);

            jsonUndo.put("fallofwickets", jsonFOW);
            jsonUndo.put("session", jsonSession);
            jsonUndo.put("interval", jsonInterval);

            if (undoObject.getBalltype() == 18)
                jsonUndo.put("substitution", jsonSubstitution);
            else if (undoObject.getBalltype() == 19)
                jsonUndo.put("concussion", jsonSubstitution);

            else if (undoObject.getBalltype() == 21 || undoObject.getBalltype() == 22 || undoObject.getBalltype() == 23)
                jsonUndo.put("powerplay", jsonPowerplay);

            else if (undoObject.getBalltype() == 20) {
                jsonUndo.put("reducedover", match.getOver());
                if (undoObject.getInnings() == 2) {
                    jsonUndo.put("revisedtarget", undoObject.getRevisedTarget());
                    jsonUndo.put("appliedrainrule", undoObject.getAppliedRainRule());
                }

            }

        } catch (JSONException e) {
            e.printStackTrace();
        }

        // ---- till here  (A)


        /*
        // added on 08/07/2020
        Undo undoObject = realm.where(Undo.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findFirst();

        Match match =  realm.where(Match.class).
                equalTo("matchid", matchid).findFirst();

        int ub = 0, ulb = 0, uwd = 0, unb = 0, up = 0, uwk = 0;

        // getting fielderIDs
        JSONArray arrayFielder = new JSONArray();
        if (undoObject.getOuttype() == 1 || undoObject.getOuttype() == 3)
            arrayFielder.put( Integer.parseInt(undoObject.getFielderids()));
        else
        if (undoObject.getOuttype() == 2) {

            String[] arrSplit = undoObject.getFielderids().split(", ");
            for (int i = 0; i < arrSplit.length; i++) {

                arrayFielder.put(arrSplit[i]);
            }
        }
        Log.d("fielderids", "setEventJSON, arrayFielder : " + arrayFielder);

        // for adding total extras on events
        ub = undoObject.getExtraBye();//extraCard.getByes();
        ulb = undoObject.getExtraLb();//extraCard.getLb();
        uwd = undoObject.getExtraWd();//extraCard.getWide();// * wideRun;
        unb = undoObject.getExtraNb();//extraCard.getNoBall();// * noballRun;
        up = undoObject.getExtraP();//extraCard.getPenalty();// * penaltyRun;

        JSONObject jsonExtra = new JSONObject();
        try {
            *//*jsonExtra.put("inningsextras",
                    (ub +
                            ulb +
                            (uwd * match.getWiderun()) +
                            (unb * match.getNoballrun()) +
                            (up * match.getPenaltyrun())));*//*
            jsonExtra.put("byes", ub);
            jsonExtra.put("legbyes", ulb);
            jsonExtra.put("wide", uwd);
            jsonExtra.put("noball", unb);
            jsonExtra.put("penalty", up);

        } catch (JSONException e) {
            e.printStackTrace();
        }


        JSONObject jsonUndo = new JSONObject();
        try {
            jsonUndo.put("matchID", undoObject.getMatchID());
            jsonUndo.put("eventid", undoObject.getEventID());
            if (undoObject.isSUPER_OVER()) {
                if (undoObject.getInnings() == 99)
                    jsonUndo.put("innings", 1);
                else if (undoObject.getInnings() == 100)
                    jsonUndo.put("innings", 2);
            }

            else
                jsonUndo.put("innings", undoObject.getInnings());
            jsonUndo.put("balltype", undoObject.getBalltype());
            jsonUndo.put("over", undoObject.getOver());
            jsonUndo.put("ball", undoObject.getBall());
            jsonUndo.put("strikerid", undoObject.getStriker_pID());
            jsonUndo.put("nonstrikerid", undoObject.getNonStriker_pID());
            jsonUndo.put("bowlerid", undoObject.getBowler_pID());
            if (arrayFielder.length() == 0) {
                Log.d("fielderids", "setEventJSON 2, arrayFielder : " + arrayFielder);
                Log.d("fielderids", "setEventJSON 2, arrayFielder.length() : " + arrayFielder.length());
                jsonUndo.put("fielderids", 0);
            }
            else
            if (arrayFielder.length() > 0) {
                jsonUndo.put("fielderids", arrayFielder);
            }

           *//* if (undoObject.getDismissedbatsmanid() <= 0)
                jsonUndo.put("dismissedbatsmanid", 0);
            else
                jsonUndo.put("dismissedbatsmanid", undoObject.getDismissedbatsmanid());*//*
            jsonUndo.put("disnewbatsmanid", undoObject.getDisnewbatsmanid());
            jsonUndo.put("outtype", undoObject.getOuttype());
            jsonUndo.put("runs", undoObject.getRuns());
            jsonUndo.put("extratype", undoObject.getExtraType());
            jsonUndo.put("extras", undoObject.getExtras());
            jsonUndo.put("extras", jsonExtra);

//            jsonUndo.put("freehit", undoObject.isFreehit());
            if (undoObject.getPenaltytype() == 1 || undoObject.getPenaltytype() == 2)
                jsonUndo.put("penaltybool", 1);
            else
                jsonUndo.put("penaltybool", 0);

            jsonUndo.put("penaltytype", undoObject.getPenaltytype());

            if (undoObject.getPenaltytype() > 0)
                jsonUndo.put("penalty", undoObject.getPenalty());
            else
                jsonUndo.put("penalty", 0);


            if (undoObject.getCommentary() != null)//.matches(""))
                jsonUndo.put("commentary", undoObject.getCommentary());
            else
                jsonUndo.put("commentary", null);


        } catch (JSONException e) {
            e.printStackTrace();
        }*/


        Log.d("undo", "setUndo() 1, jsonUndoArray : " + jsonUndoArray);
        Log.d("undo", "setUndo() 2, jsonUndo : " + jsonUndo);
        return jsonUndo;
    }





/*
    public void setUndoArray(*/
    /*Events events, *//*
int undoID, int lastEventID, int innings, boolean out, boolean preOut){

        Log.d("undo", "jsonUndoArray 1 : " + jsonUndoArray);

        Undo undoObject = realm.where(Undo.class).
                equalTo("matchid", matchid).
                equalTo("innings", innings).findFirst();

        Match match =  realm.where(Match.class).
                equalTo("matchid", matchid).findFirst();



        int ub = 0, ulb = 0, uwd = 0, unb = 0, up = 0, uwk = 0;
        int preBowId = 0;





        //for current bowler
        // commented on 14/05/2020
        */
/*Bowler bow = realm.where(Bowler.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                equalTo("team", fieldingTeamNo).
                equalTo("playerID",bowlerID).findFirst();

        JSONObject jsoncurrentbowler = new JSONObject();
        try {
            jsoncurrentbowler.put("id", bowlerID);
            jsoncurrentbowler.put("run", bwRun);
            jsoncurrentbowler.put("over", bowlerOver);
            jsoncurrentbowler.put("balls", bowlerBalls);
            jsoncurrentbowler.put("wicket", bowlerWicket);
            if (bow != null) {
                jsoncurrentbowler.put("dots", bow.getDots());
                jsoncurrentbowler.put("maiden", bow.getMaidenOver());
                jsoncurrentbowler.put("wide", bow.getWides());
                jsoncurrentbowler.put("noball", bow.getNoBalls());
            }

            else {
                jsoncurrentbowler.put("dots", 0);
                jsoncurrentbowler.put("maiden", 0);
                jsoncurrentbowler.put("wide", 0);
                jsoncurrentbowler.put("noball", 0);
            }
        } catch (JSONException e) {
            e.printStackTrace();
        }*//*


        // added on 14/05/2020
        JSONObject jsoncurrentbowler = new JSONObject();
        try {
            jsoncurrentbowler.put("id", undoObject.getBowler_pID());
            jsoncurrentbowler.put("run", undoObject.getBowlerRuns());
            jsoncurrentbowler.put("over", undoObject.getBowlerOver());
            jsoncurrentbowler.put("balls", undoObject.getBowlerBalls());
            jsoncurrentbowler.put("wicket", undoObject.getBowlerWicket());
            jsoncurrentbowler.put("dots", undoObject.getBowlerDots());
            jsoncurrentbowler.put("maiden", undoObject.getBowlerMO());
            jsoncurrentbowler.put("wide", undoObject.getBowlerWides());
            jsoncurrentbowler.put("noball", undoObject.getBowlerNoball());
            // added on 16/07/2020
            jsoncurrentbowler.put("fours", undoObject.getBowlerF4s());
            jsoncurrentbowler.put("sixes", undoObject.getBowlerS6s());

        } catch (JSONException e) {
            e.printStackTrace();
        }// till here



        //for otherend bowler
        JSONObject jsonotherendbowler = new JSONObject();
        Log.d("TEST", "setUndoArray, jsonotherendbowler : " + jsonotherendbowler);
//        if (undoObject.getPreBowler_pID() != 0) { // commented on 15/05/2020
        // commented on 14/05/2020
            */
/*
        if (preBowlerID != 0) {

            bow = realm.where(Bowler.class).
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    equalTo("team", fieldingTeamNo).
                    equalTo("playerID", preBowlerID).findFirst();
            try {
                jsonotherendbowler.put("id", preBowlerID);
                jsonotherendbowler.put("run", preBowlerRun);
                jsonotherendbowler.put("over", preBowlerOver);
                jsonotherendbowler.put("balls", preBowlerBalls);
                jsonotherendbowler.put("wicket", preBowlerWicket);
                if (bow != null) {
                    jsonotherendbowler.put("dots", bow.getDots());
                    jsonotherendbowler.put("maiden", bow.getMaidenOver());
                    jsonotherendbowler.put("wide", bow.getWides());
                    jsonotherendbowler.put("noball", bow.getNoBalls());
                }
                else {
                    jsonotherendbowler.put("dots", 0);
                    jsonotherendbowler.put("maiden", 0);
                    jsonotherendbowler.put("wide", 0);
                    jsonotherendbowler.put("noball", 0);
                }
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }

        else {
            try {
                jsonotherendbowler.put("id", 0);
                jsonotherendbowler.put("run", 0);
                jsonotherendbowler.put("over", 0);
                jsonotherendbowler.put("balls", 0);
                jsonotherendbowler.put("wicket", 0);
                jsonotherendbowler.put("dots", 0);
                jsonotherendbowler.put("maiden", 0);
                jsonotherendbowler.put("wide", 0);
                jsonotherendbowler.put("noball", 0);
            } catch (JSONException e) {
                e.printStackTrace();
            }*//*
     // till here

            //added on 14/05/2020
            try {
                preBowId = undoObject.getBowler_pID();
                Log.d("TEST", "setUndoArray, preBowId : " + preBowId);
                jsonotherendbowler.put("id", undoObject.getBowler_pID());
                jsonotherendbowler.put("run", undoObject.getPreBowlerRuns());
                jsonotherendbowler.put("over", undoObject.getPreBowlerOver());
                jsonotherendbowler.put("balls", undoObject.getPreBowlerBalls());
                jsonotherendbowler.put("wicket", undoObject.getPreBowlerWicket());
                jsonotherendbowler.put("dots", undoObject.getPreBowlerDots());
                jsonotherendbowler.put("maiden", undoObject.getPreBowlerMO());
                jsonotherendbowler.put("wide", undoObject.getPreBowlerWides());
                jsonotherendbowler.put("noball", undoObject.getPreBowlerNoball());

            } catch (JSONException e) {
                e.printStackTrace();
            }// till here
//        } // commented on 15/05/2020



        // for bowler
        JSONObject jsonbowler = new JSONObject();
        try {
            jsonbowler.put("current", jsoncurrentbowler);
            if (preBowId > 0)
                jsonbowler.put("otherend", jsonotherendbowler);
        } catch (JSONException e) {
            e.printStackTrace();
        }




        // for striker
        // commentewd on 14/05/2020
        */
/*Batsman bats = realm.where(Batsman.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                equalTo("team", battingTeamNo).
                equalTo("batsman_pID", strID).findFirst();

        JSONObject jsonstriker = new JSONObject();
        try {
            jsonstriker.put("id", strID);
            jsonstriker.put("run", strikerRuns);
            jsonstriker.put("ball", strikerBalls);

            if (bats != null) {
                if (bats.getBattingOrder() == 100)
                    jsonstriker.put("battingorder", 0);
                else
                    jsonstriker.put("battingorder", bats.getBattingOrder());
                jsonstriker.put("dots", bats.getDots());
                jsonstriker.put("fours", bats.getF4s());
                jsonstriker.put("sixes", bats.getS6s());
            }
            else {

                jsonstriker.put("battingorder", 0);
                jsonstriker.put("dots", 0);
                jsonstriker.put("fours", 0);
                jsonstriker.put("sixes", 0);
            }
        } catch (JSONException e) {
            e.printStackTrace();
        }*//*


        // added on 14/05/2020
        JSONObject jsonstriker = new JSONObject();
        try {
            jsonstriker.put("id", undoObject.getStriker_pID());
            jsonstriker.put("run", undoObject.getStrikerRuns());
            jsonstriker.put("ball", undoObject.getStrikerBalls());

            if (undoObject.getStrikerBattingOrder() == 100)
                jsonstriker.put("battingorder", 0);
            else
                jsonstriker.put("battingorder", undoObject.getStrikerBattingOrder());

            jsonstriker.put("dots", undoObject.getStrikerDots());
            jsonstriker.put("fours", undoObject.getStrikerF4s());
            jsonstriker.put("sixes", undoObject.getStrikerS6s());
        } catch (JSONException e) {
            e.printStackTrace();
        }// till here




        // for nonstriker
        // commented on 15/05/2020
        */
/*bats = realm.where(Batsman.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                equalTo("team", battingTeamNo).
                equalTo("batsman_pID", nstrID).findFirst();
        JSONObject jsonnonstriker = new JSONObject();
        try {
            jsonnonstriker.put("id", nstrID);
            jsonnonstriker.put("run", nonStrikerRuns);
            jsonnonstriker.put("ball", nonStrikerBalls);
            if (bats != null) {
                if (bats.getBattingOrder() == 100)
                    jsonnonstriker.put("battingorder", 0);
                else
                    jsonnonstriker.put("battingorder", bats.getBattingOrder());
                jsonnonstriker.put("dots", bats.getDots());
                jsonnonstriker.put("fours", bats.getF4s());
                jsonnonstriker.put("sixes", bats.getS6s());
            }
            else  {
                jsonnonstriker.put("battingorder", 0);
                jsonnonstriker.put("dots", 0);
                jsonnonstriker.put("fours", 0);
                jsonnonstriker.put("sixes", 0);
            }
        } catch (JSONException e) {
            e.printStackTrace();
        }*//*
// till here


        // added on 15/05/2020
        JSONObject jsonnonstriker = new JSONObject();
        try {
            jsonnonstriker.put("id", undoObject.getNonStriker_pID());
            jsonnonstriker.put("run", undoObject.getNonStrikerRuns());
            jsonnonstriker.put("ball", undoObject.getNonStrikerBalls());

            if (undoObject.getNonStrikerBattingOrder() == 100)
                jsonnonstriker.put("battingorder", 0);
            else
                jsonnonstriker.put("battingorder", undoObject.getNonStrikerBattingOrder());

            jsonnonstriker.put("dots", undoObject.getNonStrikerDots());
            jsonnonstriker.put("fours", undoObject.getNonStrikerF4s());
            jsonnonstriker.put("sixes", undoObject.getNonStrikerS6s());

        } catch (JSONException e) {
            e.printStackTrace();
        }// till here



        // for batsman
        JSONObject jsonbatsman = new JSONObject();
        try {
            jsonbatsman.put("striker", jsonstriker);
            jsonbatsman.put("nonstriker", jsonnonstriker);

        } catch (JSONException e) {
            e.printStackTrace();
        }




        // for adding total extras on events
        //commented on 15/05/2020
        */
/*ExtraCard extraCard = realm.where(ExtraCard.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findFirst();
        Log.d("ScoreCard", "setEventJSON, extracard : "+extraCard);
        if (extraCard != null){

            ub = extraCard.getByes();
            ulb = extraCard.getLb();
            uwd = extraCard.getWide();
            unb = extraCard.getNoBall();
            up = extraCard.getPenalty();

        }

        else {
            ub = 0;
            ulb = 0;
            uwd = 0;
            unb = 0;
            up = 0;
        }

        JSONObject jsonExtra = new JSONObject();
        try {
            jsonExtra.put("inningsextras", (ub + ulb + (uwd * wideRun) + (unb * noballRun) + (up * penaltyRun)));
            jsonExtra.put("byes", ub);
            jsonExtra.put("legbyes", ulb);
            jsonExtra.put("wide", uwd);
            jsonExtra.put("noball", unb);
            jsonExtra.put("penalty", up);

        } catch (JSONException e) {
            e.printStackTrace();
        }*//*



        // added on 15/05/2020
        JSONObject jsonExtra = new JSONObject();
        try {

            ub = undoObject.getExtraBye();
            ulb = undoObject.getExtraLb();
            uwd = undoObject.getExtraWd();
            unb = undoObject.getExtraNb();
            up = undoObject.getExtraP();

            jsonExtra.put("inningsextras",
                    (ub +
                            ulb +
                            (uwd * match.getWiderun()) +
                            (unb * match.getNoballrun()) +
                            (up * match.getPenaltyrun())));
            jsonExtra.put("byes", ub);
            jsonExtra.put("legbyes", ulb);
            jsonExtra.put("wide", uwd);
            jsonExtra.put("noball", unb);
            jsonExtra.put("penalty", up);

        } catch (JSONException e) {
            e.printStackTrace();
        }// till here


        // adding inningssummary
        //commented on 15/05/2020
        */
/*JSONObject jsonSummery = new JSONObject();
        try {
            jsonSummery.put("innings", currentInnings);
            jsonSummery.put("totalovers", Float.parseFloat(
                    new DecimalFormat("###.#").format(currentOver)));
            jsonSummery.put("totalscore", currentRuns);
            jsonSummery.put("totalwicket", wicket);
            jsonSummery.put("extras", jsonExtra);
        } catch (JSONException e) {
            e.printStackTrace();
        }*//*


        // added on 15/05/2020
        JSONObject jsonSummery = new JSONObject();
        try {
            jsonSummery.put("innings", undoObject.getInnings());
            jsonSummery.put("totalovers", Float.parseFloat(
                    new DecimalFormat("###.#").format(undoObject.getTotalovers())));
            jsonSummery.put("totalscore", undoObject.getTotalscore());
            jsonSummery.put("totalwicket", undoObject.getTotalwicket());
            jsonSummery.put("extras", jsonExtra);
        } catch (JSONException e) {
            e.printStackTrace();
        }



        // commented on 15/05/2020
        */
/*if (preOut)//out )//|| undo_balltype_7)
            uwk = wicket;
        else
            uwk = wicket + 1;*//*




     */
/*else if (ballType == 3 && outType == 10)
            wk = wicket + 1;*//*


        //commented on 15/05/2020
        */
/*//*
/ added on 15/05/2020
        if (undoObject.getBallType() == 3 && events.getOutType() != 10)
            uwk = events.getWicket();
        else
            uwk = events.getWicket() + 1;*//*




        Log.d("Partnership", "setEventJSON : newPartnership : " + newPartnership);
        Log.d("Partnership", "setEventJSON : wicket : " + wicket);
        Log.d("Partnership", "setEventJSON : wk : " + uwk);

//        setEventJSON(events);       // remove this line after use

        //commented on 15/05/2020
        */
/*RealmResults<Partnership> results = realm.where(Partnership.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                equalTo("wicket", uwk).findAll();

        Log.d("Partnership", "results.isEmpty : " + results.isEmpty());

        JSONObject jsonFOW = new JSONObject();
        if (results.isEmpty()) {
            Log.d("Partnership", "results: " + results);
            try {
                jsonFOW.put("wicketno", uwk);
                jsonFOW.put("partnershipsequence", 1);
                jsonFOW.put("partnershipruns", 0);
                jsonFOW.put("partnershipballs", 0);
                jsonFOW.put("partnershipover", Float.parseFloat(
                        new DecimalFormat("###.#").format(0)));
                jsonFOW.put("player1id", 0);
                jsonFOW.put("player2id", 0);
                jsonFOW.put("dismissedplayerid", 0);
                jsonFOW.put("player1contributedruns", 0);
                jsonFOW.put("player1contributedballs", 0);
                jsonFOW.put("player2contributedruns", 0);
                jsonFOW.put("player2contributedballs", 0);
                jsonFOW.put("partnershipbroken", "yes");
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }
        else {
            for (Partnership ps : results)
                Log.d("Partnership", "setEventJSON 111 : " + ps);
            Partnership partnership = results.last();
            Log.d("Partnership", "setEventJSON : " + partnership);
            try {
                if (partnership != null) {
                    jsonFOW.put("wicketno", partnership.getWicket());
                    jsonFOW.put("partnershipsequence", partnership.getPartnershipSequence());
                    jsonFOW.put("partnershipruns", partnership.getPartnershipRuns());
                    jsonFOW.put("partnershipballs", partnership.getPartnershipBalls());
                    jsonFOW.put("partnershipover", Float.parseFloat(
                            new DecimalFormat("###.#").format(partnership.getPartnershipOver())));
                    jsonFOW.put("player1id", partnership.getPlayer1ID());
                    jsonFOW.put("player2id", partnership.getPlayer2ID());
                    jsonFOW.put("dismissedplayerid", partnership.getDismissedPlayerID());
                    jsonFOW.put("player1contributedruns", partnership.getPlayer1ContributionRuns());
                    jsonFOW.put("player1contributedballs", partnership.getPlayer1ContributionBalls());
                    jsonFOW.put("player2contributedruns", partnership.getPlayer2ContributionRuns());
                    jsonFOW.put("player2contributedballs", partnership.getPlayer2ContributionBalls());

                    if (!preOut){//!out){ //ubtype != 3) {
                        jsonFOW.put("partnershipbroken", "no");
                    } else {
                        if (uout == 10)
                            jsonFOW.put("partnershipbroken", "no");
                        else //if (uout != 10)
                            jsonFOW.put("partnershipbroken", "yes");
                    }
                }

                *//*
     */
/*else {
                    jsonFOW.put("wicketno", 0);

                    jsonFOW.put("partnershipruns", 0);
                    jsonFOW.put("partnershipballs", 0);
                    jsonFOW.put("partnershipover", Float.parseFloat(
                            new DecimalFormat("###.#").format(0)));
                    jsonFOW.put("player1id", 0);
                    jsonFOW.put("player2id", 0);
                    jsonFOW.put("dismissedplayerid", -1);
                    jsonFOW.put("player1contributedruns", 0);
                    jsonFOW.put("player1contributedballs", 0);
                    jsonFOW.put("player2contributedruns", 0);
                    jsonFOW.put("player2contributedballs", 0);
                    jsonFOW.put("partnershipbroken", "yes");
                }*//*
     */
/*
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }*//*



        // added on 15/05/2020
        JSONObject jsonFOW = new JSONObject();
        try {

            jsonFOW.put("wicketno", undoObject.getP_wicket_no());
            jsonFOW.put("partnershipsequence", undoObject.getP_sequence_no());
            jsonFOW.put("partnershipruns", undoObject.getP_run());
            jsonFOW.put("partnershipballs", undoObject.getP_ball());
            jsonFOW.put("partnershipover", Float.parseFloat(
                    new DecimalFormat("###.#").format(undoObject.getP_over())));
            jsonFOW.put("player1id", undoObject.getP_p1Id());
            jsonFOW.put("player2id", undoObject.getP_p2Id());
            jsonFOW.put("dismissedplayerid", undoObject.getP_disId());
            jsonFOW.put("player1contributedruns", undoObject.getP_p1cr());
            jsonFOW.put("player1contributedballs", undoObject.getP_p1cb());
            jsonFOW.put("player2contributedruns", undoObject.getP_p2cr());
            jsonFOW.put("player2contributedballs", undoObject.getP_p2cb());

        } catch (JSONException e) {
            e.printStackTrace();
        }   // till here


        */
/*//*
/ adding over summary
        JSONObject jsonOverSummary = new JSONObject();
        try {
            jsonOverSummary.put("runs", events.getMo());
        }
        catch (JSONException e) {
            e.printStackTrace();
        }*//*



        JSONObject jsonUndo = new JSONObject();
        try {
            */
/*//*
/ commented on 04/07/2020
            jsonUndo.put("undoID", undoID);
            jsonUndo.put("matchID", undoObject.getMatchID());
            //=========  till here*//*

            jsonUndo.put("eventid", lastEventID);
            jsonUndo.put("superover", undoObject.isSUPER_OVER()); //SUPER_OVER);
            if (undoObject.isSUPER_OVER()) { //SUPER_OVER) {
                if (undoObject.getInnings() == 99) //currentInnings == 99)
                    jsonUndo.put("innings", 1);
                else if (undoObject.getInnings() == 100) //currentInnings == 100)
                    jsonUndo.put("innings", 2);
            }

            else
                jsonUndo.put("innings", undoObject.getInnings()); //currentInnings);
            jsonUndo.put("bowler", jsonbowler);
            jsonUndo.put("batsman", jsonbatsman);
            jsonUndo.put("inningssummary", jsonSummery);

           */
/* if (events.getBallType() == 4 || events.getBallType() == 5)
                jsonUndo.put("oversummary", jsonOverSummary);*//*


            jsonUndo.put("fallofwickets", jsonFOW);
//            jsonUndo.put("session", jsonSession);
//            jsonUndo.put("interval", jsonInterval);

        } catch (JSONException e) {
            e.printStackTrace();
        }


        jsonUndoArray.put(jsonUndo);


//        newEvent();

//         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
//        realm.executeTransaction(new Realm.Transaction() {
//                                     @Override
//                                     public void execute(Realm bgRealm) {
//
//                                         try {
//                                             Events events1 = bgRealm.where(Events.class).
//                                                     equalTo("matchid", matchid).
//                                                     equalTo("innings", currentInnings).findAll().last();
//
//                                             if (events1 != null) {
//                                                 events1.setUndoArray(String.valueOf(jsonUndoArray));
//                                                 bgRealm.copyToRealm(events1);
//                                             }
//                                         }
//                                         catch (RealmException e){
//                                             Toast.makeText(getApplicationContext(), "Exception : "+ e, Toast.LENGTH_SHORT).show();
//                                         }
//                                         finally {
//
//                                             if (realm != null) {
//                                                 realm.close();
//                                             }
//                                         }
//                                     }
//                                 });

        Log.d("undo", "jsonUndoArray 2 : " + jsonUndoArray);
        // commented at 19/03/2020
        */
/*resetJSONEventArray();
        if (isNetworkAvailable())
            postJSON(true);*//*






        Log.d("undo", "jsonUndo : " + jsonUndo);

//        return jsonUndo;
    }
*/


    void setStrikerNonStriker(Events lastEvent) {

//        Events lastEvent = realm.where(Events.class).equalTo("matchid", matchid).
//                equalTo("innings", currentInnings).findAll().last();


        Log.d("Scoring", "setStrikerNonStriker, lastEvent : " + lastEvent);

        strID = lastEvent.getStrikerID();
        if (strID != 0) {

            striker = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", battingTeamNo).
                    equalTo("playerID", strID).findFirst().getPlayerName();
//        }
            strikerBalls = lastEvent.getStrikerBalls();
            strikerRuns = lastEvent.getStrikerRuns();
//        if (!striker.matches("")) {
            Batsman batsman = realm.where(Batsman.class).
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    equalTo("team", battingTeamNo).
                    equalTo("batsman_pID", strID).findFirst();
            strikerDots = batsman.getDots();
            strikerF4s = batsman.getF4s();
            strikerS6s = batsman.getS6s();

            Log.d("Scoring", "setStrikerNonStriker, striker : " + batsman);
        }

        nstrID = lastEvent.getNonStrikerID();
        if (nstrID != 0) {

            nonStriker = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", battingTeamNo).
                    equalTo("playerID", nstrID).findFirst().getPlayerName();
            nonStrikerRuns = lastEvent.getNonStrikerRuns();
            nonStrikerBalls = lastEvent.getNonStrikerBalls();
//        if (!nonStriker.matches("")) {
            Batsman batsman = realm.where(Batsman.class).
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    equalTo("team", battingTeamNo).
                    equalTo("batsman_pID", nstrID).findFirst();
            nonStrikerDots = batsman.getDots();
            nonStrikerF4s = batsman.getF4s();
            nonStrikerS6s = batsman.getS6s();
            Log.d("Scoring", "setStrikerNonStriker, nonStriker : " + batsman);

        }


        player1ID = lastEvent.getPlayer1ID();
        player2ID = lastEvent.getPlayer2ID();

        if (player1ID == strID && player2ID == nstrID) {

            player1 = striker;
            player2 = nonStriker;
        } else if (player1ID == nstrID && player2ID == strID) {

            player1 = nonStriker;
            player2 = striker;
        }
    }


    void setBowler(Events lastEvent) {

        bowlerID = lastEvent.getBowlerID();
//        bowlerID = lastEvent.getPrevBowlerID();
        if (bowlerID != 0) {
            bowler = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", fieldingTeamNo).
                    equalTo("playerID", bowlerID).findFirst().getPlayerName();
            Bowler bow = realm.where(Bowler.class).
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    equalTo("team", fieldingTeamNo).
                    equalTo("playerID", bowlerID).findFirst();
            Log.d("undobow", "bowler bt, lastEvent : " + lastEvent);
            Log.d("undobow", "bowler bt, : " + bow);

//            bwRun = lastEvent.getBowlerRuns();
//            bowlerBalls = lastEvent.getBowlerBalls();
//            bowlerOver = lastEvent.getBowlerOver();
//            bowlerWicket = lastEvent.getBowlerWicket();
//              bwRun = lastEvent.getPreBowlerRuns();
//              bowlerBalls = lastEvent.getPreBowlerBalls();
//              bowlerOver = lastEvent.getPreBowlerOver();
//              bowlerWicket = lastEvent.getPreBowlerWicket();

            if (bow != null) {

                Log.d("undo", "bowler, : " + bow);

                bwRun = bow.getRuns();//lastEvent.getBowlerRuns();
                bowlerBalls = bow.getBalls();//lastEvent.getBowlerBalls();
                bowlerOver = bow.getOver();//lastEvent.getBowlerOver();
                bowlerWicket = bow.getWicket();//lastEvent.getBowlerWicket();
                bowlerDots = bow.getDots();
                bowlerF4s = bow.getF4s();
                bowlerS6s = bow.getS6s();
                bowlerNoBall = bow.getNoBalls();
                bowlerWide = bow.getWides();
                bowlerMO = bow.getMaidenOver();

                if (bowlerBalls == 0) {
                    bowlerBalls = ballsPerOver;
                    if (bowlerOver > 0)
                        --bowlerOver;
                    else
                        bowlerOver = 0;
                }
            } else {

//                if (bowlerBalls == 0 && bwRun == 0) {
//
                resetBowler = true;
//                    bowlerWide = 0;
//                    bowlerMO = 0;
//                }
            }
            Log.d("undo", "setBowler, bowler : " + bow);
        }

//        tvBowler.setText(bowler);


//        Log.d("Scoring", "setBowler, bwRun : "+bwRun);
//        Log.d("Scoring", "setBowler, bowlerBalls : "+bowlerBalls);
//        Log.d("Scoring", "setBowler, bowlerOver : "+bowlerOver);
//        Log.d("Scoring", "setBowler, bowlerWicket : "+bowlerWicket);
//        Log.d("Scoring", "setBowler, bowlerF4s : "+bowlerF4s);
//        Log.d("Scoring", "setBowler, bowlerS6s : "+bowlerS6s);
//        Log.d("Scoring", "setBowler, bowlerMO : "+bowlerMO);
//
//        Log.d("Scoring", "setBowler, bowlerNoBall : "+bowlerNoBall);
//        Log.d("Scoring", "setBowler, bowlerWide : "+bowlerWide);

//
//        Events seclastEvent = realm.where(Events.class).
//                equalTo("matchid", matchid).
//                equalTo("eventID", (lastEventID - 1)).findFirst();
        lastPreBowlerID = lastEvent.getLastPreBowlerID();
        preBowlerID = lastEvent.getPrevBowlerID();

        if (preBowlerID != 0) {

            preBowler = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", fieldingTeamNo).
                    equalTo("playerID", preBowlerID).findFirst().getPlayerName();

            preBowlerRun = lastEvent.getPreBowlerRuns();
            preBowlerBalls = lastEvent.getPreBowlerBalls();
            preBowlerOver = lastEvent.getPreBowlerOver();
            preBowlerWicket = lastEvent.getPreBowlerWicket();

        }

//        else {
////            nextBowlerID = lastEvent.getNextBowlerID();
////            if (nextBowlerID != 0){
////
////                nextBowler = realm.where(Player.class).
////                        equalTo("matchid", matchid).
////                        equalTo("team", fieldingTeamNo).
////                        equalTo("playerID", nextBowlerID).findFirst().getPlayerName();
////            }
//
//        }
    }


    private void setPreBowlerVisibility(boolean visible) {

        if (visible) {

            tvBowler2.setVisibility(View.VISIBLE);
            tvBowlerOver2.setVisibility(View.VISIBLE);
            tvBowlerRuns2.setVisibility(View.VISIBLE);
            tvBowlerWicket2.setVisibility(View.VISIBLE);
            tvBowlerMO2.setVisibility(View.VISIBLE);

            tvBowler2.setText(preBowler);
            tvBowlerOver2.setText(String.valueOf(new DecimalFormat("##.#").
                    format(setOverDisplay(preBowlerOver, preBowlerBalls))));
            tvBowlerRuns2.setText(String.valueOf(preBowlerRun));
            tvBowlerWicket2.setText(String.valueOf(preBowlerWicket));
            tvBowlerMO2.setText(String.valueOf(preBowlerMO));
        } else {

            tvBowler2.setVisibility(View.INVISIBLE);
            tvBowlerOver2.setVisibility(View.INVISIBLE);
            tvBowlerRuns2.setVisibility(View.INVISIBLE);
            tvBowlerWicket2.setVisibility(View.INVISIBLE);
            tvBowlerMO2.setVisibility(View.INVISIBLE);
        }
    }


    void undoExtra() {  // resetting extras in out


        Events lastEvent = realm.where(Events.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findAll().last();

        Log.d("undo", "undoExtra 1, lastEventID : " + lastEvent.getEventID() + ",psRuns : " + psRuns +
                ", psBalls : " + psBalls + ", psOver : " + psOver);
        Log.d("undo", "undoExtra 1, strID : " + strID + ", nstrID : " + nstrID);
        Log.d("undo", "undoExtra 1, ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
        Log.d("undo", "undoExtra 1, ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);


        uout = lastEvent.getOutType();
        uetype = lastEvent.getExtraType();
//        urun = lastEvent.getCurrentRun();

        if (uetype > -1) {

            if (uetype == 0 || uetype == 1) {

                uerun = lastEvent.getExtraRuns();

//                if ((uerun % 2) != 0)
//                    swap();

                if (currentRuns >= uerun)
                    currentRuns = currentRuns - uerun;
                else
                    currentRuns = 0;

                if (psRuns >= uerun)
                    psRuns = psRuns - uerun;
                else
                    psRuns = 0;

               /* if ((uerun % 2) != 0)
                    swap();*/

                if (currentInnings > 1 && currentInnings < 99) {

                    remainingRuns = remainingRuns + uerun;
                    leadingRuns = leadingRuns - uerun;
//                    ++remainingBalls;
//                    remainingOver = remainingOver + 0.1f;
                }
            } else if (uetype == 2) {

                uerun = noballRun;

                if (bwRun >= uerun)
                    bwRun = bwRun - uerun;
                else
                    bwRun = 0;

                // added on 04/05/2020
                if (mo >= uerun)
                    mo = mo - uerun;
                else
                    mo = 0;

                if (bowlerNoBall > 0)
                    --bowlerNoBall;
                else
                    bowlerNoBall = 0;

                if ((uout != 2) && (uout != 7) && (uout != 6) && (uout != 5)) {
                    if (bowlerDots > 0)
                        --bowlerDots;
                    else
                        bowlerDots = 0;
                }

                if (currentRuns >= uerun)
                    currentRuns = currentRuns - uerun;
                else
                    currentRuns = 0;

                if (psRuns >= uerun)
                    psRuns = psRuns - uerun;
                else
                    psRuns = 0;

                if (currentInnings > 1 && currentInnings < 99) {
                    remainingRuns = remainingRuns + uerun;
                }

            } else if (uetype == 3 || uetype == 6) {

                uerun = lastEvent.getExtraRuns();

//                if (((uerun - noballRun) % 2) != 0)
//                    swap();

                if (bowlerNoBall > 0)
                    --bowlerNoBall;
                else
                    bowlerNoBall = 0;

                if (bwRun >= noballRun)
                    bwRun = bwRun - noballRun;
                else
                    bwRun = 0;

                // added on 04/05/2020
                if (mo >= noballRun)
                    mo = mo - noballRun;
                else
                    mo = 0;

                if (currentRuns >= uerun)
                    currentRuns = currentRuns - uerun;
                else
                    currentRuns = 0;

                if (psRuns >= uerun)
                    psRuns = psRuns - uerun;
                else
                    psRuns = 0;


                if (currentInnings > 1 && currentInnings < 99) {
                    remainingRuns = remainingRuns + uerun;
                }
            } else if (uetype == 4) {

                uerun = lastEvent.getExtraRuns();
//                if (((uerun - wideRun) % 2) != 0)
//                    swap();

                if (bowlerWide >= uerun)
                    bowlerWide = bowlerWide - uerun;
                else
                    bowlerWide = 0;

                if (bwRun >= uerun)
                    bwRun = bwRun - uerun;
                else
                    bwRun = 0;

                // added on 04/05/2020
                if (mo >= uerun)
                    mo = mo - uerun;
                else
                    mo = 0;

                if (currentRuns >= uerun)
                    currentRuns = currentRuns - uerun;
                else
                    currentRuns = 0;
                Log.d("currentRuns", "undoExtra() : " + currentRuns);

                if (psRuns >= uerun)
                    psRuns = psRuns - uerun;
                else
                    psRuns = 0;


                if (currentInnings > 1 && currentInnings != 99) {
                    remainingRuns = remainingRuns + uerun;
                }

/*                ++bowlerBalls;
                if (bowlerBalls >= ballsPerOver) {
                    ++bowlerOver;
//                    if (bowlerBalls == ballsPerOver)
//                        bowlerBalls = 0;
//                    else if (bowlerBalls > ballsPerOver)
                        bowlerBalls = bowlerBalls - ballsPerOver;
                }*/

                ++totalBalls;
                currentOver = currentOver + 0.1f;
//                ++strikerBalls;
                ++ball;

                /*++psBalls;
                if (psBalls >= ballsPerOver) {
                    ++psOver;
                    if (psBalls == ballsPerOver)
                        psBalls = 0;
                    else if (psBalls == (ballsPerOver + 1))
                        psBalls = 1;
                }

                if (ps1ID == strID)
                    ++p1CB;
                else if (ps2ID == strID)
                    ++p2CB;*/
            } else if (uetype == 5) {

                uptype = lastEvent.getPenaltyType();

//                upteam = lastEvent.getPenaltyRunTeam();

                Log.d("undo", "undoExtra 1, uptype : " + uptype);
                Log.d("undo", "undoExtra 1, upteam : " + upteam);

                if (uptype == 1) {//upteam == battingTeamNo) {          // runs goes to batting team

                    if (currentRuns >= penaltyRun)
                        currentRuns = currentRuns - penaltyRun;
                    else
                        currentRuns = 0;
                    if (psRuns >= penaltyRun)
                        psRuns = psRuns - penaltyRun;
                    else
                        psRuns = 0;
                    uerun = penaltyRun;

//                    also need to delete the record
                } else if (uptype == 2) {          // runs goes to fielding team
                    uerun = 0;


                }
                boolean ballcount = lastEvent.isPenaltyBallCount();
                int penaltyBallCount = lastEvent.getPenaltyBallCounted();

                removeFromPenalty();
                /*RealmResults<Penalty> results = realm.where(Penalty.class).
                        equalTo("matchid", matchid).equalTo("innings", currentInnings).findAll();

                if (results.isEmpty()) {

                }

                else {
                    Penalty penalty = results.last();
                    if (penalty != null) {
                        if (!realm.isInTransaction()) {
                            realm.beginTransaction();
                        }

                        penalty.deleteFromRealm();
                        realm.commitTransaction();
                    }
                }*/


//                if (ballcount){
//                    strikerBalls--;
//                    if (penaltyBallCount == 1){
//                        bowlerBalls-- ;
//                        bowlerOver = - 0.1f;
//                        totalBalls--;
//                        currentOver = - 0.1f;
//                    }
//
//                }


//            }

//            cur

                if (currentInnings > 1 && currentInnings < 99) {

                    /*if (remainingRuns < 0) {

                        if (leadingRuns > 0)
                            leadingRuns = leadingRuns - uerun;

                        else if (leadingRuns < uerun)
                            remainingRuns = uerun - leadingRuns;
                    } else //if (remainingRuns > 0)*/
                    remainingRuns = remainingRuns + uerun;
                    leadingRuns = leadingRuns - urun;


                    /*++remainingBalls;
                    remainingOver = remainingOver + 0.1f;*/

                }
            }

            Log.d("undo", "undoExtra 2, lastEventID : " + lastEvent.getEventID() + ",psRuns : " + psRuns +
                    ", psBalls : " + psBalls + ", psOver : " + psOver);
            Log.d("undo", "undoExtra 2, strID : " + strID + ", nstrID : " + nstrID);
            Log.d("undo", "undoExtra 2, ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
            Log.d("undo", "undoExtra 2, ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);


            setUndoExtraCard(uetype, uerun, urun);

        }

        Log.d("undo", "undoExtra 3, lastEventID : " + lastEvent.getEventID() + ",psRuns : " + psRuns +
                ", psBalls : " + psBalls + ", psOver : " + psOver);
        Log.d("undo", "undoExtra 3, strID : " + strID + ", nstrID : " + nstrID);
        Log.d("undo", "undoExtra 3, ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
        Log.d("undo", "undoExtra 3, ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

    }


    public void setUndoExtraCard(int uetype, int uerun, int urun) {
//        setExtraCard();


        Realm realm = null;
        try {

             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgrealm) {

                    try {

                        ExtraCard extraCard = bgrealm.where(ExtraCard.class).equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).findFirst();


                        ecByes = extraCard.getByes();
                        ecLB = extraCard.getLb();
                        ecNoball = extraCard.getNoBall();
                        ecWide = extraCard.getWide();
                        ecPenlaty = extraCard.getPenalty();
                        Log.d("scoring", "undo, b4 object ; " + extraCard);
                        Log.d("scoring", "undo, b4 b ; " + ecByes);
                        Log.d("scoring", "undo, b4 lb ; " + ecLB);
                        Log.d("scoring", "undo, b4 nb ; " + ecNoball);
                        Log.d("scoring", "undo, b4 wd ; " + ecWide);
                        Log.d("scoring", "undo, b4 p ; " + ecPenlaty);


                        if (uetype == 0) {

                            if (ecByes > 0)
                                ecByes = ecByes - uerun;
                        } else if (uetype == 1) {
                            if (ecLB > 0)
                                ecLB = ecLB - uerun;
                        } else if (uetype == 4) {
//                                int t = uerun;// - wideRun;
                            if (ecWide >= uerun && ecWide > 0) {
                                ecWide = ecWide - uerun;
                            } else
                                ecWide = 0;
                        } else if (uetype == 2) {

                            --ecNoball;

                        } else if (uetype == 3) {
                            --ecNoball;


                            if (ecByes > 0)
                                ecByes = ecByes - (uerun - noballRun);
//                                else
//                                    ecByes = ecByes - noballRun
                        } else if (uetype == 6) {
                            --ecNoball;


                            if (ecLB > 0)
                                ecLB = ecLB - (uerun - noballRun);
//                                else
//                                    extraRun = ecLB - noballRun;

                        } else if (uetype == 5) {
                            --ecPenlaty;
                        }
                        extraCard.setByes(ecByes);
                        extraCard.setLb(ecLB);
                        extraCard.setWide(ecWide);
                        extraCard.setNoBall(ecNoball);
                        extraCard.setPenalty(ecPenlaty);

                        Log.d("scoring", "undo, af object ; " + extraCard);
                        Log.d("scoring", "undo, af b ; " + ecByes);
                        Log.d("scoring", "undo, af lb ; " + ecLB);
                        Log.d("scoring", "undo, af nb ; " + ecNoball);
                        Log.d("scoring", "undo, af wd ; " + ecWide);
                        Log.d("scoring", "undo, af p ; " + ecPenlaty);


                        bgrealm.insertOrUpdate(extraCard);


//                    }catch(RealmPrimaryKeyConstraintException e){
//                        Toast.makeText(getApplicationContext(), "Primary Key exists, Press Update instead",
//                                Toast.LENGTH_SHORT).show();
//                    }
//                }
//            });

                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });

        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }


    }


    void resetPartnership(int dismissedPlayerID) {

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        RealmResults<Partnership> results = realm.where(Partnership.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                findAll();

        if (results.isEmpty())
            Log.d("Partnership", "results : " + results);
        else {

            Partnership partnership = results.last();
            Log.d("Partnership", "partnership.getDismissedPlayerID() : " + partnership.getDismissedPlayerID());
            Log.d("Partnership", "dismissedPlayerID : " + dismissedPlayerID);
            if (partnership.getDismissedPlayerID() == dismissedPlayerID) {

//                syncBowler();

                 config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                realm.executeTransaction(new Realm.Transaction() {
                    @Override
                    public void execute(Realm realm) {

                        try {

                            partnership.setDismissedPlayerID(-1);
                            partnership.setSync(0);


                            realm.insertOrUpdate(partnership);
//                        }

                        } catch (RealmException e) {
                            Log.d("SynchBowler", "Exception  : " + e);
                        }
                    }

                });

            }
        }
    }


    void removeFromFOW(int dismissedPlayerID) {

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);

        FOW fowLast = realm.where(FOW.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                equalTo("team", battingTeamNo).
                equalTo("dismissedPlayerID", dismissedPlayerID).findFirst();


        if (fowLast != null) {

            if (!realm.isInTransaction()) {
                realm.beginTransaction();
            }

            fowLast.deleteFromRealm();

            realm.commitTransaction();
        }
    }


    void removeFromPenalty() {


         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);

        RealmResults<Penalty> results = realm.where(Penalty.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findAll();

        if (results.isLoaded()) {
            Penalty penaltylast = results.last();


            if (penaltylast != null) {

                if (!realm.isInTransaction()) {
                    realm.beginTransaction();
                }

                penaltylast.deleteFromRealm();

                realm.commitTransaction();
            }
        }
    }


    void resetRetire(int retiredPlayerID) {


        Log.e("Scoring", "resetRetire st beginning, retiredList : " + retiredList);
        Log.e("Scoring", "resetRetire st beginning, dismissedList : " + dismissedList);

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);

       /* Realm realms = null;
        try {
            realms = Realm.getDefaultInstance();
            realms.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgrealm) {

                    try {

                        Batsman batsman = bgrealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("team", battingTeamNo).
                                equalTo("batsman_pID", retiredPlayerID).findFirst();

                        batsman.setRetired(false);
                        bgrealm.copyToRealmOrUpdate(batsman);
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        }

        catch (RealmException e) {
            Log.d("scoring", "onclick, Exception : " + e);
        }

        finally {
            if (realms != null) {
                realms.close();
            }
        }


        if (retiredList.size() > 0) {
            for (int i = 0; i < retiredList.size(); i++) {

                if (retiredList.get(i) == retiredPlayerID) {

                    retiredList.remove(i);
                }
            }
        }*/

//        Log.e ("Scoring", "resetRetire at last, retiredList : "+retiredList);
//        Log.e("Scoring", "resetRetire at last, dismissedList : "+dismissedList);


        Realm realms = null;
        try {
            realms = Realm.getDefaultInstance();
            realms.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgrealm) {

                    try {

                        Batsman batsman = bgrealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("team", battingTeamNo).
                                equalTo("batsman_pID", retiredPlayerID).findFirst();

                        batsman.setRetired(false);
                        bgrealm.copyToRealmOrUpdate(batsman);

                        /*if (player_in_id > 0) {
                            Player player = bgrealm.where(Player.class).
                                    equalTo("matchid", matchid).
                                    equalTo("team", battingTeamNo).
                                    equalTo("playerID", player_in_id).findFirst();

                            if (player != null) {

                                player.setSubstitute(true);
                                bgrealm.copyToRealmOrUpdate(player);
                            }
                        }*/


                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("scoring", "onclick, Exception : " + e);
        } finally {
            if (realms != null) {
                realms.close();
            }
        }


        if (retiredList.size() > 0) {
            for (int i = 0; i < retiredList.size(); i++) {

                if (retiredList.get(i) == retiredPlayerID) {

                    retiredList.remove(i);
                }
            }
        }

        Log.e("Scoring", "resetRetire at last, retiredList : " + retiredList);
        Log.e("Scoring", "resetRetire at last, dismissedList : " + dismissedList);


    }


    void resetOUT(Events event) {

        boolean setBatsman = false;

        Log.d("TEST", "resetOUT, event 1 = " + event);

        Events lastEvent = realm.where(Events.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findAll().last();
//                equalTo("innings", currentInnings).max("eventID");
//                equalTo("eventID",  (event.getEventID() - 1)).findFirst();
        if (lastEvent != null) {

            Log.d("TEST", "resetOUT, lastEvent 1 = " + lastEvent);
            Log.d("TEST", "resetOUT, lastEvent.getBallType 1 = " + lastEvent.getBallType());
            if (lastEvent.getBallType() == 3) {


                if (lastEvent.getSyncstatus() == 1)
                    eventSync = true;
                else
                    eventSync = false;

                lastEventID = lastEvent.getEventID();

                undo_balltype_7 = true;
                out = false;
                uout = lastEvent.getOutType();
                uetype = lastEvent.getExtraType();
                urun = lastEvent.getCurrentRun();
                uerun = lastEvent.getExtraRuns();
                bowler = ubowler;
                Log.d("undo2", "resetOUT ubtype : " + ubtype + ", events : " + lastEvent + ", uout : " + uout
                        + ", currentRuns : " + currentRuns + ", currentOver : " + currentOver);
                setStrikerNonStriker(lastEvent);
                setBowler(lastEvent);

                if ((uout != (player_count - 1)) && (wicket > 0)) {

                    if (wicket > 0)
                        --wicket;
                    else
                        wicket = 0;
                }

                if (allOUT) {
                    allOUT = false;
                    tvTotalWicket.setVisibility(View.VISIBLE);
                    tvdiv.setVisibility(View.VISIBLE);
                    endOfInnings = false;

                    // disabling all buttons in Scoring
//                    btnUndo.setEnabled(false);
                    btnSwap.setEnabled(true);
                    btnScore.setEnabled(true);
                    btnOut.setEnabled(true);
                    btnExtras.setEnabled(true);
                    btnHash.setEnabled(true);
//                    btnCom.setEnabled(false);
                    btnP.setEnabled(true);
                    btn0.setEnabled(true);
                    btn1.setEnabled(true);
                    btn2.setEnabled(true);
                    btn3.setEnabled(true);
                    btn4.setEnabled(true);
                    btn6.setEnabled(true);
                    btnInterval.setEnabled(true);
                    btnChangeBatsman.setEnabled(true);
                    btnChangeBowler.setEnabled(true);
                }

                Log.d("undo2", "resetOUT wicket : " + wicket + ", allOUT : " + allOUT + ", currentRuns : " + currentRuns +
                        ", currentOver : " + currentOver);

                if (urun > 0) {

                    Log.d("undo2", "resetOUT urun > 0, urun : " + urun);

                    if ((urun % 2) != 0)
                        swap();
                }


                if (uetype > -1) {
                    Log.d("undo2", "resetOUT, uetype : " + uetype + ", uerun : " + uerun);

                    if (uetype == 0 || uetype == 1) {
                        if ((uerun % 2) != 0) {

                            swap();
                        }
                    } else if (uetype == 3 || uetype == 6) {
                        if (((uerun - noballRun) % 2) != 0)
                            swap();
                    } else if (uetype == 4) {
                        if (((uerun - wideRun) % 2) != 0)
                            swap();
                    }
                }

                if (urun == 0) {

                    Log.d("undo2", "resetOUT urun = 0, b4, strikerDots : " + strikerDots
                            + ", player1Dots : " + player1Dots + ", player2Dots : " + player2Dots + ", bowlerDots : " + bowlerDots);

                    if (strID == player1ID) {
                        --player1Dots;
                        strikerDots = player1Dots;
                    }
                    if (strID == player2ID) {
                        --player2Dots;
                        strikerDots = player2Dots;
                    }

                    if (uout != 10 && uout != 12)
                        --bowlerDots;

                    Log.d("undo2", "resetOUT urun = 0, after, strikerDots : " + strikerDots
                            + ", player1Dots : " + player1Dots + ", player2Dots : " + player2Dots + ", bowlerDots : " + bowlerDots);
                }


                if (uout >= 0 && uout <= 5 && uout != 2) {
                    removeFromFOW(lastEvent.getDismissedPlayerID());

                    if (bowlerWicket > 0)
                        --bowlerWicket;
                    else
                        bowlerWicket = 0;

                    if (uetype != 4) {
                        if (strikerBalls > 0)
                            --strikerBalls;
                        else
                            strikerBalls = 0;

                        if (ps1ID == strID) {
                            if (p1CB > 0)
                                --p1CB;
                            else
                                p1CB = 0;
                        } else if (ps2ID == strID) {
                            if (p2CB > 0)
                                --p2CB;
                            else
                                p2CB = 0;
                        }
                    }

                    if (uetype != 2) {

                        if (uetype != 4) {
                            if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                                --bowlerBalls;
                            else if (bowlerBalls > ballsPerOver)
                                bowlerBalls = bowlerBalls - ballsPerOver;
                            else if (bowlerBalls == 0)
                                bowlerBalls = ballsPerOver;
                        }

                        if (totalBalls > 0)
                            --totalBalls;
                        else
                            totalBalls = 0;


                        ball = lastEvent.getCurrentOverBalls();

                        if ((ball <= ballsPerOver) && (ball > 0))
                            --ball;
                        else if (ball > ballsPerOver)
                            ball = ball - ballsPerOver;
//                        else if (ball == 0)
//                            ball = ballsPerOver;

                        if (currentOver >= 0.1f)
                            currentOver = currentOver - 0.1f;
                        else
                            currentOver = 0f;

                    }

                    if (currentRuns >= urun)
                        currentRuns = currentRuns - urun;

                    else
                        currentRuns = 0;

                    if (uout == 5) {
                        /*if (urun == 0) {

                            if (strikerDots > 0)
                                --strikerDots;
                            else
                                strikerDots = 0;

                            if (bowlerDots > 0)
                                --bowlerDots;
                            else
                                bowlerDots = 0;

                        }*/

                        if (urun > 0) {

                            if (strikerRuns >= urun)
                                strikerRuns = strikerRuns - urun;
                            else
                                strikerRuns = 0;

                            if (psRuns >= urun)
                                psRuns = psRuns - urun;
                            else
                                psRuns = 0;

                            if (strID == ps1ID) {
                                if (p1CR >= urun)
                                    p1CR = p1CR - urun;
                                else
                                    p1CR = 0;
                            } else if (strID == ps2ID) {
                                if (p2CR >= urun)
                                    p2CR = p2CR - urun;
                                else
                                    p2CR = 0;
                            }

//                            if (currentRuns >= urun)
//                                currentRuns = currentRuns - urun;
//                            else
//                                currentRuns = 0;
//
//                            remainingRuns = remainingRuns + urun;
//                            leadingRuns = leadingRuns - urun;

                            if (bwRun >= urun)
                                bwRun = bwRun - urun;
                            else
                                bwRun = 0;

                            // added on 04/05/2020
                            if (mo >= urun)
                                mo = mo - urun;
                            else
                                mo = 0;

                        }
                    }

                    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    if (uetype > -1) {

                        if (uetype != 4 && uetype != 2) {

                            if ((psBalls <= ballsPerOver) && (psBalls > 0))
                                --psBalls;
                            else if (psBalls > ballsPerOver)
                                psBalls = psBalls - ballsPerOver;
                            else if (psBalls == 0) {
                                psBalls = ballsPerOver - 1;
                                if (psOver > 0)
                                    --psOver;
                                else
                                    psOver = 0;
                            }
                        }
//
                        undoExtra();
                    } else {
                        if ((psBalls <= ballsPerOver) && (psBalls > 0))
                            --psBalls;
                        else if (psBalls > ballsPerOver)
                            psBalls = psBalls - ballsPerOver;
                        else if (psBalls == 0) {
                            psBalls = ballsPerOver - 1;
                            if (psOver > 0)
                                --psOver;
                            else
                                psOver = 0;
                        }
                    }


                    if (currentInnings > 1 && currentInnings < 99) {

                        remainingRuns = remainingRuns + urun;
                        leadingRuns = leadingRuns - urun;

                        ++remainingBalls;
                        remainingOver = remainingOver + 0.1f;
                        // added on 06/05/2020
                        resetRemainingOver();
                    }


                    Log.d("undo", "resetOUT 2, lastEventID : " + lastEvent.getEventID() + ", outType : " + lastEvent.getOutType() +
                            ", psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver + ", currentRuns : " + currentRuns +
                            ", currentOver : " + currentOver);
                    Log.d("undo", "resetOUT 2, strID : " + strID + ", nstrID : " + nstrID);
                    Log.d("undo", "resetOUT 2, ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                    Log.d("undo", "resetOUT 2, ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);


                } else if (uout == 2) {

                    removeFromFOW(lastEvent.getDismissedPlayerID());

                    Log.d("undo", "resetOUT 3, lastEventID : " + lastEvent.getEventID() + ", outType : " + lastEvent.getOutType() +
                            ", psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver + ", currentRuns : " + currentRuns +
                            ", currentOver : " + currentOver + ", bowlerBalls : " + bowlerBalls);
                    Log.d("undo", "resetOUT 3, strID : " + strID + ", nstrID : " + nstrID);
                    Log.d("undo", "resetOUT 3, ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                    Log.d("undo", "resetOUT 3, ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

                    ball = lastEvent.getCurrentOverBalls();

                    if (uetype != 2 && uetype != 3 /*&& uetype != 4*/ && uetype != 6) {

                        if (uetype != 4) {
                            if ((psBalls <= ballsPerOver) && (psBalls > 0))
                                --psBalls;
                            else if (psBalls > ballsPerOver)
                                psBalls = psBalls - ballsPerOver;
                            else if (psBalls == 0) {
                                psBalls = ballsPerOver - 1;
                                if (psOver > 0)
                                    --psOver;
                                else
                                    psOver = 0;
                            }
                        }

                        if (uetype != 4) {
                            if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                                --bowlerBalls;
                            else if (bowlerBalls > ballsPerOver)
                                bowlerBalls = bowlerBalls - ballsPerOver;
                            else if (bowlerBalls == 0) {
                                bowlerBalls = ballsPerOver;
                                --bowlerOver;
                            }
                        }

                        if (totalBalls > 0)
                            --totalBalls;
                        else
                            totalBalls = 0;

                        if ((ball <= ballsPerOver) && (ball > 0))
                            --ball;
                        else if (ball > ballsPerOver)
                            ball = ball - ballsPerOver;
//                    else if (ball == 0)
//                        ball = ballsPerOver;
                        /*--ball;*/

                        if (currentOver >= 0.1f)
                            currentOver = currentOver - 0.1f;
                        else
                            currentOver = 0f;
                    }

                    if (uetype != 4) {
                        if (strikerBalls > 0)
                            --strikerBalls;
//                else
//                    strikerBalls = 0;
                    }

                    urun = lastEvent.getCurrentRun();
                    Log.d("undo2", "resetOUT 4, uout " + uout + ", urun : " + urun + ", currentRuns : " + currentRuns +
                            ", currentOver : " + currentOver + ", bowlerBalls : " + bowlerBalls);
                    Log.d("undo2", "resetOUT 4, strID : " + strID + ", ps1ID " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                    Log.d("undo2", "resetOUT 4, strID : " + strID + ", ps2ID " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p1CB);

                    /*if (urun == 0) {

                        if (strikerDots > 0)
                            --strikerDots;
                        else
                            strikerDots = 0;

                        if (bowlerDots > 0)
                            --bowlerDots;
                        else
                            bowlerDots = 0;

                    }*/

//                    if (urun > 0) {

                    if (strikerRuns >= urun)
                        strikerRuns = strikerRuns - urun;
                    else
                        strikerRuns = 0;

                    if (currentRuns >= urun)
                        currentRuns = currentRuns - urun;
                    else
                        currentRuns = 0;

                    remainingRuns = remainingRuns + urun;
                    leadingRuns = leadingRuns - urun;

                    if (bwRun >= urun)
                        bwRun = bwRun - urun;
                    else
                        bwRun = 0;

                    // added on 04/05/2020
                    if (mo >= urun)
                        mo = mo - urun;
                    else
                        mo = 0;


                    // partnership details
                    if (psRuns >= urun)
                        psRuns = psRuns - urun;
                    else
                        psRuns = 0;


                    if (strID == ps1ID) {
                        if (p1CR >= urun)
                            p1CR = p1CR - urun;
                        else
                            p1CR = 0;

                        if (uetype != 4) {
                            if (p1CB > 0)
                                --p1CB;
                            else
                                p1CB = 0;
                        }
                    } else if (strID == ps2ID) {
                        if (p2CR >= urun)
                            p2CR = p2CR - urun;
                        else
                            p2CR = 0;

                        if (uetype != 4) {
                            if (p2CB > 0)
                                --p2CB;
                            else
                                p2CB = 0;
                        }
                    }

                    if (urun == 4) {
                        if (strikerF4s > 0)
                            --strikerF4s;
                        else
                            strikerF4s = 0;

                        if (bowlerF4s > 0)
                            --bowlerF4s;
                        else
                            bowlerF4s = 0;
                    }

                    if (urun == 6) {
                        if (strikerS6s > 0)
                            --strikerS6s;
                        else
                            strikerS6s = 0;

                        if (bowlerS6s > 0)
                            --bowlerS6s;
                        else
                            bowlerS6s = 0;
                    }

                    /*if ((urun % 2) != 0)
                        swap();*/
//                    }

                    if (uetype > -1) {

                       /* if (currentRuns >= (uerun))
                            currentRuns = currentRuns - uerun;
                        else
                            currentRuns = 0;

                        remainingRuns = remainingRuns + uerun;
                        leadingRuns = leadingRuns - uerun;*/

                        undoExtra();
                    }


                    if (currentInnings > 1 && currentInnings != 99) {

                        ++remainingBalls;
                        remainingOver = remainingOver + 0.1f;
                        // added on 06/05/2020
                        resetRemainingOver();
                    }


                    Log.d("undo", "resetOUT 5, lastEventID : " + lastEvent.getEventID() +
                            ", outType : " + lastEvent.getOutType() +
                            ", psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver + ", currentRuns : " + currentRuns +
                            ", currentOver : " + currentOver + ", bowlerBalls : " + bowlerBalls);
                    Log.d("undo", "resetOUT 5, strID : " + strID + ", nstrID : " + nstrID);
                    Log.d("undo", "resetOUT 5, ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                    Log.d("undo", "resetOUT 5, ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);


                } else if (uout >= 6 && uout < 9) {

                    removeFromFOW(lastEvent.getDismissedPlayerID());
                    ball = lastEvent.getCurrentOverBalls();

                    if (totalBalls > 0)
                        --totalBalls;
                    else
                        totalBalls = 0;

                    if (uetype == 2 || uetype == 3 /*|| uetype == 4 */ || uetype == 6) {
                        Log.d("undo", "do nothing uetype = " + uetype);
                    } else {

                        if (uetype != 4) {
                            if ((psBalls <= ballsPerOver) && (psBalls > 0))
                                --psBalls;
                            else if (psBalls > ballsPerOver)
                                psBalls = psBalls - ballsPerOver;
                            else if (psBalls == 0) {
                                psBalls = ballsPerOver - 1;
                                if (psOver > 0)
                                    --psOver;
                                else
                                    psOver = 0;
                            }
                        }

                        if (uetype != 4) {
                            if ((bowlerBalls <= ballsPerOver) && (bowlerBalls > 0))
                                --bowlerBalls;
                            else if (bowlerBalls > ballsPerOver)
                                bowlerBalls = bowlerBalls - ballsPerOver;
                            else if (bowlerBalls == 0) {
                                bowlerBalls = ballsPerOver;
                                --bowlerOver;
                            }
                        }

                        if (currentOver >= 0.1f)
                            currentOver = currentOver - 0.1f;
                        else
                            currentOver = 0f;

                        if ((ball <= ballsPerOver) && (ball > 0))
                            --ball;
                        else if (ball > ballsPerOver)
                            ball = ball - ballsPerOver;
//                            else if (ball == 0)
//                                ball = ballsPerOver;
                    }


                    if (uetype != 4) {
                        if (strikerBalls > 0)
                            --strikerBalls;
                        else
                            strikerBalls = 0;

                        if (ps1ID == strID) {
                            if (p1CB > 0)
                                --p1CB;
                            else
                                p1CB = 0;
                        } else if (ps2ID == strID) {
                            if (p2CB > 0)
                                --p2CB;
                            else
                                p2CB = 0;
                        }
                    }


                    if (urun > 0) {

                        if (currentRuns >= urun)
                            currentRuns = currentRuns - urun;
                        else
                            currentRuns = 0;

                        if (psRuns >= urun)
                            psRuns = psRuns - urun;
                        else
                            psRuns = 0;

                        if (bwRun >= urun)
                            bwRun = bwRun - urun;
                        else
                            bwRun = 0;

                        // added on 04/05/2020
                        if (mo >= urun)
                            mo = mo - urun;
                        else
                            mo = 0;

                        if (strikerRuns >= urun)
                            strikerRuns = strikerRuns - urun;
                        else
                            strikerRuns = 0;


                        if (strID == ps1ID) {
                            if (p1CR >= urun)
                                p1CR = p1CR - urun;
                            else
                                p1CR = 0;
                        } else if (strID == ps2ID) {
                            if (p2CR >= urun)
                                p2CR = p2CR - urun;
                            else
                                p2CR = 0;

                        }


                        if (urun == 4) {

                            if (strikerF4s > 0)
                                --strikerF4s;
                            else
                                strikerF4s = 0;

                            if (bowlerF4s > 0)
                                --bowlerF4s;
                            else
                                bowlerF4s = 0;
                        }

                        if (urun == 6) {

                            if (strikerS6s > 0)
                                --strikerS6s;
                            else
                                strikerS6s = 0;

                            if (bowlerS6s > 0)
                                --bowlerS6s;
                            else
                                bowlerS6s = 0;
                        }

                    }

                    if (uetype > -1) {

                        undoExtra();
                    }

                    if (currentInnings > 1 && currentInnings < 99) {

                        remainingRuns = remainingRuns + urun + uerun;
                        leadingRuns = leadingRuns - urun - uerun;

                        if (uout == 6 || uout == 8) {
                            ++remainingBalls;
                            remainingOver = remainingOver + 0.1f;
                            // added on 06/05/2020
                            resetRemainingOver();
                        }
                    }

                    Log.d("undo", "resetOUT 6, lastEventID : " + lastEvent.getEventID() + ", outType : " + lastEvent.getOutType() +
                            ", psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver + ", currentRuns : " + currentRuns +
                            ", currentOver : " + currentOver);
                    Log.d("undo", "resetOUT 6, strID : " + strID + ", nstrID : " + nstrID);
                    Log.d("undo", "resetOUT 6, ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                    Log.d("undo", "resetOUT 6, ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

                } else if (uout == 9 || uout == 11) {
                    removeFromFOW(lastEvent.getDismissedPlayerID());
                } else if (uout == 10) {
                    resetRetire(lastEvent.getDismissedPlayerID());
                } else if (uout == 12) {

                    removeFromFOW(lastEvent.getDismissedPlayerID());
                    ball = lastEvent.getCurrentOverBalls();
                    currentRuns = lastEvent.getTotalRuns();
                    totalBalls = lastEvent.getBalls();
                    currentOver = lastEvent.getOvers();
                }

                if (uout != 10 && uout != 11 && uout != 12)
                    modified = lastEvent.getUndoDisplay();

                if (dismissedList.size() > 0) {
                    for (int i = 0; i < dismissedList.size(); i++) {

                        if (dismissedList.get(i) == lastEvent.getDismissedPlayerID()) {
                            dismissedList.remove(i);
                        }
                    }
                } else
                    Log.e("Scoring", "undo, dismissedList.size : " + dismissedList.size());

                Log.e("Scoring", "undo, dismissedList : " + dismissedList);
                Log.e("Scoring", "undo, retiredList : " + retiredList);

//            resetValues(lastEvent);
            } else {
                Log.d("lastEvent", "balltype != 3 :  " + lastEvent);
                pre_interval = true;
            }

            if (bowlerID != 0)
                syncBowler();
            if (preBowlerID == 0 || SUPER_OVER) {
                setPreBowlerVisibility(false);
            } else
                setPreBowlerVisibility(true);

            if (strID != 0)
                syncBatsmann(strID, 0, null, false, -1, false,
                        false, false);

            if (nstrID != 0)
                syncBatsmann(nstrID, 0, null, false, -1, false,
                        false, false);

            modified = lastEvent.getUndoDisplay();

            sessionID = lastEvent.getSessionId();
            sessionType = lastEvent.getSession();
            dismissedPlayrID = 0;   // Added on 07/07/2021

            Log.d("lastEvent", "resetOUT 1, lastEvent :  " + lastEvent);
            syncPartnership(wicket + 1, false, 0, false, true);

            Log.d("lastEvent", "resetOUT 2, lastEvent :  " + lastEvent);

            // added on 21/01/2021
            resetValues(lastEvent, ubtype);

            Log.d("remainingOver", "ubtype = 3, 2 : " + remainingOver);
            Log.d("remainingBalls", "ubtype = 3, 2 : " + remainingBalls);
            Log.d("pre_interval", "ubtype = " + ubtype + ", pre_interval : " + pre_interval);
            // ============ till here

            if (pre_interval) {
                undo();
            }

        }

    }


    void resetValues(Events lastEvent, int ubtype) {

        Log.d("undo", "resetValues 01, ubtype : " + ubtype + ", lastEvent : " + lastEvent);
//        lastEventID = lastEvent.getEventID();

        if (bowlerID != 0)
            syncBowler();
        if (preBowlerID == 0 || SUPER_OVER) {
            setPreBowlerVisibility(false);
        } else
            setPreBowlerVisibility(true);

        Log.d("undo", "resetValues, ubtype : " + ubtype + ", lastEvent 9 : " + lastEvent);

        if (strID != 0)
            syncBatsmann(strID, 0, null, false, -1, retired,
                    false, false);

        if (nstrID != 0)
            syncBatsmann(nstrID, 0, null, false, -1, retired,
                    false, false);

//        if (lastEvent.getBallType() == 3)
        syncPartnership(wicket + 1, false, 0, false, false);
//        else

        Log.d("undo", "resetValues, ubtype : " + ubtype + ", lastEvent 8 : " + lastEvent);

        if (strID == player1ID) {

            player1 = striker;
            player1Runs = strikerRuns;
            player1Balls = strikerBalls;
            player1Dots = strikerDots;
            player1F4s = strikerF4s;
            player1S6s = strikerS6s;
            player2 = nonStriker;
            player2Runs = nonStrikerRuns;
            player2Balls = nonStrikerBalls;
            player2Dots = nonStrikerDots;
            player2F4s = nonStrikerF4s;
            player2S6s = nonStrikerS6s;
            player1Selected.setVisibility(View.VISIBLE);
            player2Selected.setVisibility(View.GONE);

        } else if (strID == player2ID) {

            player2 = striker;
            player2Runs = strikerRuns;
            player2Balls = strikerBalls;
            player2Dots = strikerDots;
            player2F4s = strikerF4s;
            player2S6s = strikerS6s;
            player1 = nonStriker;
            player1Runs = nonStrikerRuns;
            player1Balls = nonStrikerBalls;
            player1Dots = nonStrikerDots;
            player1F4s = nonStrikerF4s;
            player1S6s = nonStrikerS6s;
            player1Selected.setVisibility(View.GONE);
            player2Selected.setVisibility(View.VISIBLE);
        }

        Log.d("undo", "resetValues, lastEventID : " + lastEventID + ", psRuns : " + psRuns + ", psBalls : " + psBalls +
                ", psOver : " + psOver);

        Log.d("undo", "resetValues, strID : " + strID + ", strikerRuns : " + strikerRuns +
                ", strikerBalls : " + strikerBalls + ", strikerDots : " + strikerDots +
                ", strikerF4s : " + strikerF4s + ", strikerS6s : " + strikerS6s);

        Log.d("undo", "resetValues, nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                ", nonStrikerBalls : " + nonStrikerBalls + ", nonStrikerDots : " + nonStrikerDots +
                ", nonStrikerF4s : " + nonStrikerF4s + ", nonStrikerS6s : " + nonStrikerS6s);

        Log.d("undo", "resetValues, player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                ", player1Balls : " + player1Balls + ", player1Dots : " + player1Dots +
                ", player1F4s : " + player1F4s + ", player1S6s : " + player1S6s);

        Log.d("undo", "resetValues, player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                ", player2Balls : " + player2Balls + ", player2Dots : " + player2Dots +
                ", player2F4s : " + player2F4s + ", player2S6s : " + player2S6s);


        tvTotalRuns.setText(String.valueOf(currentRuns));
        Log.d("currentRuns", "resetValues : " + currentRuns);
        tvPlayingOver.setText(String.valueOf(
                new DecimalFormat("##.#").format(currentOver)));
        tvTotalWicket.setText(String.valueOf(wicket));

        Log.d("undo", "resetValues, ubtype : " + ubtype + ", lastEvent 7 : " + lastEvent);

        setInningsRuns(currentInnings, currentRuns);

        Log.d("undo", "resetValues, ubtype : " + ubtype + ", lastEvent 6 : " + lastEvent);

        if (currentInnings == 1 || currentInnings == 99)
            ll_remainings.setVisibility(View.GONE);

        else {

            ll_remainings.setVisibility(View.VISIBLE);

            if (remainingRuns > 0)
                tvRemainingRuns.setText(String.valueOf(remainingRuns));
//            else if (leadingRuns > 0 && totalInnings == 4) {
            if (leadingRuns > remainingRuns && totalInnings == 4) {
                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                tvRemainingRunsText.setText("Leading Runs : ");
            }


            if (tvRemainingOversBallsText.isShown()) {

                if (remainingBalls > 100) {
                    tvRemainingOversBallsText.setText(", Overs : ");
                    tvRemainingOversBalls.setText(String.valueOf(
                            new DecimalFormat("##.#").format(remainingOver)));
                } else {
                    tvRemainingOversBallsText.setText(", Balls : ");
                    Log.e("Scoring", "resetValues, remainingBalls 1 : " + remainingBalls);
                    Log.e("Scoring", "resetValues, leadingRuns 1 : " + leadingRuns);
                    tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                }
            }

            if (innings.matches("single")) {
                tvRemainingRunsText.setText("Remaining Runs : ");
            } else {

                if (remainingRuns > 0) {
                    if (currentInnings == 4)
                        tvRemainingRunsText.setText("Remaining Runs : ");
                    else
                        tvRemainingRunsText.setText("Trial Runs : ");
                } else
                    tvRemainingRunsText.setText("Lead Runs : ");
            }
        }

        tvPlayer1.setText(player1);
        tvPlayer1Runs.setText(String.valueOf(player1Runs));
        tvPlayer1Balls.setText(String.valueOf(player1Balls));
        tvPlayer2.setText(player2);
        tvPlayer2Runs.setText(String.valueOf(player2Runs));
        tvPlayer2Balls.setText(String.valueOf(player2Balls));

        Log.d("SCoring", "Inside resetValues");
        tvBowler.setText(bowler);
        tvBowlerOver.setText(String.valueOf(new
                DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
        tvBowlerRuns.setText(String.valueOf(bwRun));
        tvBowlerWicket.setText(String.valueOf(bowlerWicket));
        tvBowlerMO.setText(String.valueOf(bowlerMO));

        Log.d("undo", "resetValues, ubtype : " + ubtype + ", lastEvent 5 : " + lastEvent);

        if (!SUPER_OVER && preBowlerID != 0) {

            tvBowler2.setText(preBowler);
            tvBowlerOver2.setText(String.valueOf(new
                    DecimalFormat("##.#").format(setOverDisplay(preBowlerOver, preBowlerBalls))));
            tvBowlerRuns2.setText(String.valueOf(preBowlerRun));
            tvBowlerWicket2.setText(String.valueOf(preBowlerWicket));
            tvBowlerMO2.setText(String.valueOf(preBowlerMO));
        }

        if (preBowlerID == 0 /*&& nextBowlerID != 0*/) {

            tvBowler2.setText("");
            tvBowlerOver2.setText(String.valueOf(new DecimalFormat("##.#").format(0)));
            tvBowlerRuns2.setText(String.valueOf(0));
            tvBowlerWicket2.setText(String.valueOf(0));
            tvBowlerMO2.setText(String.valueOf(0));
        }

        tvCurrentOver.setText(modified);
        Log.d("modified2", modified);
        Log.d("udisplay2", udisplay);

        Log.d("undo", "resetValues, ubtype : " + ubtype + ", lastEvent 4 : " + lastEvent);
//        sessionID = lastEvent.getSessionId();
//        session = lastEvent.getSessionT();

        if (currentInnings == 1 || currentInnings == 99)
            ll_remainings.setVisibility(View.GONE);

        else {

            ll_remainings.setVisibility(View.VISIBLE);

            if (remainingRuns > 0)
                tvRemainingRuns.setText(String.valueOf(remainingRuns));
//            else if (leadingRuns >= 0 && totalInnings == 4){
            if (leadingRuns > remainingRuns && totalInnings == 4) {
                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                tvRemainingRunsText.setText("Leading Runs : ");
            }

            Log.e("resetValues", "undo, leadingRuns 2 : " + leadingRuns);

            if (remainingBalls < 100) {
                tvRemainingOversBallsText.setText(", Balls : ");
                Log.e("Scoring", "undo, remainingBalls 2 : " + remainingBalls);
                tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
            } else {
                tvRemainingOversBallsText.setText(", Overs : ");
                tvRemainingOversBalls.setText(String.valueOf(new
                        DecimalFormat("##.#").format(remainingOver)));
            }

            if (innings.matches("single")) {
                tvRemainingRunsText.setText("Remaining Runs : ");
            } else {

                if (remainingRuns > 0) {
                    if (currentInnings == 4)
                        tvRemainingRunsText.setText("Remaining Runs : ");
                    else
                        tvRemainingRunsText.setText("Trial Runs : ");
                } else
                    tvRemainingRunsText.setText("Lead Runs : ");
            }
        }

        if (innings.matches("multi") && totalOver == 1000) {
            tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
            tvRemainingOversBalls.setVisibility(View.INVISIBLE);
        } else {
            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
            tvRemainingOversBalls.setVisibility(View.VISIBLE);
        }

        Log.d("undo", "resetValues, eventSync : " + eventSync);
        Log.d("undo", "resetValues, ubtype : " + ubtype + ", lastEvent 3 : " + lastEvent);

        // removing the last Event from device database

       /* Commented on 21/01/2021
        if (undo_balltype_7) {
            Log.d("undo", "lastEvent : " + lastEvent);
            undo_balltype_7 = false;
        }
        else {*/

            /*if (UNDO_LIMIT) {

                Log.d("undo", "resetValues, UNDO_LIMIT : " + UNDO_LIMIT + ", lastEvent : " + lastEvent);

            }

            else {*/


/*
        Moving it to bottom
                if (lastEvent != null) {
                    if (!realm.isInTransaction()) {
                        realm.beginTransaction();
                    }

                    lastEvent.deleteFromRealm();
                    realm.commitTransaction();

                    if (undo_balltype_7) {
                        Log.d("undo", "lastEvent : " + lastEvent);
                        undo_balltype_7 = false;
//                        undo();
                    }
                }*/
//            }
//        }         // commented on 21/01/2021


        // removing the last event from server
//        if (jsonEventArray != null){


        if (!lastOut) {

            // commented on 30/04/2020
            /*// added on 27/04/20
            if (isNetworkAvailable()) {
                jsonEventArray = new JSONArray();
                resetJSONEventArray();
            }*/

            // added on 04/05/2020
            if (UNDO_LIMIT) {

                initializeBowler();
                syncBowler();
                RealmResults<Events> results = realm.where(Events.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).findAll();

               /* if (results.isEmpty()) {

                    Events lastEvent1 = new Events();
                    saveUndo(lastEventID, false, false, lastEvent1, false);
                }

                else {
                    Events lastEvent1 = results.last();
                    if (eventSync) {
                        saveUndo(lastEventID, false, false, lastEvent1, true);
                    }
                }*/


            } else {
                int temp_count = realm.where(Events.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        findAll().size();

                if (temp_count <= 0) {

                    UNDO_LIMIT = true;
                    inningsNotStarted = true;
                    AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
                    alertDialog.setIcon(R.drawable.ball);
                    alertDialog.setCancelable(false);
                    alertDialog.setTitle("Undo has reached limit");
                    alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                            new DialogInterface.OnClickListener() {
                                public void onClick(DialogInterface dialog, int which) {
                                    dialog.dismiss();
                                    btnUndo.setEnabled(false);
                                    initializeBowler();
                                    syncBowler();
                                    if (eventSync) {
                                        Events lastEvent1 = realm.where(Events.class).
                                                equalTo("matchid", matchid).
                                                equalTo("eventID", lastEventID).findFirst();
                                        // updated on 06/7/2021
                                        if (lastEvent1 != null) {
                                            Log.d("SCORE", "resetValues,(limit) lastEvent1 = " + lastEvent1);
                                            saveUndo(lastEventID, false, false, lastEvent1, false); // Updated on 06/07/2021
                                        } else {
                                            Events lastEvent123 = new Events();
                                            Log.d("SCORE", "resetValues,(limit+null) lastEvent123 = " + lastEvent123);
                                            saveUndo(lastEventID, false, false, lastEvent123, false); // Updated on 06/07/2021
                                        }
//                                        Events lastEvent1 = new Events(); Commented on 06/07/2021
//                                        saveUndo(lastEventID, false, false, lastEvent1, false); Commented on 06/07/2021
                                    }

                                    setExtraCard(/*UNDO_LIMIT*/);
                                }
                            });
                    alertDialog.show();

                } else {
                    //=========== till here
                    Events events = realm.where(Events.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            findAll().last();

                    Log.d("undo", "events 1 : " + events);

                    if (events != null) {

                        Log.d("undo", "eventSync : " + eventSync + ", events 2 : " + events);
                        // post undo
//               jsonUndoArray.put(setUndoArray(events, lastEventID));
                        if (eventSync) {
//                            saveUndo(lastEventID, false, false, events, true); Commeted on 06/07/2021
                            // updated on 06/7/2021
                            Events lastEvent1 = realm.where(Events.class).
                                    equalTo("matchid", matchid).
                                    equalTo("eventID", lastEventID).findFirst();
                            if (lastEvent1 != null) {
                                Log.d("SCORE", "resetValues, 2 lastEvent1 = " + lastEvent1);
                                saveUndo(lastEventID, false, false, lastEvent1, true); // Updated on 06/07/2021
                            } else {
                                Events lastEvent123 = new Events();
                                Log.d("SCORE", "resetValues,(2+null) lastEvent123 = " + lastEvent123);
                                saveUndo(lastEventID, false, false, lastEvent123, true); // Updated on 06/07/2021
                            }


                        }

//               if (isNetworkAvailable())
//                   postJSON(true);

                    }
                }


            }
        } else
            lastOut = false;

        extra = 0;


        // Added from top
        if (lastEvent != null) {
            if (!realm.isInTransaction()) {
                realm.beginTransaction();
            }

            lastEvent.deleteFromRealm();
            realm.commitTransaction();

            if (undo_balltype_7) {
                Log.d("undo", "lastEvent : " + lastEvent);
                undo_balltype_7 = false;
//                        undo();
            }
        }

    }


    void resetRemainingOver() {

        Log.d("remainingOver", "resetRemainingOver, first : " + remainingOver);

        int temp_ro = (int) remainingOver;
        float difference = remainingOver - temp_ro;
        if (difference > 0) {

            float float_balls = difference * 10;
            int temp_balls = (int) float_balls;
            if (temp_balls == ballsPerOver) {

                ++temp_ro;
                remainingOver = (float) temp_ro;

                Math.round(remainingOver);
            }
        }

        Log.d("remainingOver", "resetRemainingOver, last : " + remainingOver);
    }


    public void saveUndo(int lastEventID, boolean uout, boolean preOut, Events event, boolean lastevent) {

//        newEvent();

        Log.d("SCORE", "saveUndo, event = " + event.getEventID());
        Log.d("SCORE", "saveUndo, lastevent = " + lastevent);
        Realm realm = null;
        try {
//            Toast.makeText(getApplicationContext(), "Inside savePlayerDetails", Toast.LENGTH_SHORT).show();
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {


                    try {
                        Number num = bgRealm.where(Undo.class).max("undoID");
                        undoID = (num == null) ? 1 : num.intValue() + 1;

                        Undo undoObject = bgRealm.createObject(Undo.class, undoID);
                        undoObject.setMatchid(matchid);
                        undoObject.setMatchID(matchID);
                        undoObject.setInnings(currentInnings);
                        undoObject.setEventID(lastEventID);
                        undoObject.setPreOut(preOut);

//                        undoObject.setBowler_pID(bowlerID);
//                        undoObject.setPreBowler_pID(preBowlerID);
//                        undoObject.setStriker_pID(strID);
//                        undoObject.setNonStriker_pID(nstrID);
//                        undoObject.setTotalscore(currentRuns);
//                        undoObject.setTotalwicket(wicket);
//
//                        undoObject.setTotalovers(currentOver);
                        undoObject.setSync(0);
//                        undoObject.setSUPER_OVER(SUPER_OVER);

                        // added on 14/05/2020
                        undoObject.setBowler_pID(bowlerID);
                        undoObject.setStriker_pID(strID);
                        Batsman bat = bgRealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("team", battingTeamNo).
                                equalTo("batsman_pID", strID).findFirst();
                        if (bat != null) {

                            Log.d("SA", "saveUndo, Str, bat = " + bat);

                            undoObject.setStrikerRuns(bat.getRuns());
                            undoObject.setStrikerBalls(bat.getBalls());
                            undoObject.setStrikerBattingOrder(bat.getBattingOrder());
                            undoObject.setStrikerDots(bat.getDots());
                            undoObject.setStrikerF4s(bat.getF4s());
                            undoObject.setStrikerS6s(bat.getS6s());
                            undoObject.setStrikerOutType(bat.getOutType());
                        }

                        //nonstriker details
                        undoObject.setNonStriker_pID(nstrID);
                        bat = bgRealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("team", battingTeamNo).
                                equalTo("batsman_pID", nstrID).findFirst();
                        if (bat != null) {

                            Log.d("SA", "saveUndo, Nstr, bat = " + bat);

                            undoObject.setNonStrikerRuns(bat.getRuns());
                            undoObject.setNonStrikerBalls(bat.getBalls());
                            undoObject.setNonStrikerBattingOrder(bat.getBattingOrder());
                            undoObject.setNonStrikerDots(bat.getDots());
                            undoObject.setNonStrikerF4s(bat.getF4s());
                            undoObject.setNonStrikerS6s(bat.getS6s());
                            undoObject.setNonStrikerOutType(bat.getOutType());
                        }


                        // bowler details
//                        undoObject.setBowler_pID(bowlerID);
                        Bowler bows = bgRealm.where(Bowler.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("team", fieldingTeamNo).
                                equalTo("playerID", bowlerID).findFirst();
                        if (bows != null) {

                            undoObject.setBowlerRuns(bows.getRuns());
                            undoObject.setBowlerOver(bows.getOver());
                            undoObject.setBowlerBalls(bows.getBalls());
                            undoObject.setBowlerWicket(bows.getWicket());
                            undoObject.setBowlerDots(bows.getDots());
                            undoObject.setBowlerMO(bows.getMaidenOver());
                            undoObject.setBowlerWides(bows.getWides());
                            undoObject.setBowlerNoball(bows.getNoBalls());
                            // added on  16/07/2020
                            undoObject.setBowlerF4s(bows.getF4s());
                            undoObject.setBowlerS6s(bows.getS6s());


                        }

                        // pre bowler details
                        if (preBowlerID != 0) {
                            undoObject.setPreBowler_pID(preBowlerID);
                            bows = bgRealm.where(Bowler.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", currentInnings).
                                    equalTo("team", fieldingTeamNo).
                                    equalTo("playerID", preBowlerID).findFirst();
                            if (bows != null) {

                                undoObject.setPreBowlerRuns(bows.getRuns());
                                undoObject.setPreBowlerBalls(bows.getBalls());
                                undoObject.setPreBowlerOver(bows.getOver());
                                undoObject.setPreBowlerWicket(bows.getWicket());
                                undoObject.setPreBowlerDots(bows.getDots());
                                undoObject.setPreBowlerMO(bows.getMaidenOver());
                                undoObject.setPreBowlerWides(bows.getWides());
                                undoObject.setPreBowlerNoball(bows.getNoBalls());
                                // added on  16/07/2020
                                undoObject.setPreBowlerF4s(bows.getF4s());
                                undoObject.setPreBowlerS6s(bows.getS6s());
                            }
                        }


                        // set extras details
                        ExtraCard extraCard = bgRealm.where(ExtraCard.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).findFirst();
                        if (extraCard != null) {

                            undoObject.setExtraBye(extraCard.getByes());
                            undoObject.setExtraLb(extraCard.getLb());
                            undoObject.setExtraWd(extraCard.getWide());
                            undoObject.setExtraNb(extraCard.getNoBall());
                            undoObject.setExtraP(extraCard.getPenalty());
                        }


                        //partnership details
                        int wk = 0;
                        if (ballType == 3 && outType != 10)
                            wk = wicket;
                        else
                            wk = wicket + 1;

                        RealmResults<Partnership> results = bgRealm.where(Partnership.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("wicket", wk).findAll();

                        if (results.isEmpty()) {

                        } else {
                            Partnership partnership = results.last();
                            if (partnership != null) {
                                undoObject.setP_wicket_no(partnership.getWicket());
                                undoObject.setP_sequence_no(partnership.getPartnershipSequence());
                                undoObject.setP_run(partnership.getPartnershipRuns());
                                undoObject.setP_ball(partnership.getPartnershipBalls());
                                undoObject.setP_over(partnership.getPartnershipOver());
                                undoObject.setP_p1Id(partnership.getPlayer1ID());
                                undoObject.setP_p2Id(partnership.getPlayer2ID());
                                undoObject.setP_disId(partnership.getDismissedPlayerID());
                                undoObject.setP_p1cr(partnership.getPlayer1ContributionRuns());
                                undoObject.setP_p1cb(partnership.getPlayer1ContributionBalls());
                                undoObject.setP_p2cr(partnership.getPlayer2ContributionRuns());
                                undoObject.setP_p2cb(partnership.getPlayer2ContributionBalls());

                                if (ballType != 3) {
                                    undoObject.setP_broken(false);
                                } else {
                                    if (outType == 10)
                                        undoObject.setP_broken(false);
                                    else if (outType != 10)
                                        undoObject.setP_broken(true);
                                }
                            }
                        }


                        // added on 26/06/2020
                        undoObject.setBatting_team(battingTeamNo);
                        undoObject.setTotalovers(currentOver);
                        undoObject.setOver((int) currentOver);
                        undoObject.setBall(ball);
                        undoObject.setTotalscore(currentRuns);
                        undoObject.setTotalwicket(wicket);
//                        strikerid = 0;
//                        nonstrikerid = 0;
//                        bowlerid = 0;

                        if (lastevent) {
                            undoObject.setBalltype(event.getBallType());//balltype = -1;
                            undoObject.setDismissedbatsmanid(event.getDismissedPlayerID());//dismissedbatsmanid = 0;
                            undoObject.setDisnewbatsmanid(event.getDisNewBatsmanID());//disnewbatsmanid = 0;
                            undoObject.setFielderids(event.getFielderID());//fielderids = null;
                            undoObject.setExtraType(event.getExtraType());//extratype = -1;
                            undoObject.setFreehit(event.isFreeHit());//freehit = false;
                            undoObject.setOuttype(event.getOutType());//outtype = -1;
//                            undoObject.setOuttype();penaltybool = 0;

                            // added on 27/06/2020
                            undoObject.setPenaltytype(event.getPenaltyType());// penaltytype = 0;
                            undoObject.setRuns(event.getCurrentRun());
                            undoObject.setExtras(event.getExtraRuns());
                            undoObject.setPenalty(event.getPenaltyRuns());
                            undoObject.setCommentary(event.getCommentary());
                            undoObject.setStrokedirection(event.getStrokeDirection());
                            undoObject.setSessionId(event.getSessionId());
                            undoObject.setIntervalId(event.getIntervalId());

                            undoObject.setOverScore(event.getMo());

                            undoObject.setSub_team(event.getSub_team());
                            undoObject.setSub_playerout_id(event.getSub_playerout_id());
                            undoObject.setSub_playerin_id(event.getSub_playerin_id());

                            undoObject.setPower_start_over(event.getPower_start_over());//power.getStart());
                            undoObject.setPower_end_over(event.getPower_end_over());//power.getEnd());
                            undoObject.setPower_sequence(event.getPower_sequence());//power.getCount());

                            undoObject.setRevisedTarget(event.getRevisedTarget());
                            undoObject.setAppliedRainRule(event.getAppliedRainRule());

//                            setEventJSON()
                        } else {
//                            undoObject.setDisnewbatsmanid(0);//disnewbatsmanid = 0;
//                            undoObject.setFielderids("");//fielderids = null;
//                            undoObject.setExtraType(extraType);//extratype
                        }

                        bgRealm.copyToRealm(undoObject);
                        Log.d("SCORE", "saveUndo, undoObject = " + undoObject.toString());
//                        Log.d("TEST", "saveUndo, undoObject 1 = " + undoObject);

                        post(4);
//                        setUndoArray(undoID, lastEventID, uout, preOut);

                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });


//            setUndoArray(undoID, lastEventID, currentInnings, uout, preOut);



            /* undo_count = 0;
            jsonUndoArray = new JSONArray();
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            RealmResults<Undo> result1 = realm.where(Undo.class).
                    equalTo("matchid", matchid).
                    equalTo("sync", 1).findAll();

            if (result1.isEmpty()) {
//            jsonEventArray = new JSONArray();

                RealmResults<Undo> result11 = realm.where(Undo.class).
                        equalTo("matchid", matchid).findAll();

                Log.d("saveundo", "result11 1 : " + result11);

                for (Undo undo : result11) {

                    if (undo_count <= 10) {//10) {
                        ++undo_count;
                        Log.d("jsonUndoArray", "resetJSONEventArray() 1 : " + undo);
//                        if (undo.getSync() == 0) {


                            // added on 04/07/2020
                            jsonUndoArray.put(setUndo(undo));


                            // commented on 04/07/2020
//                            setUndoArray(undo.getUndoID(), undo.getEventID(), undo.getInnings(), false, undo.isPreOut());

                            Log.d("jsonUndoArray", "resetJSONEventArray() 1 : " + jsonEventArray);
//                        }
                    }

                    else
                        break;;
                }

                Log.d("undo_count", "resetJSONEventArray() 1 : " + undo_count);
                postUndoJSON();
            }*/


            // commented on 27/06/2020
            /*// added on 27/06/2020
            jsonUndoArray.put(setUndo());*/

            //commented on 08/07/2020
//            post();
        } catch (RealmException e) {
            Toast.makeText(getApplicationContext(), "Exception : " + e, Toast.LENGTH_SHORT).show();
        } finally {

            if (realm != null) {
                realm.close();
            }
        }

    }


    void changeStriker() {

        Log.e("Scoring", "changeStriker, striker : " + striker);
        Log.e("Scoring", "changeStriker, nonstriker : " + nonStriker);

//        Log.d("changeStriker", " matchid :"+matchid);
//        Log.d("changeStriker", " matchID :"+matchID);

        if (forceSwap) {

            Log.e("Scoring", "changeStriker(forceSwap), striker : " + striker);
            Log.e("Scoring", "changeStriker(forceSwap), nonstriker : " + nonStriker);

            swapAlert = new AlertDialog.Builder(ScoringActivity.this).create();
            swapAlert.setIcon(R.drawable.ball);
            swapAlert.setCancelable(false);
            swapAlert.setTitle("Confirm to swap strike");
            swapAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {
                            dialog.dismiss();
                            swap();
                            forceSwap = false;
                        }
                    });

            swapAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "CANCEL",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {
                            dialog.dismiss();
                        }
                    });
            swapAlert.show();

        } else {

            Log.e("Scoring", "changeStriker(!forceSwap), striker : " + striker);
            Log.e("Scoring", "changeStriker(!forceSwap), nonstriker : " + nonStriker);
            swap();

        }


    }


    public void swap() {
        Log.d("swap", "method called");
        /*Log.e("Scoring", "outToScoring, starting of swap striker : "+striker);
        Log.e("Scoring", "outToScoring, starting of swap strID : "+strID);
        Log.e("Scoring", "outToScoring, starting of swap strikerRuns : "+strikerRuns);
        Log.e("Scoring", "outToScoring, starting of swap strikerBalls : "+strikerBalls);
        Log.e("Scoring", "outToScoring, starting of swap strikerF4s : "+strikerF4s);
        Log.e("Scoring", "outToScoring, starting of swap strikerS6s : "+strikerS6s);

        Log.e("Scoring", "outToScoring, starting of swap nonStriker : "+nonStriker);
        Log.e("Scoring", "outToScoring, starting of swap nstrID : "+nstrID);
        Log.e("Scoring", "outToScoring, starting of swap nonStrikerRuns : "+nonStrikerRuns);
        Log.e("Scoring", "outToScoring, starting of swap nonStrikerBalls : "+nonStrikerBalls);
        Log.e("Scoring", "outToScoring, starting of swap nonStrikerF4s : "+nonStrikerF4s);
        Log.e("Scoring", "outToScoring, starting of swap nonStrikerS6s : "+nonStrikerS6s);

        Log.e("Scoring", "outToScoring, starting of swap player1 : "+player1);
        Log.e("Scoring", "outToScoring, starting of swap player1ID : "+player1ID);
        Log.e("Scoring", "outToScoring, starting of swap player1Runs : "+player1Runs);
        Log.e("Scoring", "outToScoring, starting of swap player1Balls : "+player1Balls);
        Log.e("Scoring", "outToScoring, starting of swap player1F4s : "+player1F4s);
        Log.e("Scoring", "outToScoring, starting of swap player1S6s : "+player1S6s);

        Log.e("Scoring", "outToScoring, starting of swap player2 : "+player2);
        Log.e("Scoring", "outToScoring, starting of swap player2ID : "+player2ID);
        Log.e("Scoring", "outToScoring, starting of swap player2Runs : "+player2Runs);
        Log.e("Scoring", "outToScoring, starting of swap player2Balls : "+player2Balls);
        Log.e("Scoring", "outToScoring, starting of swap player2F4s : "+player2F4s);
        Log.e("Scoring", "outToScoring, starting of swap player2S6s : "+player2S6s);
*/


        if (player1Selected.getVisibility() == View.VISIBLE) {

            player1Selected.setVisibility(View.GONE);
            player2Selected.setVisibility(View.VISIBLE);

            strID = player2ID;
            striker = player2;
            strikerRuns = player2Runs;
            strikerBalls = player2Balls;
            strikerDots = player2Dots;
            strikerF4s = player2F4s;
            strikerS6s = player2S6s;

            nstrID = player1ID;
            nonStriker = player1;
            nonStrikerRuns = player1Runs;
            nonStrikerBalls = player1Balls;
            nonStrikerDots = player1Dots;
            nonStrikerF4s = player1F4s;
            nonStrikerS6s = player1S6s;

        } else {

            player2Selected.setVisibility(View.GONE);
            player1Selected.setVisibility(View.VISIBLE);

            strID = player1ID;
            striker = player1;
            strikerRuns = player1Runs;
            strikerBalls = player1Balls;
            strikerDots = player1Dots;
            strikerF4s = player1F4s;
            strikerS6s = player1S6s;

            nstrID = player2ID;
            nonStriker = player2;
            nonStrikerRuns = player2Runs;
            nonStrikerBalls = player2Balls;
            nonStrikerDots = player2Dots;
            nonStrikerF4s = player2F4s;
            nonStrikerS6s = player2S6s;

        }

        /*Log.e("Scoring", "swap, striker : "+striker);
        Log.d("Scoring", "swap, nonstriker : "+nonStriker);

        Log.e("Scoring", "outToScoring, end of swap striker : "+striker);
        Log.e("Scoring", "outToScoring, end of swap strID : "+strID);
        Log.e("Scoring", "outToScoring, end of swap strikerRuns : "+strikerRuns);
        Log.e("Scoring", "outToScoring, end of swap strikerBalls : "+strikerBalls);
        Log.e("Scoring", "outToScoring, end of swap strikerF4s : "+strikerF4s);
        Log.e("Scoring", "outToScoring, end of swap strikerS6s : "+strikerS6s);

        Log.e("Scoring", "outToScoring, end of swap nonStriker : "+nonStriker);
        Log.e("Scoring", "outToScoring, end of swap nstrID : "+nstrID);
        Log.e("Scoring", "outToScoring, end of swap nonStrikerRuns : "+nonStrikerRuns);
        Log.e("Scoring", "outToScoring, end of swap nonStrikerBalls : "+nonStrikerBalls);
        Log.e("Scoring", "outToScoring, end of swap nonStrikerF4s : "+nonStrikerF4s);
        Log.e("Scoring", "outToScoring, end of swap nonStrikerS6s : "+nonStrikerS6s);*/
    }


    void addRuns() {

//     Log.d("addRuns()", " matchid :"+matchid);
//     Log.d("addRuns()", " matchID :"+matchID);


        addRunsBuilder = new AlertDialog.Builder(ScoringActivity.this);
        addRunsBuilder.setIcon(R.drawable.ball);
        addRunsBuilder.setCancelable(false);
        addRunsBuilder.setTitle("Enter the Runs");

        final EditText input = new EditText(this);

        input.setInputType(InputType.TYPE_CLASS_NUMBER);
        addRunsBuilder.setView(input);
//        Log.d("Test", "inside AddRuns()");
        addRunsBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {

            //            @Override
            public void onClick(DialogInterface dialog, int which) {

                firstbowler = false;

                if (input.getText().equals(null)) {
                    Toast.makeText(getApplicationContext(),
                            "Please enter the Run", Toast.LENGTH_SHORT).show();
                } else {
                    builderText = Integer.parseInt(input.getText().toString());
//                    Log.d("Test", "BuilderText : " + builderText);


                    if (builderText != 0) {

                        displayOver(builderText);

//                        setPlayerRuns(builderText);

                    } else {
                        Log.d("Test", "buildertext = 0");
                    }

                }
            }
        });

        addRunsBuilder.setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.cancel();
            }
        });

        AlertDialog alert = addRunsBuilder.create();
        alert.show();

        builderText = 0;
    }


//    void addRuns(int run){
//
////        Log.d("addRuns()", " matchid :"+matchid);
////        Log.d("addRuns()", " matchID :"+matchID);
//
//        switch (run){
//
//            case 0:
//                displayOver(run);
//                break;
//
//            case 1:
//                displayOver(run);
//                break;
//
//            case 2:
//                displayOver(run);
//                break;
//
//            case 3:
//                displayOver(run);
//                break;
//
//            case 4:
//                displayOver(run);
//                break;
//
//            case 6:
//                displayOver(run);
//                break;
//
//                default:
//                    break;
//        }
//
//    }


    // function to set over

    void setOver(int runs) {

        Log.d("MODIFIED", "setOver() 10, runs : " + runs);
        Log.d("MODIFIED", "setOver() 10, extras : " + extras);
        Log.d("MODIFIED", "setOver() 10, confirm_extras : " + confirm_extras);
        Log.d("MODIFIED", "setOver() 10, modified : " + modified);
        Log.d("MODIFIED", "setOver() 10, udisplay : " + udisplay);

        Log.e("SETOVER", "beginning, remainingOver : " + remainingOver);
        Log.e("SETOVER", "beginning, runs : " + runs);
        Log.e("SETOVER", "beginning, ball : " + ball);
        Log.e("SETOVER", "beginning, ballsPerOver : " + ballsPerOver);
        Log.e("Scoring", "extraToScoring, bye/lb");
        Log.d("so_inninngs1Runs", "setover7 , : " + so_inninngs1Runs);

        Log.d("checkFreeHit", "setOver 1, : " + checkFreeHit);
        Log.d("freeHit", "setOver 1, : " + freeHit);


//       if (!wagon_wheel)
//           SET_OVER = true;
//       Log.e("SETOVER", "beginning, leadingRuns : "+leadingRuns);
//       Log.e("SETOVER", "beginning, remainingRuns : "+remainingRuns);
//       Log.e("SETOVER", "beginning, remainingBalls : "+remainingBalls);
//       Log.e("SETOVER", "beginning, remainingOver : "+remainingOver);


        if (runs != 537) {

            if ((!noBall) && (!wide)) {

                ++ball;
                if (ball == ballsPerOver)
                    endOver = true;

                Log.d("remainingOver", "remainingOver 1, : " + remainingOver);
//               remainingOver = setRemainingOver(remainingOver);
              /* float temp_ro = (remainingOver - (int)remainingOver);
               if (temp_ro > .1f && temp_ro <= (.1f * ballsPerOver))
                   remainingOver = remainingOver - .1f;
               else if (temp_ro == .0f) {
                   remainingOver = remainingOver - 1;
                   remainingOver = remainingOver + (.1f * ballsPerOver);
               }*/
                Log.d("remainingOver", "remainingOver 2, : " + remainingOver);
            }

            ++totalBalls;
            ++psBalls;
            if (psBalls >= ballsPerOver) {
                ++psOver;
                if (psBalls == ballsPerOver)
                    psBalls = 0;
                else if (psBalls == (ballsPerOver + 1))
                    psBalls = 1;
            }

            if (currentInnings > 1 && remainingRuns > 0) {
                --remainingBalls;
            }


            if (ball > 10) {
                currentOver = currentOver + 0.01f;

                Log.d("remainingOver", "remainingOver 3, : " + remainingOver);
                if (currentInnings > 1) {
                    float temp_ro = (remainingOver - (int) remainingOver);
                    if (temp_ro > .1f && temp_ro <= (.1f * ballsPerOver))
                        remainingOver = remainingOver - .1f;
                    else if ((int) (temp_ro * 10) == 0) {
                        remainingOver = remainingOver - 1;
                        remainingOver = remainingOver + (.1f * (ballsPerOver - 1));
                    }

                }
                Log.d("remainingOver", "remainingOver 4, : " + remainingOver);

//           bowlerOver = bowlerOver + 0.01f;
            } else {
                currentOver = currentOver + 0.1f;

                Log.d("remainingOver", "remainingOver 5, : " + remainingOver);
                if (currentInnings > 1) {
//                   remainingOver = remainingOver - 0.1f;
                    float temp_ro = (remainingOver - (int) remainingOver);
                    if (temp_ro > .1f && temp_ro <= (.1f * ballsPerOver))
                        remainingOver = remainingOver - .1f;
                    else if ((int) (temp_ro * 10) == 0) {
                        remainingOver = remainingOver - 1;
                        remainingOver = remainingOver + (.1f * (ballsPerOver - 1));
                    }
                }
                Log.d("remainingOver", "remainingOver 1, : " + remainingOver);
//            bowlerOver = bowlerOver + 0.1f;
            }

            if (currentOver == 0.1f)
                btnUndo.setEnabled(true);

            if (runs != 12345) {     // valid ball, but not a run, this is a wicket,

//                mo = mo + runs;
//                maiden = false;
                if (ball >= ballsPerOver /*&& !wheel*/) {    // commented on 12/05/2020
                    efo = true;
                    endOver = true;
                    if (!wheel)
                        callEndOfOverAlert();
                }

                if (!confirm_extras) { //extras) { Updated on 01/03/2021

                    udisplay = modified;
                    modified = modified + "\t\t" + runs;
                    tvCurrentOver.setText(modified);
                    Log.d("modified3", modified);
                    Log.d("udisplay3", udisplay);

                    Log.d("MODIFIED", "setOver() 11, runs : " + runs);
                    Log.d("MODIFIED", "setOver() 11, modified : " + modified);
                    Log.d("MODIFIED", "setOver() 11, udisplay : " + udisplay);
                }

                Log.d("MODIFIED", "setOver() 12, runs : " + runs);
                Log.d("MODIFIED", "setOver() 12, modified : " + modified);
                Log.d("MODIFIED", "setOver() 12, udisplay : " + udisplay);


//           Log.d("Scoring","setover , modified : "+modified);
            } else {


                Log.d("Scoring", "setover , ball : " + ball);
                Log.d("Scoring", "setover , ballsPerOver : " + ballsPerOver);
                Log.d("Scoring", "setover , runs : " + runs);
//               udisplay = modified;
//               modified = modified + "\t\t" + runs;
//               tvCurrentOver.setText(modified);


            }
        }

        if (SET_OVER) {  // SET_OVER is used for calling the following codes
            // after traversing from Wagon Wheel
            Log.d("Scoring", "setover , SET_OVER : " + SET_OVER);
            SET_OVER = false;


            if (ball >= ballsPerOver) {

                efo = true;
                if (!wheel)
                    callEndOfOverAlert();

            }
        }

        Log.d("Scoring", "setover , currentInnings : " + currentInnings);
        Log.d("Scoring", "setover , totalInnings : " + totalInnings);


        if (currentInnings == totalInnings) {

          /* String message = "";

           if (preInningsRuns < currentRuns){//remainingRuns < currentRuns) {
               Log.d("Scoring", "setover , condition 1");
               Log.d("Scoring", "setover , preInningsRuns : "+ preInningsRuns + ", currentRuns : " + currentRuns);

               message = battingTeam + " win by " + (player_count - wicket) + " wickets";
               displayAlert(message);

           }

           else  if (currentOver == totalOver && preInningsRuns > currentRuns){

               Log.d("Scoring", "setover , preInningsRuns : "+ preInningsRuns + ", currentRuns : " + currentRuns);

               message = fieldingTeam + " win by " + (remainingRuns - currentRuns) + " runs";
               displayAlert(message);

           }*/

            Log.d("Scoring", "setover , innings : " + innings);
            Log.d("Scoring", "setover , totalInnings : " + totalInnings);
            Log.d("Scoring", "setover , currentOver : " + currentOver);
            Log.d("Scoring", "setover , totalOver : " + totalOver);
            Log.d("Scoring", "setover , currentRuns : " + currentRuns);
            Log.d("Scoring", "setover , innings1Runs : " + innings1Runs);
            Log.d("so_inninngs1Runs", "setover8 , : " + so_inninngs1Runs);


            if (totalInnings == 2) {

                if (currentOver == totalOver) {
                    target_achieved = true;
                    endMessage = "Allotted Overs are completed";
                    displayAlert(endMessage, 1);
                } else if (currentOver <= totalOver) {

                    if (currentRuns > innings1Runs) {
                        target_achieved = true;
                        endMessage = "Target Achieved";
                        displayAlert(endMessage, 1);
                    }

                    if (revisedTarget > 0) {
                        if (currentRuns >= revisedTarget) {
                            target_achieved = true;
                            endMessage = "Revised Target Achieved";
                            displayAlert(endMessage, 1);
                        }
                    }
                }
            } else if (totalInnings == 4 && currentInnings == 4) {

                if (remainingRuns <= 0) {
                    target_achieved = true;
                    endMessage = "Target Achieved";
                    displayAlert(endMessage, 1);
                }

              /*if (revisedTarget > 0) {
                  if (currentRuns == revisedTarget)
                      displayAlert("Revised Target Achieved", 1);
              }*/
            }

        }

        if (SUPER_OVER && currentInnings == 100) {

            Log.d("so_inninngs1Runs", "setover9 , : " + so_inninngs1Runs);

            if (currentRuns > so_inninngs1Runs) {
                target_achieved = true;
                endMessage = "Target Achieved";
                displayAlert(endMessage, 1);
            }

            if (revisedTarget > 0) {
                if (currentRuns >= revisedTarget) {
                    target_achieved = true;
                    endMessage = "Revised Target Achieved";
                    displayAlert(endMessage, 1);
                }
            }
        }


        tvPlayingOver.setText(String.valueOf(new DecimalFormat("##.#").format(currentOver)));
        tvBowler.setText(bowler);
        tvBowlerOver.setText(String.valueOf(new
                DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
        tvBowlerMO.setText(String.valueOf(bowlerMO));
        tvBowlerRuns.setText(String.valueOf(bwRun));
        tvBowlerWicket.setText(String.valueOf(bowlerWicket));

        if (SUPER_OVER || preBowlerID == 0) {
//           if (preBowlerID == 0) {
            setPreBowlerVisibility(false);
//           }
        } else if (preBowlerID != 0 && !SUPER_OVER)
            setPreBowlerVisibility(true);


        if (currentInnings == 1 || currentInnings == 99)
            ll_remainings.setVisibility(View.GONE);

        else {

            ll_remainings.setVisibility(View.VISIBLE);

            if (remainingRuns > 0)
                tvRemainingRuns.setText(String.valueOf(remainingRuns));
//           else if (leadingRuns >= 0 && totalInnings == 4) {
            if (leadingRuns > remainingRuns && totalInnings == 4) {
                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                tvRemainingRunsText.setText("Leading Runs : ");
            }

            Log.e("Scoring", "setOver, leadingRuns 1 : " + leadingRuns);

            if (tvRemainingOversBallsText.isShown()) {
                if (remainingBalls > 100) {

                    tvRemainingOversBallsText.setText(", Overs : ");
                    tvRemainingOversBalls.setText(String.valueOf(new DecimalFormat("##.#").format(remainingOver)));
                } else {

                    tvRemainingOversBallsText.setText(", Balls : ");
                    Log.e("Scoring", "setOver, remainingBalls 1 : " + remainingBalls);
                    tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                }
            }

            if (innings.matches("single")) {

                tvRemainingRunsText.setText("Remaining Runs : ");
            } else {

                if (remainingRuns > 0) {
                    if (currentInnings == 4)
                        tvRemainingRunsText.setText("Remaining Runs : ");
                    else
                        tvRemainingRunsText.setText("Trial Runs : ");
                } else
                    tvRemainingRunsText.setText("Lead Runs : ");
            }
        }


        if (innings.matches("multi") && totalOver == 1000) {
            tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
            tvRemainingOversBalls.setVisibility(View.INVISIBLE);
        } else {
            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
            tvRemainingOversBalls.setVisibility(View.VISIBLE);
        }

        setDisplay(false);


    }


    void callEndOfOverAlert() {

        if (target_achieved) {

        } else {
            overCompleteAlert = new AlertDialog.Builder(ScoringActivity.this).create();
            overCompleteAlert.setIcon(R.drawable.ball);
            overCompleteAlert.setCancelable(false);
            overCompleteAlert.setTitle("OVER COMPLETED");
            overCompleteAlert.setButton(AlertDialog.BUTTON_POSITIVE, "END OVER",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {
                            dialog.dismiss();

                            Log.d("maiden", "dialog dismissed");

                            endOver = false;
                            undo = false;
                            tvCurrentOver.setText(" ");
                            dso = null;
                            tco = currentOver;
                            tbo = bowlerOver;
                            tpbo = preBowlerOver;

                            currentOver = totalBalls / ballsPerOver;
                            if (!new_bowler) {
//                            bowlerOver = bowlerBalls / ballsPerOver;
                                new_bowler = false;
                            }
//                        remainingOver = remainingBalls / ballsPerOver;
                            Log.d("scoring", "callEndOfOverAlert, currentOver : " + currentOver);
                            Log.d("scoring", "callEndOfOverAlert, bowlerOver : " + bowlerOver);
                            tvPlayingOver.setText(String.valueOf(new DecimalFormat("##.#").format(currentOver)));
                            tvBowlerOver.setText(String.valueOf(new
                                    DecimalFormat("##.##").format(setOverDisplay(bowlerOver, bowlerBalls))));

                            Log.d("maiden", "callEndOfOver 2, maiden : " + maiden);
                            Log.d("maiden", "callEndOfOver 2, bowlerMO : " + bowlerMO);

                            if (currentInnings == 1 || currentInnings == 99)
                                ll_remainings.setVisibility(View.GONE);

                            else {

                                ll_remainings.setVisibility(View.VISIBLE);

                                if (remainingRuns > 0)
                                    tvRemainingRuns.setText(String.valueOf(remainingRuns));
//                            else if (leadingRuns >= 0 && totalInnings == 4) {
                                if (leadingRuns > remainingRuns && totalInnings == 4) {
                                    tvRemainingRuns.setText(String.valueOf(leadingRuns));
                                    tvRemainingRunsText.setText("Leading Runs : ");
                                }

                                Log.e("Scoring", "callEndOfOverAlert, leadingRuns 2 : " + leadingRuns);

                                if (tvRemainingOversBallsText.isShown()) {
                                    if (remainingBalls > 100) {

                                        tvRemainingOversBallsText.setText(", Overs : ");
                                        tvRemainingOversBalls.setText(String.valueOf(new
                                                DecimalFormat("##.#").format(remainingOver)));
                                    } else {

                                        tvRemainingOversBallsText.setText(", Balls : ");
                                        Log.e("Scoring", "callEndOfOverAlert, remainingBalls 2 : " + remainingBalls);
                                        tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                                    }
                                }

                                if (innings.matches("single")) {

                                    tvRemainingRunsText.setText("Remaining Runs : ");
                                } else {

                                    if (remainingRuns > 0) {

                                        if (currentInnings == 4)
                                            tvRemainingRunsText.setText("Remaining Runs : ");
                                        else
                                            tvRemainingRunsText.setText("Trial Runs : ");
                                    } else
                                        tvRemainingRunsText.setText("Lead Runs : ");
                                }

                            }

                            if (innings.matches("multi") && totalOver == 1000) {

                                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                                tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                            } else {

                                tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                                tvRemainingOversBalls.setVisibility(View.VISIBLE);
                            }


                            udisplay = modified;
                            modified = "";

                            if (mo == 0) {
                                maiden = true;
                                ++bowlerMO;
                            } else
                                maiden = false;

                            replacedBowlerID = 0;
                            replacedBowler = null;
                            replacedBowlerOver = 0;
                            replacedBowlerBall = 0;

                            Log.d("maiden", "callEndOfOver 1, maiden : " + maiden);
                            Log.d("maiden", "callEndOfOver 1, bowlerMO : " + bowlerMO);
                            tvBowlerMO.setText(String.valueOf(bowlerMO));


                            syncBowler();

                            endOfOver = true;
                            changeStriker();

                            ballType = 5;
                            final int temp_ball = ball;
                            ball = 0;
                            Log.d("so_inninngs1Runs", "callEndOfOver10 , : " + so_inninngs1Runs);
//                        Log.e("Scoring", "setOver, overCompleteAlert, ballType : "+ballType);
                            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball, temp_ball,
                                    preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                    innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                    fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                    nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                    bowlerBalls, bowlerWicket,/* nextBowlerID,*/ preBowlerID, preBowlerRun,
                                    preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0,
                                    ballType, 0, 0, -1, dismissedPlayrID,
                                    null, 0, 0, 0, 0,
                                    false, 0, commentary, 0, mo,
                                    maiden, modified, udisplay, tco, tbo, tpbo, 0, sessionType,
                                    sessionID, false,/*jsonEventArray, jsonUndoArray,*/ endOfDay,
                                    SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, false, freeHit,
                                    false, inning_started, 0, 0,
                                    0, null, pre_out, callBowlerAlert, wk_id,
                                    keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                    forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                    tea_flag, dinner_flag);
                            Log.d("Scoring", "callEndOfOverAlert, bowlerID : " + bowlerID + ", bwRun : " + bwRun +
                                    ", bowlerOver : " + bowlerOver + ", bowlerBalls : " + bowlerBalls + ", bowlerWicket " +
                                    bowlerWicket);
//                        ball = 0;


                            mo = 0;
                            maiden = false;

                            if (currentOver >= totalOver) {

                                Log.d("Scoring", "callEndOfOverAlert, currentOver : " + currentOver);

                                callEndOfInnings(1);

                            } else {
                                selectBowlerAlertDialog();
                            }


                        }


                    });

            overCompleteAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "RETURN",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {

                            dialog.dismiss();
                            endOver = false;
                            undo = false;
                        }
                    });

            overCompleteAlert.show();
            endOfOver = false;
        }
    }


    void callEndOfInnings(int id) {

        endOfInningsAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        endOfInningsAlert.setIcon(R.drawable.ball);
        endOfInningsAlert.setCancelable(false);
        endOfInningsAlert.setTitle("End Innings");
        endOfInningsAlert.setMessage("Allotted overs completed");
        endOfInningsAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.cancel();
                        endOfInnings = true;
//                        dialog.dismiss();

                        ballType = 10;
//                        setEndInnings(false, ballType);
                        editor = sharedPreferences.edit();
                        editor.putInt("sp_batting_order", 2);
                        editor.apply();

                        Log.e("Scoring", "setOver, endOfInningsAlert, ballType : " + ballType);
                        Log.e("strID", "setOver, endOfInningsAlert, ballType : " + strID);
                        Log.e("nstrId", "setOver, endOfInningsAlert, ballType : " + nstrID);
                        Log.e("Scoring", "setOver, endOfInningsAlert, currentInnings : " + currentInnings);
                        Log.e("Scoring", "setOver, endOfInningsAlert, totalInnings : " + totalInnings);

                        if (SUPER_OVER) {

                            if (currentInnings == 99) {
//                                endOfInnings = true;
                                displayScoreCard(false, false);
                            } else if (currentInnings == 100) {


                                callEndOfMatch(1, id);
                            }
                        } else if (currentInnings == totalInnings) {
                            Log.d("Scoring", "callEndOfInnings, currentInnings : " + currentInnings);

                            if (totalInnings == 2 && currentRuns == preInningsRuns)
                                check_SUPEROVER();
                            else {
                                callEndOfMatch(1, id);
                            }

                        } else {

//                            setMatchStatus("SE3", 11);
//                            continue
//                            endOfInnings = true;
                            displayScoreCard(false, false);
                        }
                    }
                });


        endOfInningsAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
//                        endOfInnings = false;
                        /*if (id == 1)
                            callEndOfOverAlert();*/
                    }
                });

        endOfInningsAlert.show();
    }


    void callEndOfMatch(int id, int pid) {

        Log.d("callEndOfMatch", "callEndOfMatch,");

        allottedInningsAlert = new AlertDialog.
                Builder(ScoringActivity.this).create();
        allottedInningsAlert.setIcon(R.drawable.ball);
        allottedInningsAlert.setCancelable(false);
        allottedInningsAlert.setTitle("Match is Over");
        allottedInningsAlert.setMessage("Allotted innings completed");
        allottedInningsAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();
                        endOfMatch = true;

                        // Added on 22/04/2021 (C)
                        if (id == 1) {
                            sessionID = 11;
                            sessionType = "SE3";
                        }
                        // ======== till here (C)
//                        Log.d("callEndOfMatch", "endOfMatch : " + endOfMatch);
//                        if (currentInnings == totalInnings && currentInnings == 2) {
//                            Log.d("callEndOfMatch", "currentInnings = totalInnings = " + totalInnings);
//                            /*if (currentRuns == innings1Runs) {
//
//                                check_SUPEROVER();
//                            }
//                            else {*/
//                                endOfMatch();
////                            displayScoreCard();
////                            }
//                        }
//
//                        else {

                        // Added on 03/03/2021
                        if (ballType == 9 && forceEndingType > 0) {
                            setEndInnings(false, ballType);
                            if (forceEndingType == 2)
                                setBatsmanAsAbsent();
                        } else if (ballType == 10 && SUPER_OVER && currentInnings == 100) {
                            setEndInnings(false, ballType);
                        } else if (ballType == 10 && (currentInnings == totalInnings) && !SUPER_OVER) {
                            setEndInnings(false, ballType);
                        }


                        callMatchEnd(); // Added on 03/03/2021
                        endOfMatch();
//                            displayScoreCard();
//                        }
                    }
                });


        allottedInningsAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
//                            selectBowlerAlertDialog();

                        ballType = -1;
                        forceEndingType = 0;
                        rain_rule = false;
                        remaining_absent = false;
                        declared = false;
                        endOfInnings = false;

                        if (id == 2)
                            forceEndInnings(0, 0);
                        else if (id == 1)
                            callEndOfInnings(pid);
//                        endOfMatch = true;
                    }
                });
        allottedInningsAlert.show();
    }


    void displayAlert(String message, int flag) {

        matchOverAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        matchOverAlert.setIcon(R.drawable.ball);
        matchOverAlert.setCancelable(false);
//        matchOverAlert.setTitle("Match Over");
        matchOverAlert.setTitle(message);
//                    matchOverAlert.setMessage(battingTeam + " win by " + (player_count - wicket) + " wickets");
//        matchOverAlert.setMessage(message);
        matchOverAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        endOfInnings = true;
                        endOfMatch = true;
                        updateMatch(matchid, endOfInnings);
                        saveEndOfInnings();
                        if (strID != 0)
                            syncBatsmann(strID, 0, null, false, -1,
                                    false, false, false);
                        if (nstrID != 0)
                            syncBatsmann(nstrID, 0, null, false, -1,
                                    false, false, false);
                        syncBowler();
                        callMatchEnd();
                        endOfMatch();

                    }
                });

        matchOverAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        endOfInnings = true;
                        saveEndOfInnings();


//                        endOfMatch = true;
//                        if (flag == 0)
//                            allOUT();
//                        else if (flag == 1) {
//                            SET_OVER = false;
//                            setOver(537);
//                        }

                    }
                });
        matchOverAlert.show();
    }


    void saveEndOfInnings() {

        Log.d("so_inninngs1Runs", "saveEndOfInnings11 , : " + so_inninngs1Runs);
        ballType = 10;
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo,
                player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID, nonStrikerRuns,
                nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket,/*nextBowlerID,*/
                preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket,
                lastPreBowlerID, runs, ballType, 0, 0, 0, 0,
                null, 0, 0, 0, 0, false,
                0, commentary, 0, 0, false, modified,
                udisplay, tco, tbo, tpbo, 0, sessionType, sessionID, false, /*jsonEventArray,
                jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, false,
                freeHit, false, inning_started, 0, 0, 0,
                null, pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id,
                pre_wk_position, FORFEIT, forfeit_team, forfeit_innings, CONCEDE, conceded_team,
                forceEndingType, lunch_flag, tea_flag, dinner_flag);
    }


    void callMatchEnd() {

        Log.d("so_inninngs1Runs", "callMatchEnd12 , : " + so_inninngs1Runs);

        ballType = 11;
        Log.e("displayAlert", "endOfMatch : " + endOfMatch + ", ballType : " + ballType);
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo,
                player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID, nonStrikerRuns,
                nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/
                preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                runs, ballType, 0, 0, 0, 0, null,
                0, 0, 0, 0, false, 0,
                commentary, 0, 0, false, modified, udisplay, tco, tbo, tpbo,
                0, sessionType, sessionID, false, /*jsonEventArray, jsonUndoArray,*/
                endOfDay, SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, false, freeHit,
                false, inning_started, 0, 0, 0,
                null, pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id,
                pre_wk_position, FORFEIT, forfeit_team, forfeit_innings, CONCEDE, conceded_team,
                forceEndingType, lunch_flag, tea_flag, dinner_flag);

       /* allottedInningsAlert = new AlertDialog.
                Builder(ScoringActivity.this).create();
        allottedInningsAlert.setIcon(R.drawable.ball);
        allottedInningsAlert.setCancelable(false);
        allottedInningsAlert.setTitle("Match is Over");
        allottedInningsAlert.setMessage("Allotted innings completed");
        allottedInningsAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();
                        endOfMatch = true;

                        ballType = 11;
                        Log.e("displayAlert", "endOfMatch : " + endOfMatch + ", ballType : " + ballType);
                        newEvent(currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                innings1Runs, innings2Runs, innings3Runs, innings4Runs,
                                battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID, strikerRuns,
                                strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                                bowlerOver, bowlerBalls, bowlerWicket, *//*nextBowlerID,*//* preBowlerID,
                                preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, runs,
                                ballType, 0, 0, 0, 0, null,
                                0, 0, 0, 0, false,
                                0, commentary, 0, 0, false,
                                modified, udisplay, tco, tbo, tpbo, 0, null,
                                0, false, jsonEventArray);

                        if (strID != 0)
                            syncBatsmann(strID, 0, null, false, -1, false, false);
                        if (nstrID != 0)
                            syncBatsmann(nstrID, 0, null, false, -1, false, false);
                        syncBowler();
                        endOfMatch();
                    }
                });


        allottedInningsAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        displayAlert(message, flag);
                    }
                });
        allottedInningsAlert.show();*/
    }



   /* void callNextBowler(){

        firstBowlerAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        firstBowlerAlert.setIcon(R.drawable.ball);
        firstBowlerAlert.setMessage("Bowler Changed");
        firstBowlerAlert.setButton(AlertDialog.BUTTON_POSITIVE, "OK",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        preBowlerID = bowlerID;
                        preBowler = bowler;
                        preBowlerRun = bwRun;
                        preBowlerBalls = bowlerBalls;
                        preBowlerOver = bowlerOver;
                        preBowlerWicket = bowlerWicket;
                        preBowlerMO = bowlerMO;

                        mo = 0;

                        bowlerID = nextBowlerID;
                        bowler = nextBowler;
                        nextBowler = "";
                        nextBowlerID = 0;
                        newBowler(bowlerID, preBowlerID);

                        tco = currentOver;
                        tbo = bowlerOver;
                        tpbo = preBowlerOver;
                        udisplay = modified;

                        currentOver = totalBalls / ballsPerOver;
                        if (!new_bowler) {
//                            bowlerOver = bowlerBalls / ballsPerOver;
                            new_bowler = false;
                        }
                        remainingOver = remainingBalls / ballsPerOver;
                        tvPlayingOver.setText(String.valueOf(
                                new DecimalFormat("##.#").format(currentOver)));
                        tvBowlerOver.setText(String.valueOf(
                                new DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
//                                                    changeBowler();

                        if (currentInnings != 99) {

                            tvBowler2.setText(preBowler);
                            tvBowlerRuns2.setText(String.valueOf(preBowlerRun));
                            tvBowlerMO2.setText(String.valueOf(preBowlerMO));
                            tvBowlerWicket2.setText(String.valueOf(preBowlerWicket));
                            tvBowlerOver2.setText(String.valueOf(
                                    new DecimalFormat("##.#").
                                            format(setOverDisplay(preBowlerOver, preBowlerBalls))));
                        }

                        ballType = 6;

                        Log.e("Scoring", "setOver, nextBowlerAlert, ballType : "+ballType);
                        newEvent(currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID, strikerRuns,
                                strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                                bowlerOver, bowlerBalls, bowlerWicket, *//*nextBowlerID,*//* preBowlerID, preBowlerRun,
                                preBowlerOver, preBowlerBalls, preBowlerWicket, 0, ballType,0,
                                0, 0, 0, null, 0,
                                0, 0, 0, false, 0,
                                commentary, bowlerID, mo, maiden, modified, udisplay, tco, tbo, tpbo,
                                0, null, 0, false, jsonEventArray);

                    }
                });
        nextBowlerAlert.show();
    }
*/


    void selectBowlerAlertDialog() {

        bowlerAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        bowlerAlert.setIcon(R.drawable.ball);
        bowlerAlert.setCancelable(false);
        bowlerAlert.getWindow().setGravity(Gravity.BOTTOM);
        bowlerAlert.setTitle("Select Bowler");
        bowlerAlert.setMessage("Return to continue with bowler of previous over");
        bowlerAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CHANGE",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        tco = currentOver;
                        tbo = bowlerOver;
                        tpbo = preBowlerOver;
                        udisplay = modified;

                        callBowlerAlert = false;
                        Log.d("SBAD", "currentOver = " + currentOver);
                        Log.d("SBAD", "totalBalls = " + totalBalls);
                        Log.d("SBAD", "ballsPerOver = " + ballsPerOver);
//                        currentOver = totalBalls / ballsPerOver;// commented on 02/07/2021
//                        ++currentOver;
                        Log.d("SBAD", "currentOver 2 = " + currentOver);
                        if (!new_bowler) {
//                            bowlerOver = bowlerBalls / ballsPerOver;
                            new_bowler = false;
                        }
//                        remainingOver = remainingBalls / ballsPerOver;
                        tvPlayingOver.setText(String.valueOf(new DecimalFormat("##.#").format(currentOver)));
                        tvBowlerOver.setText(String.valueOf(new
                                DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));


                        if (currentInnings == 1 || currentInnings == 99)
                            ll_remainings.setVisibility(View.GONE);

                        else {

                            ll_remainings.setVisibility(View.VISIBLE);

                            if (remainingRuns > 0)
                                tvRemainingRuns.setText(String.valueOf(remainingRuns));
//                            else if (leadingRuns >= 0 && totalInnings == 4) {
                            if (leadingRuns > remainingRuns && totalInnings == 4) {
                                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                                tvRemainingRunsText.setText("Leading Runs : ");
                            }

                            Log.e("Scoring", "selectBowlerAlertDialog, leadingRuns : " +
                                    leadingRuns);

                            if (tvRemainingOversBallsText.isShown()) {
                                if (remainingBalls > 100) {

                                    tvRemainingOversBallsText.setText(", Overs : ");
                                    tvRemainingOversBalls.setText(String.valueOf(new
                                            DecimalFormat("##.#").format(remainingOver)));
                                } else {

                                    tvRemainingOversBallsText.setText(", Balls : ");
                                    Log.e("Scoring", "selectBowlerAlertDialog, remainingBalls : " +
                                            remainingBalls);
                                    tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                                }
                            }

                            if (innings.matches("single")) {

                                tvRemainingRunsText.setText("Remaining Runs : ");
                            } else {

                                if (remainingRuns > 0) {

                                    if (currentInnings == 4)
                                        tvRemainingRunsText.setText("Remaining Runs : ");
                                    else
                                        tvRemainingRunsText.setText("Trial Runs : ");
                                } else
                                    tvRemainingRunsText.setText("Lead Runs : ");
                            }

                        }


                        if (innings.matches("multi") && totalOver == 1000) {

                            tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                            tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                        } else {

                            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                            tvRemainingOversBalls.setVisibility(View.VISIBLE);
                        }

                        changeBowler(1);


                        if (currentInnings >= 99) {

                            tvBowler2.setText(preBowler);
                            tvBowlerRuns2.setText(String.valueOf(preBowlerRun));
                            tvBowlerMO2.setText(String.valueOf(preBowlerMO));
                            tvBowlerWicket2.setText(String.valueOf(preBowlerWicket));
                            tvBowlerOver2.setText(String.valueOf(new
                                    DecimalFormat("##.#").format(setOverDisplay(preBowlerOver, preBowlerBalls))));
                        }


                        tvBowler.setText(bowler);
                        tvBowlerRuns.setText(String.valueOf(bwRun));
                        tvBowlerOver.setText(String.valueOf(new
                                DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
                        tvBowlerMO.setText(String.valueOf(bowlerMO));
                        tvBowlerWicket.setText(String.valueOf(bowlerWicket));

                    }
                });


        bowlerAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "RETURN",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        callBowlerAlert = false;
                        if (preBowlerID == 0) {

                            AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
                            alertDialog.setIcon(R.drawable.ball);
                            alertDialog.setCancelable(false);
                            alertDialog.setMessage("No previous bowler to return");
                            alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                                    new DialogInterface.OnClickListener() {
                                        public void onClick(DialogInterface dialog, int which) {
                                            dialog.dismiss();
                                            selectBowlerAlertDialog();
                                        }
                                    });
                            alertDialog.show();
                        } else {

                            // Added on 08/07/2021
                            if (limited_over) {
                                Bowler bow = realm.where(Bowler.class).
                                        equalTo("matchid", matchid).
                                        equalTo("innings", currentInnings).
                                        equalTo("playerID", preBowlerID).findFirst();
                                if (bow != null) {
                                    b_over = bow.getOver();
                                    if (b_over >= max_opb) {
                                        displayWarningBowler(/*"Over limit exceeded for the bowler ",*/ preBowler, -1, 2);
                                    } else
                                        confirmReturnBowler();
                                } else
                                    confirmReturnBowler();
                            } else
                                confirmReturnBowler();

                            // === till here

                           /* Moved to bottom on 08/07/2021
                            //ADDED ON 26/02/2021 (only alert box)

                            AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                            builderInner.setIcon(R.drawable.ball);
                            builderInner.setCancelable(false);
                            dialog.dismiss();
                            builderInner.setMessage(preBowler);
                            builderInner.setTitle("Selected Bowler is");

                            builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {

                                    tco = currentOver;
                                    tbo = bowlerOver;
                                    tpbo = preBowlerOver;

                                    Log.d("so_inninngs1Runs","selectBowlerAlertDialog13 , : "+so_inninngs1Runs);
                                    ballType = 6;
                                    int tempID = bowlerID;
                                    lastPreBowlerID = preBowlerID;
                                    bowlerID = preBowlerID;
                                    preBowlerID = tempID;
                                    preBowler = bowler;
                                    Log.e("Scoring", "selectBowlerAlertDialog, bowlerAlert, RETURN, ballType : " + ballType);
                                    newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                                            wicket, ball, 0, preInningsRuns, remainingRuns, remainingBalls,
                                            remainingOver, leadingRuns, innings1Runs, innings2Runs, innings3Runs,
                                            innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                                            strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID,
                                            bwRun, bowlerOver, bowlerBalls, bowlerWicket, *//*nextBowlerID,*//*preBowlerID,
                                            preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                                            0, ballType, -1, 0, -1, 0,
                                            null, 0, 0, 0, 0,
                                            false, 0, commentary, preBowlerID, mo, maiden,
                                            modified, udisplay, tco, tbo, tpbo, 0, sessionType, sessionID,
                                            false, *//*jsonEventArray, jsonUndoArray,*//* endOfDay, SUPER_OVER,
                                            so_inninngs1Runs, so_inninngs2Runs, false, freeHit,
                                            false, inning_started, 0, 0,
                                            0, null, pre_out, callBowlerAlert, wk_id,
                                            keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                            forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                            tea_flag, dinner_flag);

                                    newBowler(bowlerID, preBowlerID);

                                }
                            });

                            builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {
                                    dialog.dismiss();
                                    selectBowlerAlertDialog();
                                }
                            });
//
                            builderInner.show();*/
                        }
//                        changeStriker();
                    }
                });

        bowlerAlert.setButton(AlertDialog.BUTTON_NEUTRAL, "INTERVAL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        callBowlerAlert = true;
                        setInterval(1);
                    }
                });
        bowlerAlert.show();
    }


    // function used to check whether the run is boundary or not

    void checkBoundary(int run) {

//        Log.d("checkBoundary", " matchid :"+matchid);
//        Log.d("checkBoundary", " matchID :"+matchID);

        boundaryAlert = new AlertDialog.Builder(this);
        boundaryAlert.setIcon(R.drawable.ball);
        boundaryAlert.setCancelable(false);
        boundaryAlert.setTitle("Boundary or Runs ?");
//        boundaryAlert.setMessage("This is BOUNDARY ?");
        boundaryAlert.setPositiveButton("BOUNDARY", new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int which) {
                ballType = 2;
                boundary = true;
                setPlayerRuns(run);
            }
        });
        boundaryAlert.setNegativeButton("RUNS", new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int which) {
                ballType = 1;
                setPlayerRuns(run);
            }
        });
        boundaryAlert.show();

    }


    // set runs of player, either player1 or player2, including boundary

    public void setPlayerRuns(int run) {
        int t = 0;

        Log.d("MODIFIED", "setPlayerRuns() 9, modified : " + modified);
        Log.d("MODIFIED", "setPlayerRuns() 9, udisplay : " + udisplay);

        Log.e("scoring", " setPlayerRuns, bowlerID : " + bowlerID);
        Log.e("scoring", " setPlayerRuns, run : " + run);
        Log.e("scoring", " setPlayerRuns, currentOver : " + currentOver);
        Log.e("scoring", " setPlayerRuns, ball : " + ball);
        Log.e("scoring", " setPlayerRuns, preInningsRuns : " + preInningsRuns);
//        Log.e("scoring", " setPlayerRuns, preBowlerID : "+preBowlerID);
//        Log.d("SETPLAYERRUNS", ", beginning, mo : " + mo);
//        Log.d("SETPLAYERRUNS", "beginning, maiden : " + maiden);
//        Log.d("setPlayerRuns", " matchID :"+matchID);
//        Log.d("setPlayerRuns", " striker :"+striker);
//        Log.d("setPlayerRuns", " nonStriker :"+nonStriker);
//        Log.e("SETPLAYERRUNS", "beginning, leadingRuns : " + leadingRuns);
//        Log.e("SETPLAYERRUNS", "beginning, remainingRuns : " + remainingRuns);
//        Log.e("SETPLAYERRUNS", "beginning, remainingBalls : " + remainingBalls);
//        Log.e("SETPLAYERRUNS", "beginning, remainingOver : " + remainingOver);


        if (!striker.matches("") && !(nonStriker.matches(""))) {

            Log.e("scoring", " setPlayerRuns, striker : " + striker);
            Log.e("scoring", " setPlayerRuns, nonStriker : " + nonStriker);

            /*if (newPartnership)
                newPartnership = false;*/


            if (strID == player1ID) {

                if (run == 0) {
                    ++player1Dots;
                    ++bowlerDots;
                }

                if (ballType == 2) {
                    if (run == 4) {
                        ++player1F4s;
                        ++bowlerF4s;
                    }
                    if (run == 6) {
                        ++player1S6s;
                        ++bowlerS6s;
                    }
                }

                player1Runs = player1Runs + run;
                ++player1Balls;
                strikerRuns = player1Runs;
                strikerBalls = player1Balls;

                strikerDots = player1Dots;
                strikerF4s = player1F4s;
                strikerS6s = player1S6s;
                nonStrikerDots = player2Dots;
                nonStrikerF4s = player2F4s;
                nonStrikerS6s = player2S6s;
                tvPlayer1Runs.setText(String.valueOf(player1Runs));
                tvPlayer1Balls.setText(String.valueOf(player1Balls));
//                Log.d("setPlayerRuns", " player 1 run added : "+ run);
            }


            if (strID == player2ID) {

                if (run == 0) {
                    ++player2Dots;
                    ++bowlerDots;
                }

                if (ballType == 2) {
                    if (run == 4) {
                        ++player2F4s;
                        ++bowlerF4s;
                    }
                    if (run == 6) {
                        ++player2S6s;
                        ++bowlerS6s;
                    }
                }
                player2Runs = player2Runs + run;
                ++player2Balls;
                strikerRuns = player2Runs;
                strikerBalls = player2Balls;

                strikerDots = player2Dots;
                strikerF4s = player2F4s;
                strikerS6s = player2S6s;
                nonStrikerDots = player1Dots;
                nonStrikerF4s = player1F4s;
                nonStrikerS6s = player1S6s;
                tvPlayer2Runs.setText(String.valueOf(player2Runs));
                tvPlayer2Balls.setText(String.valueOf(player2Balls));
//                Log.d("setPlayerRuns", "player 2 run added : "+ run);
            }
//            Log.d("setPlayerRuns", striker+" run added : "+ run);

            if (strID == ps1ID) {
                ++p1CB;
                p1CR = p1CR + run;
            } else if (strID == ps2ID) {
                ++p2CB;
                p2CR = p2CR + run;
            }


            strikerPlaying = true;
            strikerOut = false;
            oType = "";
//            bowlerRun = bowlerRun + run;
            currentRuns = currentRuns + run;
            psRuns = psRuns + run;

            setInningsRuns(currentInnings, currentRuns);

            if (currentInnings == 1 || currentInnings == 99)
                ll_remainings.setVisibility(View.GONE);

            else {
//
//                Log.e("SETPLAYERRUNS", "add leading run,  ll_remaining veisible");
//                Log.e("SETPLAYERRUNS", "add leading run,  remainingRuns : " + remainingRuns);


                ll_remainings.setVisibility(View.VISIBLE);

                leadingRuns = leadingRuns + run;
                if (remainingRuns > 0) {

                    remainingRuns = remainingRuns - run;
                    tvRemainingRuns.setText(String.valueOf(remainingRuns));
                    Log.e("SETPLAYERRUNS", "add leading run,  leadingRuns : " + leadingRuns);
                    Log.e("SETPLAYERRUNS", "add leading run,  remainingRuns : " + remainingRuns);
                }


                /*else if (remainingRuns < 0) {
                    if (leadingRuns == 0) {

                        temp = run + (-remainingRuns);
//                        Log.e("SETPLAYERRUNS", "add leading run,  temp : " + temp);
//                        Log.e("SETPLAYERRUNS", "add leading run,  run : " + run);
//                        if (temp < 0)
//                            leadingRuns = -temp;
//                        else
                            leadingRuns = temp;
                        temp = 0;
                        remainingRuns = 0;
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
                    }
                }*/

//                else if (leadingRuns >= 0 && totalInnings == 4) {
                if (leadingRuns > remainingRuns && totalInnings == 4) {
                    tvRemainingRuns.setText(String.valueOf(leadingRuns));
                    tvRemainingRunsText.setText("Leading Runs : ");

                }


//                 else if (run > remainingRuns && leadingRuns == 0) {
////                        remaining_run_flag = false;
////                    leadingRuns = run - remainingRuns;
//                        if (remainingRuns < 0)
//
//                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
//
//                    }
//
//                }


//                Log.e("SETPLAYERRUNS", "add leading run,  leadingRuns : " + leadingRuns);


                if (innings.matches("single")) {

                    tvRemainingRunsText.setText("Remaining Runs : ");
                } else {

                    if (remainingRuns > 0) {
                        if (currentInnings == 4)
                            tvRemainingRunsText.setText("Remaining Runs : ");
                        else
                            tvRemainingRunsText.setText("Trial Runs : ");
                    } else
                        tvRemainingRunsText.setText("Lead Runs : ");
                }

//                Log.e("SETPLAYERRUNS", "b4 setOver,  leadingRuns : " + leadingRuns);
            } //  end of (currentInnings != 1 || currentInnings != 99)


            ++bowlerBalls;
//            bowlerOver = bowlerOver + 0.1f;
            bwRun = bwRun + run;
            mo = mo + run;

            tvBowlerRuns.setText(String.valueOf(bwRun));
            tvTotalRuns.setText(String.valueOf(currentRuns));

            tvBowler.setText(bowler);
            tvBowlerOver.setText(String.valueOf(new
                    DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
            tvBowlerMO.setText(String.valueOf(bowlerMO));
//            tvBowlerRuns.setText(String.valueOf(bowlerRuns));
            tvBowlerWicket.setText(String.valueOf(bowlerWicket));


            if (preBowlerID == 0)
                setPreBowlerVisibility(false);
            else
                setPreBowlerVisibility(true);
//            if (currentInnings != 99 && currentInnings != 100) {
//
//                tvBowlerRuns2.setText(String.valueOf(preBowlerRun));
//                tvBowler2.setText(preBowler);
//                tvBowlerOver2.setText(String.valueOf(new
//                        DecimalFormat("##.#").format(setOverDisplay(preBowlerOver, preBowlerBalls))));
//                tvBowlerMO2.setText(String.valueOf(preBowlerMO));
////            tvBowlerRuns.setText(String.valueOf(bowlerRuns));
//                tvBowlerWicket2.setText(String.valueOf(preBowlerWicket));
//
//            }
            Log.d("so_inninngs1Runs", "setPlayerRuns14 , : " + so_inninngs1Runs);
            Log.d("checkFreeHit", "setPlayerRuns 1, : " + checkFreeHit);
            Log.d("freeHit", "setPlayerRuns 1, : " + freeHit);

            setOver(run);

            Log.d("MODIFIED", "setPlayerRuns() 10, modified : " + modified);
            Log.d("MODIFIED", "setPlayerRuns() 10, udisplay : " + udisplay);

            syncBatsmann(strID, 0, null, false, -1, false,
                    false, false);
            syncBowler();

            Log.d("Partnership", "setPlayerRuns 1, wicket : " + wicket);
            Log.d("Partnership", "setPlayerRuns 1, psRuns : " + psRuns);
            Log.d("Partnership", "setPlayerRuns 1, psBalls : " + psBalls);
            Log.d("Partnership", "setPlayerRuns 1, player1ID : " + player1ID);
            Log.d("Partnership", "setPlayerRuns 1, ps1ID : " + ps1ID);
            Log.d("Partnership", "setPlayerRuns 1, p1CR : " + p1CR);
            Log.d("Partnership", "setPlayerRuns 1, p1CB : " + p1CB);
            Log.d("Partnership", "setPlayerRuns 1, player2ID: " + player2ID);
            Log.d("Partnership", "setPlayerRuns 1, ps2ID : " + ps2ID);
            Log.d("Partnership", "setPlayerRuns 1, p2CR : " + p2CR);
            Log.d("Partnership", "setPlayerRuns 1, p2CB : " + p2CB);
            Log.d("Partnership", "setPlayerRuns 1, newPartnership : " + newPartnership);
            syncPartnership(wicket + 1, out, 0, false, false);
           /* if (newPartnership)
                newPartnership = false;*/

            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket,
                    ball, 0, preInningsRuns, remainingRuns, remainingBalls, remainingOver,
                    leadingRuns, innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                    fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID,
                    nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket,
                    /*nextBowlerID,*/preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket,
                    lastPreBowlerID, run, ballType, -1, 0, -1, 0,
                    null, 0, -1, 0, 0, false,
                    0, commentary, 0, mo, maiden, modified, udisplay, tco,
                    tbo, tpbo, 0, sessionType, sessionID, true, /*jsonEventArray,
                     jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs,
                    false, freeHit, false, inning_started, 0,
                    0, 0, null, pre_out, callBowlerAlert, wk_id,
                    keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team, forfeit_innings,
                    CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);

            /*if (strikerBalls == 1)
                syncBatsmann(strID,0, null, false, -1, false, true);
            else*/


            if (wheel) {// && !out) {
                setWagonWheelRegion(eventID);
            }

            if (ball >= 1)
                inningsNotStarted = false;

            Log.d("checkFreeHit", "setPlayerRuns 2, : " + checkFreeHit);
            Log.d("freeHit", "setPlayerRuns 2, : " + freeHit);

            resetFreeHit();

            boundary = false;
            commentary = "";
            endOfOver = false;

//            Log.d("SETPLAYERRUNS", "end, mo : " + mo);
//            Log.d("SETPLAYERRUNS", "end, maiden : " + maiden);

        }

    }


    void resetFreeHit() {

        if (freeHit) {

            freeHit = false;
            checkFreeHit = false;
        }

    }


    // seperates boundaries and normal runs

    void displayOver(int run) {

        Log.d("MODIFIED", "displayOver() 8, modified : " + modified);
        Log.d("MODIFIED", "displayOver() 8, udisplay : " + udisplay);

        firstbowler = false;
        just_started = false;
        if (status.matches("start")) {
            status = "resume";
            updateMatch(matchid, false);
        }

//        Log.d("displayOver", " matchid :"+matchid);
//        Log.d("displayOver", " matchID :"+matchID);


        if (run == 4 || run == 6) {

            checkBoundary(run);
        } else {

            ballType = 1;
            setPlayerRuns(run);
        }
        if (run % 2 != 0) {//run == 1 || run == 3){
            changeStriker();
        }

    }


    // the current bowler

    void changeBowler(int type) {

        ArrayList<Integer> bowlerIDs = new ArrayList<Integer>();


        Log.d("Scoring", "changeBowler, replacedBowler : " + replacedBowler + ", balltype : " + ballType);
        Log.d("Scoring", "changeBowler, preBowlerID : " + preBowlerID + ", preBowler : " + preBowler);
        Log.d("Scoring", "changeBowler, bowlerID : " + bowlerID + ", bowler : " + bowler + ", bowlerBalls : " + bowlerBalls);

        final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                android.R.layout.select_dialog_singlechoice);

        RealmResults<Player> results = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", fieldingTeamNo).
                equalTo("retired", false).
                equalTo("retired_concussion", false).    // added on 27/02/2021
                equalTo("substitute", false).findAll();

        results.load();
        for (Player player : results) {
            if (!(player.getPlayerName()).matches(bowler)) {

                if (player.getPlayerID() != wk_id) {
//                    arrayAdapter.add(player.getPlayerName());
                    if (replacedBowler != null) {

                        if (!(player.getPlayerName()).matches(replacedBowler)) {
                            arrayAdapter.add(player.getPlayerName());
                            bowlerIDs.add(player.getPlayerID());
                        }
                    } else {
                        arrayAdapter.add(player.getPlayerName());
                        bowlerIDs.add(player.getPlayerID());
                    }
                }
            }
        }

        Log.d("SCORE", "changeBowler, arrayAdapter = " + arrayAdapter);
        Log.d("SCORE", "changeBowler, bowlerIDs = " + bowlerIDs);

//            lastBallType = realm.where(Events.class).
//                    equalTo("matchid", matchid).
//                    equalTo("innings", currentInnings).findAll().last().getBallType();

        bowlerBuilder = new AlertDialog.Builder(ScoringActivity.this);
        bowlerBuilder.setIcon(R.drawable.ball);
        bowlerBuilder.setCancelable(false);
        bowlerBuilder.setTitle("Select Next Bowler");
        bowlerBuilder.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();

                if (type == 1)
                    selectBowlerAlertDialog();

                    /*else if (type == 0)
                        changeBowler(2);*/

            }
        });
        bowlerBuilder.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                String strName = arrayAdapter.getItem(which);
                int bowID = bowlerIDs.get(which);


                // copied on 06/05/2020, from top, before adding values to adapter
                Log.d("Scoring", "changeBowler 1, balltype : " + ballType + ", bowlerBalls : " + bowlerBalls +
                        ", ballsPerOver : " + ballsPerOver);
                if (ballType != 4 && ballType != 5 && ballType != 12 && ballType != 7) {// && ballType != 13) {
                    Log.d("Scoring", "changeBowler 2, balltype : " + ballType + ", bowlerBalls : " + bowlerBalls +
                            ", ballsPerOver : " + ballsPerOver);
                    if (bowlerBalls > 0 && bowlerBalls <= ballsPerOver) {
                        Log.d("Scoring", "changeBowler, replacedBowler");

                        replacedBowlerID = bowlerID;
                        replacedBowler = bowler;
                        replacedBowlerOver = bowlerOver;
                        replacedBowlerBall = bowlerBalls;
                    }
                } else {
                    lastPreBowlerID = preBowlerID;
                    preBowlerID = bowlerID;
                    preBowler = bowler;
                }
//                dialog.dismiss();

                // Added on 08/07/2021
                if (limited_over) {
                    Bowler bow = realm.where(Bowler.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("playerID", bowID).findFirst();
                    if (bow != null) {
                        b_over = bow.getOver();
                        if (b_over >= max_opb) {
                            displayWarningBowler(/*"Over limit exceeded for the bowler ",*/ strName, type, 1);
                        } else
                            confirmBowler(type, strName);
                    } else
                        confirmBowler(type, strName);
                } else
                    confirmBowler(type, strName);

                // === till here

                  /* Commented on  08/07/2021
                  Moved to seperate function = confirmBowler(type, strName);
                    AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                    builderInner.setIcon(R.drawable.ball);
                    builderInner.setCancelable(false);
                    dialog.dismiss();
                    builderInner.setMessage(strName);
                    builderInner.setTitle("Selected Bowler is");

                    builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {

                            if (replacedBowler == null) { //.matches("")) {

                                if (preBowlerID != 0) {
                                    if (!strName.matches(preBowler)) {

                                        replaceNextBowler(strName);

                                    } else {

                                        AlertDialog.Builder builderInners = new AlertDialog.Builder(ScoringActivity.this);
                                        builderInners.setIcon(R.drawable.ball);
                                        builderInners.setCancelable(false);
                                        dialog.dismiss();
                                        builderInners.setMessage("Selected bowler " + strName + " just bowled the previous over");
                                        builderInners.setTitle("OK to change selection");

                                        builderInners.setPositiveButton("OK", new DialogInterface.OnClickListener() {
                                            @Override
                                            public void onClick(DialogInterface dialog, int which) {
                                                dialog.dismiss();
                                                changeBowler(type);
                                            }
                                        });
                                        builderInners.show();
                                    }
                                }

                                else {
                                    replaceNextBowler(strName);
                                }
                            }

                            else if (replacedBowler != null) {

                                if (preBowlerID != 0) {

                                    if (!(strName.matches(preBowler)) && !(strName.matches(replacedBowler))) {

                                        replaceNextBowler(strName);

                                    } else {

                                        AlertDialog.Builder builderInners = new AlertDialog.Builder(ScoringActivity.this);
                                        builderInners.setIcon(R.drawable.ball);
                                        builderInners.setCancelable(false);
                                        dialog.dismiss();
                                        builderInners.setMessage("Selected bowler " + strName + " just bowled the previous over");
                                        builderInners.setTitle("OK to change selection");

                                        builderInners.setPositiveButton("OK", new DialogInterface.OnClickListener() {
                                            @Override
                                            public void onClick(DialogInterface dialog, int which) {

                                                dialog.dismiss();
                                                changeBowler(type);

                                            }
                                        });
//
                                        builderInners.show();
                                    }
                                }

                                else {

                                    replaceNextBowler(strName);
                                }
                            }
                        }
                    });

                    builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {
                            dialog.dismiss();
                            changeBowler(type);
                        }
                    });
                    builderInner.show();*/
            }
        });
        bowlerBuilder.show();
    }


    void replaceNextBowler(String strName) {

        {

            bowler = strName;
//            dialog.dismiss();
            tvBowler.setText(bowler);
            bowlerID = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", fieldingTeamNo).
                    equalTo("playerName", bowler).findFirst().getPlayerID();
            newBowler(bowlerID, preBowlerID);
            syncBowler();
            ballType = 6;
            Log.d("so_inninngs1Runs", "chyangeBowler16 , : " + so_inninngs1Runs);
            Log.e("Scoring", "changeBowler, bowlerBuilder, builderInner, ballType : " + ballType);
            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket,
                    ball, 0, preInningsRuns, remainingRuns, remainingBalls, remainingOver,
                    leadingRuns, innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                    fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID,
                    nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls,
                    bowlerWicket, /*nextBowlerID,*/ preBowlerID, preBowlerRun, preBowlerOver,
                    preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType, 0,
                    0, 0, 0, null, 0,
                    0, 0, 0, false, 0,
                    commentary, bowlerID, mo, maiden, modified, udisplay, tco, tbo, tpbo, 0,
                    sessionType, sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay,
                    SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, false, freeHit,
                    false, inning_started, 0, 0, 0,
                    null, pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id,
                    pre_wk_position, FORFEIT, forfeit_team, forfeit_innings, CONCEDE, conceded_team,
                    forceEndingType, lunch_flag, tea_flag, dinner_flag);
            commentary = "";
        }
    }


    // sync Batsman table with striker details

    void syncBatsmann(int batsmanID, int bowlerID, String fielderID, boolean out, int outType,
                      boolean retired, boolean undo, boolean wk_flag) {

//        displayProgress();
        Log.e("Scoring", "syncBatsmann, batsmanID : " + batsmanID + ", outType : " + outType + ", out : " + out);

        Log.e("syncBatsmann", " method, eventId : " + eventID);
        Log.e("syncBatsmann", " method, SUPER_OVER : " + SUPER_OVER);

//        Log.d("synchBatsmann", " striker :"+striker);
//        Log.d("synchBatsmann", " nonstriker :"+nonStriker);
//        Log.d("synchBatsmann", " player1 :"+player1);
//        Log.d("synchBatsmann", " player2 :"+player2);
//        Log.d("synchBatsmann", " bowler :"+bowler);
//        Log.d("synchBatsmann", " battingTeamNo :"+battingTeamNo);
//        Log.d("synchBatsmann", " matchid :"+matchid);
//        Log.d("synchBatsmann", " matchID :"+matchID);

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);


        Player player = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", battingTeamNo).
                equalTo("playerID", batsmanID).findFirst();

        Log.e("syncBatsmann", " method, player : " + player);


        realm.executeTransaction(new Realm.Transaction() {
            @Override
            public void execute(Realm realm) {

                Batsman batsmann = realm.where(Batsman.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("team", battingTeamNo).
                        equalTo("batsman_pID", batsmanID).findFirst();
                Log.d("Scoring", "newBatsman" + batsmann);

                if (batsmann == null) {

                    Number num = realm.where(Batsman.class).max("batsmanID");
                    int batId = (num == null) ? 1 : num.intValue() + 1;

//                    int batId = RandomNumber.generate("Batsman");
                    batsmann = realm.createObject(Batsman.class, batId);
                    batsmann.setBatsman_pID(batsmanID);
                    batsmann.setMatchid(matchid);
                    batsmann.setMatchID(matchID);
//                    batsmann.setBatsmanName(batsman);
                    batsmann.setTeam(player.getTeam());
                    batsmann.setInnings(currentInnings);
                    batsmann.setPlaying(true);
                    batsmann.setSUPER_OVER(SUPER_OVER);


//                    batsmann.setToBeBatted(false);

//                    if (RUN_ONCE) {
//
//                        batsmann.setPosition(0);
//                    }
//                    else {


//                    }
                    Log.d("Scoring", "synchBatsmann, null, bid :" + batsmanID);
                    Log.d("Scoring", "synchBatsmann, null, matchid :" + matchid);
                    Log.d("Scoring", "synchBatsmann, null, matchID :" + matchID);
//                    Log.d("Scoring","synchBatsmann, null, batsman :"+batsman);
                    Log.d("Scoring", "synchBatsmann, null, player.getTeam() :" + player.getTeam());
                    Log.d("Scoring", "synchBatsmann, null, currentInnings :" + currentInnings);
                }

                if (batsmanID == strID) {

//                    if (pos) {
//                        if (strikerBalls == 1) {
                           /* Number num1 = realm.where(Batsman.class).
                                    equalTo("innings", currentInnings).
                                    equalTo("team", battingTeamNo).
                                    max("battingOrder");
                            int order = (num1 == null) ? 1 : num1.intValue() + 1;
                            batsmann.setBattingOrder(order);*/
//                        }
//                    }

                    batsmann.setRuns(strikerRuns);
                    batsmann.setBalls(strikerBalls);
                    batsmann.setDots(strikerDots);
                    batsmann.setF4s(strikerF4s);
                    batsmann.setS6s(strikerS6s);
                    batsmann.setRetired(retired);
                    Log.d("Scoring", "synchBatsmann, not null, strikerRuns :" + strikerRuns);
                    Log.d("Scoring", "synchBatsmann, not null, strikerBalls :" + strikerBalls);
                    Log.d("Scoring", "synchBatsmann, not null, strikerDots :" + strikerDots);
                    Log.d("Scoring", "synchBatsmann, not null, strikerF4s :" + strikerF4s);
                    Log.d("Scoring", "synchBatsmann, not null, strikerS6s :" + strikerS6s);
                    if (strikerRuns > 0 || strikerBalls > 0) {
                        batsmann.setPlaying(true);
                        batsmann.setToBeBatted(false);
                    }

                } else if (batsmanID == nstrID) {

                    batsmann.setRuns(nonStrikerRuns);
                    batsmann.setBalls(nonStrikerBalls);
                    batsmann.setDots(nonStrikerDots);
                    batsmann.setF4s(nonStrikerF4s);
                    batsmann.setS6s(nonStrikerS6s);
                    Log.d("Scoring", "synchBatsmann, not null, nonStrikerRuns :" + nonStrikerRuns);
                    Log.d("Scoring", "synchBatsmann, not null, nonStrikerBalls :" + nonStrikerBalls);
                    Log.d("Scoring", "synchBatsmann, not null, nonStrikerDots :" + nonStrikerDots);
                    Log.d("Scoring", "synchBatsmann, not null, nonStrikerF4s :" + nonStrikerF4s);
                    Log.d("Scoring", "synchBatsmann, not null, nonStrikerS6s :" + nonStrikerS6s);
                }


                if (out) {
                    batsmann.setOut(true);
                    batsmann.setPlaying(false);
                    batsmann.setRetired(false);
                    batsmann.setOutType(outType);
                    batsmann.setBowler_pID(bowlerID);
                    batsmann.setFielder_pID(fielderID);
//                    batsmann.setRetired(retired);

                    //Added on 18/03/2021
                    if (wk_flag) {
                        batsmann.setWk_fielder(wk_flag);
                    }
                } else {
                    batsmann.setOut(false);
                    batsmann.setPlaying(true);
                }

                batsmann.setToBeBatted(false);

                if (retired) {
                    batsmann.setRetired(true);
                    batsmann.setPlaying(false);
                }


                if (undo) {
                    batsmann.setBattingOrder(100);
                }


                if (SUPER_OVER)
                    realm.copyToRealm(batsmann);

                else
                    realm.copyToRealmOrUpdate(batsmann);
            }
        });

//        progress.dismiss();

    }


    // synch Bowler table with bowler details

    void syncBowler() {
        int tempover = 0, tempballs = 0;

//        Log.d("synchBowler", " matchid :"+matchid);
//        Log.d("synchBowler", " matchID :"+matchID);
        Log.d("syncBowler", " bowler :" + bowler);
        Log.d("syncBowler", " currentInnings :" + currentInnings);
        Log.d("syncBowler", " bowlerBalls :" + bowlerBalls);
        Log.d("syncBowler", " ballsPerOver :" + ballsPerOver);
        Log.d("syncBowler", " bowlerOver :" + bowlerOver);


//        displayProgress();

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        realm.executeTransaction(new Realm.Transaction() {
            @Override
            public void execute(Realm realm) {

                try {

                    Bowler bowller = realm.where(Bowler.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", fieldingTeamNo).
                            equalTo("playerID", bowlerID).findFirst();
                    Log.d("synchBowler", "bowlerID : " + bowlerID);
                    Log.d("synchBowler", "bowler : " + bowller);


                    if (UNDO_LIMIT) {
                        Log.d("undo", "syncBowler");
                        //   added on 21/01/2021
                        bowlerOver = 0;
                        bowlerBalls = 0;
                        bowlerMO = 0;
                        bwRun = 0;
                        bowlerWicket = 0;
                        bowlerDots = 0;
                        bowlerF4s = 0;
                        bowlerS6s = 0;
                        bowlerWide = 0;
                        bowlerNoBall = 0;
                        // till here
                    } else {

                        if (bowlerBalls >= ballsPerOver) {
                            ++bowlerOver;
                            if (bowlerBalls == ballsPerOver)
                                bowlerBalls = 0;
                            else if (bowlerBalls == (ballsPerOver + 1))
                                bowlerBalls = 1;
                        }
                    }


                    if (bowller != null) {

                        bowller.setOver(bowlerOver);
                        bowller.setBalls(bowlerBalls);
                        bowller.setMaidenOver(bowlerMO);
                        bowller.setRuns(bwRun);
                        bowller.setWicket(bowlerWicket);
                        bowller.setDots(bowlerDots);
                        bowller.setF4s(bowlerF4s);
                        bowller.setS6s(bowlerS6s);
                        bowller.setWides(bowlerWide);
                        bowller.setNoBalls(bowlerNoBall);

                        Log.d("synchBowler", " bowlerOver :" + bowlerOver);
                        Log.d("synchBowler", " bowlerBalls :" + bowlerBalls);
                        Log.d("synchBowler", " bowlerMO :" + bowlerMO);
                        Log.d("synchBowler", " bwRun :" + bwRun);
                        Log.d("synchBowler", " bowlerWicket :" + bowlerWicket);
                        Log.d("synchBowler", " bowlerDots :" + bowlerDots);
                        Log.d("synchBowler", " bowlerF4s :" + bowlerF4s);
                        Log.d("synchBowler", " bowlerS6s :" + bowlerS6s);
                        Log.d("synchBowler", " bowlerWide :" + bowlerWide);
                        Log.d("synchBowler", " bowlerNoBall :" + bowlerNoBall);


                        realm.insertOrUpdate(bowller);
                    }
                } catch (RealmException e) {

                    Log.d("SynchBowler", "Exception  : " + e);
                }
            }

        });

//        progress.dismiss();

    }


    // create a new record in Bowler table for new Bowler

    void newBowler(int bowlerID, int preBowlerID) {

//        displayProgress();

//        Log.d("newBowler", "bowler"+bowler);
//        Log.d("newBowler", " matchid :"+matchid);
//        Log.d("newBowler", " matchID :"+matchID);
        Log.d("scoring", "newBowler, bowlerID :" + bowlerID);
        Log.d("scoring", "newBowler, bowler :" + bowler);
        Log.d("scoring", "newBowler, preBowlerID :" + preBowlerID);
        Log.d("scoring", "newBowler, preBowler :" + preBowler);
//        Log.d("scoring", "newBowler, nextBowlerID :"+nextBowlerID);
//        Log.d("scoring", "newBowler, nextBowler :"+nextBowler);

        bowler = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", fieldingTeamNo).
                equalTo("playerID", bowlerID).findFirst().getPlayerName();

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        realm.executeTransaction(new Realm.Transaction() {
            @Override
            public void execute(Realm realm) {

                try {

                    Bowler bowller = realm.where(Bowler.class).
                            equalTo("matchid", matchid).
                            equalTo("team", fieldingTeamNo).
                            equalTo("innings", currentInnings).
                            equalTo("playerID", bowlerID).findFirst();
//                    assert bowller != null;


                    if (bowller == null) {

                        Number num = realm.where(Bowler.class).max("bowlerID");
                        int bwId = (num == null) ? 1 : num.intValue() + 1;
//                        int bwId = RandomNumber.generate("Bowler");
                        bowller = realm.createObject(Bowler.class, bwId);
                        bowller.setPlayerID(bowlerID);
                        bowller.setMatchid(matchid);
                        bowller.setMatchID(matchID);
//                        bowller.setBowlerName(bowler);
                        bowller.setTeam(fieldingTeamNo);
                        bowller.setInnings(currentInnings);

                        bowller.setSUPER_OVER(SUPER_OVER);

//                        bowlerOver = 0;
//                        bowlerBalls = 0;
//                        bowlerMO = 0;
//                        bwRun = 0;
//                        bowlerWicket  = 0;
//                        bowlerF4s = 0;
//                        bowlerS6s = 0;
//                        bowlerWide = 0;
//                        bowlerNoBall = 0;
                    }

//                    else if (bowller != null) {

                    bowlerOver = bowller.getOver();
                    bowlerBalls = bowller.getBalls();
                    bowlerMO = bowller.getMaidenOver();
                    bwRun = bowller.getRuns();
                    bowlerWicket = bowller.getWicket();
                    bowlerDots = bowller.getDots();
                    bowlerF4s = bowller.getF4s();
                    bowlerS6s = bowller.getS6s();
                    bowlerWide = bowller.getWides();
                    bowlerNoBall = bowller.getNoBalls();
//                    }


                    if (preBowlerID != 0) {

                        Bowler prebowller = realm.where(Bowler.class).
                                equalTo("matchid", matchid).
                                equalTo("team", fieldingTeamNo).
                                equalTo("innings", currentInnings).
                                equalTo("playerID", preBowlerID).findFirst();

                        if (prebowller == null) {

                            Number num = realm.where(Bowler.class).max("bowlerID");
                            int bwId = (num == null) ? 1 : num.intValue() + 1;
//                        int bwId = RandomNumber.generate("Bowler");
                            prebowller = realm.createObject(Bowler.class, bwId);
                            prebowller.setPlayerID(preBowlerID);
                            prebowller.setMatchid(matchid);
                            prebowller.setMatchID(matchID);
//                        prebowller.setBowlerName(bowler);
                            prebowller.setTeam(fieldingTeamNo);
                            prebowller.setInnings(currentInnings);
                        }
//
                        preBowlerOver = prebowller.getOver();
                        preBowlerBalls = prebowller.getBalls();
                        preBowlerMO = prebowller.getMaidenOver();
                        preBowlerRun = prebowller.getRuns();
                        preBowlerWicket = prebowller.getWicket();
//                        bowlerF4s = prebowller.getF4s();
//                        bowlerS6s = prebowller.getS6s();
//                        bowlerWide = prebowller.getWides();
//                        bowlerNoBall = prebowller.getNoBalls();

                        realm.insertOrUpdate(prebowller);

                    }

//                        initializeBowler();
                    tvBowler.setText(bowler);
                    tvBowlerWicket.setText(String.valueOf(bowlerWicket));
                    tvBowlerOver.setText(String.valueOf(new
                            DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
                    tvBowlerRuns.setText(String.valueOf(bwRun));
                    tvBowlerMO.setText(String.valueOf(bowlerMO));

                    if (currentInnings != 99) {

                        if (preBowlerID != 0) {

                            setPreBowlerVisibility(true);

//                            tvBowler2.setText(preBowler);
//                            tvBowlerOver2.setText(String.valueOf(new
//                                    DecimalFormat("##.#").format(setOverDisplay(preBowlerOver, preBowlerBalls))));
//                            tvBowlerRuns2.setText(String.valueOf(preBowlerRun));
//                            tvBowlerWicket2.setText(String.valueOf(preBowlerWicket));
//                            tvBowlerMO2.setText(String.valueOf(preBowlerMO));
                        } else {

                            setPreBowlerVisibility(false);
                        }

                    }

                    realm.insertOrUpdate(bowller);

                } catch (RealmException e) {

                    Log.d("SynchBowler", "Exception  : " + e);
                }
            }

        });

//        progress.dismiss();

    }


    // select new player for next batsman

    void changeBatsman(int dismissedPlayerID, String replacedBatsman, boolean newPartnership, boolean bow) {

//        if (first_batsman)
//            score


//        Log.d("changeBatsman", " matchid :"+matchid);
//        Log.d("changeBatsman", " matchID :"+matchID);
        if (wicket >= 0 && wicket <= player_count - 2) {

            ArrayList<Integer> batsmanIDList = new ArrayList<Integer>();

            final ArrayAdapter<String> batsmanAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                    android.R.layout.select_dialog_singlechoice);
//        dismissedList = new ArrayAdapter<String>(ScoringActivity.this, android.R.layout.select_dialog_singlechoice);


            RealmResults<Player> p_results = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", battingTeamNo).
                    equalTo("retired_concussion", false).    // added on 27/02/2021
                    equalTo("substitute", false).findAll();

            p_results.load();
            for (Player player : p_results) {
//            batsmanAdapter.add(player.getPlayerName());
                batsmanIDList.add(player.getPlayerID());
            }

            Log.e("Scoring", "changeBatsman, 1st, batsmanIDList : " + batsmanIDList);
            Log.e("Scoring", "changeBatsman, dismissedPlayerID : " + dismissedPlayerID);

            RealmResults<Batsman> b_result = realm.where(Batsman.class).                // check for
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    equalTo("team", battingTeamNo).
//                    equalTo("retired_concussion", false).    // added on 27/02/2021
        equalTo("out", true).findAll();
            b_result.load();

            for (Batsman batsman : b_result) {

                Log.e("Scoring", "changeBatsman, batsman : " + batsman);

                for (int i = 0; i < batsmanIDList.size(); i++) {

                    if (batsmanIDList.get(i) == batsman.getBatsman_pID()) {

                        batsmanIDList.remove(i);


                    }
                }
//                if (batsmanIDList.contains(batsman.getBatsman_pID()))
//                    batsmanIDList.remove(batsman.getBatsman_pID());


            }

            Log.e("Scoring", "changeBatsman, 2nd," +
                    " removing out players from batsman list, batsmanIDList : " + batsmanIDList);
            Log.e("Scoring", "changeBatsman, b4 dismissedList : " + dismissedList);


            if (dismissedList != null) {
                for (int id : dismissedList) {
                    if (id != 0) {

                        for (int i = 0; i < batsmanIDList.size(); i++) {

                            if (batsmanIDList.get(i) == id) {

                                batsmanIDList.remove(i);
                            }
                        }

                    }
                }
            }

            Log.e("Scoring", "changeBatsman, after dismissedList : " + dismissedList);
            Log.e("Scoring", "changeBatsman, retiredList : " + retiredList);


            for (int b_ID : batsmanIDList) {

                for (Player player : p_results) {

                    if (b_ID == player.getPlayerID()) {

                        batsmanAdapter.add(player.getPlayerName());
                    }

                }

            }

            Log.e("Scoring", "changeBatsman, batsmanAdapter : " + batsmanAdapter);


            batsmanAdapter.remove(striker);
            batsmanAdapter.remove(nonStriker);

            Log.e("Scoring", "changeBatsman, batsmanBuilder");

            batsmanBuilder = new AlertDialog.Builder(ScoringActivity.this);
            batsmanBuilder.setIcon(R.drawable.ball);
            batsmanBuilder.setCancelable(false);
            batsmanBuilder.setTitle("Select Next Batsman");
//            batsmanBuilder.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
//                @Override
//                public void onClick(DialogInterface dialog, int which) {
//                    dialog.dismiss();
//                }
//            });

            //commented on 08/05/2020
            //if (dismissedPlayerID <= 0) {

            batsmanBuilder.setPositiveButton("CANCEL", new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    dialog.dismiss();

                    // updated on 08/05/2020
                    if (dismissedPlayerID <= 0)
                        confirmReplace(replacedBatsman, bow);
                    else
                        dismissedPlayerDetails(dismissedPlayerID);
                    //=========== updated till here

                }
            });
            //} // commnted on 08/05/2020


            // Added on 30/06/2021
            batsmanBuilder.setNeutralButton("UNDO", new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    dialog.dismiss();
                    undo();
                }
            });
            // == till here

            // added on 08/05/2020
            batsmanBuilder.setNegativeButton("INTERVAL",
                    new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {
//                    dismissedPlayrID = dismissedPlayerID;
                            dialog.dismiss();
                            pre_out = true;
                            setInterval(3);
                        }
                    }); //=========== added till here

            batsmanBuilder.setAdapter(batsmanAdapter, new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog1, int which) {

                    newBatsman = batsmanAdapter.getItem(which);
//                dialog1.dismiss();
                    AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                    builderInner.setIcon(R.drawable.ball);
                    builderInner.setCancelable(false);

                    builderInner.setMessage(newBatsman);
                    builderInner.setTitle("Selected new Batsman is");
//                    Log.e("Scoring", "changeBatsman, batsmanBuilder, builderInner");

                    builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {

                            dismissedPlayrID = 0; // added on 11/05/2020
                            dialog1.dismiss();
                            dialog.dismiss();

                            if (out) {

                                pre_out = false;

                                Log.e("Scoring", "changeBatsman, batsmanBuilder, builderInner, out : " + out);

                                checkRetired(newBatsman, out, dismissedPlayerID, bow);

                                if (dismissedPlayerID > 0) {

                                    if (!allOUT) {

                                        Log.e("outToScoring", "outToScoring, allOUT, newBatsman : "
                                                + newBatsman + ", bats : " + bats);

                                        setNewBatsman(dismissedPlayerID, newBatsman, bow);

                                        /*if (bow)
                                            selectBowlerAlertDialog();*/


                                    }

                                }

                                /*// commented on 12/05/2020
                                if (ball == ballsPerOver){
                                    callEndOfOverAlert();
                                }*/

                            } else {
                                Log.d("CHANGEBATSMAN", "replacedBatsman = " + replacedBatsman);
                                updateBatsman(newBatsman, replacedBatsman);
                            }
                            /*replaceBatsman(newBatsman);*/

//                            resetBatsmanTable();

                        }
                    });

                    builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {
                            dialog.dismiss();
                            Log.d("CHANGEBATSMAN", "changeBatsman, Selected Batsman is, Cancel");
                            changeBatsman(dismissedPlayerID, replacedBatsman, newPartnership, bow);//-1);
                        }
                    });
//
                    builderInner.show();
//                dialog.dismiss();
                }
            });


            batsmanBuilder.show();

        } else {

            outOfPlayerAlert = new AlertDialog.Builder(ScoringActivity.this).create();
            outOfPlayerAlert.setIcon(R.drawable.ball);
            outOfPlayerAlert.setCancelable(false);
            outOfPlayerAlert.setTitle("No more players left for change batsman");
            outOfPlayerAlert.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {
//                            dialog.dismiss();
                            bats = null;
                        }
                    });
            outOfPlayerAlert.show();

        }

        Log.e("Scoring", "wicket = " + wicket);
        Log.e("Scoring", "player_count = " + player_count);


    }


    void updateBatsman(String newBatsman, String replacedBatsman) {

        int replacedPlayerID = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", battingTeamNo).
                equalTo("playerName", replacedBatsman).findFirst().getPlayerID();

        int newplayerID = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", battingTeamNo).
                equalTo("playerName", newBatsman).findFirst().getPlayerID();


        //update in Batsman table
        realm.executeTransaction(new Realm.Transaction() {
            @Override
            public void execute(Realm realm) {

                Batsman batsmann1 = realm.where(Batsman.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("team", battingTeamNo).
                        equalTo("batsman_pID", replacedPlayerID).findFirst();

                Batsman batsmann2 = realm.where(Batsman.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("team", battingTeamNo).
                        equalTo("batsman_pID", newplayerID).findFirst();
                Log.d("Scoring", "synchBatsmann, batsmann :" + batsmann1);
                Log.d("Scoring", "synchBatsmann, batsmann1 :" + batsmann1);

                if (batsmann1 != null) {

                    batsmann1.setBatsman_pID(newplayerID);
                    batsmann1.setPlaying(true);
                    batsmann1.setToBeBatted(false);
                    realm.insertOrUpdate(batsmann1);
                }

                if (batsmann2 != null) {

                    batsmann2.setBatsman_pID(replacedPlayerID);
                    batsmann2.setPlaying(false);
                    batsmann2.setToBeBatted(true);
                    realm.insertOrUpdate(batsmann2);
                }
            }
        });


        if (replacedPlayerID == player1ID) {
            player1 = newBatsman;
            tvPlayer1.setText(player1);
            tvPlayer1Runs.setText(String.valueOf(player1Runs));
            tvPlayer1Balls.setText(String.valueOf(player1Balls));
            player1ID = newplayerID;
        } else if (replacedPlayerID == player2ID) {
            player2 = newBatsman;
            tvPlayer2.setText(player2);
            player2ID = newplayerID;
        }

        if (strID > 0 && replacedPlayerID == strID) {
            striker = newBatsman;
            strID = newplayerID;
        } else if (nstrID > 0 && replacedPlayerID == nstrID) {
            nonStriker = newBatsman;
            nstrID = newplayerID;
        }

        if (replacedPlayerID == ps1ID)
            ps1ID = newplayerID;
        else if (replacedPlayerID == ps2ID)
            ps2ID = newplayerID;


        Log.d("so_inninngs1Runs", "updateBatsman17 , : " + so_inninngs1Runs);
        ballType = 0;
        Log.e("Scoring", "replaceBatsman, ballType : " + ballType);
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo,
                player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID, nonStrikerRuns,
                nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket,/*nextBowlerID,*/
                preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                0, ballType, 0, 0, 0, replacedPlayerID, null,
                newplayerID, 0, 0, 0, false, 0,
                commentary, 0, mo, maiden, modified, udisplay, tco, tbo, tpbo, intervalID,
                sessionType, sessionID, false,/*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                so_inninngs1Runs, so_inninngs2Runs, false, freeHit, false,
                inning_started, 0, 0, 0, null,
                pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                tea_flag, dinner_flag);

        commentary = "";
    }


    void setNewBatsman(int dismissedPlayerID, String bats, boolean bow) {

        newFlag = false;

        int batsID = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", battingTeamNo).
                equalTo("playerName", bats).findFirst().getPlayerID();

//        newBatsID = batsID;


        Batsman batsmann = realm.where(Batsman.class).
                equalTo("matchid", matchid).
                equalTo("team", battingTeamNo).
                equalTo("innings", currentInnings).
                equalTo("batsman_pID", batsID).findFirst();


        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {

                    try {

                        Number num1 = bgRealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("team", battingTeamNo).
                                notEqualTo("battingOrder", 100).
                                max("battingOrder");
                        int order = (num1 == null) ? 1 : num1.intValue() + 1;

                        Log.d("order", "scoring, order : " + order);
                        Log.d("order", "scoring, num1 : " + num1);


                        if (SUPER_OVER) {

                            newFlag = true;

                            Batsman batsmann = bgRealm.where(Batsman.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", currentInnings).
                                    equalTo("team", battingTeamNo).
                                    equalTo("batsman_pID", batsID).findFirst();
                            Log.d("Scoring", "synchBatsmann, batsmann :" + batsmann);

                            if (batsmann == null) {

                                Number num = bgRealm.where(Batsman.class).max("batsmanID");
                                int batId = (num == null) ? 1 : num.intValue() + 1;

                                batsmann = bgRealm.createObject(Batsman.class, batId);
                                batsmann.setBatsman_pID(batsID);
                                batsmann.setMatchid(matchid);
                                batsmann.setMatchID(matchID);
                                batsmann.setTeam(battingTeamNo);
                                batsmann.setInnings(currentInnings);
                                batsmann.setPlaying(true);
                                batsmann.setSUPER_OVER(SUPER_OVER);
                                batsmann.setBattingOrder(order);
                                bgRealm.copyToRealmOrUpdate(batsmann);


                            }
                        } else {
                            /*Number num1 = bgRealm.where(Batsman.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", currentInnings).
                                    equalTo("team", battingTeamNo).
                                    notEqualTo("battingOrder", 100).
                                    max("battingOrder");
                            int order = (num1 == null) ? 1 : num1.intValue() + 1;*/

//                         ++battingOrder;

                            if (batsmann != null) {

                                if (retiredList.size() > 0) {
                                    if (!batsmann.isRetired())
                                        batsmann.setBattingOrder(order);
                                } else
                                    batsmann.setBattingOrder(order);

                                bgRealm.copyToRealm(batsmann);
                            }

                        }


                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("setNewBatsman", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }


        // sync Partnership table

        ballType = 7;

        psRuns = 0;
        psBalls = 0;
        psOver = 0;

        Log.d("setNewBatsman", "ps1ID : " + ps1ID + ", ps2ID : " + ps2ID + ", dismissedPlayerID : " + dismissedPlayerID);


        if (ps1ID == dismissedPlayerID) {
            ps1ID = batsID;
            p1CB = 0;
            p1CR = 0;
            p2CB = 0;
            p2CR = 0;
            /*if (newFlag) {        // don't need it, because anyway new partnerShip will create

            }*/
        } else if (ps2ID == dismissedPlayerID) {
            ps2ID = batsID;
            p1CB = 0;
            p1CR = 0;
            p2CB = 0;
            p2CR = 0;
        }


        if (player1ID == dismissedPlayerID) {

            player1ID = batsID;
            player1 = bats;
            if (newFlag) {      // selected player is new

                player1Balls = 0;
                player1Runs = 0;
                player1Dots = 0;
                player1F4s = 0;
                player1S6s = 0;

            } else {      // selected player was retired

                player1Balls = batsmann.getBalls();
                player1Runs = batsmann.getRuns();
                player1Dots = batsmann.getDots();
                player1F4s = batsmann.getF4s();
                player1S6s = batsmann.getS6s();
            }
            tvPlayer1.setText(bats);
            tvPlayer1Runs.setText(String.valueOf(player1Runs));
            tvPlayer1Balls.setText(String.valueOf(player1Balls));

        } else if (player2ID == dismissedPlayerID) {

            player2ID = batsID;
            player2 = bats;

            if (newFlag) {
                player2Balls = 0;
                player2Runs = 0;
                player2Dots = 0;
                player2F4s = 0;
                player2S6s = 0;
            } else {
                player2Balls = batsmann.getBalls();
                player2Runs = batsmann.getRuns();
                player2Dots = batsmann.getDots();
                player2F4s = batsmann.getF4s();
                player2S6s = batsmann.getS6s();
            }
            tvPlayer2.setText(bats);
            tvPlayer2Runs.setText(String.valueOf(player2Runs));
            tvPlayer2Balls.setText(String.valueOf(player2Balls));
        }

        if (strID == dismissedPlayerID) {

            strID = batsID;
            striker = bats;

            if (newFlag) {
                strikerRuns = 0;
                strikerBalls = 0;
                strikerDots = 0;
                strikerF4s = 0;
                strikerS6s = 0;
            } else {
                strikerRuns = batsmann.getRuns();
                strikerBalls = batsmann.getBalls();
                strikerDots = batsmann.getDots();
                strikerF4s = batsmann.getF4s();
                strikerS6s = batsmann.getS6s();
            }
        } else if (nstrID == dismissedPlayerID) {

            nstrID = batsID;
            nonStriker = bats;

            if (newFlag) {
                nonStrikerRuns = 0;
                nonStrikerBalls = 0;
                nonStrikerDots = 0;
                nonStrikerF4s = 0;
                nonStrikerS6s = 0;
            } else {
                nonStrikerRuns = batsmann.getRuns();
                nonStrikerBalls = batsmann.getBalls();
                nonStrikerDots = batsmann.getDots();
                nonStrikerF4s = batsmann.getF4s();
                nonStrikerS6s = batsmann.getS6s();
            }
        }


        // save the new Batsman event

        Log.d("so_inninngs1Runs", "setNewBatsman18 , : " + so_inninngs1Runs);
        Log.d("Partnership", "setNewBatsman 18 , : " + newPartnership);


       /* if (newPartnership) {
//            newPartnership = false;
            syncPartnership(wicket, false, -1, true);
        }
        else {*/
        syncPartnership(wicket + 1, false, 0, newPartnership, false);
        /*}*/


        Log.d("Partnership", "setNewBatsman 19 , : " + newPartnership);

        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo,
                player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID, nonStrikerRuns,
                nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket,/* nextBowlerID,*/
                preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                0, ballType, -1, 0, -1, dismissedPlayerID, null,
                batsID, penaltyType, penaltyRun, penaltyRunTeam, false, 0,
                commentary, 0, mo, maiden, modified, udisplay, tco, tbo, tpbo, 0,
                sessionType, sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay,
                SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, false, freeHit, newPartnership,
                inning_started, 0, 0, 0, null,
                pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                tea_flag, dinner_flag);


        Log.d("Partnership", "setNewBatsman 20 , : " + newPartnership);


        syncBatsmann(batsID, 0, null, false,
                -1, false, false, false);

        Log.d("Partnership", "setNewBatsman 1, wicket : " + wicket);
        Log.d("Partnership", "setNewBatsman 1, psRuns : " + psRuns);
        Log.d("Partnership", "setNewBatsman 1, psBalls : " + psBalls);
        Log.d("Partnership", "setNewBatsman 1, player1ID : " + player1ID);
        Log.d("Partnership", "setNewBatsman 1, ps1ID : " + ps1ID);
        Log.d("Partnership", "setNewBatsman 1, p1CR : " + p1CR);
        Log.d("Partnership", "setNewBatsman 1, p1CB : " + p1CB);
        Log.d("Partnership", "setNewBatsman 1, player2ID: " + player2ID);
        Log.d("Partnership", "setNewBatsman 1, ps2ID : " + ps2ID);
        Log.d("Partnership", "setNewBatsman 1, p2CR : " + p2CR);
        Log.d("Partnership", "setNewBatsman 1, p2CB : " + p2CB);
        Log.d("Partnership", "setNewBatsman 21 , : " + newPartnership);
        Log.d("Partnership", "setNewBatsman 21, bow : " + bow);
        Log.d("Partnership", "setNewBatsman 21, bowlerID : " + bowlerID);
        Log.d("Partnership", "setNewBatsman 21, preBowlerID : " + preBowlerID);
        Log.d("Partnership", "setNewBatsman 21, lastBowler : " + lastBowler);

        if (bow)
            selectBowlerAlertDialog();

    }


    void setOut(String nextStriker, int id, int type) {

//        setFOW(id, false);

//        int id = realm.where(Player.class).
//                equalTo("matchid", matchid).
//                equalTo("team", battingTeamNo).
//                equalTo("playerName", nextStriker).findFirst().getPlayerID();

        Log.e("Scoring", "setOut, nextStriker : " + nextStriker);

//        udisplay = modified;

//        outType = 12;
        Log.d("so_inninngs1Runs", "setOUT19 , : " + so_inninngs1Runs);
        Log.e("Scoring", "setOut, ballType : " + type);
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo,
                player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID, nonStrikerRuns,
                nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/
                preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                0, type, -1, 0, 12, id, null, 0,
                -1, 0, 0, false, 0, commentary,
                0, mo, maiden, modified, udisplay, tco, tbo, tpbo, 0, sessionType,
                sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                so_inninngs1Runs, so_inninngs2Runs, false, freeHit, false,
                inning_started, 0, 0, 0, null, pre_out,
                callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);

        ++wicket;

        syncBatsmann(id, 0, null, true, 12, false,
                false, false);
        setFOW(id, false);

//        changeBatsman();


    }


    void checkRetired(String nextStriker, boolean out, int dismissedPlayerID, boolean bow) {

        int i = 0;

        Log.e("Scoring", "checkRetired at beginning, retiredList : " + retiredList);
        Log.e("Scoring", "checkRetired at beginning, dismissedList : " + dismissedList);


        if (!nextStriker.matches("")) {

            if (retiredList.size() > 0) {

                int id = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", battingTeamNo).
                        equalTo("playerName", nextStriker).findFirst().getPlayerID();

                Batsman batsman = realm.where(Batsman.class).
                        equalTo("matchid", matchid).
                        equalTo("team", battingTeamNo).
                        equalTo("innings", currentInnings).
                        equalTo("batsman_pID", id).
                        equalTo("outType", 10).findFirst();

                Log.e("Scoring", "checkRetired at beginning, flag : " + flag);

                if (batsman != null) {

                    if (batsman.isRetired()) {

//                    continueBatting = callAlert(nextStriker, id);

//                    callAlert(nextStriker, id);
                        callretiredAlert(nextStriker, id, dismissedPlayerID, bow/*, batsman*/);

                    } else {
//                    continueBatting = true;
                        bats = nextStriker;
//                    tv_nextStriker.setText(nextStriker);

                    }
                }
            } else {
//                continueBatting = true;
                bats = nextStriker;
//                tv_nextStriker.setText(nextStriker);
            }

        } else
            Log.e("Scoring", "checkRetired, selected next striker is : " + nextStriker);

        Log.e("Scoring", "checkRetired at last,, playerSelected : " + playerSelected);
        Log.e("Scoring", "checkRetired at last, retiredList : " + retiredList);
        Log.e("Scoring", "checkRetired at last, dismissedList : " + dismissedList);

        Log.e("Scoring", "checkRetired at last, flag : " + flag);
        Log.e("Scoring", "checkRetired at last, continueBatting : " + continueBatting);

//        return continueBatting;
    }


    void callretiredAlert(String nextStriker, int id, int dismissedPlayerID, boolean bow/*, Batsman batsman*/) {

        retiredAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        retiredAlert.setIcon(R.drawable.ball);
        retiredAlert.setCancelable(false);
        retiredAlert.setTitle("Retired Hurt player");
        retiredAlert.setButton(AlertDialog.BUTTON_POSITIVE, "Continue Batting",
                new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        bats = nextStriker;
//                       tv_nextStriker.setText(nextStriker);
                    }
                });

        retiredAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "Retired Out",
                new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        Log.e("Scoring",
                                "callAlert , Retired Out, playerSelected : " + playerSelected);
                        Toast.makeText(getApplicationContext(),
                                " Retires Out , playerSelected : " + playerSelected,
                                Toast.LENGTH_SHORT).show();

                        confirmAlert = new AlertDialog.Builder(ScoringActivity.this).create();
                        confirmAlert.setIcon(R.drawable.ball);
                        confirmAlert.setCancelable(false);
                        confirmAlert.setTitle(nextStriker + " is selected as OUT");
                        confirmAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                                new DialogInterface.OnClickListener() {
                                    public void onClick(DialogInterface dialog, int which) {
                                        setOut(nextStriker, id, 3);
                                    }
                                });

                        confirmAlert.setButton(AlertDialog.BUTTON_NEUTRAL, "Cancel",
                                new DialogInterface.OnClickListener() {
                                    @Override
                                    public void onClick(DialogInterface dialog, int which) {

//                                        bats = nextStriker;
                                        callretiredAlert(nextStriker, id, dismissedPlayerID, bow/*, batsman*/);
//                                                    tv_nextStriker.setText(nextStriker);
                                    }
                                });

                        confirmAlert.show();


                    }
                });

        Log.e("Scoring", "callAlert at last, retiredAlert : " + retiredAlert);

        retiredAlert.setButton(AlertDialog.BUTTON_NEUTRAL, "Cancel",
                new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                                    /*bats = nextStriker;
//                                    tv_nextStriker.setText(nextStriker);*/
                        dialog.dismiss();
                        bats = "";
                        Log.d("CHANGEBATSMAN", "callretiredAlert, Cancel");

                        changeBatsman(dismissedPlayerID, null, false, bow);

                    }
                });

        retiredAlert.show();
    }


    // replace the existing batsman with newly selected player
    void replaceBatsman(boolean bow) {

        Log.e("Scoring", "replaceBatsman()");

//        final ArrayAdapter<String> batsmanAdapter = new ArrayAdapter<String>(ScoringActivity.this,
//                android.R.layout.select_dialog_singlechoice);
//        batsmanAdapter.add(player1);
//        batsmanAdapter.add(player2);

        String[] batsmans = {player1, player2};
        Log.e("Scoring", "replaceBatsman, batsmans : " + batsmans);

        replaceBatsmanBuilder = new AlertDialog.Builder(ScoringActivity.this);
        replaceBatsmanBuilder.setIcon(R.drawable.ball);
        replaceBatsmanBuilder.setCancelable(false);
        replaceBatsmanBuilder.setTitle("Select Batsman to Replace ");
        replaceBatsmanBuilder.setSingleChoiceItems(batsmans, checkedItem,
                new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        final String s = Arrays.asList(batsmans).get(which);
                        replacedPlayer = s;
                    }
                });

        replaceBatsmanBuilder.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                dialog.dismiss();

                Log.e("Scoring", "replaceBatsman, replacedPlayer : " + replacedPlayer);

                Log.e("Scoring", "replaceBatsman, ok, replacedPlayer : " + replacedPlayer);

//                replacedPlayer = batsmanAdapter.getItem(which);

                confirmReplace(replacedPlayer, bow);


//                Toast.makeText(getApplicationContext(),"selected Player : "+dismissedPlayer, Toast.LENGTH_SHORT).show();
            }

        });
        replaceBatsmanBuilder.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {

            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
//                changeBatsman(-1);
            }
        });

        replaceBatsmanBuilder.show();
//        AlertDialog alert = replaceBatsmanBuilder.create();
//        alert.show();


    }


    void confirmReplace(String replacedPlayer, boolean bow) {

        AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
        builderInner.setIcon(R.drawable.ball);
        builderInner.setCancelable(false);
        builderInner.setTitle(replacedPlayer + " will be replaced");
//                    Log.e("Scoring", "changeBatsman, batsmanBuilder, builderInner");

        builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                dialog.dismiss();
//                selectNewBatsman(replacedPlayer);
                Log.d("CHANGEBATSMAN", "confirmReplace, Ok");

                changeBatsman(-1, replacedPlayer, false, bow);
            }

        });

        builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                replaceBatsman(bow);
            }
        });
//
        builderInner.show();
    }


    void selectNewBatsman(String replacedPlayer) {


    }



/*
    void resetTable(int replacedId, int newId){



        Realm realm = null;
        try {
//            Toast.makeText(getApplicationContext(), "Inside savePlayerDetails", Toast.LENGTH_SHORT).show();
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {

                    try {

                        Batsman batsmanr = bgRealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("batsman_pID", replacedId).findFirst();

                        Batsman batsmann = bgRealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).
                                equalTo("batsman_pID", newId).findFirst();

                        Batsman temp = batsmanr;
                        if (batsmanr != null && temp != null){


                            int positionr = batsmanr.getBattingOrder();
                           */
/* batsmanr.setBatsman_pID(batsmann.getBatsman_pID());
                            batsmanr.setBatsmanID(batsmann.getBatsmanID());
                            batsmanr.setSyncstatus(batsmann.getSyncstatus());
                            batsmanr.setBatsmanID(batsmann.getBatsmanID());*//*

                            batsmanr.setBattingOrder(0);
                            bgRealm.copyToRealm(batsmanr);


                            */
/*batsmann.setBatsman_pID(temp.getBatsman_pID());
                            batsmann.setBatsmanID(temp.getBatsmanID());
                            batsmann.setSyncstatus(temp.getSyncstatus());*//*

                            batsmann.setBattingOrder(positionr);
                            bgRealm.copyToRealm(batsmann);

                        }
                    }
                    catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        }
        catch (RealmException e){
            Toast.makeText(getApplicationContext(), "Exception : "+ e, Toast.LENGTH_SHORT).show();
        }
        finally {

            if (realm != null) {
                realm.close();
            }
        }



    }
*/


//                j++;
//                dismissedList.add(dismissedPlayer);
//                Log.d("Test" , "dismissedList ; "+dismissedList[j]);

//                nextStriker();


    // to save each event

    public void newEvent(int matchid, String matchID,
                         int innings, int totalRuns, float over, int balls, int wicket, int currentOverBalls, int temp_balls,
                         int preInningsRuns, int remainingRuns, int remainingBalls, float remainingOver, int leadingRuns,
                         int innings1Runs, int innings2Runs, int innings3Runs, int innings4Runs,
                         int battingTeamNo, int fieldingTeamNo,
                         int player1ID, int player2ID,
                         int strikerID, int strikerRuns, int strikerBalls,
                         int nonStrikerID, int nonStrikerRuns, int nonStrikerBalls,
                         int bowllerID, int bowlerRuns, int bowlerOver, int bowlerBalls, int bowlerWicket,
                         //int nextBowlerID,
                         int preBowlerID, int preBowlerRuns, int preBowlerOver, int preBowlerBalls, int preBowlerWicket, int lastPreBowlerID,
                         int run, int balType, int extraType, int extraRun,
                         int outType, int dismissedPlayerID, String fielderID, int newBatsmanID,
                         int penaltyType, int penaltyRun, int penaltyTeam, boolean ballCount, int penaltyBallCounted,
                         String com, int newBowlerID, int mo, boolean maidenOver, String currentOver, String undoDisplay,
                         float tco, float tbo, float tpbo,
                         int intervalId, String sessionType, int sessionId,
                         boolean sww, /* if !sww the post json to server*//*JSONArray postArray, JSONArray undoArray,*/
                         boolean endOfDay, boolean super_over, int so_innings1Runs, int so_innings2Runs,
                         boolean declared, boolean freeHit, boolean newPartnerships, boolean innings_start,
                         int substitutionID, float reducedOver, int revisedTarget, String appliedRainRule,
                         boolean pre_out, boolean callBowlerAlert,
                         int wicketkeeperID, int wicketkeeperPosition, int preWicketkeeperID, int preWicketkeeperPosition,
                         boolean forfeit, int forfeit_team, int forfeit_innings,
                         boolean concede, int conceded_team, int forceEndingType,
                         int lunch_flag, int tea_flag, int dinner_flag) {


//        AlertDialog.Builder dlgAlert = new AlertDialog.Builder(ScoringActivity.this);
//
//        Log.e("scoring", "newEvent, before, eventId : "+eventID);
//        Log.e("scoring", "newEvent, before, bowlerID : "+bowllerID);
//        Log.e("scoring", "newEvent, before, preBowlerID : "+preBowlerID);
////        Log.e("scoring", "newEvent, before, nextBowlerID : "+nextBowlerID);
//        Log.e("scoring", "newEvent, before, retiredList : "+retiredList);
//        Log.e("scoring", "newEvent, before, dismissedList : "+dismissedList);
//
//        Log.e("scoring", "newEvent, before, leadingRuns : "+leadingRuns);
        Log.e("scoring", "newEvent, before, noBall : " + noBall);
        Log.e("scoring", "newEvent, before, runsOffBatNB : " + runsOffBatNB);
        Log.e("scoring", "newEvent, before, runsOffBat : " + runsOffBat);

        Log.d("checkFreeHit", "newEvent 1, : " + checkFreeHit);
        Log.d("freeHit", "newEvent 1, : " + freeHit);


//        strID = 0;
//        nstrID = 0;
//        bwlrID = 0;
//        disID = 0;
//        nbtsmnID= 0;
//        fID = 0;
//        eventId++;

//        displayProgress();

        if (substitutionID == 0) {
            just_started = false;
            if (status.matches("start")) {
                status = "resume";
                updateMatch(matchid, false);
            }
        }

        Realm realm = null;
        try {
//            Toast.makeText(getApplicationContext(), "Inside savePlayerDetails", Toast.LENGTH_SHORT).show();
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {


                    try {

                        Number num = bgRealm.where(Events.class).max("eventID");
                        eventID = (num == null) ? 1 : num.intValue() + 1;

                        Events events = bgRealm.createObject(Events.class, eventID);
                        Log.d("eventId", " newEvent, eventId : " + eventID);
                        Log.d("newEvent", " after, eventId : " + eventID);
//                        Events events = new Events();
//                        Log.d("Test", "event : "+events);
//                        events.setEventId(eventId);
//                        Log.d("Test", "event id : "+eventId);
                        events.setMatchid(matchid);
                        events.setMatchID(matchID);
                        events.setInnings(innings);           // current innings
                        events.setTotalRuns(totalRuns);         // current total runs
                        events.setOvers(Float.parseFloat(
                                new DecimalFormat("###.#").format(over))); // current playing run
                        events.setBalls(balls);                  // current total balls played
                        events.setWicket(wicket);               // current wicketas playing

                        events.setTemp_balls(temp_balls);
                        events.setCurrentOverBalls(currentOverBalls);
                        events.setPreInningsRuns(preInningsRuns);
                        events.setLeadingRuns(leadingRuns);
                        events.setRemainingRuns(remainingRuns);
                        events.setRemainingBalls(remainingBalls);
                        events.setRemainingOvers(remainingOver);
                        events.setBattingTeamNo(battingTeamNo);
                        events.setFieldingTeamNo(fieldingTeamNo);

                        events.setInnings1Runs(innings1Runs);
                        events.setInnings2Runs(innings2Runs);
                        events.setInnings3Runs(innings3Runs);
                        events.setInnings4Runs(innings4Runs);

                        events.setPlayer1ID(player1ID);
                        events.setPlayer2ID(player2ID);

                        //commented on 14/05/2020
                        /*events.setStrikerID(strikerID);
                        events.setStrikerRuns(strikerRuns);
                        events.setStrikerBalls(strikerBalls);*/

                        /*events.setNonStrikerID(nonStrikerID);
                        events.setNonStrikerRuns(nonStrikerRuns);
                        events.setNonStrikerBalls(nonStrikerBalls);*/

                        /*events.setBowlerID(bowllerID);
                        events.setBowlerRuns(bowlerRuns);
                        events.setBowlerOver(bowlerOver);
                        events.setBowlerBalls(bowlerBalls);
                        events.setBowlerWicket(bowlerWicket);*/

//                        if (nextBowlerID != 0)
//                            events.setNextBowlerID(nextBowlerID);

                        /*if (preBowlerID != 0) {

                            events.setPrevBowlerID(preBowlerID);
                            events.setPreBowlerRuns(preBowlerRuns);
                            events.setPreBowlerBalls(preBowlerBalls);
                            events.setPreBowlerOver(preBowlerOver);
                            events.setPreBowlerWicket(preBowlerWicket);
                        }*/                                                     // till here


                        if (lastPreBowlerID != 0)
                            events.setLastPreBowlerID(lastPreBowlerID);

                        events.setCurrentRun(run);
                        events.setBallType(balType);

                        events.setExtraType(extraType);
                        events.setExtraRuns(extraRun);

                        events.setOutType(outType);
                        events.setDismissedPlayerID(dismissedPlayerID);
                        events.setFielderID(fielderID);
                        events.setDisNewBatsmanID(newBatsmanID);

                        events.setPenaltyType(penaltyType);
                        events.setPenaltyRuns(penaltyRun);
                        events.setPenaltyRunTeam(penaltyTeam);
                        events.setPenaltyBallCount(ballCount);
                        events.setPenaltyBallCounted(penaltyBallCounted);
                        events.setCommentary(com);

                        events.setNewBowlerID(newBowlerID);
                        events.setMo(mo);
                        events.setMaidenOver(maidenOver);
                        events.setCurrentOver(currentOver);
                        events.setUndoDisplay(undoDisplay);

                        events.setTco(tco);
//                        events.setTbo(tbo);
//                        events.setTpbo(tpbo);

                        events.setIntervalId(intervalId);
                        events.setSession(sessionType);
                        events.setSessionId(sessionId);

//                        events.setPostArray(String.valueOf(postArray));
//                        events.setUndoArray(String.valueOf(undoArray));

                        events.setEndOfDay(endOfDay);

                        events.setSUPER_OVER(super_over);
                        if (super_over) {
                            events.setSuper_over_innings1runs(so_innings1Runs);
                            events.setSuper_over_innings2runs(so_innings2Runs);
                        }

                        if (totalInnings == 4)
                            events.setDeclared(declared);

                        events.setFreeHit(freeHit);
                        events.setNewPartnership(newPartnerships);
                        events.setInning_started(innings_start);

                        events.setSubstitutionID(substitutionID);
                        events.setReducedOver(reducedOver);
                        events.setRevisedTarget(revisedTarget);
                        events.setAppliedRainRule(appliedRainRule);

                        events.setPre_out(pre_out);
                        events.setCallBowlerAlert(callBowlerAlert);

                        // ================== added on 14/05/2020 =====================

                        // striker details
                        events.setStrikerID(strikerID);
                        Batsman bat = bgRealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", innings).
                                equalTo("team", battingTeamNo).
                                equalTo("batsman_pID", strikerID).findFirst();
                        if (bat != null) {

                            events.setStrikerRuns(bat.getRuns());
                            events.setStrikerBalls(bat.getBalls());
                            events.setStrikerBattingOrder(bat.getBattingOrder());
                            events.setStrikerDots(bat.getDots());
                            events.setStrikerF4s(bat.getF4s());
                            events.setStrikerS6s(bat.getS6s());
                        }

                        //nonstriker details
                        events.setNonStrikerID(nonStrikerID);
                        bat = bgRealm.where(Batsman.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", innings).
                                equalTo("team", battingTeamNo).
                                equalTo("batsman_pID", nonStrikerID).findFirst();
                        if (bat != null) {

                            events.setNonStrikerRuns(bat.getRuns());
                            events.setNonStrikerBalls(bat.getBalls());
                            events.setNonStrikerBattingOrder(bat.getBattingOrder());
                            events.setNonStrikerDots(bat.getDots());
                            events.setNonStrikerF4s(bat.getF4s());
                            events.setNonStrikerS6s(bat.getS6s());
                        }

                        // bowler details
                        events.setBowlerID(bowllerID);
                        Bowler bows = bgRealm.where(Bowler.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", innings).
                                equalTo("team", fieldingTeamNo).
                                equalTo("playerID", bowllerID).findFirst();
                        if (bows != null) {

                            events.setBowlerRuns(bows.getRuns());
                            events.setBowlerOver(bows.getOver());
                            events.setBowlerBalls(bows.getBalls());
                            events.setBowlerWicket(bows.getWicket());
                            events.setBowlerDots(bows.getDots());
                            events.setBowlerMO(bows.getMaidenOver());
                            events.setBowlerWides(bows.getWides());
                            events.setBowlerNoball(bows.getNoBalls());
                        }

                        // pre bowler details
                        if (preBowlerID != 0) {
                            events.setPrevBowlerID(preBowlerID);
                            bows = bgRealm.where(Bowler.class).
                                    equalTo("matchid", matchid).
                                    equalTo("innings", innings).
                                    equalTo("team", fieldingTeamNo).
                                    equalTo("playerID", preBowlerID).findFirst();
                            if (bows != null) {

                                events.setPreBowlerRuns(bows.getRuns());
                                events.setPreBowlerBalls(bows.getBalls());
                                events.setPreBowlerOver(bows.getOver());
                                events.setPreBowlerWicket(bows.getWicket());
                                events.setPreBowlerDots(bows.getDots());
                                events.setPreBowlerMO(bows.getMaidenOver());
                                events.setPreBowlerWides(bows.getWides());
                                events.setPreBowlerNoball(bows.getNoBalls());
                            }
                        }


                        // set extras details
                        ExtraCard extraCard = bgRealm.where(ExtraCard.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", innings).findFirst();
                        if (extraCard != null) {

                            events.setExtraBye(extraCard.getByes());
                            events.setExtraLb(extraCard.getLb());
                            events.setExtraWd(extraCard.getWide());
                            events.setExtraNb(extraCard.getNoBall());
                            events.setExtraP(extraCard.getPenalty());
                        }


                        //partnership details
                        int wk = 0;
                        if (balType == 3 && outType != 10)
                            wk = wicket;
                        else
                            wk = wicket + 1;

                        RealmResults<Partnership> results = bgRealm.where(Partnership.class).
                                equalTo("matchid", events.getMatchid()).//matchid).
                                equalTo("innings", events.getInnings()).//currentInnings).
                                /*equalTo("wicket", wk).*/findAll();

                        if (results.isEmpty()) {
                            /*events.setP_wicket_no(wicket + 1);
                            if (strikerID > 0)
                                events.setP_p1Id(strikerID);
                            else if (nonStrikerID > 0)
                                events.setP_p1Id(nonStrikerID);
                            events.setP_p2Id(1);*/

                            events.setP_wicket_no(wk);
                            events.setP_sequence_no(1);
                            events.setP_disId(0);
                            events.setP_broken(true);

                            /*jsonFOW.put("wicketno", wk);
                            jsonFOW.put("partnershipsequence", 1);
                            jsonFOW.put("partnershipruns", 0);
                            jsonFOW.put("partnershipballs", 0);
                            jsonFOW.put("partnershipover", Float.parseFloat(
                                    new DecimalFormat("###.#").format(0)));
                            jsonFOW.put("player1id", 0);
                            jsonFOW.put("player2id", 0);
                            jsonFOW.put("dismissedplayerid", -1);
                            jsonFOW.put("player1contributedruns", 0);
                            jsonFOW.put("player1contributedballs", 0);
                            jsonFOW.put("player2contributedruns", 0);
                            jsonFOW.put("player2contributedballs", 0);
                            jsonFOW.put("partnershipbroken", "yes");*/
                        } else {
                            Partnership partnership = results.last();
                            if (partnership != null &&
                                    ((partnership.getPlayer1ID() > 0) && (partnership.getPlayer2ID() > 0))) {
                                events.setP_wicket_no(partnership.getWicket());
                                events.setP_sequence_no(partnership.getPartnershipSequence());
                                events.setP_run(partnership.getPartnershipRuns());
                                events.setP_ball(partnership.getPartnershipBalls());
                                events.setP_over(partnership.getPartnershipOver());
                                events.setP_p1Id(partnership.getPlayer1ID());
                                events.setP_p2Id(partnership.getPlayer2ID());
                                events.setP_disId(partnership.getDismissedPlayerID());
                                events.setP_p1cr(partnership.getPlayer1ContributionRuns());
                                events.setP_p1cb(partnership.getPlayer1ContributionBalls());
                                events.setP_p2cr(partnership.getPlayer2ContributionRuns());
                                events.setP_p2cb(partnership.getPlayer2ContributionBalls());

                                if (balType != 3) {
                                    events.setP_broken(false);
                                } else {
                                    if (outType == 10)
                                        events.setP_broken(false);
                                    else //if (outType != 10)
                                        events.setP_broken(true);
                                }
                            } else {

                                Partnership partnership1 = bgRealm.where(Partnership.class).
                                        equalTo("matchid", events.getMatchid()).//matchid).
                                        equalTo("innings", events.getInnings()).//currentInnings).
                                        equalTo("wicket", wicket).findAll().last();

                                events.setP_wicket_no(partnership1.getWicket());
                                events.setP_sequence_no(partnership1.getPartnershipSequence());
                                events.setP_run(partnership1.getPartnershipRuns());
                                events.setP_ball(partnership1.getPartnershipBalls());
                                events.setP_over(partnership1.getPartnershipOver());
                                events.setP_p1Id(partnership1.getPlayer1ID());
                                events.setP_p2Id(partnership1.getPlayer2ID());
                                events.setP_disId(partnership1.getDismissedPlayerID());
                                events.setP_p1cr(partnership1.getPlayer1ContributionRuns());
                                events.setP_p1cb(partnership1.getPlayer1ContributionBalls());
                                events.setP_p2cr(partnership1.getPlayer2ContributionRuns());
                                events.setP_p2cb(partnership1.getPlayer2ContributionBalls());

                                if (balType != 3) {
                                    events.setP_broken(false);
                                } else {
                                    if (outType == 10)
                                        events.setP_broken(false);
                                    else //if (outType != 10)
                                        events.setP_broken(true);
                                }
                            }
                        }

                        // ADDED ON 27/02/2021 -------------(1)

                        events.setWkID(wicketkeeperID);
                        events.setWk_position(wicketkeeperPosition);
                        events.setPreWkID(preWicketkeeperID);
                        events.setPreWk_position(preWicketkeeperPosition);

                        // ========== till here ------------(1)

                        // Added on 02/03/2021 ------------------(2)

                        events.setForfeit(forfeit);
                        events.setForfeit_team(forfeit_team);
                        events.setForfeit_innings(forfeit_innings);
                        events.setCONCEDE(concede);
                        events.setConceded_team(conceded_team);
                        events.setForceEndingType(forceEndingType);
//                        events.setConceded_innings(conceded_innings);

                        // Added on 28/04/2021 (3)
                        events.setLunch_flag(lunch_flag);
                        events.setTea_flag(tea_flag);
                        events.setDinner_flag(dinner_flag);
                        // === till here (3)

                        // ========== till here ------------(2)

                        // ======================== till here =========================

                        bgRealm.copyToRealm(events);

//                        if (!sww)
//                            jsonEventArray.put(setEventJSON(events));

                        Log.d("Scoring", "newEvents, events : " + events);

//                        postJSON();

                        if (inning_started)
                            inning_started = false;

                        if (ballType == 7 && newPartnership)
                            newPartnership = false;

                        Log.d("internet", "newEvents 1, isNetworkAvailable() : " + isNetworkAvailable());

                        if (isNetworkAvailable()) {// && balType != 15) {

                            Log.d("jsonEventArray", "newEvents 1, : " + jsonEventArray);
                            Log.d("wheel", "newEvents 1, : " + wheel);

                            if (wheel)
                                Log.d("newEvent", "wheel : " + wheel);
                            else if (substitution)
                                Log.d("newEvent", "substitution : " + substitution);
                            else if (power)
                                Log.d("newEvent", "power : " + power);
                            else {
                                //if (!wheel && !substitution && !power) { // commented on 12/05/2020
//                               jsonEventArray.put(setEventJSON(events));

                                // commented on 08/07/2020      ------  (E)
                               /*resetJSONEventArray();
                               // added on 07/07/2020
                               if (jsonUndoArray.length() > 0)
                                   postUndoJSON();
                               else
                                   postJSON(matchid, matchID,false);

                                    // till here                ------ (E)  */
                                // added on 08/07/2020

                                post(5);
                            }

                            Log.d("jsonEventArray", "newEvents 2, : " + jsonEventArray);


//                            if (!checkSyncStatus()){  // &&
//
////                                matchJSONPost();
//
////                                    String requestBody = setJSON(events);
////                                    postJSON(requestBody);
//                            } else {
//
//                                if (jsonArray == null) {
//                                    setJSON(events);
//                                }
//
//                                else //if (jsonArray != null)
//                                    setJSON(jsonArray, events);
//                            }
                        }

                       /*
                        // commented on 27/04/20
                        else{
                           if (!wheel)
                               resetJSONEventArray();
//                            jsonEventArray.put(setEventJSON(events));
//                            addToArrayList(events);
                        }*/
//                        toJSON(if (!checkSyncStatus()){  // &&

//                                matchJSONPost();

//                                    String requestBody = setJSON(events);
////                                    postJSON(requestBody);
//                            } else {
//
//                                if (jsonArray == null) {
//                                    setJSON(events);
//                                }
//
//                                else //if (jsonArray != null)
//                                    setJSON(jsonArray, events);
//                            }events);
                        Log.d("scoring", "newEvent : " + events);
//                        Log.d("Test" , "\n\nEvent Added");
//                        saveToSP();
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Toast.makeText(getApplicationContext(), "Exception : " + e, Toast.LENGTH_SHORT).show();
        } finally {

            if (realm != null) {
                realm.close();
            }
        }

        serverSync();

//        progress.dismiss();


//        ballType = -1;


    }





/*    // to store the match details in the server

    private void  matchJSONPost(){

        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
        int mstatus = match.getMatchSync();
        JSONObject jsonMatch = new JSONObject();
        if (mstatus == 0){


            try {
                jsonMatch.put("matchID", matchID);
                jsonMatch.put("teamA", match.getTeamA());
                jsonMatch.put("teamB", match.getTeamB());
                jsonMatch.put("venue", match.getVenue());
                jsonMatch.put("end1", match.getEnd1());
                jsonMatch.put("end2", match.getEnd2());
                jsonMatch.put("event", match.getEvent());
                jsonMatch.put("phase", match.getPhase());
                jsonMatch.put("match_type", match.getMatchType());
                jsonMatch.put("innings", match.getInnings());
                jsonMatch.put("players", match.getPlayer());
                jsonMatch.put("substitute_players", match.getSubst());
                jsonMatch.put("over", match.getOver());
                jsonMatch.put("balls_per_over", match.getBalls());
                jsonMatch.put("wide_value", match.getWiderun());
                jsonMatch.put("noball_value", match.getNoballrun());
                jsonMatch.put("penalty_value", match.getPenaltyrun());
                jsonMatch.put("umpire1", match.getUmpire1());
                jsonMatch.put("umprire2", match.getUmpire2());
                jsonMatch.put("umpire3", match.getUmpire3());
                jsonMatch.put("umpire4", match.getUmpire4());
                jsonMatch.put("scorer", match.getScorer());
                jsonMatch.put("match_referee", match.getMatchReferee());
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }

        else
            Log.d("Scoring", "runOnce, status : "+status);


        JSONArray jsonArray = new JSONArray();
        jsonArray.put(jsonMatch);



        JSONObject jsonPlayerA = new JSONObject();
        String captain = null, wk = null;

        RealmResults<Player> results = realm.where(Player.class).equalTo("matchid", matchid).
                equalTo("team", 1).findAll();

        for (Player player : results) {
            if (player.isCaptain())
                captain = player.getPlayerName();
            if (player.isWicketKeeper())
                wk = player.getPlayerName();
            jsonPlayerA = new JSONObject();
            try {
                jsonPlayerA.put("name", player.getPlayerName());
            }
            catch (JSONException e) {
                e.printStackTrace();
            }
        }

        JSONArray jsonArrayA = new JSONArray();
        jsonArrayA.put(jsonPlayerA);


        JSONObject jsonA= new JSONObject();
        try {

            jsonA.put("team", match.getTeamA());
            jsonA.put("Players", jsonArrayA);
            jsonA.put("captain", captain);
            jsonA.put("wicketkeeper", wk);
        }
        catch (JSONException e) {
            e.printStackTrace();
        }



        JSONObject jsonPlayerB = new JSONObject();

        results = realm.where(Player.class).equalTo("matchid", matchid).
                equalTo("team", 2).findAll();

        for (Player player : results) {
            if (player.isCaptain())
                captain = player.getPlayerName();
            if (player.isWicketKeeper())
                wk = player.getPlayerName();
            jsonPlayerB = new JSONObject();
            try {
                jsonPlayerB.put("name", player.getPlayerName());
            }
            catch (JSONException e) {
                e.printStackTrace();
            }
        }

        JSONArray jsonArrayB = new JSONArray();
        jsonArrayB.put(jsonPlayerB);


        JSONObject jsonB = new JSONObject();
        try {

            jsonB.put("team", teamB);
            jsonB.put("Players", jsonArrayB);
            jsonB.put("captain", captain);
            jsonB.put("wicketkeeper", wk);
        }
        catch (JSONException e) {
            e.printStackTrace();
        }

        JSONArray jsonArray1 = new JSONArray();
        jsonArray1.put(jsonA);
        jsonArray1.put(jsonB);

        JSONObject jsonMain = new JSONObject();
        try {

            jsonMain.put("user_token", token);
            if (mstatus == 0)
                jsonMain.put("new_match", jsonMatch);
            jsonMain.put("player", jsonArray1);
        }
        catch (JSONException e) {
            e.printStackTrace();
        }

        if (isNetworkAvailable())
            postJSON(jsonMain.toString());
    }*/


    //posting events or BALL BY BALL
    private void postJSON(int matchid, String matchID/*, boolean undo*/) {

//        Log.d("postJSON", "called, matchID : " + matchID);

        boolean matchSync = false, playerSync = false, tossSync = false;
        int msync = 0, psync = 0, tsync = 0, osync = 0;
        String capA = null, vcA = null, wkA = null, capB = null, vcB = null, wkB = null,
                umpire1_v = "", umpire2_v = "", umpire3_v = "", umpire4_v = "", match_referee_v = "";
        boolean post = false, player_post = false;

        Match match = realm.where(Match.class).
                equalTo("matchid", matchid).findFirst();
//        Log.d("matchid", "postJSON : " + matchid);
        Log.d("match", "postJSON : " + match);

        if (isNetworkAvailable()) {

            if (match != null) {
//            if (matchID == null)
//                matchID = match.getMatchID();
                msync = match.getMatchSync();
                psync = match.getPlayerSync();
                tsync = match.getTossSync();
                osync = match.getOpenerSync();
                post = match.isPost();
                player_post = match.isPlayer_post();
            }


            // posting officials
            RealmResults<MatchOfficials> result = realm.where(MatchOfficials.class).
                    equalTo("matchID", matchID).findAll();

            JSONArray arrayOfficials = new JSONArray();
            Log.d("officials", "results 1 : " + result);
            if (result.isEmpty()) {

                Log.d("officials", "results : " + result);
            } else {

                for (MatchOfficials officials : result) {

                    JSONObject jsonOfficials = new JSONObject();

                    try {
                        if (!officials.getOfficialName().matches(""))
                            jsonOfficials.put("name", officials.getOfficialName());
                        else
                            jsonOfficials.put("name", "");

                        if (officials.getStatus().matches("u1") || officials.getStatus().matches("u2"))
                            jsonOfficials.put("type", "u");
                        else
                            jsonOfficials.put("type", officials.getStatus());

                        if (officials.getD4s_id() == 0)
                            jsonOfficials.put("d4s_playerid", 0);
                        else
                            jsonOfficials.put("d4s_playerid", officials.getD4s_id());

                        arrayOfficials.put(jsonOfficials);

                    } catch (JSONException e) {
                        e.printStackTrace();
                    }
                }
            }

            // posting match details if not synced
            JSONObject jsonMatch = new JSONObject();

            if (post)
                Log.d("cap", "match : " + match);
            else {//msync == 0) {

                try {

                    jsonMatch.put("d4s_gameid", match.getD4s_matchid());
                    jsonMatch.put("d4s_userid", match.getD4s_userid());

                    jsonMatch.put("matchID", match.getMatchID());
                    jsonMatch.put("teamA", match.getTeamA());
                    jsonMatch.put("d4s_teamA_id", match.getTeamAId());
                    jsonMatch.put("teamB", match.getTeamB());
                    jsonMatch.put("d4s_teamB_id", match.getTeamBId());
                    jsonMatch.put("venue", match.getVenue());
                    jsonMatch.put("d4s_venue_id", match.getVenueId());
                    if (match.getEnd1() == null)
                        jsonMatch.put("end1", "");
                    else
                        jsonMatch.put("end1", match.getEnd1());
                    if (match.getEnd2() == null)
                        jsonMatch.put("end2", "");
                    else
                        jsonMatch.put("end2", match.getEnd2());
                    jsonMatch.put("event", match.getEvent());
                    jsonMatch.put("d4s_event_id", match.getEventId());
                    jsonMatch.put("phase", match.getPhase());
                    jsonMatch.put("match_type", match.getMatchType());
                    jsonMatch.put("innings", match.getInnings());
                    jsonMatch.put("playersA", match.getPlayerA());
                    jsonMatch.put("playersB", match.getPlayerB());
                    jsonMatch.put("overs_per_bowler", match.getMax_opb());
//                    jsonMatch.put("players", match.getPlayer());
//                    jsonMatch.put("substitute_players", match.getSubst());
                    jsonMatch.put("over", match.getActual_over());
                    jsonMatch.put("balls_per_over", match.getBalls());
                    jsonMatch.put("wide_value", match.getWiderun());
                    jsonMatch.put("noball_value", match.getNoballrun());
                    jsonMatch.put("penalty_value", match.getPenaltyrun());
                    jsonMatch.put("rainruleused", "n");
                /*if (match.getUmpire1() == null)
                    jsonMatch.put("umpire1", "");
                else
                    jsonMatch.put("umpire1", match.getUmpire1());
                if (match.getUmpire2() == null)
                    jsonMatch.put("umpire2", "");
                else
                    jsonMatch.put("umpire2", match.getUmpire2());
                if (match.getUmpire3() == null)
                    jsonMatch.put("umpire3", "");
                else
                    jsonMatch.put("umpire3", match.getUmpire3());
                if (match.getUmpire4() == null)
                    jsonMatch.put("umpire4", "");
                else
                    jsonMatch.put("umpire4", match.getUmpire4());
                if (match.getMatchReferee() == null)
                    jsonMatch.put("match_referee", "");
                else
                    jsonMatch.put("match_referee", match.getMatchReferee());*/
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }


            //posting Players
            // starting of adding Team A players
            JSONObject jsonPlayerA;

            // for adding players

            RealmResults<Player> results = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", 1).
                    equalTo("substitute", false).findAll();
            JSONArray arrayPlayerA = new JSONArray();

            for (Player player : results) {

                jsonPlayerA = new JSONObject();

                try {
                    jsonPlayerA.put("name", player.getPlayerName());
                    jsonPlayerA.put("player_id", player.getPlayerID());
                    jsonPlayerA.put("d4s_playerid", player.getD4s_playerid());
                    if (player.isCaptain()) {
                        jsonPlayerA.put("captain", "y");
                        capA = player.getPlayerName();
                    } else
                        jsonPlayerA.put("captain", "n");
                    if (player.isViceCaptain()) {
                        jsonPlayerA.put("vice_captain", "y");
                        vcA = player.getPlayerName();
                    } else
                        jsonPlayerA.put("vice_captain", "n");
                    if (player.isWicketKeeper()) {
                        jsonPlayerA.put("wicketkeeper", "y");
                        wkA = player.getPlayerName();
                    } else
                        jsonPlayerA.put("wicketkeeper", "n");
                    arrayPlayerA.put(jsonPlayerA);
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }

            //for adding substitute players

            results = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", 1).
                    equalTo("substitute", true).findAll();
            JSONArray arraySubA = new JSONArray();

            for (Player player : results) {

                jsonPlayerA = new JSONObject();

                try {
                    jsonPlayerA.put("name", player.getPlayerName());
                    jsonPlayerA.put("player_id", player.getPlayerID());
                    jsonPlayerA.put("d4s_playerid", player.getD4s_playerid());
                    if (player.isCaptain())
                        jsonPlayerA.put("captain", "y");
                    else
                        jsonPlayerA.put("captain", "n");
                    if (player.isViceCaptain())
                        jsonPlayerA.put("vice_captain", "y");
                    else
                        jsonPlayerA.put("vice_captain", "n");
                    if (player.isWicketKeeper())
                        jsonPlayerA.put("wicketkeeper", "y");
                    else
                        jsonPlayerA.put("wicketkeeper", "n");
                    arraySubA.put(jsonPlayerA);
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }

            JSONObject jsonTeamA = new JSONObject();
            try {
                jsonTeamA.put("players", arrayPlayerA);
                jsonTeamA.put("substitutes", arraySubA);
                jsonTeamA.put("captain", capA);
                jsonTeamA.put("vice captain", vcA);
                jsonTeamA.put("wicketkeeper", wkA);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            JSONObject jsonA = new JSONObject();
            try {
                jsonA.put("TeamA", jsonTeamA);
            } catch (JSONException e) {
                e.printStackTrace();
            }// end of adding Team A players

            // starting of adding Team B players
            JSONObject jsonPlayerB;

            // for adding players

            results = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", 2).
                    equalTo("substitute", false).findAll();
            JSONArray arrayPlayerB = new JSONArray();

            for (Player player : results) {

                jsonPlayerB = new JSONObject();

                try {
                    jsonPlayerB.put("name", player.getPlayerName());
                    jsonPlayerB.put("player_id", player.getPlayerID());
                    jsonPlayerB.put("d4s_playerid", player.getD4s_playerid());
                    if (player.isCaptain()) {
                        jsonPlayerB.put("captain", "y");
                        capB = player.getPlayerName();
                    } else
                        jsonPlayerB.put("captain", "n");
                    if (player.isViceCaptain()) {
                        jsonPlayerB.put("vice_captain", "y");
                        vcB = player.getPlayerName();
                    } else
                        jsonPlayerB.put("vice_captain", "n");
                    if (player.isWicketKeeper()) {
                        jsonPlayerB.put("wicketkeeper", "y");
                        wkB = player.getPlayerName();
                    } else
                        jsonPlayerB.put("wicketkeeper", "n");
                    arrayPlayerB.put(jsonPlayerB);
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }

            //for adding substitute players

            results = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", 2).
                    equalTo("substitute", true).findAll();
            JSONArray arraySubB = new JSONArray();

            for (Player player : results) {

                jsonPlayerB = new JSONObject();

                try {
                    jsonPlayerB.put("name", player.getPlayerName());
                    jsonPlayerB.put("player_id", player.getPlayerID());
                    jsonPlayerB.put("d4s_playerid", player.getD4s_playerid());
                    if (player.isCaptain())
                        jsonPlayerB.put("captain", "y");
                    else
                        jsonPlayerB.put("captain", "n");
                    if (player.isViceCaptain())
                        jsonPlayerB.put("vice_captain", "y");
                    else
                        jsonPlayerB.put("vice_captain", "n");
                    if (player.isWicketKeeper())
                        jsonPlayerB.put("wicketkeeper", "y");
                    else
                        jsonPlayerB.put("wicketkeeper", "n");
                    arraySubB.put(jsonPlayerB);
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }

            JSONObject jsonTeamB = new JSONObject();
            try {
                jsonTeamB.put("players", arrayPlayerB);
                jsonTeamB.put("substitutes", arraySubB);
                jsonTeamB.put("captain", capB);
                jsonTeamB.put("vice captain", vcB);
                jsonTeamB.put("wicketkeeper", wkB);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            JSONObject jsonB = new JSONObject();
            try {
                jsonB.put("TeamB", jsonTeamB);
            } catch (JSONException e) {
                e.printStackTrace();
            }//end of adding Team B players


            JSONObject jsonmid = new JSONObject();
            try {
                jsonmid.put("matchID", matchID);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            //adding players to Players array
            JSONArray arrayPlayers = new JSONArray();
            arrayPlayers.put(jsonmid);
            arrayPlayers.put(jsonA);
            arrayPlayers.put(jsonB);


            // adding toss winner and their decision
            // commented on 19/10/2020
            /*JSONObject jsonToss = new JSONObject();
            try {
                jsonToss.put("matchID", matchID);
                jsonToss.put("winner", tossWinner);
                jsonToss.put("decision", decision);
            } catch (JSONException e) {
                e.printStackTrace();
            }*/
            // added on 19/10/2020
            JSONObject jsonToss = new JSONObject();
            try {
                jsonToss.put("matchID", matchID);
                if (match.isNoToss() || match.isUnknownToss()) {
                    jsonToss.put("winner", -1);
                    jsonToss.put("decision", decision);
                    jsonToss.put("battingteam", tossWinner);
                } else {
                    jsonToss.put("winner", tossWinner);
                    jsonToss.put("decision", decision);
                    jsonToss.put("battingteam", 0);
                }
            } catch (JSONException e) {
                e.printStackTrace();
            }

//        Log.e("scoring", "jsonToss : "+jsonToss);

            JSONArray arrayToss = new JSONArray();
            arrayToss.put(jsonToss);
//        Log.e("scoring", "arrayToss : "+arrayToss);

            JSONObject jsonOpener = new JSONObject();
            try {
                jsonOpener.put("matchID", matchID);
                jsonOpener.put("innings", currentInnings);
                jsonOpener.put("striker", striker);
                jsonOpener.put("non_striker", nonStriker);
                jsonOpener.put("bowler", bowler);
//            jsonOpener.put("next_bowler", nextBowler);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            JSONArray arrayOpener = new JSONArray();
            arrayOpener.put(jsonOpener);
//        Log.e("toss", "arrayOpener : "+arrayOpener);

            JSONObject jsonball = new JSONObject();
            try {
                Log.d("jsonEventArray", "postJSON : " + jsonEventArray);
                jsonball.put("ball", jsonEventArray);

            } catch (JSONException e) {
                e.printStackTrace();
            }

            // ======== added  on 04/07/2020
            JSONObject jsonball2 = new JSONObject();
            try {
                jsonball2.put("ball", jsonUndoArray);

            } catch (JSONException e) {
                e.printStackTrace();
            }

            JSONObject jsonbbb2 = new JSONObject();
            try {
                jsonbbb2.put("ballbyball", jsonball2);
            } catch (JSONException e) {
                e.printStackTrace();
            }
            // ======== till here


            JSONObject jsonbbb = new JSONObject();
            try {
                jsonbbb.put("ballbyball", jsonball);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            JSONObject jsonmatchid = new JSONObject();
            try {
                jsonmatchid.put("matchID", matchID);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            // ======== added  on 04/07/2020
            JSONArray arrayAddBBB2 = new JSONArray();
            arrayAddBBB2.put(jsonmatchid);
            arrayAddBBB2.put(jsonbbb2);
            // ========= till here

            JSONArray arrayAddBBB = new JSONArray();
            arrayAddBBB.put(jsonmatchid);
            arrayAddBBB.put(jsonbbb);




        /*JSONObject jsonUndo = new JSONObject();
        try {
            jsonUndo.put("matchID", matchID);
            jsonUndo.put("innings", currentInnings);
            jsonUndo.put("undo", jsonUndoArray);
        } catch (JSONException e) {
            e.printStackTrace();
        }*/


            // added on 15/05/2020
            JSONObject jsonObject = new JSONObject();
            try {
                jsonObject.put("matchID", matchID);
                jsonObject.put("officials", arrayOfficials);
            } catch (JSONException e) {
                e.printStackTrace();
            }


            // adding values into feed
            JSONObject jsonFeed = new JSONObject();
            try {
            /*if (post)
                Log.d("cap", "match : " + match);
            else {//msync == 0) {*/
                if (msync == 0) {
                    jsonFeed.put("AddMatch", jsonMatch);
                    jsonFeed.put("AddMatchOfficials", jsonObject);
//            }

//            else {
                    if (psync == 0) {
                    /*if (player_post)
                        Log.d("cap", "match : " + match);
                    else //psync == 0)*/
                        jsonFeed.put("AddPlayers", arrayPlayers);
                    }

                    /*  else {*/ // commented on 15/05/2020

//                    if (psync == 1) {
                    if (tsync == 0) {
                        jsonFeed.put("AddToss", arrayToss);
                    }
//                    }
                    //for openers
//            if (osync == 0)
//                jsonFeed.put("AddOpeners", arrayOpener);
//            jsonFeed.put("AddBBB", jsonEventArray);


                } else {
                    //commented on 15/05/2020
                    /*else {
                            if (tsync == 1) {*/

                    // commented on 07/07/2020
                               /* if (jsonUndoArray.length() > 0) {

                                    // added & commented  on 27/06/2020
                                    jsonFeed.put("UndoBBB", arrayAddBBB2);

                                    // commented on 04/07/2020
//                                     jsonFeed.put("UndoBBB", jsonUndoArray);//jsonUndo);
                                }*/
//            else
                    if (jsonEventArray.length() > 0)
                        jsonFeed.put("AddBBB", arrayAddBBB);
                            /*}
                        }
                }*/// commented on 15/05/2020
                }

            } catch (JSONException e) {
                e.printStackTrace();
            }
//        Log.e("scoring", "jsonFeed : "+jsonFeed);

            //adding values to postparams
            JSONObject postparams = new JSONObject();
            try {
                postparams.put("title", "CHASE_POST");
                postparams.put("feed", jsonFeed);
            } catch (JSONException e) {
                e.printStackTrace();
            }

//        Log.e("scoring", "postparams : "+postparams);

            JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                    Constants.CHASE_CRICKET_MATCH_API,
                    postparams,
                    new Response.Listener<JSONObject>() {
                        @Override
                        public void onResponse(JSONObject response) {


                            Log.e("scoring", "response : " + response);

                            try {

                                //if no error in response

                                if ((response.getInt("status") == 200) && !response.getBoolean("error")) {

                                    JSONObject jsonMatch = response.getJSONObject("match");

                                    //commented on 15/05/2020
//                                JSONArray updatedIDs = response.getJSONArray("updatedIDs");
                                /*JSONArray updatedIDs = new JSONArray();
                                if (response.has("updatedIDs")) {
                                    updatedIDs = response.getJSONArray("updatedIDs");
                                }*/

                                    Realm realm = null;
                                    try {
                                         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                                        realm.executeTransaction(new Realm.Transaction() {
                                            @Override
                                            public void execute(Realm bgRealm) {

                                                try {

                                                    Match match1 = bgRealm.where(Match.class).
                                                            equalTo("matchID",
                                                                    jsonMatch.getString("app_matchID")).
                                                            findFirst();

                                                    if (match1 != null) {
                                                        match1.setPost(true);

//                                                    if (match1.getMatchSync() == 1) {
                                                        match1.setMatchSync(1);
                                                        match1.setPlayer_post(true);

                                                        if (match1.getPlayerSync() != 1) {
                                                            match1.setPlayerSync(1);

                                                            // added on 14/09/2020
                                                            RealmResults<Player> resultsPlayer = bgRealm.where(Player.class).
                                                                    equalTo("matchID", jsonMatch.getString("app_matchID")).
                                                                    findAll();

                                                            for (Player player : resultsPlayer) {

                                                                player.setSync(1);
                                                                bgRealm.copyFromRealm(player);
                                                                Log.e("RESPONSE", "Captain, synced player : " + player.toString());
                                                            }
                                                            //============= till here
                                                        }
                                                        if (match1.getOpenerSync() != 1)
                                                            match1.setOpenerSync(1);
                                                        if (match1.getTossSync() != 1)
                                                            match1.setTossSync(1);
//                                                    }
//                                                    else
//                                                        match1.setMatchSync(1);


                                                        Log.d("matchSync", "scoring, match1 synced");

                                                        bgRealm.copyToRealm(match1);
                                                        Log.d("matchSync", "scoring, match1 : " + match1);
                                                    }


//                                                =====================================================================================
//                                                =====================================================================================
//                                                need to sync Undo table

//                                                resetJSONUndoArray();
//                                                =====================================================================================
//                                                =====================================================================================


                                                    if (response.has("updatedIDs")) {
                                                        JSONArray updatedIDs = response.getJSONArray("updatedIDs");

                                                        if (updatedIDs.length() > 0) {
                                                            for (int i = 0; i < updatedIDs.length(); i++) {
//                                                                Log.d("updatedIDs", " : " + updatedIDs.get(i));
                                                                Integer tempID = (Integer) updatedIDs.get(i);
                                                                Events events1 = bgRealm.where(Events.class).
                                                                        equalTo("eventID", (Integer) updatedIDs.get(i)).
                                                                        findFirst();
//                                                            equalTo("matchID", jsonMatch.getString("app_matchID")).

//                                                                if (events1 == null) {
//                                                                    Log.d("Events", "response 1, : " + events1);
//                                                                } else
                                                                if (events1 != null) {

                                                                    Log.d("Events", "response 2, : " + events1);
                                                                    events1.setUndoArray(null);
                                                                    events1.setSyncstatus(1);

//                                                                    Log.d("Events", "response 3, : " + events1);
                                                                    bgRealm.copyToRealm(events1);
                                                                    // commented on 27/07/2020
//                                                                    resetJSONEventArray();
                                                                    // added on 27/07/2020
                                                                    //commented on 30/07/2020
//                                                                    post();
                                                                }

                                                            }
                                                        }
                                                    }

                                                    serverSync();

                                                } catch (JSONException e) {
                                                    e.printStackTrace();
                                                } catch (RealmPrimaryKeyConstraintException e) {
                                                    progress.dismiss();
//                                                Toast.makeText(getApplicationContext(),
//                                                        "Primary Key exists, Press Update instead",
//                                                        Toast.LENGTH_SHORT).show();
                                                    Log.e("postJSON", "RealmPrimaryKeyConstraintException : " + e);
                                                }
                                            }
                                        });
                                    } catch (RealmException e) {
                                        Log.d("test", "Exception : " + e);
                                    } finally {
                                        if (realm != null) {
                                            realm.close();
                                        }
                                    }


                                /*Toast.makeText(getApplicationContext(),
                                        response.getString("message"), Toast.LENGTH_SHORT).show();*/

                                    Log.d("post_response", response.getString("message"));

//

                                } else {
                                /*Toast.makeText(getApplicationContext(),
                                        response.getString("message"), Toast.LENGTH_SHORT).show();*/
                                    Log.d("post_response_error", response.getString("message"));
                                }
                            } catch (JSONException e) {

                                serverSync();
                                e.printStackTrace();
                                Log.d("JSONException", "scoring, " + e);
                            }


                        }

                    },
                    new Response.ErrorListener() {
                        @Override
                        public void onErrorResponse(VolleyError error) {
                            serverSync();
                            Log.e("volley", "Scoring, onErrorResponse  : " + error);

                        }
                    });

            MyApplicationClass.getInstance(getApplicationContext()).addToRequestQueue(jsonObjReq, "postRequest");
            Log.d("scoring", "jsonObjReq  : " + jsonObjReq);
            Log.d("scoring", "postparams  : " + postparams);

        }

    }


    // added on 07/07/2020
    // for posting undo
    private void postUndoJSON() {

        Log.d("postJSON", "called, matchID : " + matchID);
        Log.d("postJSON", "called, jsonUndoArray : " + jsonUndoArray);

        boolean matchSync = false, playerSync = false, tossSync = false;


        int msync = 0, psync = 0, tsync = 0, osync = 0;
        String capA = null, vcA = null, wkA = null, capB = null, vcB = null, wkB = null,
                umpire1_v = "", umpire2_v = "", umpire3_v = "", umpire4_v = "", match_referee_v = "";
        boolean post = false, player_post = false;

        Match match = realm.where(Match.class).
                equalTo("matchid", matchid).findFirst();
        Log.d("matchid", "postJSON : " + matchid);
        Log.d("match", "postJSON : " + match);

        if (isNetworkAvailable()) {


            JSONObject jsonball2 = new JSONObject();
            try {
                jsonball2.put("ball", jsonUndoArray);

            } catch (JSONException e) {
                e.printStackTrace();
            }

            JSONObject jsonbbb2 = new JSONObject();
            try {
                jsonbbb2.put("ballbyball", jsonball2);
            } catch (JSONException e) {
                e.printStackTrace();
            }


            JSONObject jsonmatchid = new JSONObject();
            try {
                jsonmatchid.put("matchID", matchID);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            JSONArray arrayAddBBB2 = new JSONArray();
            arrayAddBBB2.put(jsonmatchid);
            arrayAddBBB2.put(jsonbbb2);


            // adding values into feed
            JSONObject jsonFeed = new JSONObject();
            try {

//                if (jsonUndoArray.length() > 0) {

                jsonFeed.put("UndoBBB", arrayAddBBB2);
//                    jsonFeed.put("UndoBBB", jsonUndoArray);
//                }
            } catch (JSONException e) {
                e.printStackTrace();
            }
//        Log.e("scoring", "jsonFeed : "+jsonFeed);

            //adding values to postparams
            JSONObject postparams = new JSONObject();
            try {
                postparams.put("title", "CHASE_POST");
                postparams.put("feed", jsonFeed);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            Log.d("jsonUndoArray", "post() 8 , postparams : " + postparams);

//        Log.e("scoring", "postparams : "+postparams);

            JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                    Constants.CHASE_CRICKET_MATCH_UNDO_API,
                    postparams,
                    new Response.Listener<JSONObject>() {
                        @Override
                        public void onResponse(JSONObject response) {


                            Log.e("scoring", "response : " + response);

                            // added on 11/07/2020
                            try {
                                JSONArray array = response.getJSONArray("eventid");
                                Log.e("scoring", "array : " + array);
                                if (array.length() > 0) {

                                    for (int i = 0; i < array.length(); i++) {
                                        Log.d("array", " : " + array.get(i));
                                        Integer tempID = (Integer) array.get(i);
                                        Undo undo1 = realm.where(Undo.class).
                                                equalTo("matchid", matchid).
                                                equalTo("eventID", (Integer) array.get(i)).
                                                findFirst();

                                        if (undo1 != null) {
                                            if (!realm.isInTransaction()) {
                                                realm.beginTransaction();
                                            }

                                            undo1.deleteFromRealm();
                                            realm.commitTransaction();
                                        }
                                    }
                                    updateUndo2();
                                    serverSync();
                                }

                            } catch (JSONException e) {
                                e.printStackTrace();
                                serverSync();
                            }
                        }
                    },
                    new Response.ErrorListener() {
                        @Override
                        public void onErrorResponse(VolleyError error) {

                            Log.e("volley", "postundo, onErrorResponse  : " + error);
                            updateUndo2();
                            serverSync();

                        }
                    });

            MyApplicationClass.getInstance(getApplicationContext()).addToRequestQueue(jsonObjReq, "postRequest");
            Log.d("scoring", "jsonObjReq  : " + jsonObjReq);
            Log.d("scoring", "postparams  : " + postparams);
        }

    }


    private void resetJSONUndoArray() {

//        for (int i = 0; i < jsonUndoArray.length(); i++) {
//
//        }

        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
            for (int i = jsonUndoArray.length() - 1; i >= 0; --i) {
                jsonUndoArray.remove(i);
            }
        } else
            jsonUndoArray = new JSONArray();

    }


    private void resetJSONEventArray() {

        Log.d("json1", "resetJSONEventArray method called");

        count = 0;
        undo_count = 0;


//        if (isNetworkAvailable()) {     // added on 27/04/20

        // inserting undo array in resetJSONEventArray()
        jsonUndoArray = new JSONArray();
        jsonEventArray = new JSONArray();
         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
           /* RealmResults<Undo> result1 = realm.where(Undo.class).
                    equalTo("matchid", matchid).
                    equalTo("sync", 1).findAll();

            if (result1.isEmpty()) {
//            jsonEventArray = new JSONArray();

                RealmResults<Undo> result11 = realm.where(Undo.class).
                        equalTo("matchid", matchid).findAll();

                for (Undo undo : result11) {

                    if (undo_count <= 0) {//10) {
                        ++undo_count;
                        Log.d("jsonUndoArray", "resetJSONEventArray() 1 : " + undo);
                        if (undo.getSync() == 0) {


                            // added on 04/07/2020
                            jsonUndoArray.put(setUndo());

                            // commented on 04/07/2020
//                            setUndoArray(undo.getUndoID(), undo.getEventID(), undo.getInnings(), false, undo.isPreOut());

                            Log.d("jsonUndoArray", "resetJSONEventArray() 1 : " + jsonEventArray);
                        }
                    }

                    else
                        break;;
                }
            }*/



        /*RealmResults<Events> results = realm.where(Events.class).
                equalTo("matchid", matchid).findAll();*/

        RealmResults<Events> result = realm.where(Events.class).
                equalTo("matchid", matchid).
                equalTo("syncstatus", 1).findAll();

        if (result.isEmpty()) {
//            jsonEventArray = new JSONArray();

            RealmResults<Events> results = realm.where(Events.class).
                    equalTo("matchid", matchid).findAll();

            for (Events event : results) {

//                    if (count <= 2){//50) {//10) {  // commented on 0/07/2021
                if (count <= 1) {
                    ++count;

                    Log.d("jsonEventArray", "event 1 : " + event);
                    if (event.getSyncstatus() == 0) {
                        jsonEventArray.put(setEventJSON(event));
                        Log.d("jsonEventArray", "resetJSONEventArray 1 : " + jsonEventArray);
                    }
                } else
                    break;
            }
        } else {


            Events events = result.last();

      /* Events events = realm.where(Events.class).
                equalTo("matchid", matchid).
                equalTo("syncstatus", 1).findAll().last();
*/
           /* if (events == null) {

                RealmResults<Events> results = realm.where(Events.class).
                        equalTo("matchid", matchid).findAll();

                for (Events event : results) {

                    if (event.getSyncstatus() == 0)
                        jsonEventArray.put(setEventJSON(event));
                }
            } else {*/

            RealmResults<Events> results = realm.where(Events.class).
                    equalTo("matchid", matchid).
                    greaterThan("eventID", events.getEventID()).findAll();

            for (Events event : results) {

//                    if (count <= 2){//50) {//10) {  // commented on 0/07/2021
                if (count <= 1) {
                    ++count;

                    if (event.getSyncstatus() == 0) {
                        Log.d("jsonEventArray", "event 2 : " + event);
                        jsonEventArray.put(setEventJSON(event));
                        Log.d("jsonEventArray", "resetJSONEventArray 2 : " + jsonEventArray);
                    }
                } else
                    break;
            }

//            Log.e("resetJSONEventArray", "resetJSONEventArray : "+ jsonEventArray);
//            Log.e("scoring", "newEvent, before, runsOffBatNB : "+runsOffBatNB);
//            Log.e("scoring", "newEvent, before, runsOffBat : "+runsOffBat);
//            }
        }
//        }
    }


    // set event details in JSON format

    public JSONObject setEventJSON(Events events) {

        int b = 0, lb = 0, wd = 0, nb = 0, p = 0, wk = 0;
        Match match = realm.where(Match.class).
                equalTo("matchid", matchid).
                findFirst();


        //for bowler

        // commented on 16/05/2020
        /*Bowler bow = realm.where(Bowler.class).
                equalTo("matchid", events.getMatchid()).//matchid).
                equalTo("innings", events.getInnings()).//currentInnings).
                equalTo("team", events.getFieldingTeamNo()).//fieldingTeamNo).
                equalTo("playerID",events.getBowlerID()).findFirst();*/

        JSONObject jsoncurrentbowler = new JSONObject();
        try {
            jsoncurrentbowler.put("id", events.getBowlerID());
            jsoncurrentbowler.put("run", events.getBowlerRuns());
            jsoncurrentbowler.put("over", events.getBowlerOver());
            jsoncurrentbowler.put("balls", events.getBowlerBalls());
            jsoncurrentbowler.put("wicket", events.getBowlerWicket());
//            if (bow != null) {    // commented on 16/05/2020
            jsoncurrentbowler.put("dots", events.getBowlerDots());//bow.getDots());
            jsoncurrentbowler.put("maiden", events.getBowlerMO());//bow.getMaidenOver());
            jsoncurrentbowler.put("wide", events.getBowlerWides());//bow.getWides());
            jsoncurrentbowler.put("noball", events.getBowlerNoball());//bow.getNoBalls());
            /*}     // commented on 16/05/2020

            else {
                jsoncurrentbowler.put("dots", 0);
                jsoncurrentbowler.put("maiden", 0);
                jsoncurrentbowler.put("wide", 0);
                jsoncurrentbowler.put("noball", 0);
            }*/
        } catch (JSONException e) {
            e.printStackTrace();
        }


        JSONObject jsonotherendbowler = new JSONObject();

        if (events.getPrevBowlerID() != 0) {

            // commented on 16/05/2020
            /*bow = realm.where(Bowler.class).
                    equalTo("matchid", events.getMatchid()).//matchid).
                    equalTo("innings", events.getInnings()).//currentInnings).
                    equalTo("team", events.getFieldingTeamNo()).//fieldingTeamNo).
                    equalTo("playerID", events.getPrevBowlerID()).findFirst();*/
            try {
                jsonotherendbowler.put("id", events.getPrevBowlerID());
                jsonotherendbowler.put("run", events.getPreBowlerRuns());
                jsonotherendbowler.put("over", events.getPreBowlerOver());
                jsonotherendbowler.put("balls", events.getPreBowlerBalls());
                jsonotherendbowler.put("wicket", events.getPreBowlerWicket());
//                if (bow != null) {    // commented on 16/05/2020
                jsonotherendbowler.put("dots", events.getPreBowlerDots());//bow.getDots());
                jsonotherendbowler.put("maiden", events.getPreBowlerMO());//bow.getMaidenOver());
                jsonotherendbowler.put("wide", events.getPreBowlerWides());//bow.getWides());
                jsonotherendbowler.put("noball", events.getPreBowlerNoball());//bow.getNoBalls());
                /*}     // commented on 16/05/2020
                else {
                    jsonotherendbowler.put("dots", 0);
                    jsonotherendbowler.put("maiden", 0);
                    jsonotherendbowler.put("wide", 0);
                    jsonotherendbowler.put("noball", 0);
                }*/
            } catch (JSONException e) {
                e.printStackTrace();
            }
        } else {
            try {
                jsonotherendbowler.put("id", 0);
                jsonotherendbowler.put("run", 0);
                jsonotherendbowler.put("over", 0);
                jsonotherendbowler.put("balls", 0);
                jsonotherendbowler.put("wicket", 0);
                jsonotherendbowler.put("dots", 0);
                jsonotherendbowler.put("maiden", 0);
                jsonotherendbowler.put("wide", 0);
                jsonotherendbowler.put("noball", 0);
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }


        JSONObject jsonbowler = new JSONObject();
        try {
            jsonbowler.put("current", jsoncurrentbowler);
            jsonbowler.put("otherend", jsonotherendbowler);
        } catch (JSONException e) {
            e.printStackTrace();
        }


        // for batsman
        /*Batsman bats = realm.where(Batsman.class).
                equalTo("matchid", events.getMatchid()).//matchid).
                equalTo("innings", events.getInnings()).//currentInnings).
                equalTo("team", events.getBattingTeamNo()).//battingTeamNo).
                equalTo("batsman_pID", events.getStrikerID()).findFirst();*/

        JSONObject jsonstriker = new JSONObject();
        try {
            jsonstriker.put("id", events.getStrikerID());
            jsonstriker.put("run", events.getStrikerRuns());
            jsonstriker.put("ball", events.getStrikerBalls());

//            if (bats != null) {
            if (events.getStrikerBattingOrder() == 100)//bats.getBattingOrder() == 100)
                jsonstriker.put("battingorder", 0);
            else
                jsonstriker.put("battingorder", events.getStrikerBattingOrder());//bats.getBattingOrder());
            jsonstriker.put("dots", events.getStrikerDots());//bats.getDots());
            jsonstriker.put("fours", events.getStrikerF4s());//bats.getF4s());
            jsonstriker.put("sixes", events.getStrikerS6s());//bats.getS6s());
            /*}
            else {

                jsonstriker.put("battingorder", 0);
                jsonstriker.put("dots", 0);
                jsonstriker.put("fours", 0);
                jsonstriker.put("sixes", 0);
            }*/
        } catch (JSONException e) {
            e.printStackTrace();
        }


        // commented on 16/05/2020
        /*bats = realm.where(Batsman.class).
                equalTo("matchid", events.getMatchid()).//matchid).
                equalTo("innings", events.getInnings()).//currentInnings).
                equalTo("team", events.getBattingTeamNo()).//battingTeamNo).
                equalTo("batsman_pID", events.getNonStrikerID()).findFirst();*/
        JSONObject jsonnonstriker = new JSONObject();
        try {
            jsonnonstriker.put("id", events.getNonStrikerID());
            jsonnonstriker.put("run", events.getNonStrikerRuns());
            jsonnonstriker.put("ball", events.getNonStrikerBalls());
//            if (bats != null) {       // commented on 16/05/2020
            if (events.getNonStrikerBattingOrder() == 100)//bats.getBattingOrder() == 100)
                jsonnonstriker.put("battingorder", 0);
            else
                jsonnonstriker.put("battingorder", events.getNonStrikerBattingOrder());//bats.getBattingOrder());
            jsonnonstriker.put("dots", events.getNonStrikerDots());//bats.getDots());
            jsonnonstriker.put("fours", events.getNonStrikerF4s());//bats.getF4s());
            jsonnonstriker.put("sixes", events.getNonStrikerS6s());//bats.getS6s());
            /*}     // commented on 16/05/2020
            else  {
                jsonnonstriker.put("battingorder", 0);
                jsonnonstriker.put("dots", 0);
                jsonnonstriker.put("fours", 0);
                jsonnonstriker.put("sixes", 0);
            }*/
        } catch (JSONException e) {
            e.printStackTrace();
        }


        JSONObject jsonbatsman = new JSONObject();
        try {
            jsonbatsman.put("striker", jsonstriker);
            jsonbatsman.put("nonstriker", jsonnonstriker);

        } catch (JSONException e) {
            e.printStackTrace();
        }


        // for adding total extras on events

        // commented on 16/05/2020
        /*ExtraCard extraCard = realm.where(ExtraCard.class).
                equalTo("matchid", events.getMatchid()).//matchid).
                equalTo("innings", events.getInnings()).//currentInnings).
                findFirst();
        Log.d("ScoreCard", "setEventJSON, extracard : "+extraCard);
        if (extraCard != null){*/

        b = events.getExtraBye();//extraCard.getByes();
        lb = events.getExtraLb();//extraCard.getLb();
        wd = events.getExtraWd();//extraCard.getWide();// * wideRun;
        nb = events.getExtraNb();//extraCard.getNoBall();// * noballRun;
        p = events.getExtraP();//extraCard.getPenalty();// * penaltyRun;

        /*}     // commented on 16/05/2020

        else {
            b = 0;
            lb = 0;
            wd = 0;
            nb = 0;
            p = 0;
        }*/

        JSONObject jsonExtra = new JSONObject();
        try {
//            jsonExtra.put("inningsextras", (b + lb + (wd * wideRun) + (nb * noballRun) + (p * penaltyRun)));
            jsonExtra.put("inningsextras",
                    (b +
                            lb +
                            (wd * match.getWiderun()) +
                            (nb * match.getNoballrun()) +
                            (p * match.getPenaltyrun())));
            jsonExtra.put("byes", b);
            jsonExtra.put("legbyes", lb);
            jsonExtra.put("wide", wd);
            jsonExtra.put("noball", nb);
            jsonExtra.put("penalty", p);

        } catch (JSONException e) {
            e.printStackTrace();
        }


        // adding inningssummary

        JSONObject jsonSummery = new JSONObject();
        try {
//            jsonSummery.put("innings", events.getInnings());
            if (events.isSUPER_OVER()) {
                if (events.getInnings() == 99)
                    jsonSummery.put("innings", 1);
                else if (events.getInnings() == 100)
                    jsonSummery.put("innings", 2);
            } else
                jsonSummery.put("innings", events.getInnings());
            jsonSummery.put("totalovers", Double.parseDouble(
                    new DecimalFormat("###.#").format(events.getOvers())));
            jsonSummery.put("totalscore", events.getTotalRuns());
            jsonSummery.put("totalwicket", events.getWicket());
            jsonSummery.put("extras", jsonExtra);
        } catch (JSONException e) {
            e.printStackTrace();
        }


        // adding over summary
        JSONObject jsonOverSummary = new JSONObject();
        try {
            jsonOverSummary.put("runs", events.getMo());
        } catch (JSONException e) {
            e.printStackTrace();
        }


        // getting fielderIDs
        JSONArray arrayFielder = new JSONArray();
        if (events.getOutType() == 1 || events.getOutType() == 3)
            arrayFielder.put(Integer.parseInt(events.getFielderID()));
        else if (events.getOutType() == 2) {

            String[] arrSplit = events.getFielderID().split(", ");
            for (int i = 0; i < arrSplit.length; i++) {

                arrayFielder.put(arrSplit[i]);
            }
        }
        Log.d("fielderids", "setEventJSON, arrayFielder : " + arrayFielder);

        /*else
            arrayFielder.put();*/





        /*else if (ballType == 3 && outType == 10)
            wk = wicket + 1;*/

        if ((events.getBallType() == 3) && (events.getOutType() != 10))//ballType == 3 && outType != 10)
            wk = events.getWicket();//wicket;
        else
            wk = events.getWicket() + 1;//wicket + 1;

        Log.d("Partnership", "setEventJSON : newPartnership : " + newPartnership);
        Log.d("Partnership", "setEventJSON : wicket : " + wicket);
        Log.d("Partnership", "setEventJSON : wk : " + wk);


        //commented on 18/05/2020
        /*RealmResults<Partnership> results = realm.where(Partnership.class).
                equalTo("matchid", events.getMatchid()).//matchid).
                equalTo("innings", events.getInnings()).//currentInnings).
                equalTo("wicket", wk).findAll();

        Log.d("Partnership", "results.isEmpty : " + results.isEmpty());*/

        JSONObject jsonFOW = new JSONObject();
        /*if (results.isEmpty()) {      //commented on 18/05/2020
            Log.d("Partnership", "results: " + results);
            try {
                jsonFOW.put("wicketno", wk);
                jsonFOW.put("partnershipsequence", 1);
                jsonFOW.put("partnershipruns", 0);
                jsonFOW.put("partnershipballs", 1);
                jsonFOW.put("partnershipover", Float.parseFloat(
                        new DecimalFormat("###.#").format(0)));
//                jsonFOW.put("player1id", 0);
//                jsonFOW.put("player2id", 0);
                if (strID > 0)
                    jsonFOW.put("player1id", strID);
                else
                    jsonFOW.put("player1id", nstrID);
                jsonFOW.put("player2id", 1);
                jsonFOW.put("dismissedplayerid", 0);//-1);
                jsonFOW.put("player1contributedruns", 0);
                jsonFOW.put("player1contributedballs", 0);
                jsonFOW.put("player2contributedruns", 0);
                jsonFOW.put("player2contributedballs", 0);
                jsonFOW.put("partnershipbroken", "no");
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }
        else {
            for (Partnership ps : results)
                Log.d("Partnership", "setEventJSON 111 : " + ps);
            Partnership partnership = results.last();
            Log.d("Partnership", "setEventJSON : " + partnership);*/
        try {
//                if (partnership != null) {        //commented on 18/05/2020
            jsonFOW.put("wicketno", events.getP_wicket_no());//partnership.getWicket());
            jsonFOW.put("partnershipsequence", events.getP_sequence_no());//partnership.getPartnershipSequence());
            jsonFOW.put("partnershipruns", events.getP_run());//partnership.getPartnershipRuns());
                    /*if (events.getP_ball() == 0)
                        jsonFOW.put("partnershipballs", 1);//partnership.getPartnershipBalls());
                    else*/
            jsonFOW.put("partnershipballs", events.getP_ball());//partnership.getPartnershipBalls());
//                    jsonFOW.put("partnershipover", Float.parseFloat(
//                            new DecimalFormat("###.#").format(events.getP_over())));//partnership.getPartnershipOver())));
            jsonFOW.put("partnershipover", events.getP_over());//partnership.getPartnershipOver())));
            jsonFOW.put("player1id", events.getP_p1Id());//partnership.getPlayer1ID());
            jsonFOW.put("player2id", events.getP_p2Id());//partnership.getPlayer2ID());
            jsonFOW.put("dismissedplayerid", events.getP_disId());//partnership.getDismissedPlayerID());
            jsonFOW.put("player1contributedruns", events.getP_p1cr());//partnership.getPlayer1ContributionRuns());
                    /*if (events.getP_p1cb() == 0)
                        jsonFOW.put("player1contributedballs", 1);//partnership.getPlayer1ContributionBalls());
                    else*/
            jsonFOW.put("player1contributedballs", events.getP_p1cb());//partnership.getPlayer1ContributionBalls());
            jsonFOW.put("player2contributedruns", events.getP_p2cr());//partnership.getPlayer2ContributionRuns());
            jsonFOW.put("player2contributedballs", events.getP_p2cb());//partnership.getPlayer2ContributionBalls());

            if (events.getBallType() != 3) {
                jsonFOW.put("partnershipbroken", "no");
            } else {
                if (events.getOutType() == 10)
                    jsonFOW.put("partnershipbroken", "no");
                else if (events.getOutType() != 10)
                    jsonFOW.put("partnershipbroken", "yes");
            }
//                }     //commented on 18/05/2020

                /*else {
                    jsonFOW.put("wicketno", 0);

                    jsonFOW.put("partnershipruns", 0);
                    jsonFOW.put("partnershipballs", 0);
                    jsonFOW.put("partnershipover", Float.parseFloat(
                            new DecimalFormat("###.#").format(0)));
                    jsonFOW.put("player1id", 0);
                    jsonFOW.put("player2id", 0);
                    jsonFOW.put("dismissedplayerid", -1);
                    jsonFOW.put("player1contributedruns", 0);
                    jsonFOW.put("player1contributedballs", 0);
                    jsonFOW.put("player2contributedruns", 0);
                    jsonFOW.put("player2contributedballs", 0);
                    jsonFOW.put("partnershipbroken", "yes");
                }*/
        } catch (JSONException e) {
            e.printStackTrace();
        }
//        }     //commented on 18/05/2020


        //adding session details
        JSONObject jsonSession = new JSONObject();
        try {
//            if (events.getBallType() == 13) {
            if (events.getSessionId() == 7 || events.getSessionId() == 9 || events.getSessionId() == 11)
                jsonSession.put("type", "end");

            else if (events.getSessionId() == 8 || events.getSessionId() == 10 ||
                    events.getSessionId() == 12 || events.getSessionId() == 6)
                jsonSession.put("type", "start");

            if (events.getSessionId() == 7 || events.getSessionId() == 12 || events.getSessionId() == 6)
                jsonSession.put("number", 1);
            else if (events.getSessionId() == 8 || events.getSessionId() == 9)
                jsonSession.put("number", 2);
            else if (events.getSessionId() == 10 || events.getSessionId() == 11)
                jsonSession.put("number", 3);

//                if (events.isInning_started())
//                    jsonSession.put("inningsstarted", events.isInning_started());//"yes");
//                else
//                    jsonSession.put("inningsstarted", "no");
/*           }

            else {

                jsonSession.put("type", "");
                jsonSession.put("number", 0);
//                jsonSession.put("inningsstarted", events.isInning_started());
//                if (events.isInning_started())
//                    jsonSession.put("inningsstarted", "yes");
//                else
//                    jsonSession.put("inningsstarted", "no");
            }*/
        } catch (JSONException e) {
            e.printStackTrace();
        }


        //adding interval details
        JSONObject jsonInterval = new JSONObject();
        try {
            if (events.getBallType() == 12)
                jsonInterval.put("id", events.getIntervalId());
            else
                jsonInterval.put("id", 0);
        } catch (JSONException e) {
            e.printStackTrace();
        }

        // for substituion and concussion
        JSONObject jsonSubstitution = new JSONObject();
        if (events.getBallType() == 18 || events.getBallType() == 19) {
            /*Substitution substitution = realm.where(Substitution.class).
                    equalTo("matchid", events.getMatchid()).
                    equalTo("innings", events.getInnings()).
                    equalTo("subID", events.getSubstitutionID()).findFirst();

            if (substitution != null) {*/
            try {

                jsonSubstitution.put("team", events.getSub_team());//substitution.getTeam());
//                    jsonSubstitution.put("innings", substitution.getInnings());
                jsonSubstitution.put("playerout_id", events.getSub_playerout_id());//substitution.getPlayer_OUT_ID());
                jsonSubstitution.put("playerin_id", events.getSub_playerin_id());//substitution.getPlayer_IN_ID());
//                    jsonSubstitution.put("playerout", substitution.getPlayer_OUT_ID());
//                    jsonSubstitution.put("playerin", substitution.getPlayer_IN_ID());

            } catch (JSONException e) {
                e.printStackTrace();
            }
//            }
        }


        JSONObject jsonPowerplay = new JSONObject();
        // commented on 18/05/2020
        /*if (events.getBallType() == 21 || events.getBallType() == 22 || events.getBallType() == 23) {
            Power power = realm.where(Power.class).
                    equalTo("matchid", events.getMatchid()).
                    equalTo("innings", events.getInnings()).
                    equalTo("id", events.getPower_id()).findFirst();

            if (power != null) {*/
        try {
            jsonPowerplay.put("start_over", events.getPower_start_over());//power.getStart());
            jsonPowerplay.put("end_over", events.getPower_end_over());//power.getEnd());
            jsonPowerplay.put("type", null);//power.getType());
//                    jsonPowerplay.put("innings", power.getInnings());
            jsonPowerplay.put("sequence", events.getPower_sequence());//power.getCount());

        } catch (JSONException e) {
            e.printStackTrace();
        }
            /*}     // commented on 18/05/2020
        }*/

        // added on 18/03/2021
        JSONObject jsonChangeWk = new JSONObject();
        try {
            jsonChangeWk.put("wkid", events.getWkID());
        } catch (JSONException e) {
            e.printStackTrace();
        }

        JSONObject jsonChangeSubWk = new JSONObject();
        try {
            jsonChangeSubWk.put("wkid", events.getWkID());
        } catch (JSONException e) {
            e.printStackTrace();
        }

        // ========= till here


        // adding event details

        JSONObject jsonEvent = new JSONObject();
        try {
            jsonEvent.put("eventid", events.getEventID());
            jsonEvent.put("superover", events.isSUPER_OVER());
            if (events.isSUPER_OVER()) {
                if (events.getInnings() == 99)
                    jsonEvent.put("innings", 1);
                else if (events.getInnings() == 100)
                    jsonEvent.put("innings", 2);
            } else
                jsonEvent.put("innings", events.getInnings());
            jsonEvent.put("battingteam", events.getBattingTeamNo());
            jsonEvent.put("over", (int) events.getOvers());
            jsonEvent.put("ball", events.getCurrentOverBalls());
            jsonEvent.put("strikerid", events.getStrikerID());
            jsonEvent.put("nonstrikerid", events.getNonStrikerID());
            jsonEvent.put("bowlerid", events.getBowlerID());
            jsonEvent.put("balltype", events.getBallType());
            /*if (events.getFielderID() != null)//.matches(""))
                jsonEvent.put("fielderids", events.getFielderID());
            else
                jsonEvent.put("fielderids", null);*/

            if (events.getDismissedPlayerID() <= 0)
                jsonEvent.put("dismissedbatsmanid", 0);
            else
                jsonEvent.put("dismissedbatsmanid", events.getDismissedPlayerID());
            jsonEvent.put("disnewbatsmanid", events.getDisNewBatsmanID());
            jsonEvent.put("outtype", events.getOutType());

            if (arrayFielder.length() == 0) {
                Log.d("fielderids", "setEventJSON 2, arrayFielder : " + arrayFielder);
                Log.d("fielderids", "setEventJSON 2, arrayFielder.length() : " + arrayFielder.length());
                jsonEvent.put("fielderids", 0);
            } else if (arrayFielder.length() > 0) {
                jsonEvent.put("fielderids", arrayFielder);
            }

            jsonEvent.put("extratype", events.getExtraType());
            jsonEvent.put("freehit", events.isFreeHit());
            if (events.getPenaltyType() == 1 || events.getPenaltyType() == 2)
                jsonEvent.put("penaltybool", 1);
            else
                jsonEvent.put("penaltybool", 0);

            jsonEvent.put("penaltytype", events.getPenaltyType());
            jsonEvent.put("runs", events.getCurrentRun());
            jsonEvent.put("extras", events.getExtraRuns());
            if (events.getPenaltyType() > 0)
                jsonEvent.put("penalty", events.getPenaltyRuns());
            else
                jsonEvent.put("penalty", 0);

            if (events.getCommentary() != null)//.matches(""))
                jsonEvent.put("commentary", events.getCommentary());
            else
                jsonEvent.put("commentary", null);

            jsonEvent.put("strokedirection", events.getStrokeDirection());

            jsonEvent.put("bowler", jsonbowler);
            jsonEvent.put("batsman", jsonbatsman);
            jsonEvent.put("inningssummary", jsonSummery);

            if (events.getBallType() == 4 || events.getBallType() == 5)
                jsonEvent.put("oversummary", jsonOverSummary);

//            if (events.getBallType() == 3 && events.getDismissedPlayerID() > -1)
            jsonEvent.put("fallofwickets", jsonFOW);
            jsonEvent.put("session", jsonSession);
            jsonEvent.put("interval", jsonInterval);

//            if (events.getBallType() == 18 || events.getBallType() == 19) {
            if (events.getBallType() == 18)
                jsonEvent.put("substitution", jsonSubstitution);
            else if (events.getBallType() == 19)
                jsonEvent.put("concussion", jsonSubstitution);

            else if (events.getBallType() == 21 || events.getBallType() == 22 || events.getBallType() == 23)
                jsonEvent.put("powerplay", jsonPowerplay);

            else if (events.getBallType() == 20) {
                jsonEvent.put("rainruleused", "y");
                jsonEvent.put("reducedovers", events.getReducedOver());//match.getOver());
                jsonEvent.put("rainrulemethod", events.getAppliedRainRule());
//                if (events.getInnings() == 2) {
                jsonEvent.put("revisedtarget", events.getRevisedTarget());
//                    jsonEvent.put("rainrulemethod", events.getAppliedRainRule());
//                }

            }

            // Added on 18/03/2021
            else if (events.getBallType() == 24) {
                jsonEvent.put("changewk", jsonChangeWk);
            } else if (events.getBallType() == 25) {
                jsonEvent.put("changesubwk", jsonChangeSubWk);
            }

        } catch (JSONException e) {
            e.printStackTrace();
        }

        Log.e("jsonEventArray", "setEventJSON, jsonEvent : " + jsonEvent);

        return jsonEvent;//jsonCurrentEvent;
    }

    private boolean isNetworkAvailable() {
        ConnectivityManager connectivityManager
                = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);
        NetworkInfo activeNetworkInfo = connectivityManager.getActiveNetworkInfo();
        Log.d("internet", "scoring, activeNetworkInfo : " + activeNetworkInfo);
        if (activeNetworkInfo != null)
            Log.d("internet", "scoring, activeNetworkInfo.isConnected() : " + activeNetworkInfo.isConnected());
        NetworkInfo wifiInfo = connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
        Log.d("internet", "scoring, wifiInfo : " + wifiInfo);
        if (wifiInfo != null)
            Log.d("internet", "scoring, wifiInfo.isConnected() : " + wifiInfo.isConnected());
        return ((activeNetworkInfo != null && activeNetworkInfo.isConnected()) || (wifiInfo != null && wifiInfo.isConnected()));
    }





   /* @Override
    public void onSaveInstanceState(Bundle savedInstanceState) {
        super.onSaveInstanceState(savedInstanceState);
        // Save UI state changes to the savedInstanceState.
        // This bundle will be passed to onCreate if the process is
        // killed and restarted.
//        savedInstanceState.putBoolean("osi_", true);
//        savedInstanceState.putDouble("myDouble", 1.9);
//        savedInstanceState.putInt("MyInt", 1);

        savedInstanceState.putString("osi_teamA", teamA);
        savedInstanceState.putString("osi_teamA", teamA);
        savedInstanceState.putString("osi_teamB", teamB);
        savedInstanceState.putString("osi_battingTeam", battingTeam);
        savedInstanceState.putString("osi_fieldingTeam", fieldingTeam);
        savedInstanceState.putInt("osi_batTNo", battingTeamNo);
        savedInstanceState.putInt("osi_fieldTNo", fieldingTeamNo);
        savedInstanceState.putInt("osi_currentInnings", currentInnings);
        savedInstanceState.putString("osi_inningsType", innings);
        savedInstanceState.putString("osi_matchType", matchtype);
        savedInstanceState.putInt("osi_totalOver", totalOver);
        savedInstanceState.putInt("osi_ballsPerOver", ballsPerOver);
        savedInstanceState.putInt("osi_remainingRuns", remainingRuns);
        savedInstanceState.putInt("osi_remainingBalls", remainingBalls);
        savedInstanceState.putInt("osi_currentRuns", currentRuns);
        savedInstanceState.putFloat("osi_currentOver", currentOver);updatedIDs = response.getJSONArray("updatedIDs");
        savedInstanceState.putInt("osi_currentBalls", currentBalls);
        savedInstanceState.putInt("osi_currentWicket", wicket);
        savedInstanceState.putString("osi_player1", player1);
        savedInstanceState.putString("osi_player2", player2);
        savedInstanceState.putString("osi_striker", striker);
        savedInstanceState.putString("osi_nstriker", nonStriker);
        savedInstanceState.putInt("osi_player1Runs", player1Runs);
        savedInstanceState.putInt("osi_player2Runs", player2Runs);
        savedInstanceState.putInt("osi_player1Balls", player1Balls);
        savedInstanceState.putInt("osi_player2Balls", player2Balls);
        savedInstanceState.putString("osi_bowler", bowler);
        savedInstanceState.putFloat("osi_bowlerOver", bowlerOver);

        savedInstanceState.putInt("osi_bowlerMO", bowlerMO);
        savedInstanceState.putInt("osi_bowlerRuns", bwRun);
        savedInstanceState.putInt("osi_bowlerWicket", bowlerWicket);

        savedInstanceState.putInt("osi_currentExtras", currentExtras);
        savedInstanceState.putInt("osi_totalExtras", totalExtras);
        savedInstanceState.putInt("ins_nextEventID", eventId + 1);

        // etc.
    }




    @Override
    public void onRestoreInstanceState(Bundle savedInstanceState) {
        super.onRestoreInstanceState(savedInstanceState);
        // Restore UI state from the savedInstanceState.
        // This bundle has also been passed to onCreate.
//        boolean myBoolean = savedInstanceState.getBoolean("MyBoolean");
//        double myDouble = savedInstanceState.getDouble("myDouble");
//        int myInt = savedInstanceState.getInt("MyInt");
//        String myString = savedInstanceState.getString("MyString");

        teamA = savedInstanceState.getString("osi_teamA", null);
        teamB = savedInstanceState.getString("osi_teamB", null);
        battingTeam = savedInstanceState.getString("osi_battingTeam", null);
        fieldingTeam = savedInstanceState.getString("osi_fieldingTeam", null);
        battingTeamNo = savedInstanceState.getInt("osi_batTNo", 0);
        fieldingTeamNo = savedInstanceState.getInt("osi_fieldTNo", 0);
        currentInnings = savedInstanceState.getInt("osi_cInng", 0);
        innings = savedInstanceState.getString("osi_inningsType", null);
        matchtype = savedInstanceState.getString("osi_matchType", null);
        currentOver = savedInstanceState.getFloat("osi_currentOver", 0.0f);
//        ballsPerOver =
        remainingRuns = savedInstanceState.getInt("osi_remainingRuns", 0);
        remainingBalls = savedInstanceState.getInt("osi_remainingBalls", 0);
        currentRuns = savedInstanceState.getInt("osi_currentRuns", 0);
        currentOver = savedInstanceState.getFloat("osi_currentOver", 0.0f);
        currentBalls = savedInstanceState.getInt("osi_remainingBalls", 0);
        wicket = savedInstanceState.getInt("osi_currentWicket", 0);
        player1 = savedInstanceState.getString("osi_player1", null);
        player2 = savedInstanceState.getString("osi_player2", null);

        striker = savedInstanceState.getString("osi_striker", null);
        nonStriker = savedInstanceState.getString("osi_nstriker", null);

        totalRuns = savedInstanceState.getInt("osi_totalRuns", 0);

        player1Runs = savedInstanceState.getInt("osi_player1Runs", 0);
        player2Runs = savedInstanceState.getInt("osi_player2Runs", 0);
        player1Balls = savedInstanceState.getInt("osi_player1Balls", 0);
        player2Balls = savedInstanceState.getInt("osi_player2Balls", 0);
        bowler = savedInstanceState.getString("osi_bowler", null);
        bowlerOver = savedInstanceState.getFloat("osi_bowlerOver", 0.0f);
        bowlerMO = savedInstanceState.getInt("osi_bowlerMO", 0);
        bwRun = savedInstanceState.getInt("osi_bowlerRuns", 0);
        bowlerWicket = savedInstanceState.getInt("osi_bowlerWicket", 0);
        currentExtras = savedInstanceState.getInt("osi_currentExtras", 0);
        totalExtras = savedInstanceState.getInt("osi_totalExtras", 0);
        eventId = savedInstanceState.getInt("osi_nextEventID", 0);


        setDisplay();
    }*/


    @Override
    protected void onPause() {

        super.onPause();
//        Toast.makeText(getApplicationContext(), "onPause called", Toast.LENGTH_LONG).show();
        Log.d("OnPause", "OnPause called");
        Log.d("OnPause", " matchid : " + matchid);
//        stop = true;
        editor = sharedPreferences.edit();


        editor.putInt("op_matchid", matchid);
        editor.putString("op_matchID", matchID);
        editor.putString("sp_status", status);
        editor.putBoolean("sp_just_started", just_started);
        editor.putInt("sp_total_innings", totalInnings);
        editor.putInt("sp_current_innings", currentInnings);

        editor.apply();

        updateMatch(matchid, endOfInnings);

    }


    private void updateMatch(int matchid, boolean endOfInnings) {

        Log.d("updateMatch", "updateMatch,endOfInnings : " + endOfInnings);

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Match match = realm.where(Match.class).
                                equalTo("matchid", matchid).findFirst();
//                        match.setAddPlayers(false);
//                        match.setCaptain(false);
//                        match.setToss(false);
                        match.setOpeners(false);
                        match.setScoring(true);
                        match.setEndOfInnings(endOfInnings);
//                        match.setScoreCard(false);
//                        match.setPulledMatch(false);
//                        match.setSelectAXI(false);
//                        match.setSelectBXI(false);
                        match.setJustStarted(just_started);
                        match.setPlayingInnings(currentInnings);
                        if (endOfInnings) {
                            match.setScoreCard(true);
                            match.setScoring(false);
                            if (currentInnings == 1)
                                match.setInnings1Runs(currentRuns);
                            else if (currentInnings == 2)
                                match.setInnings2Runs(currentRuns);
                            else if (currentInnings == 3)
                                match.setInnings3Runs(currentRuns);
                            else if (currentInnings == 4)
                                match.setInnings4Runs(currentRuns);
                            else if (currentInnings == 99)
                                match.setSuper_over_innings1runs(currentRuns);
                            else if (currentInnings == 100)
                                match.setSuper_over_innings2runs(currentRuns);
                        }
                        realm.copyToRealmOrUpdate(match);

                        Log.d("updateMatch", " match : " + match);
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("scoring", "onclick, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


    @Override
    protected void onStop() {

        super.onStop();
//        Toast.makeText(getApplicationContext(), "onStop called", Toast.LENGTH_LONG).show();
        Log.d("Scoring", "onStop called");
        Log.d("Scoring", " matchid : " + matchid);

        editor = sharedPreferences.edit();
        editor.putInt("op_matchid", matchid);
        editor.putString("op_matchID", matchID);


        editor.apply();

    }


//    @Override
//    protected void onRestart() {
//
//        super.onResume();
//        Toast.makeText(getApplicationContext(), "onResumed called", Toast.LENGTH_LONG).show();
//        Log.d("OnResume", "OnResume called");
//        Log.d("OnResume", " matchid : "+matchid);
//        Log.d("OnResume", "out "+out);
//        Log.d("OnResume", "extras "+extras);
//
//
////        if (out || extras) {
////            Log.d("onResume", "out : "+out);
////            Log.d("onResume", "extras : "+extras);
//        sharedPreferences = PreferenceManager.getDefaultSharedPreferences(this);
//
//        teamA = sharedPreferences.getString("op_teamA", null);
//        teamB = sharedPreferences.getString("op_teamB", null);
//        battingTeam = sharedPreferences.getString("op_battingTeam", null);
//        fieldingTeam = sharedPreferences.getString("op_fieldingTeam", null);
//        battingTeamNo = sharedPreferences.getInt("op_batTNo", 0);
//        fieldingTeamNo = sharedPreferences.getInt("op_fieldTNo", 0);
//        currentInnings = sharedPreferences.getInt("op_cInng", 0);
//        innings = sharedPreferences.getString("op_inningsType", null);
//        matchtype = sharedPreferences.getString("op_matchType", null);
//        currentOver = sharedPreferences.getFloat("op_currentOver", 0.0f);
////        ballsPerOver =
//        remainingRuns = sharedPreferences.getInt("op_remainingRuns", 0);
//        remainingBalls = sharedPreferences.getInt("op_remainingBalls", 0);
//        currentRuns = sharedPreferences.getInt("op_currentRuns", 0);
//        currentOver = sharedPreferences.getFloat("op_currentOver", 0.0f);
//        currentBalls = sharedPreferences.getInt("op_remainingBalls", 0);
//        wicket = sharedPreferences.getInt("op_currentWicket", 0);
//        player1 = sharedPreferences.getString("op_player1", null);
//        player2 = sharedPreferences.getString("op_player2", null);
//
//        striker = sharedPreferences.getString("op_striker", null);
//        nonStriker = sharedPreferences.getString("op_nstriker", null);
//
//        totalRuns = sharedPreferences.getInt("op_totalRuns", 0);
//
//        player1Runs = sharedPreferences.getInt("op_player1Runs", 0);
//        player2Runs = sharedPreferences.getInt("op_player2Runs", 0);
//        player1Balls = sharedPreferences.getInt("op_player1Balls", 0);
//        player2Balls = sharedPreferences.getInt("op_player2Balls", 0);
//        bowler = sharedPreferences.getString("op_bowler", null);
//        bowlerOver = sharedPreferences.getFloat("op_bowlerOver", 0.0f);
//        bowlerMO = sharedPreferences.getInt("op_bowlerMO", 0);
//        bwRun = sharedPreferences.getInt("op_bowlerRuns", 0);
//        bowlerWicket = sharedPreferences.getInt("op_bowlerWicket", 0);
//        currentExtras = sharedPreferences.getInt("op_currentExtras", 0);
//        totalExtras = sharedPreferences.getInt("op_totalExtras", 0);
//        eventId = sharedPreferences.getInt("op_nextEventID", 0);
//
//
//        setDisplay();
////        }
//
////        if (out)
////            setOut();
////
////        if (extras)
////            setExtra();
//
//    }


    public void setCommentry() {

//        Log.d("setCommentry", " matchid :"+matchid);
//        Log.d("setCommentry", " matchID :"+matchID);

        comBuilder = new AlertDialog.Builder(ScoringActivity.this);
        comBuilder.setIcon(R.drawable.ball);
        comBuilder.setCancelable(false);
        comBuilder.setTitle("Enter the commentary");

        final EditText input = new EditText(this);

        input.setInputType(InputType.TYPE_CLASS_TEXT);
        comBuilder.setView(input);
//        Log.d("Test", "inside setCommentry()");
        comBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {

            //            @Override
            public void onClick(DialogInterface dialog, int which) {

                if (input.getText().toString().equals(null)) {
                    Toast.makeText(getApplicationContext(),
                            "Please enter the Run", Toast.LENGTH_SHORT).show();
                } else {
                    commentary = input.getText().toString();
                    Log.d("Test", "BuilderText : " + commentary);


                    if (!commentary.matches("")) {
                        tvCommentry.setText(commentary);
                        Log.d("so_inninngs1Runs", "setCommentry20 , : " + so_inninngs1Runs);
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                                wicket, ball, 0, preInningsRuns, remainingRuns, remainingBalls,
                                remainingOver, leadingRuns, innings1Runs, innings2Runs, innings3Runs,
                                innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                                strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls,
                                bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket, preBowlerID,
                                preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket,
                                lastPreBowlerID, 0, -1, -1, 0, -1,
                                0, null, 0, 0, 0,
                                0, false, 0, commentary, -1,
                                mo, maiden, modified, udisplay, tco, tbo, tpbo, intervalID, sessionType,
                                sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay,
                                SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, declared, freeHit,
                                false, inning_started, 0, 0,
                                0, null, pre_out, callBowlerAlert, wk_id,
                                keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                tea_flag, dinner_flag);

                        tvCommentry.setText("");
                    } else {
                        Log.d("Test", "buildertext = null");
                    }

                }
            }
        });

        comBuilder.setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.cancel();
            }
        });

        AlertDialog alert = comBuilder.create();
        alert.show();

    }


    void alert() {

        AlertDialog.Builder builder = new AlertDialog.Builder(ScoringActivity.this);
        builder.setIcon(R.drawable.ball);
        builder.setCancelable(false);
        builder.setTitle("Can not continue the match");
        builder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            //            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
            }
        });

        AlertDialog alert = builder.create();
        alert.show();
    }


    void playerOUT() {

        boolean temp_out = true;
        int temp_total = player_count;
        commentary = "";
        wk_flag = false;


        Log.d("newBatsman", "playerOUT newBatsman :" + newBatsman);
//        Log.d("playerOUT", " matchid :"+matchid);
//        Log.d("playerOUT", " matchID :"+matchID);

        LayoutInflater layoutInflater = (LayoutInflater)
                ScoringActivity.this.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
        View customViewOUT = layoutInflater.inflate(R.layout.out, null);

        btn_out_back = customViewOUT.findViewById(R.id.out_back);
        btn_out_Type = customViewOUT.findViewById(R.id.btn_outtype);
        btn_out_batsman = customViewOUT.findViewById(R.id.btn_batsman);
        btn_out_fielder = customViewOUT.findViewById(R.id.btn_fielder);
//        btn_out_crossed = customViewOUT.findViewById(R.id.btn_crossed);
        btn_out_extra = customViewOUT.findViewById(R.id.btn_extra);
        btn_out_extra_type = customViewOUT.findViewById(R.id.btn_out_extra_type);
//        btn_out_penalty = customViewOUT.findViewById(R.id.btn_out_penalty);
//        btn_out_change_penalty_run = customViewOUT.findViewById(R.id.btn_out_change_penalty_run);
//        btn_out_next_striker = customViewOUT.findViewById(R.id.btn_next_striker);
        btn_out_com = customViewOUT.findViewById(R.id.btn_out_com);
        btn_out_next = customViewOUT.findViewById(R.id.bt_out_next);

        tv_outType = customViewOUT.findViewById(R.id.txt_outtype);
        tv_outBatsman = customViewOUT.findViewById(R.id.txt_batsman);
        tv_fielder = customViewOUT.findViewById(R.id.txt_fielder);
//        tv_crossed = customViewOUT.findViewById(R.id.txt_crossed);
        tv_extraType = customViewOUT.findViewById(R.id.txt_out_extra_Type);
//        tv_out_penalty = customViewOUT.findViewById(R.id.txt_out_penalty);
//        tv_nextStriker = customViewOUT.findViewById(R.id.txt_next_striker);
        tv_com = customViewOUT.findViewById(R.id.txt_out_com);
//        tv_extra = customViewOUT.findViewById(R.id.txt_out_extra_Type);
        et_out_run = customViewOUT.findViewById(R.id.edit_out_run);
        et_runsOffBat_out = customViewOUT.findViewById(R.id.edit_run_off_bat_out);
        et_extra_run_out = customViewOUT.findViewById(R.id.edit_extra_run_out);

        rb_crossed = customViewOUT.findViewById(R.id.rb_crossed);
        rb_not_crossed = customViewOUT.findViewById(R.id.rb_not_crossed);

        ll_batsman = customViewOUT.findViewById(R.id.layout_batsman);
        ll_fielder = customViewOUT.findViewById(R.id.layout_fielder);
        ll_crossed = customViewOUT.findViewById(R.id.layout_crossed);
        ll_extra = customViewOUT.findViewById(R.id.layout_extra); // layout which contains Extra button and out_run edittext
        ll_extras = customViewOUT.findViewById(R.id.layout_extras); // layout which containd extratypes and penalty
        ll_extra_runs = customViewOUT.findViewById(R.id.layout_extra_run);
//        ll_penalty = customViewOUT.findViewById(R.id.layout_penalty);
        ll_ballcount = customViewOUT.findViewById(R.id.layout_out_ballcount);

        cb_ball_count = customViewOUT.findViewById(R.id.cb_out_ballcount);

        out_run = 0;

//        crossed = false;
//        ll_nextStriker = customViewOUT.findViewById(R.id.layout_next_striker);

//        tv_nextStriker.setVisibility(View.GONE);

//        if (allOUT)
//            ll_nextStriker.setVisibility(View.GONE);


        //instantiate OUT popup window
        popupOUT = new PopupWindow(customViewOUT, LinearLayout.LayoutParams.MATCH_PARENT,
                LinearLayout.LayoutParams.MATCH_PARENT);
        popupOUT.setFocusable(true);
        popupOUT.setOutsideTouchable(isRestricted());
        popupOUT.update();


        //display the OUT popup window
        popupOUT.showAtLocation(linearLayout, Gravity.CENTER, 500, 500);


        Log.e("playerOUT", " out : " + out);

        RealmResults<Player> player_result = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", fieldingTeamNo).
                equalTo("retired", false).findAll();
        if (player_result.isEmpty())
            temp_total = player_count;
        else
            temp_total = player_result.size();
        substitute = false;
        fielderss = new String[temp_total];
        checkedFielders = new boolean[temp_total];


        setVisibity();
        outType = -1;
        ballType = -1;
        dismissedPlayer = "";
        single = false;
        multi = false;
        retired = false;
        ve_flag = 0;

//        tv_outType.setVisibility(View.GONE);

        /*if (rb_not_crossed.isSelected()){
            crossed = false;
            Log.d("scoring", "playerOUT, rb_not_crossed crossed : "+crossed);
        }

        else if (rb_crossed.isSelected()){
            crossed = true;
            Log.d("scoring", "playerOUT, rb_crossed crossed : "+crossed);
            if (outType == 2)
                btn_out_batsman.setVisibility(View.VISIBLE);

            else if (outType == 3 || outType == 8) {
                ll_extra.setVisibility(View.VISIBLE);
            }
        }*/


        btn_out_back.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                out = false;
//                confirm_out = false;
                outType = -1;
                ballType = -1;
                dismissedPlayer = "";
                single = false;
                multi = false;
                retired = false;
                popupOUT.dismiss();

                if (ball >= ballsPerOver)
                    callEndOfOverAlert();
            }
        });


        btn_out_Type.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                selectOutType();
            }
        });


        btn_out_batsman.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                selectDismissedPlayer();
            }
        });


        btn_out_fielder.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                selectFielder();
            }
        });


        /*btn_out_crossed.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                checkStrikerCrossed();
            }
        });*/

        btn_out_extra.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                checkViewExtra();
            }
        });


        btn_out_extra_type.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                checkOutExtraType();
            }
        });


//        btn_out_penalty.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                setPenalty();
//            }
//        });


//        btn_out_change_penalty_run.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                changePenaltyRun();
//            }
//        });

//        btn_out_next_striker.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//
//                changeBatsman(-1);
//            }
//        });


        btn_out_com.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                editOutCommentary();
            }
        });


//        cb_ball_count.setOnCheckedChangeListener((CompoundButton.OnCheckedChangeListener) this);
        cb_ball_count.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                CheckBox checkBox = (CheckBox) view;
                if (checkBox.isChecked())
                    out_ball_not_count = true;
                else
                    out_ball_not_count = false;
                /*if (cb_ball_count.isChecked())
                    out_ball_not_count = true;
                else
                    out_ball_not_count = false;*/
                Log.e("Scoring", "playerOUT, out_ball_not_count : " + out_ball_not_count);
            }
        });


        btn_out_next.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

//                displayProgress();

                Log.e("Scoring", "playerOUT, btn_out_next out_ball_not_count : " + out_ball_not_count);
//                Log.e("Scoring", "playerOUT, btn_out_next striker : "+striker);
//                Log.e("Scoring", "playerOUT, btn_out_next strID : "+strID);
//                Log.e("Scoring", "playerOUT, btn_out_next strikerRuns : "+strikerRuns);
//                Log.e("Scoring", "playerOUT, btn_out_next strikerBalls : "+strikerBalls);
//                Log.e("Scoring", "playerOUT, btn_out_next strikerF4s : "+strikerF4s);
//                Log.e("Scoring", "playerOUT, btn_out_next strikerS6s : "+strikerS6s);
//
//                Log.e("Scoring", "playerOUT, btn_out_next nonStriker : "+nonStriker);
//                Log.e("Scoring", "playerOUT, btn_out_next nstrID : "+nstrID);
//                Log.e("Scoring", "playerOUT, btn_out_next nonStrikerRuns : "+nonStrikerRuns);
//                Log.e("Scoring", "playerOUT, btn_out_next nonStrikerBalls : "+nonStrikerBalls);
//                Log.e("Scoring", "playerOUT, btn_out_next nonStrikerF4s : "+nonStrikerF4s);
//                Log.e("Scoring", "playerOUT, btn_out_next nonStrikerS6s : "+nonStrikerS6s);
//
//                Log.e("Scoring", "outToScoring, btn_out_next player1 : "+player1);
//                Log.e("Scoring", "outToScoring, btn_out_next player1ID : "+player1ID);
//                Log.e("Scoring", "outToScoring, btn_out_next player1Runs : "+player1Runs);
//                Log.e("Scoring", "outToScoring, btn_out_next player1Balls : "+player1Balls);
//                Log.e("Scoring", "outToScoring, btn_out_next player1F4s : "+player1F4s);
//                Log.e("Scoring", "outToScoring, btn_out_next player1S6s : "+player1S6s);
//
//                Log.e("Scoring", "outToScoring, btn_out_nextp player2 : "+player2);
//                Log.e("Scoring", "outToScoring, btn_out_next player2ID : "+player2ID);
//                Log.e("Scoring", "outToScoring, btn_out_next player2Runs : "+player2Runs);
//                Log.e("Scoring", "outToScoring, btn_out_next player2Balls : "+player2Balls);
//                Log.e("Scoring", "outToScoring, btn_out_next player2F4s : "+player2F4s);
//                Log.e("Scoring", "outToScoring, btn_out_nextp player2S6s : "+player2S6s);


                Log.e("Scoring", "outToScoring, btn_out_next dismissedPlayer : " + dismissedPlayer);
                Log.e("Scoring", "outToScoring, btn_out_next outType : " + outType + ", ectraType : " + extraType);
                Log.e("Scoring", "outToScoring, btn_out_next fielderPlayerID : " + fielderPlayerID);
                Log.e("Scoring", "outToScoring, btn_out_next fielders : " + fielders);
                Log.e("Scoring", "outToScoring, btn_out_next fielders : " + fielders.length);

                if ((dismissedPlayer == null) || (dismissedPlayer.matches("")) || (outType == -1)) {
//                    outAlert(1);
                    outAlert(1, "Please select dismissed player");
                } else if (!message.matches(""))
                    displayError(message);


                else {

                    Log.d("b4 setExtra", "2 ballType : " + ballType + ", outextras : " + outextras);
                    Log.d("b4 setExtra", "2 extras : " + extras + ",extraType : " + extraType +
                            ", extra : " + extra + ", extraRun : " + extraRun + ", runsOffBat : " + runsOffBat);
                    Log.d("b4 setExtra", "2 out : " + out + ", outType : " + outType + ", out_run : " + out_run);
                    Log.d("b4 setExtra", "2 strID : " + strID + ", strikerRuns : " + strikerRuns +
                            ", strikerBalls : " + strikerBalls);
                    Log.d("b4 setExtra", "2 nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                            ", nonStrikerBalls : " + nonStrikerBalls);
                    Log.d("b4 setExtra", "2 player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                            ", player1Balls : " + player1Balls);
                    Log.d("b4 setExtra", "2 player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                            ", player2Balls : " + player2Balls);
                    Log.d("b4 setExtra", "2 psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver);
                    Log.d("b4 setExtra", "2 ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                    Log.d("b4 setExtra", "2 ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

                    just_started = false;
                    if (status.matches("start")) {
                        status = "resume";
                        updateMatch(matchid, false);
                    }

                    if (et_out_run.isShown()) {
                        String temp = et_out_run.getText().toString();

                        if (temp.matches(""))
                            out_run = 0;
                        else
                            out_run = Integer.parseInt(temp);


                    }

                    if (et_extra_run_out.isShown()) {
                        String str = et_extra_run_out.getText().toString();
                        if (str.matches(""))
                            extraRun = 0;
                        else
                            extraRun = Integer.parseInt(str);
                        if (noBall)
                            extra = extraRun + noballRun;
                        else if (wide)
                            extra = extraRun + wideRun;
                    }

                    if (et_runsOffBat_out.isShown()) {

                        String str2 = et_runsOffBat_out.getText().toString();
                        if (str2.matches(""))
                            runsOffBat = 0;
                        else
                            runsOffBat = Integer.parseInt(str2);
                    }

                    if (/*outType != 7 && */outType != 9 && outType != 10 && outType != 11 && outType != 12) {
                        if (wide || out_ball_not_count)     // working
                            Log.d("out", "wide : " + wide);
                        else {
                            ++strikerBalls;
                            if (strID == ps1ID) {
                                ++p1CB;
                            } else if (strID == ps2ID) {
                                ++p2CB;
                            }
                        }

                    }
                    Log.d("Scoring", "btn_out_next, runs : " + runs + ", runsOffBat : " + runsOffBat);
                    strikerRuns = strikerRuns + out_run + runsOffBat;
                    if (strID == player1ID) {

                        player1Balls = strikerBalls;
                        player1Runs = strikerRuns;
                    } else if (strID == player2ID) {

                        player2Balls = strikerBalls;
                        player2Runs = strikerRuns;
                    }

                    if (strID == ps1ID) {
                        p1CR = p1CR + runsOffBat + out_run;
                    } else if (strID == ps2ID) {
                        p2CR = p2CR + runsOffBat + out_run;
                    }

                    bwRun = bwRun + out_run + runsOffBat;
                    currentRuns = currentRuns + out_run + runsOffBat;
                    psRuns = psRuns + out_run + runsOffBat;
                    leadingRuns = leadingRuns + out_run + runsOffBat;

                    if (remainingRuns > 0) {
                        remainingRuns = remainingRuns - out_run - runsOffBat;
                        tvRemainingRuns.setText(String.valueOf(remainingRuns));
                    }
//                    else if (totalInnings == 4 && leadingRuns >= 0) {
                    if (leadingRuns > remainingRuns && totalInnings == 4) {
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
                        tvRemainingRunsText.setText("Leading Runs : ");
                    }


                    Log.d("Scoring", "btn_out_next, remainingRuns : " + remainingRuns);
                    Log.d("Scoring", "btn_out_next, leadingRuns : " + leadingRuns);

//                    if (strID == player1ID) {
//                        ++player1Balls;
//                        player1Runs = runs + runsOffBat;
//                    }
//                    else if (strID == player2ID) {
//
//                        ++player2Balls;
//                        player1Runs = runs + runsOffBat;
//                    }

                    if (out_ball_not_count) // working
                        Log.d("out", "outtype : " + outType + ", out_ball_not_count : " + out_ball_not_count);

                    else {

                        if (runsOffBat == 0 && out_run == 0) {

                            if (strID == player1ID) {
                                ++player1Dots;
                                strikerDots = player1Dots;
                            }
                            if (strID == player2ID) {
                                ++player2Dots;
                                strikerDots = player2Dots;
                            }

                            if (retired || outType == 10 || outType == 12)
                                Log.d("Test", "retired");
                            else
                                ++bowlerDots;
                        }

                        if (runsOffBat == 4 || out_run == 4) {

                            if (strID == player1ID) {
                                ++player1F4s;
                                strikerF4s = player1F4s;
                            }
                            if (strID == player2ID) {
                                ++player2F4s;
                                strikerF4s = player2F4s;
                            }
                            ++bowlerF4s;
                        } else if (runsOffBat == 6 || out_run == 6) {

                            if (strID == player1ID) {
                                ++player1S6s;
                                strikerS6s = player1S6s;
                            }
                            if (strID == player2ID) {
                                ++player2S6s;
                                strikerS6s = player2S6s;
                            }
                        }
                    }


/*
                     else if (penalty) {

                         if (penaltyType == 1) {

//                savePenalty(penaltyType, penaltyRunTeam, true, battingTeamNo);
                             // didn't removed it when both undo & cancel
                             totalExtras = totalExtras + penaltyRun;

                             currentRuns = currentRuns + penaltyRun;
                             psRuns = psRuns + penaltyRun;
                             setInningsRuns(currentInnings, currentRuns);

                             if (currentInnings > 1 && currentInnings != 99) {
                                 ll_remainings.setVisibility(View.VISIBLE);
//                                        penaltyType = 1;
                                 leadingRuns = leadingRuns + penaltyRun;
                                 if (remainingRuns > 0) {

                                     remainingRuns = remainingRuns - penaltyRun;
//                                            leadingRuns = leadingRuns + penaltyRun;
                                     tvRemainingRuns.setText(String.valueOf(remainingRuns));

                                 }

                                 if (leadingRuns > remainingRuns && totalInnings == 4) {
                                     tvRemainingRuns.setText(String.valueOf(leadingRuns));
                                     tvRemainingRunsText.setText("Leading Runs : ");
                                 }

                             }
                             else {
                                 ll_remainings.setVisibility(View.GONE);
                             }
                         }

                         else if (penaltyType == 2) {

                             if (totalInnings == currentInnings) {
                                 remainingRuns = remainingRuns + penaltyRun;
//                    savePenalty(penaltyType, penaltyRunTeam, true, fieldingTeamNo);
                                 if (currentInnings == 2) {
                                     innings1Runs = innings1Runs + penaltyRun;
                                 }
                                 else {
                                     if (!followon)
                                         innings3Runs = innings3Runs + penaltyRun;
                                 }
                                 // didn't removed it when both undo & cancel
                             }

                             else if (SUPER_OVER) {

                                 remainingRuns = remainingRuns + penaltyRun;
//                    savePenalty(penaltyType, penaltyRunTeam, true, fieldingTeamNo);
                                 if (currentInnings == 100) {
                                     so_inninngs1Runs = so_inninngs1Runs + penaltyRun;
                                     Log.d("so_inninngs1Runs","setPenalty22 , : "+so_inninngs1Runs);
                                 }
                             }
                         }

                         */
/*if (ballCount) {

                             if (bowball) {
                                 ++bowlerBalls;
//                        bowlerOver = bowlerOver + 0.1f;
                                 setOver(0);
//                        strikerBalls++;
                                 penaltyBallCount = 1;
                                 if (striker.matches(player1)) {
                                     player1Balls++;
                                     strikerBalls = player1Balls;
                                     tvPlayer1Balls.setText(String.valueOf(player1Balls));
                                 }
                                 if (striker.matches(player2)) {
                                     player2Balls++;
                                     strikerBalls = player2Balls;
                                     tvPlayer2Balls.setText(String.valueOf(player2Balls));
                                 }

                                 if (strID == ps1ID) {
                                     ++p1CB;
                                 } else if (strID == ps2ID) {
                                     ++p2CB;
                                 }
                             } else if (batsball) {
                                 if (striker.matches(player1)) {
                                     player1Balls++;
                                     strikerBalls = player1Balls;
                                     tvPlayer1Balls.setText(String.valueOf(player1Balls));
                                 }
                                 if (striker.matches(player2)) {
                                     player2Balls++;
                                     strikerBalls = player2Balls;
                                     tvPlayer2Balls.setText(String.valueOf(player2Balls));
                                 }

                                 if (strID == ps1ID) {
                                     ++p1CB;
                                 } else if (strID == ps2ID) {
                                     ++p2CB;
                                 }
                             }
                         }*//*



                         if (penaltyType == 1)
                             savePenalty(penaltyType, penaltyRunTeam, true, battingTeamNo, ballCount, bowball, batsball);

                         else if (penaltyType == 2) {

                             if ((totalInnings == currentInnings) || SUPER_OVER)
                                 savePenalty(penaltyType, penaltyRunTeam, true, fieldingTeamNo, ballCount, bowball, batsball);

                             else
                                 savePenalty(penaltyType, penaltyRunTeam, false, fieldingTeamNo, ballCount, bowball, batsball);
                         }
                     }
*/


                    /*Log.e("Scoring", "playerOUT, b4 outToScoring striker : "+striker);
                    Log.e("Scoring", "playerOUT, b4 outToScoring strID : "+strID);
                    Log.e("Scoring", "playerOUT, b4 outToScoring strikerRuns : "+strikerRuns);
                    Log.e("Scoring", "playerOUT, b4 outToScoring strikerBalls : "+strikerBalls);
                    Log.e("Scoring", "playerOUT, b4 outToScoring strikerF4s : "+strikerF4s);
                    Log.e("Scoring", "playerOUT, b4 outToScoring strikerS6s : "+strikerS6s);

                    Log.e("Scoring", "playerOUT, b4 outToScoring nonStriker : "+nonStriker);
                    Log.e("Scoring", "playerOUT, b4 outToScoring nstrID : "+nstrID);
                    Log.e("Scoring", "playerOUT, b4 outToScoring nonStrikerRuns : "+nonStrikerRuns);
                    Log.e("Scoring", "playerOUT, b4 outToScoring nonStrikerBalls : "+nonStrikerBalls);
                    Log.e("Scoring", "playerOUT, b4 outToScoring nonStrikerF4s : "+nonStrikerF4s);
                    Log.e("Scoring", "playerOUT, b4 outToScoring nonStrikerS6s : "+nonStrikerS6s);

                    Log.e("Scoring", "outToScoring, b4 outToScoring player1 : "+player1);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player1ID : "+player1ID);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player1Runs : "+player1Runs);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player1Balls : "+player1Balls);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player1F4s : "+player1F4s);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player1S6s : "+player1S6s);

                    Log.e("Scoring", "outToScoring, b4 outToScoring player2 : "+player2);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player2ID : "+player2ID);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player2Runs : "+player2Runs);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player2Balls : "+player2Balls);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player2F4s : "+player2F4s);
                    Log.e("Scoring", "outToScoring, b4 outToScoring player2S6s : "+player2S6s);*/


                    outToScoring();
                }
            }
        });
    }


    // Updated on 19/04/2021
    void outAlert(int i, String warning) {//int i) {

        Log.d("OUTALERT", "i : " + i);
        /*// Added on 19/04/2021
        String warning = "";
        if (i == 1)
            warning = "Please select dismissed player";
        else if (i == 2)
            warning = "Please select fielder";
        else if (i == 3)
            warning = "Please enter required fields";*/


//        progress.dismiss();
        AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
        alertDialog.setIcon(R.drawable.ball);
        alertDialog.setCancelable(false);
        alertDialog.setTitle(warning);
        alertDialog.setButton(AlertDialog.BUTTON_POSITIVE, "Ok",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                    }
                });
        alertDialog.show();
    }


    void noballAlert(String message) {

        AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
        alertDialog.setIcon(R.drawable.ball);
        alertDialog.setCancelable(false);
        alertDialog.setTitle(message);
        alertDialog.setButton(AlertDialog.BUTTON_POSITIVE, "Ok",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
//                        runsOffBat = 0;
                    }
                });
        alertDialog.show();
    }


    // set the visibile of the OUT layouts
    void setVisibity() {


        ll_batsman.setVisibility(View.GONE);
        ll_fielder.setVisibility(View.GONE);
        ll_crossed.setVisibility(View.GONE);
        ll_extra.setVisibility(View.GONE);
        ll_extras.setVisibility(View.GONE);
        ll_extra_runs.setVisibility(View.GONE);
//        ll_penalty.setVisibility(View.GONE);
        ll_ballcount.setVisibility(View.GONE);
//        tv_out_penalty.setVisibility(View.GONE);    // Added on 18/03/2021
//        ll_nextStriker.setVisibility(View.GONE);

//        checkAllOut();

        // Added on 18/03/2021
        tv_outType.setVisibility(View.INVISIBLE);
        tv_outBatsman.setVisibility(View.INVISIBLE);
        tv_fielder.setVisibility(View.INVISIBLE);
        tv_extraType.setVisibility(View.INVISIBLE);
//        tv_out_penalty.setVisibility(View.INVISIBLE);
        tv_com.setVisibility(View.GONE);

    }


//    void checkAllOut(){
//
//        if (wicket >= player_count - 2)
//            ll_nextStriker.setVisibility(View.GONE);
//        else
//            ll_nextStriker.setVisibility(View.VISIBLE);
//    }


    void selectOutType() {

//        applySubstitution();
        resetOUT();
        Log.e("OUTT", "1,  tv_outType.getVisibility() : " + tv_outType.getVisibility());
        outtypeBuilder = new AlertDialog.Builder(ScoringActivity.this);
        outtypeBuilder.setIcon(R.drawable.ball);
        outtypeBuilder.setCancelable(false);
        outtypeBuilder.setTitle("Out Type");
        outtypeBuilder.setSingleChoiceItems(R.array.outTypeList, checkedItem, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                switch (which) {

                    case 0:
                        outType = 0;
                        break;

                    case 1:
                        outType = 1;
//                        crossed = true;
                        break;

                    case 2:
                        outType = 2;
                        break;

                    case 3:
                        outType = 3;
                        break;

                    case 4:
                        outType = 4;
                        break;

                    case 5:
                        outType = 5;
                        break;

                    case 6:
                        outType = 6;
                        break;

                    case 7:
                        outType = 7;
                        break;

                    case 8:
                        outType = 9;
                        break;

                    case 9:
                        outType = 10;
                        break;

                    case 10:
//                        outType = 11; Commented on 03/03/2021
                        outType = 12;
                        break;

                    /*case 11:
                        outType = 12;
                        break;*/

                    /*case 12:
                        outType = 12;
                        break;*/

                    default:
                        Toast.makeText(getApplicationContext(), "please Select one Out Type",
                                Toast.LENGTH_SHORT).show();
                        break;
                }
                Toast.makeText(getApplicationContext(), oType + " selected", Toast.LENGTH_SHORT).show();

            }

        });


        outtypeBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                Log.e("selectOutType", "ok,  out : " + out);
                Log.e("OUTT", "ok,  outType : " + outType);
                Log.e("OUTT", "ok,  tv_outType.getVisibility() : " + tv_outType.getVisibility());

//                ++wicket;
//                ballType = 3;

                if (outType == -1) {
                    Toast.makeText(ScoringActivity.this, "Select a out type", Toast.LENGTH_SHORT).show();
                    tv_outType.setVisibility(View.INVISIBLE);
                } else {

                    if (outType == 0) {

                        oType = "Bowled";
                        ll_batsman.setVisibility(View.VISIBLE);
                        tv_outBatsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_extra.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.GONE);
//                    Log.d("Bowled", "strkr : "+strkr);
                        tv_outBatsman.setText(striker);
                        dismissedPlayer = striker;
                        single = false;
                        multi = false;
                        lastWicket = false;
                    } else if (outType == 1) {

                        oType = "Caught";

                        ll_batsman.setVisibility(View.VISIBLE);
                        ll_fielder.setVisibility(View.VISIBLE);
                        ll_crossed.setVisibility(View.VISIBLE);
                        tv_outBatsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.GONE);
                        ll_extra.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        tv_outBatsman.setText(striker);
                        tv_fielder.setText("");
                        dismissedPlayer = striker;
                        single = true;
                        multi = false;
                        lastWicket = false;
//                    dismissedList.add(striker);
//                    bowlerWicket++;
                    } else if (outType == 2) {

                        oType = "Run Out";
                        ll_batsman.setVisibility(View.VISIBLE);
                        ll_fielder.setVisibility(View.VISIBLE);
                        ll_crossed.setVisibility(View.VISIBLE);
//                    et_runsOffBat_out.setVisibility(View.VISIBLE);
                        btn_out_batsman.setVisibility(View.VISIBLE);
                        ll_extra.setVisibility(View.VISIBLE);
                        et_out_run.setVisibility(View.VISIBLE);
                        ll_extra_runs.setVisibility(View.GONE);
                        et_extra_run_out.setVisibility(View.GONE);
                        et_runsOffBat_out.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.VISIBLE);
                        ll_ballcount.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        tv_outBatsman.setText("");
                        tv_fielder.setText("");
//                    et_out_run.setText("");
                        et_out_run.setText("");
                        single = false;
                        multi = true;
                        lastWicket = false;

                        int i = 0;

                        RealmResults<Player> results = realm.where(Player.class).
                                equalTo("matchid", matchid).
                                equalTo("team", fieldingTeamNo).
                                equalTo("retired_concussion", false).    // added on 27/02/2021
                                equalTo("retired", false).findAll();
//                            equalTo("substitute", substitute).findAll(); COMMENTED ON 26/02/2021
//                                btn_batsman.setVisibility(View.VISIBLE);
                        results.load();
                        Log.d("scoring", "fielderss, results.size() : " + results.size());
                        fielderss = new String[results.size()];

                        for (Player player : results) {
                            fielderss[i] = player.getPlayerName();
                            checkedFielders[i] = false;

                            Log.d("Scoring", "selectFielder, fielders[i] : " + fielders[i] +
                                    ", checkedFielders[i] : " + checkedFielders[i] + ", i : " + i);
                            ++i;
                        }

                        fieldersList.clear();
                    } else if (outType == 3) {

                        oType = "Stumped";
                        fielderPlayerID = "";
                        tv_fielder.setVisibility(View.VISIBLE); // Added on 18/03/2021
                        tv_fielder.setText(wicketkeeper);
                        ll_batsman.setVisibility(View.VISIBLE);
                        ll_fielder.setVisibility(View.VISIBLE);
                        ll_extra.setVisibility(View.VISIBLE);
                        et_out_run.setVisibility(View.GONE);
                        tv_outBatsman.setVisibility(View.VISIBLE);
                        ll_extras.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
//                    ll_extra_runs.setVisibility(View.VISIBLE);
//                    ll_penalty.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        tv_outBatsman.setText(striker);
//                    tv_fielder.setText("");
                        dismissedPlayer = striker;
                        single = true;
                        multi = false;
                        lastWicket = false;
                        fieldersList.add(wicketkeeper);

                        Player fielder = realm.where(Player.class).
                                equalTo("matchid", matchid).
                                equalTo("team", fieldingTeamNo).
                                equalTo("retired", false).
                                equalTo("playerName", wicketkeeper).findFirst();
                        if (fielder != null)
                            fielderPlayerID = String.valueOf(fielder.getPlayerID());
                        if (fielder.getPlayerID() == wk_id)
                            wk_flag = true;
                        else
                            wk_flag = false;
//                    dismissedList.add(striker);
//                    bowlerWicket++;
                    } else if (outType == 4) {

                        oType = "LBW";
                        ll_batsman.setVisibility(View.VISIBLE);
                        tv_outBatsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.GONE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_extra.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        tv_outBatsman.setText(striker);
                        dismissedPlayer = striker;
                        single = false;
                        multi = false;
                        lastWicket = false;
//                    dismissedList.add(striker);
//                    bowlerWicket++;
                    } else if (outType == 5) {

                        oType = "Hit Wicket";
                        ll_batsman.setVisibility(View.VISIBLE);
                        ll_extra.setVisibility(View.VISIBLE);
                        tv_outBatsman.setVisibility(View.VISIBLE);
                        ll_extra_runs.setVisibility(View.GONE);
                        et_extra_run_out.setVisibility(View.GONE);
                        et_runsOffBat_out.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.GONE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        et_out_run.setVisibility(View.GONE);
                        tv_outBatsman.setText(striker);
                        dismissedPlayer = striker;
                        single = false;
                        multi = false;
                        lastWicket = false;
//                    dismissedList.add(striker);
//                    bowlerWicket++;
                    } else if (outType == 6) {

                        oType = "Hit the Ball Twice";
                        ll_batsman.setVisibility(View.VISIBLE);
                        ll_extra.setVisibility(View.VISIBLE);
                        et_out_run.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
                        et_extra_run_out.setVisibility(View.GONE);
                        et_runsOffBat_out.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        tv_outBatsman.setVisibility(View.VISIBLE);
                        ll_extras.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.GONE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        tv_outBatsman.setText(striker);
                        dismissedPlayer = striker;
                        single = false;
                        multi = false;
                        lastWicket = false;
//                    dismissedList.add(striker);
                    } else if (outType == 7) {

                        oType = "Obstructing the Field";
                        ll_batsman.setVisibility(View.VISIBLE);
                        ll_crossed.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.VISIBLE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_extra.setVisibility(View.VISIBLE);
                        ll_extras.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
                        et_extra_run_out.setVisibility(View.GONE);
                        et_runsOffBat_out.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.VISIBLE);
                        ll_ballcount.setVisibility(View.GONE);
                        tv_outBatsman.setText("");
                        single = false;
                        multi = false;
                        lastWicket = false;
                    }

                /*if (outType == 8){

                    oType = "Handled the Ball";
                    ll_batsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                    tv_outBatsman.setVisibility(View.VISIBLE);
                    btn_out_batsman.setVisibility(View.GONE);
                    ll_fielder.setVisibility(View.GONE);
                    ll_crossed.setVisibility(View.GONE);
                    ll_extra.setVisibility(View.GONE);
                    ll_extras.setVisibility(View.GONE);
                    ll_extra_runs.setVisibility(View.GONE);
                    ll_penalty.setVisibility(View.GONE);
                    tv_outBatsman.setText(striker);
                    dismissedPlayer = striker;
//                    dismissedList.add(striker);
                }*/

                    else if (outType == 9) {

                        oType = "Timed out";
                        if (strikerBalls > 0 && nonStrikerBalls > 0) {
                            oType = "";
                            outType = -1;
                            displayError("Timed out not possible");
                        } else {
                            ll_batsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                            tv_outBatsman.setVisibility(View.VISIBLE);
                            ll_extras.setVisibility(View.GONE);
                            btn_out_batsman.setVisibility(View.GONE);
                            ll_fielder.setVisibility(View.GONE);
                            ll_crossed.setVisibility(View.GONE);
                            ll_extra.setVisibility(View.GONE);
                            ll_extras.setVisibility(View.GONE);
                            ll_extra_runs.setVisibility(View.GONE);
//                            ll_penalty.setVisibility(View.GONE);
                            ll_ballcount.setVisibility(View.GONE);
                            if (striker.matches(newBatsman)) {
                                if (strikerBalls == 0) {
                                    dismissedPlayer = striker;
                                    tv_outBatsman.setText(striker);
                                }
                            } else if (nonStriker.matches(newBatsman)) {
                                if (nonStrikerBalls == 0) {
                                    dismissedPlayer = nonStriker;
                                    tv_outBatsman.setText(nonStriker);
                                }
                            }
                            single = false;
                            multi = false;
                            lastWicket = false;
                        }
                    } else if (outType == 10) {

                        oType = "Retired Hurt";
                        retired = true;
                        ll_batsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.VISIBLE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_extra.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
//                    ll_extra_runs.setVisibility(View.GONE);
//                    ll_penalty.setVisibility(View.GONE);
                        tv_outBatsman.setText("");
                        single = false;
                        multi = false;

                        // added on 01/01/2021
                        if (wicket == (player_count - 2)) {
                            lastWicket = true;
                        }
                    } else if (outType == 11) {

                        oType = "Absent";
//                    retired = true;
                        ll_batsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.VISIBLE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_extra.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        tv_outBatsman.setText("");
                        single = false;
                        multi = false;
                        lastWicket = false;
                    } else if (outType == 12) {

                        oType = "Retired Out";
//                    retired = true;
                        ll_batsman.setVisibility(View.VISIBLE);
//                    ll_nextStriker.setVisibility(View.GONE);
                        btn_out_batsman.setVisibility(View.VISIBLE);
                        ll_fielder.setVisibility(View.GONE);
                        ll_crossed.setVisibility(View.GONE);
                        ll_extra.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        ll_extra_runs.setVisibility(View.GONE);
//                        ll_penalty.setVisibility(View.GONE);
                        ll_ballcount.setVisibility(View.GONE);
                        tv_outBatsman.setText("");
                        single = false;
                        multi = false;
                        lastWicket = false;
                    }


//                checkAllOut();


//                if (out)
                    tv_outType.setVisibility(View.VISIBLE); // Added on 18/03/2021
                    tv_outType.setText(oType);
//                tvTotalWicket.setText(String.valueOf(wicket));
//                Toast.makeText(getApplicationContext(), type + " confirmed", Toast.LENGTH_SHORT).show();
                }

            }
        });

        outtypeBuilder.setNegativeButton("Cancel", null);

        // create and show the alert dialog
        AlertDialog dialog = outtypeBuilder.create();
        dialog.show();


    }


    void selectDismissedPlayer() {

//        if (outType != 9) { // Added on 06/03/2021

        String[] players = {player1, player2};

        selectDismissedBuilder = new AlertDialog.Builder(this);
        selectDismissedBuilder.setIcon(R.drawable.ball);
        selectDismissedBuilder.setCancelable(false);
        selectDismissedBuilder.setTitle("Select Dismissed player");
        selectDismissedBuilder.setSingleChoiceItems(players, checkedItem, new DialogInterface.OnClickListener() {

            @Override
            public void onClick(DialogInterface dialog, int position) {

                final String s = Arrays.asList(players).get(position);
                dismissedPlayer = s;
                tv_outBatsman.setVisibility(View.VISIBLE); // Added on 18/03/2021
                tv_outBatsman.setText(dismissedPlayer);
            }

        });
        selectDismissedBuilder.setPositiveButton("Ok", new DialogInterface.OnClickListener() {

            @Override
            public void onClick(DialogInterface dialog, int which) {

                Log.e("selectDismissedPlayer", "ok,  out : " + out);
//                    dialog.dismiss();
                if (dismissedPlayer == null || dismissedPlayer.matches(""))
                    Toast.makeText(ScoringActivity.this, "Select dismissed player", Toast.LENGTH_SHORT).show();
                else
                    dialog.dismiss();
            }
        });
        selectDismissedBuilder.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                dismissedPlayer = "";
                tv_outBatsman.setVisibility(View.INVISIBLE); // Added on 18/03/2021
                tv_outBatsman.setText(null);
            }
        });
        AlertDialog alert = selectDismissedBuilder.create();
        alert.show();

        //=========== Added on 06/03/2021 ====================
      /*  }

        else {


//            selectFielder();

            RealmResults<Batsman> results = realm.where(Batsman.class).
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    equalTo("toBeBatted", true).
                    equalTo("out", false).
                    equalTo("playing", false).
                    equalTo("retired", false).
                    findAll();

            if (results.size() > 0) {

                ArrayList<Integer> playerIDs = new ArrayList<Integer>();

                final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                        android.R.layout.select_dialog_singlechoice);

                for (Batsman batsman : results) {
                    Player player = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("playerID", batsman.getBatsman_pID()).findFirst();
                    if (player != null) {
                        arrayAdapter.add(player.getPlayerName());
                        playerIDs.add(batsman.getBatsman_pID());
                    }
                }

                AlertDialog.Builder dismissedBuilder = new AlertDialog.Builder(ScoringActivity.this);
                dismissedBuilder.setIcon(R.drawable.ball);
                dismissedBuilder.setCancelable(false);
                dismissedBuilder.setTitle("Select Dismissed player");
                dismissedBuilder.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        dismissedPlayer = "";
                        disPID = 0;
                        tv_outBatsman.setText("");
                    }
                });
                dismissedBuilder.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        String strName = arrayAdapter.getItem(which);
                        int id = playerIDs.get(which);
                        dismissedPlayer = strName;
//                        dismissedPlayrID = id;
                        disPID = id;
                        tv_outBatsman.setText(dismissedPlayer);


                       *//* AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                        builderInner.setIcon(R.drawable.ball);
                        builderInner.setCancelable(false);
                        dialog.dismiss();
                        builderInner.setMessage(strName);
                        builderInner.setTitle("Selected fielder is ");

                        builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                            @Override
                            public void onClick(DialogInterface dialog, int which) {
                                Log.e("selectFielder", "ok,  out : " + out);
                                fielderPlayer = strName;
                                fieldersList.add(fielderPlayer);
                                tv_fielder.setText(fielderPlayer);
                                dialog.dismiss();


                                Player fielder = realm.where(Player.class).
                                        equalTo("matchid", matchid).
                                        equalTo("team", fieldingTeamNo).
                                        equalTo("retired", false).
                                        equalTo("retired_concussion", false).    // added on 27/02/2021
                                        equalTo("playerName", fielderPlayer).findFirst();
                                if (fielder != null)
                                    fielderPlayerID = String.valueOf(fielder.getPlayerID());

                            }
                        });
                        builderInner.show();*//*
                    }
                });

//                dismissedBuilder.setNegativeButton("Cancel", null);

                dismissedBuilder.show();
            }
            else {
                displayError("No batsman left");
            }
        }

        // ========= till here =====================*/
    }


    void resetOUT() {

        ll_extras.setVisibility(View.GONE);
        tv_outBatsman.setText("");
        ll_fielder.setVisibility(View.GONE);
        ll_ballcount.setVisibility(View.GONE);
        et_out_run.setVisibility(View.VISIBLE);
        et_out_run.setText("");

        // Added on 18/03/2021
        tv_outType.setVisibility(View.INVISIBLE);
        tv_outBatsman.setVisibility(View.INVISIBLE);
        tv_fielder.setVisibility(View.INVISIBLE);
        tv_extraType.setVisibility(View.INVISIBLE);
//        tv_out_penalty.setVisibility(View.INVISIBLE);
        outType = -1;
    }


    void selectFielder() {


        int i = 0;


//        applySubstitution();
        Log.d("selectFielder", " matchid :" + matchid);
        Log.d("selectFielder", " matchID :" + matchID);


//        int i = 0;
        final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                android.R.layout.select_dialog_singlechoice);
        Log.d("Test", "Inside Select Fielder");


        RealmResults<Player> results = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", fieldingTeamNo).
                equalTo("retired_concussion", false).
                equalTo("retired", false).findAll();
//                equalTo("substitute", substitute).findAll();

        if (outType == 1 || outType == 2 || outType == 3) {

            if (SUPER_OVER) {

                results = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", fieldingTeamNo).
                        equalTo("retired", false).
                        equalTo("substitute", false).findAll();
            } else {

                results = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", fieldingTeamNo).
                        equalTo("retired", false).findAll();
            }
        }

        Log.d("Scoring", "selectFielder, fielders  : " + results);


        results.load();
//        if (single) {
//
//                //fielders.add(player.getPlayerName());
////            Toast.makeText(getApplicationContext(), "player : "+player.getPlayerName(), Toast.LENGTH_SHORT).show();
////            Log.d("Test", "player "+ player.getPlayerName());
////            fielders[i] = player.getPlayerName();
////            Log.d("Test", "array of player "+ fielders[i]);
////            i++;
////            checkedFielders.add(false);
//
//
//        }


//        else if (multi) {
//
//
//
//        }

        Log.d("Scoring", "selectFielder, single : " + single + ", multi : " + multi);

//        Log.d("Scoring", "selectFielder, checkedFielders  : "+checkedFielders);
//        Log.d("Scoring", "selectFielder, fieldersArrayadapter  : "+arrayAdapter);

        if (single) {


            for (Player player : results) {
                arrayAdapter.add(player.getPlayerName());
            }

            fielderBuilder = new AlertDialog.Builder(ScoringActivity.this);
            fielderBuilder.setIcon(R.drawable.ball);
            fielderBuilder.setCancelable(false);
            //Toast.makeText(getApplicationContext(), "inside builder", Toast.LENGTH_SHORT).show();
//        Log.d("TAG", "AlertDialog.Builder created");
            fielderBuilder.setTitle("Select Fielder");
//        Log.d("Test", "Title created");
            fielderBuilder.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    dialog.dismiss();
                }
            });
            fielderBuilder.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    String strName = arrayAdapter.getItem(which);
//                dialog.dismiss();
                    AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                    builderInner.setIcon(R.drawable.ball);
                    builderInner.setCancelable(false);
                    dialog.dismiss();
                    builderInner.setMessage(strName);
                    builderInner.setTitle("Selected fielder is ");

                    builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {
                            Log.e("selectFielder", "ok,  out : " + out);
                            fielderPlayer = strName;
                            fieldersList.add(fielderPlayer);
                            tv_fielder.setVisibility(View.VISIBLE); // Added on 18/03/2021
                            tv_fielder.setText(fielderPlayer);
                            dialog.dismiss();


                            Player fielder = realm.where(Player.class).
                                    equalTo("matchid", matchid).
                                    equalTo("team", fieldingTeamNo).
                                    equalTo("retired", false).
                                    equalTo("retired_concussion", false).    // added on 27/02/2021
                                    equalTo("playerName", fielderPlayer).findFirst();
                            if (fielder != null) {
                                fielderPlayerID = String.valueOf(fielder.getPlayerID());
                                if (fielder.getPlayerID() == wk_id)
                                    wk_flag = true;
                                else
                                    wk_flag = false;
                            }

                        }
                    });
//
                    builderInner.show();
//                dialog.dismiss();
                }
            });

//            fielderBuilder.setNegativeButton("Cancel", null);


            fielderBuilder.show();
        } else if (multi) {

            t = 0;
            Log.d("Scoring", "selectFielder, t : " + t);
            Log.d("Scoring", "selectFielder, fielderss.length : " + fielderss.length);
            for (int x = 0; x < fielderss.length; x++)
                Log.d("Scoring", "selectFielder, fielderss : " + fielderss[x]);

            /*for (Player player : results) {
                fielderss[i] = player.getPlayerName();
                checkedFielders[i] = false;

                Log.d("Scoring", "selectFielder, fielders[i] : "+fielders[i]+
                        ", checkedFielders[i] : "+checkedFielders[i]+", i : "+i);
                ++i;
            }

            fieldersList.clear();*/

            fielderBuilder = new AlertDialog.Builder(ScoringActivity.this);
            fielderBuilder.setIcon(R.drawable.ball);
            fielderBuilder.setCancelable(false);
            fielderBuilder.setTitle("Select Fielder");
            fielderBuilder.setMultiChoiceItems(fielderss, checkedFielders,
                    new DialogInterface.OnMultiChoiceClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which, boolean isChecked) {

//                    checkedFielders

                  /*  for (int j = 0; j < checkedFielders.length; j++) {

                        boolean checked = checkedFielders[j];
                        if (checked) {

                        }
                    }*/

                        }
                    });

            fielderBuilder.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {

                    Log.d("FIELDER", "1, checkedFielders.length = " + checkedFielders.length);
                    Log.d("FIELDER", "2, checkedFielders = " + checkedFielders.toString());

                    /*if (checkedFielders.length == 0) {

                        Toast.makeText(ScoringActivity.this, "Select Fielder", Toast.LENGTH_SHORT).show();
                        tv_fielder.setVisibility(View.INVISIBLE);
                    }

                    else {*/

                    tv_fielder.setText("");
                    tv_fielder.setVisibility(View.VISIBLE); // Added on 18/03/2021

                    for (int j = 0; j < checkedFielders.length; j++) {
                        boolean checked = checkedFielders[j];
                        if (checked) {
                            fieldersList.add(fielderss[j]);
                            Log.d("fielderPlayerID", " t : " + t + " , : " + fielderPlayerID);

                           /* if (fieldersList.size() == 0)
                                tv_fielder.setText(fielderss[j]);

                            else if (fieldersList.size() > 0)
                                tv_fielder.setText(tv_fielder.getText() + ", "+fielderss[j]);
//                            tv.setText(tv.getText() + colorsList.get(i) + "\n");*/

                            if (t == 0) {
                                tv_fielder.setText(fielderss[j]);
                                /*fielderPlayerID =  String.valueOf(realm.where(Player.class).
                                        equalTo("matchid", matchid).
                                        equalTo("team", fieldingTeamNo).
                                        equalTo("playerName", fieldersList.get(t)).findFirst().getPlayerID());*/

                                Player fielder = realm.where(Player.class).
                                        equalTo("matchid", matchid).
                                        equalTo("team", fieldingTeamNo).
                                        equalTo("retired", false).
                                        equalTo("playerName", fieldersList.get(t)).findFirst();
                                if (fielder != null)
                                    fielderPlayerID = "" + fielder.getPlayerID();

                            } else if (t > 0) {
                                tv_fielder.setText(tv_fielder.getText() + ", " + fielderss[j]);
                                /*fielderPlayerID = fielderPlayerID + ", " + realm.where(Player.class).
                                        equalTo("matchid", matchid).
                                        equalTo("team", fieldingTeamNo).
                                        equalTo("playerName", fieldersList.get(t)).findFirst().getPlayerID();*/

                                Player fielder = realm.where(Player.class).
                                        equalTo("matchid", matchid).
                                        equalTo("team", fieldingTeamNo).
                                        equalTo("retired", false).
                                        equalTo("playerName", fieldersList.get(t)).findFirst();
                                if (fielder != null) {
                                    fielderPlayerID = fielderPlayerID + ", " + fielder.getPlayerID();
                                }
                            }


                            ++t;
                        }
                    }
                    t = 0;
                    Log.d("Scoring", "selectFielder, fieldersList  : " + fieldersList);
                    Log.d("fielderList", "fielder, fieldersList : " + fieldersList +
                            ", fielderPlayerID : " + fielderPlayerID);
//                    }
                }
            });

            fielderBuilder.setNegativeButton("Cancel", null);
            fielderBuilder.show();
        }


//        else
//            syncBatsmann(matchid, matchID, dismissedPlayer, bowler, null, true);
//        AlertDialog dialog = fielderBuilder.create();
//        dialog.show();


    }


    void checkViewExtra() {

        if (ve_flag == 0) {


            ve_flag = 1;
            ll_extras.setVisibility(View.VISIBLE);
            et_out_run.setVisibility(View.GONE);
            ll_extra_runs.setVisibility(View.GONE);
            et_extra_run_out.setVisibility(View.GONE);
            et_runsOffBat_out.setVisibility(View.GONE);
//            ll_penalty.setVisibility(View.VISIBLE);
            tv_extraType.setVisibility(View.INVISIBLE); // Added on 18/03/2021
            Log.e("checkViewExtra", "display extras");
        } else {
            Log.e("checkViewExtra", "hide extras");

            ve_flag = 0;
            ll_extras.setVisibility(View.GONE);
            tv_extraType.setVisibility(View.INVISIBLE); // Added on 18/03/2021
//            eType = "";

        }
    }


    void checkOutExtraType() {

        ll_extra_runs.setVisibility(View.GONE);

        runsOffBat = 0;
        outExtraTypeBuilder = new AlertDialog.Builder(ScoringActivity.this);
        outExtraTypeBuilder.setIcon(R.drawable.ball);
        outExtraTypeBuilder.setCancelable(false);
        outExtraTypeBuilder.setTitle("Extra Type");
        outExtraTypeBuilder.setSingleChoiceItems(R.array.extraTypeList, checkedItem, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

//                Log.d("test", "inside override method");
                switch (which) {

                    case 0:

//                        extras = true;
//                        outextras = true;
                        bye = true;
                        lb = false;
                        wide = false;
                        noBall = false;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_runs.setVisibility(View.VISIBLE);
                        et_extra_run_out.setVisibility(View.VISIBLE);
                        et_runsOffBat_out.setVisibility(View.INVISIBLE);
                        break;

                    case 1:

//                        extras = true;
//                        outextras = true;
                        bye = false;
                        lb = true;
                        wide = false;
                        noBall = false;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_runs.setVisibility(View.VISIBLE);
                        et_extra_run_out.setVisibility(View.VISIBLE);
                        et_runsOffBat_out.setVisibility(View.INVISIBLE);
                        break;

                    case 2:

//                        outextras = true;
//                        extras = true;
                        bye = false;
                        lb = false;
                        wide = true;
                        noBall = false;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_runs.setVisibility(View.VISIBLE);
                        et_extra_run_out.setVisibility(View.VISIBLE);
                        et_runsOffBat_out.setVisibility(View.INVISIBLE);
                        break;

                    case 3:

//                        outextras = true;
//                        extras = true;
                        bye = false;
                        lb = false;
                        wide = false;
                        noBall = true;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_runs.setVisibility(View.GONE);
                        et_extra_run_out.setVisibility(View.GONE);
                        et_runsOffBat_out.setVisibility(View.GONE);
                        break;

                    default:
                        Toast.makeText(getApplicationContext(), "please Select an extra",
                                Toast.LENGTH_SHORT).show();
                        break;

                }
            }
        });

        outExtraTypeBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                Log.e("checkOutExtraType", "ok,  out : " + out);
                Log.e("checkOutExtraType", "ok,  bye : " + bye + ", lb : " + lb + ", wide " + wide +
                        ", noball : " + noBall + ", byeNB : " + byeNB + ", lbNB : " + lbNB);

                Log.d("b4 setExtra", "3 ballType : " + ballType);
                Log.d("b4 setExtra", "3 extras : " + extras + ",extraType : " + extraType +
                        ", extra : " + extra + ", extraRun : " + extraRun + ", runsOffBat : " + runsOffBat);
                Log.d("b4 setExtra", "3 out : " + out + ", outType : " + outType + ", out_run : " + out_run);
                Log.d("b4 setExtra", "3 strID : " + strID + ", strikerRuns : " + strikerRuns +
                        ", strikerBalls : " + strikerBalls);
                Log.d("b4 setExtra", "3 nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                        ", nonStrikerBalls : " + nonStrikerBalls);
                Log.d("b4 setExtra", "3 player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                        ", player1Balls : " + player1Balls);
                Log.d("b4 setExtra", "3 player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                        ", player2Balls : " + player2Balls);
                Log.d("b4 setExtra", "3 psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver);
                Log.d("b4 setExtra", "3 ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                Log.d("b4 setExtra", "3 ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);
                Log.d("b4 setExtra", "3 bye : " + bye + ", lb : " + lb + ", wide : " + wide);
                Log.d("b4 setExtra", "3 noBall : " + noBall + ", eType : " + eType);


                if (bye) {

                    eType = "Byes";

                    if (outType == 3 || outType == 5 || outType == 6) {
                        message = oType + " is not a valid dismissal for Byes";
                        displayError(message);
                    } else {


                        et_runsOffBat_out.setVisibility(View.INVISIBLE);
                        et_extra_run_out.setVisibility(View.VISIBLE);
                        extraType = 0;
//                    ballType = 9;

                        if (/*outextras) {*/extras) {
                            if (strID == player1ID) {
                                ++player1Balls;
                                strikerBalls = player1Balls;
                            }

                            if (strID == player2ID) {
                                ++player2Balls;
                                strikerBalls = player2Balls;
                            }

                            if (strID == ps1ID) {
                                ++p1CB;
                            } else if (strID == ps2ID) {
                                ++p2CB;
                            }
                        }
                    }

                } else if (lb) {

                    eType = "Leg Byes";

                    if (outType == 3 || outType == 5 || outType == 6) {
                        message = oType + " is not a valid dismissal for Legbyes";
                        displayError(message);
                    } else {

                        et_runsOffBat_out.setVisibility(View.INVISIBLE);
                        et_extra_run_out.setVisibility(View.VISIBLE);
                        extraType = 1;

                        if (/*outextras) {*/extras) {
                            if (strID == player1ID) {
                                ++player1Balls;
                                strikerBalls = player1Balls;
                            }
                            if (strID == player2ID) {
                                ++player2Balls;
                                strikerBalls = player2Balls;
                            }

                            if (strID == ps1ID) {
                                ++p1CB;
                            } else if (strID == ps2ID) {
                                ++p2CB;
                            }
                        }
                    }
                } else if (wide) {

                    eType = "Wide";

                    if (outType == 6) {
                        message = oType + " is not a valid dismissal for Wide";
                        displayError(message);
                    } else {
                        message = "";
                        if (outType == 3) {
                            ll_extra_runs.setVisibility(View.GONE);
                            et_runsOffBat_out.setVisibility(View.GONE);
                            et_extra_run_out.setVisibility(View.GONE);
                        } else if (outType == 5) {
                            ll_extra_runs.setVisibility(View.GONE);
                            et_runsOffBat_out.setVisibility(View.GONE);
                            et_extra_run_out.setVisibility(View.GONE);
                        } else {
                            et_runsOffBat_out.setVisibility(View.INVISIBLE);
                            et_extra_run_out.setVisibility(View.VISIBLE);
                        }

                        extraType = 4;
                    }

                } else if (noBall) {

                    eType = "Noball";

                    if (outType == 3 || outType == 5) {
                        message = oType + " is not a valid dismissal for Noball";
                        displayError(message);
                    } else {
                        message = "";
                        setNoball();
                    }

                }

                if (extras) {
                    tvExtrasType.setVisibility(View.VISIBLE);
                    tvExtrasType.setText(eType);
                } else if (out) {
                    tv_extraType.setVisibility(View.VISIBLE);
                    tv_extraType.setText(eType);
                    ll_extras.setVisibility(View.VISIBLE);
                }

                if (extras) {
                    if (bye || lb) {

                        ++ball;
                        ++totalBalls;
                        ++psBalls;
                        if (psBalls >= ballsPerOver) {
                            ++psOver;
                            if (psBalls == ballsPerOver)
                                psBalls = 0;
                            else if (psBalls == (ballsPerOver + 1))
                                psBalls = 1;
                        }

                        currentOver = currentOver + 0.1f;

//                        remainingOver = setRemainingOver(remainingOver);

                        if (currentInnings > 1) {// && remainingRuns > 0){
//                            remainingOver = remainingOver - 0.1f;
                            float temp_ro = (remainingOver - (int) remainingOver);
                            if (temp_ro > .1f && temp_ro <= (.1f * ballsPerOver))
                                remainingOver = remainingOver - .1f;
                            else if ((int) (temp_ro * 10) == 0) {
                                remainingOver = remainingOver - 1;
                                remainingOver = remainingOver + (.1f * (ballsPerOver - 1));
                            }
                            --remainingBalls;

                        }
                    }
                }


                Log.d("b4 setExtra", "4 ballType : " + ballType);
                Log.d("b4 setExtra", "4 extras : " + extras + ",extraType : " + extraType +
                        ", extra : " + extra + ", extraRun : " + extraRun + ", runsOffBat : " + runsOffBat);
                Log.d("b4 setExtra", "4 out : " + out + ", outType : " + outType + ", out_run : " + out_run);
                Log.d("b4 setExtra", "4 strID : " + strID + ", strikerRuns : " + strikerRuns + ", strikerBalls : " + strikerBalls);
                Log.d("b4 setExtra", "4 nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                        ", nonStrikerBalls : " + nonStrikerBalls);
                Log.d("b4 setExtra", "4 player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                        ", player1Balls : " + player1Balls);
                Log.d("b4 setExtra", "4 player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                        ", player2Balls : " + player2Balls);
                Log.d("b4 setExtra", "4 psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver);
                Log.d("b4 setExtra", "4 ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
                Log.d("b4 setExtra", "4 ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

            }
        });

        outExtraTypeBuilder.setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                dialog.dismiss();


                et_runsOffBat_out.setVisibility(View.GONE);
                et_extra_run_out.setVisibility(View.GONE);

            }
        });

        // create and show the alert dialog

        AlertDialog dialog = outExtraTypeBuilder.create();
        dialog.show();

    }


    void editOutCommentary() {


        outComBuilder = new AlertDialog.Builder(ScoringActivity.this);
        outComBuilder.setIcon(R.drawable.ball);
        outComBuilder.setCancelable(false);
        outComBuilder.setTitle("Enter the commentary");

        final EditText input = new EditText(this);

        input.setInputType(InputType.TYPE_CLASS_TEXT);
        outComBuilder.setView(input);
        input.setText(commentary);
//        Log.d("Test", "inside setCommentry()");
        outComBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {

            //            @Override
            public void onClick(DialogInterface dialog, int which) {

                if (input.getText().toString().equals("") || input.getText().toString() == null) {
                    Toast.makeText(getApplicationContext(),
                            "Please enter commentary", Toast.LENGTH_SHORT).show();
                } else {
                    commentary = input.getText().toString();
//                    Log.d("Test", "BuilderText : " + commentary);


                    if (!commentary.matches("")) {
                        tv_com.setVisibility(View.VISIBLE); // Added on 18/03/2021
                        tv_com.setText(commentary);

                    } else {
                        Log.d("Test", "buildertext = null");
                    }

                }
            }
        });

        outComBuilder.setNegativeButton("Cancel", null);
        AlertDialog alert = outComBuilder.create();
        alert.show();

    }


    void outToScoring() {
        Log.d("b4 setExtra", "1 out_ball_not_count : " + out_ball_not_count);
        Log.d("b4 setExtra", "1 ballType : " + ballType);
        Log.d("b4 setExtra", "1 extras : " + extras + ",extraType : " + extraType +
                ", extra : " + extra + ", extraRun : " + extraRun + ", runsOffBat : " + runsOffBat);
        Log.d("b4 setExtra", "1 out : " + out + ", outType : " + outType + ", out_run : " + out_run);
        Log.d("b4 setExtra", "1 strID : " + strID + ", strikerRuns : " + strikerRuns + ", strikerBalls : " + strikerBalls);
        Log.d("b4 setExtra", "1 nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                ", nonStrikerBalls : " + nonStrikerBalls);
        Log.d("b4 setExtra", "1 player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                ", player1Balls : " + player1Balls);
        Log.d("b4 setExtra", "1 player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                ", player2Balls : " + player2Balls);
        Log.d("b4 setExtra", "1 psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver);
        Log.d("b4 setExtra", "1 ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
        Log.d("b4 setExtra", "1 ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

        Log.e("Scoring", "outToScoring, dismissedList : " + dismissedList);
        Log.e("Scoring", "outToScoring, retiredList : " + retiredList);

       /* Log.e("Scoring", "outToScoring, starting striker : "+striker);
        Log.e("Scoring", "outToScoring, starting strID : "+strID);
        Log.e("Scoring", "outToScoring, starting strikerRuns : "+strikerRuns);
        Log.e("Scoring", "outToScoring, starting strikerBalls : "+strikerBalls);
        Log.e("Scoring", "outToScoring, starting strikerF4s : "+strikerF4s);
        Log.e("Scoring", "outToScoring, starting strikerS6s : "+strikerS6s);

        Log.e("Scoring", "outToScoring, starting nonStriker : "+nonStriker);
        Log.e("Scoring", "outToScoring, starting nstrID : "+nstrID);
        Log.e("Scoring", "outToScoring, starting nonStrikerRuns : "+nonStrikerRuns);
        Log.e("Scoring", "outToScoring, starting nonStrikerBalls : "+nonStrikerBalls);
        Log.e("Scoring", "outToScoring, starting nonStrikerF4s : "+nonStrikerF4s);
        Log.e("Scoring", "outToScoring, starting nonStrikerS6s : "+nonStrikerS6s);

        Log.e("Scoring", "outToScoring, starting player1 : "+player1);
        Log.e("Scoring", "outToScoring, starting player1ID : "+player1ID);
        Log.e("Scoring", "outToScoring, starting player1Runs : "+player1Runs);
        Log.e("Scoring", "outToScoring, starting player1Balls : "+player1Balls);
        Log.e("Scoring", "outToScoring, starting player1F4s : "+player1F4s);
        Log.e("Scoring", "outToScoring, starting player1S6s : "+player1S6s);

        Log.e("Scoring", "outToScoring, starting player2 : "+player2);
        Log.e("Scoring", "outToScoring, starting player2ID : "+player2ID);
        Log.e("Scoring", "outToScoring, starting player2Runs : "+player2Runs);
        Log.e("Scoring", "outToScoring, starting player2Balls : "+player2Balls);
        Log.e("Scoring", "outToScoring, starting player2F4s : "+player2F4s);
        Log.e("Scoring", "outToScoring, starting player2S6s : "+player2S6s);*/


       /*if (flag == 0){
            tv_crossed.setText("YES");
            crossed = true;
            if (outType == 2)
                btn_out_batsman.setVisibility(View.VISIBLE);

            else if (outType == 3 || outType == 8) {
                ll_extra.setVisibility(View.VISIBLE);
            }

            flag = 1;
            Log.e("checkStrikerCrossed", "yes,  out : "+out);
        }
        else {
            Log.e("checkStrikerCrossed", "no,  out : "+out);
            tv_crossed.setText("NO");
            crossed = false;
            flag = 0;
        }*/



       /*if (rb_not_crossed.isSelected()){
           crossed = false;
       }

       else {
           crossed = true;
           if (outType == 2)
               btn_out_batsman.setVisibility(View.VISIBLE);

           else if (outType == 3 || outType == 8) {
               ll_extra.setVisibility(View.VISIBLE);
           }
       }*/

        newPartnership = false;

        if (noBall)
            ++bowlerNoBall;

        Log.e("Partnership", "outToScoring, newPartnership : " + newPartnership);


        if ((outType == 1 || outType == 2 || outType == 3) && (fieldersList.size() <= 0)) {
//            outAlert(2);
            outAlert(2, "Please select fielder");
        } else {


            ballType = 3;

            firstbowler = false;


//        Log.d("outToScoring", " matchid :"+matchid);
//        Log.d("outToScoring", " matchID :"+matchID);

            if (!retired || outType != 10)
                ++wicket;


//            if (retiredList.size() == 0) {    COMMENTED ON 01/01/2021
            if (wicket == (player_count - 1)) {
                allOUT = true;
                tvTotalWicket.setVisibility(View.INVISIBLE);
                tvdiv.setVisibility(View.INVISIBLE);
            }
            /* COMMENTED ON 01/01/2021
            } else if (retiredList.size() > 0) {

                if ((wicket + retiredList.size()) == (player_count - 1)) {
                    allOUT = true;
                    tvTotalWicket.setVisibility(View.INVISIBLE);
                    tvdiv.setVisibility(View.INVISIBLE);
                }

            }*/

            if (retired && lastWicket && (wicket == (player_count - 2))) {
                allOUT = true;
//                tvTotalWicket.setVisibility(View.INVISIBLE);
//                tvdiv.setVisibility(View.INVISIBLE);
            }


//            Log.e("Partnership", "outToScoring, retired 1 : " + retired);
//            Log.e("Partnership", "outToScoring, newPartnership 1 : " + newPartnership);
//            Log.e("outToScoring", "outToScoring, retired : " + retired);
//            Log.e("outToScoring", "outToScoring, wicket : " + wicket);
//            Log.e("outToScoring", "outToScoring, player_count : " + player_count);
//            Log.e("outToScoring", "outToScoring, allOUT : " + allOUT);
            Log.e("outToScoring11", "outToScoring 11, outType : " + outType);
            Log.e("outToScoring11", "outToScoring 11, retired : " + retired);
            Log.e("outToScoring11", "outToScoring 11, wicket : " + wicket);
            Log.e("outToScoring11", "outToScoring 11, player_count : " + player_count);


            tvTotalWicket.setText(String.valueOf(wicket));

            if (outType >= 0 && outType <= 7) {

                Log.d("out", "outToScorig, outType : " + outType);
                if (wide || noBall || out_ball_not_count)
                    Log.d("out", "outToScorig, outType : " + outType +
                            ", wide : " + wide + ", noBall : " + noBall + ", out_ball_not_count : " + out_ball_not_count);
                else
                    ++bowlerBalls;
                // commented on 26/06/2020
                /*if (!wide && !noBall)
                    ++bowlerBalls;*/

            }


            if (outType >= 0 && outType <= 5 && outType != 2)
                ++bowlerWicket;
            tvBowlerWicket.setText(String.valueOf(bowlerWicket));

//            if (crossed || ((out_run % 2) != 0) || ((runsOffBat % 2) != 0))
//                swap();


            Log.e("outToScoring", "dismissedPlayer : " + dismissedPlayer);
            Log.e("outToScoring", "disPID : " + disPID);
            int dismissedPlayerID = 0;
//        if (!retired) {

           /* // Added on 06/3/2021
            if (outType == 9)
                dismissedPlayerID = newBatsID;//dismissedPlayrID;
            else    // till here*/
            dismissedPlayerID = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", battingTeamNo).
                    equalTo("playerName", dismissedPlayer).findFirst().getPlayerID();


            //        }

            Log.e("Scoring", "outToScoring, fielderPlayer : " + fielderPlayer);
            Log.e("Scoring", "outToScoring, dismissedPlayer : " + dismissedPlayer);
            Log.e("Scoring", "outToScoring, dismissedPlayerID : " + dismissedPlayerID);


//        if (!fielderPlayer.matches("")){
//
//            if (single) {
//
//                fielderPlayerID = "" + realm.where(Player.class).
//                        equalTo("matchid", matchid).
//                        equalTo("team", fieldingTeamNo).
//                        equalTo("playerName", fielderPlayer).findFirst().getPlayerID();
//
//            }
//
//            else if (multi) {
//
//                // get each player from arraylist and find their ids
//                if (fieldersList.size()>0) {
//
//                    for (int i = 0; i < fieldersList.size(); i++) {
//
//                        fielderPlayerID = fielderPlayerID + realm.where(Player.class).
//                                equalTo("matchid", matchid).
//                                equalTo("team", fieldingTeamNo).
//                                equalTo("playerName", fieldersList.get(i)).findFirst().getPlayerID()
//                                + ", ";
//
//                    }
//                }
//
//            }
//        }
//
//
//        else {
//
//            fielderPlayerID = null;
//        }

            if (!retired) {
                dismissedList.add(dismissedPlayerID);
//                newPartnership = false;
            } else {
                retiredList.add(dismissedPlayerID);
                newPartnership = true;
            }


            Log.e("Partnership", "outToScoring, retired 2 : " + retired);
            Log.e("Partnership", "outToScoring, newPartnership 2 : " + newPartnership);
            Log.e("Scoring", "outToScoring, dismissedPlayerID : " + dismissedPlayerID);
            Log.e("Scoring", "outToScoring, dismissedList : " + dismissedList);
            Log.e("Scoring", "outToScoring, retiredList : " + retiredList);
            Log.e("Scoring", "outToScoring, fielderPlayerID : " + fielderPlayerID);
            Log.e("Scoring", "outToScoring, outType : " + outType);

            Log.d("b4 setExtra", "ballType : " + ballType);
            Log.d("b4 setExtra", "extras : " + extras + ",extraType : " + extraType +
                    ", extra : " + extra + ", extraRun : " + extraRun + ", runsOffBat : " + runsOffBat);
            Log.d("b4 setExtra", "out : " + out + ", outType : " + outType + ", out_run : " + out_run);
            Log.d("b4 setExtra", "strID : " + strID + ", strikerRuns : " + strikerRuns + ", strikerBalls : " + strikerBalls);
            Log.d("b4 setExtra", "nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                    ", nonStrikerBalls : " + nonStrikerBalls);
            Log.d("b4 setExtra", "player1ID : " + player1ID + ", player1Runs : " + player1Runs +
                    ", player1Balls : " + player1Balls);
            Log.d("b4 setExtra", "player2ID : " + player2ID + ", player2Runs : " + player2Runs +
                    ", player2Balls : " + player2Balls);
            Log.d("b4 setExtra", "psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver);
            Log.d("b4 setExtra", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
            Log.d("b4 setExtra", "ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);

            setExtras();
            syncBowler();

            if (outType >= 1 && outType <= 3)
                syncBatsmann(dismissedPlayerID, bowlerID, fielderPlayerID, true, outType,
                        false, false, wk_flag);

            else if ((outType == 0) || ((outType >= 4) && (outType < 9)))
                syncBatsmann(dismissedPlayerID, bowlerID, null, true, outType,
                        false, false, false);

            else if (outType == 10)
                syncBatsmann(dismissedPlayerID, 0, null, false, 10,
                        true, false, false);

            else if (outType == 9 || outType == 11 || outType == 12)
                syncBatsmann(dismissedPlayerID, 0, null, true, outType,
                        false, false, false);



      /*  Log.e("Scoring", "outToScoring, b4 setExtras striker : "+striker);
        Log.e("Scoring", "outToScoring, b4 setExtras strID : "+strID);
        Log.e("Scoring", "outToScoring, b4 setExtras strikerRuns : "+strikerRuns);
        Log.e("Scoring", "outToScoring, b4 setExtras strikerBalls : "+strikerBalls);
        Log.e("Scoring", "outToScoring, b4 setExtras strikerF4s : "+strikerF4s);
        Log.e("Scoring", "outToScoring, b4 setExtras strikerS6s : "+strikerS6s);

        Log.e("Scoring", "outToScoring, b4 setExtras nonStriker : "+nonStriker);
        Log.e("Scoring", "outToScoring, b4 setExtras nstrID : "+nstrID);
        Log.e("Scoring", "outToScoring, b4 setExtras nonStrikerRuns : "+nonStrikerRuns);
        Log.e("Scoring", "outToScoring, b4 setExtras nonStrikerBalls : "+nonStrikerBalls);
        Log.e("Scoring", "outToScoring, b4 setExtras nonStrikerF4s : "+nonStrikerF4s);
        Log.e("Scoring", "outToScoring, b4 setExtras nonStrikerS6s : "+nonStrikerS6s);

        Log.e("Scoring", "outToScoring, b4 setExtras player1 : "+player1);
        Log.e("Scoring", "outToScoring, b4 setExtras player1ID : "+player1ID);
        Log.e("Scoring", "outToScoring, b4 setExtras player1Runs : "+player1Runs);
        Log.e("Scoring", "outToScoring, b4 setExtras player1Balls : "+player1Balls);
        Log.e("Scoring", "outToScoring,  b4 setExtras player1F4s : "+player1F4s);
        Log.e("Scoring", "outToScoring, b4 setExtras player1S6s : "+player1S6s);

        Log.e("Scoring", "outToScoring, b4 setExtras player2 : "+player2);
        Log.e("Scoring", "outToScoring, b4 setExtras player2ID : "+player2ID);
        Log.e("Scoring", "outToScoring, b4 setExtras player2Runs : "+player2Runs);
        Log.e("Scoring", "outToScoring, b4 setExtras player2Balls : "+player2Balls);
        Log.e("Scoring", "outToScoring, b4 setExtras player2F4s : "+player2F4s);
        Log.e("Scoring", "outToScoring, b4 setExtras player2S6s : "+player2S6s);*/


            // updated and entered below on 30/06/2020
            /*  if (!retired && !wide && !noBall && outType > -1 && outType <= 8 *//*outType != 7 &&*//* *//* && outType != 11 || outType != 12)*//*) {

                setOver(12345);                                 // valid ball, but not a run, this s a wicket,
                // so not to count or display the run
            } else if (wide || noBall || out_ball_not_count) {

                setOver(537);
            }*/


            // here

            if (wide || noBall || out_ball_not_count) {
                Log.d("Partnership", "outToScoring 1, out_ball_not_count : " + out_ball_not_count);
                setOver(537);
            } else if (!retired && outType > -1 && outType <= 8) {

                setOver(12345);                                 // valid ball, but not a run, this s a wicket,
                // so not to count or display the run
            }

            Log.d("Partnership", "outToScoring 1, out : " + out);
            Log.d("Partnership", "outToScoring 1, extras : " + extras);
            Log.d("Partnership", "outToScoring 1, wicket : " + wicket);
            Log.d("Partnership", "outToScoring 1, outType : " + outType);
            Log.d("Partnership", "outToScoring 1, psRuns : " + psRuns);
            Log.d("Partnership", "outToScoring 1, psBalls : " + psBalls);
            Log.d("Partnership", "outToScoring 1, player1ID : " + player1ID);
            Log.d("Partnership", "outToScoring 1, ps1ID : " + ps1ID);
            Log.d("Partnership", "outToScoring 1, p1CR : " + p1CR);
            Log.d("Partnership", "outToScoring 1, p1CB : " + p1CB);
            Log.d("Partnership", "outToScoring 1, player2ID: " + player2ID);
            Log.d("Partnership", "outToScoring 1, ps2ID : " + ps2ID);
            Log.d("Partnership", "outToScoring 1, p2CR : " + p2CR);
            Log.d("Partnership", "outToScoring 1, p2CB : " + p2CB);
            Log.d("Partnership", "outToScoring 1, dismissedPlayerID : " + dismissedPlayerID);
            Log.d("Partnership", "outToScoring 1, newPartnership  3: " + newPartnership);
            Log.d("Partnership", "outToScoring 1, retired 3 : " + retired);
            Log.d("Partnership", "outToScoring 1, noneNB 3 : " + noneNB);
            if (newPartnership)
                syncPartnership(wicket + 1, out, dismissedPlayerID, false, false);
            else
                syncPartnership(wicket, out, dismissedPlayerID, false, false);

//        modified = tvCurrentOver.getText().toString();
            udisplay = modified;

            Log.d("Partnership", "outToScoring 1, noneNB 4 : " + noneNB);
            if (runsOffBatNB) {
                Log.d("Partnership", "outToScoring 1, runsOffBatNB 5 : " + runsOffBatNB);
                modified = modified + "\t\t W(" + runsOffBat + ")";
                if (runsOffBat > 0)
                    maiden = false;
            } else if (noneNB) {
                Log.d("Partnership", "outToScoring 1, noneNB 5 : " + noneNB);
                modified = modified + "\t\t W(nb)";
                maiden = false;
            } else if (outType == 2 && out_run > 0) {
                Log.d("Partnership", "outToScoring 1, out_run 5 : " + out_run);
                modified = modified + "\t\t W(" + out_run + ")";
                if (out_run > 0)
                    maiden = false;
            } else if (retired) {
                Log.d("Partnership", "outToScoring 1, retired 5 : " + retired);
                modified = modified + "";
                Log.d("modified4", modified);
                Log.d("udisplay4", udisplay);
            } else {
                Log.d("Partnership", "outToScoring 1, else 5 : W");
                modified = modified + "\t\t W";

                Log.d("modified5", modified);
                Log.d("udisplay5", udisplay);
            }


            tvCurrentOver.setText(modified);
            tvBowlerOver.setText(String.valueOf(new
                    DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));
            tvPlayingOver.setText(String.valueOf(new DecimalFormat("##.#").format(currentOver)));


            if (currentInnings == 1 || currentInnings == 99)
                ll_remainings.setVisibility(View.GONE);

            else {

                ll_remainings.setVisibility(View.VISIBLE);
                if (remainingRuns > 0) {

//                remainingRuns = remainingRuns - run;
                    tvRemainingRuns.setText(String.valueOf(remainingRuns));
                } else {

//                if (remaining_run_flag){
//                    remaining_run_flag = false;
//                    leadingRuns = run - remainingRuns;
//                }
//
//                leadingRuns = leadingRuns + run;

                    tvRemainingRunsText.setText("Leading Runs : ");
                    tvRemainingRuns.setText(String.valueOf(leadingRuns));

                }

                Log.e("Scoring", "outTOScoring, remainingRuns : " + remainingRuns);
                Log.e("Scoring", "outTOScoring, leadingRuns : " + leadingRuns);

                if (tvRemainingOversBallsText.isShown()) {
                    if (remainingBalls > 100) {

                        tvRemainingOversBallsText.setText(", Overs : ");
                        tvRemainingOversBalls.setText(String.valueOf(new DecimalFormat("##.#").format(remainingOver)));
                    } else {

                        tvRemainingOversBallsText.setText(", Balls : ");
                        Log.e("Scoring", "outTOScoring, remainingBalls : " + remainingBalls);
                        tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                    }
                }

                if (innings.matches("single")) {

                    tvRemainingRunsText.setText("Remaining Runs : ");
                } else {

                    if (remainingRuns > 0) {
                        if (currentInnings == 4)
                            tvRemainingRunsText.setText("Remaining Runs : ");
                        else
                            tvRemainingRunsText.setText("Trial Runs : ");
                    } else
                        tvRemainingRunsText.setText("Lead Runs : ");
                }

            }


            if (innings.matches("multi") && totalOver == 1000) {

                tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                tvRemainingOversBalls.setVisibility(View.INVISIBLE);
            } else {

                tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                tvRemainingOversBalls.setVisibility(View.VISIBLE);
            }


            tvTotalRuns.setText(String.valueOf(currentRuns));


            tvBowlerWicket.setText(String.valueOf(bowlerWicket));

            if (!retired) {
                if (noBall || wide || out_ball_not_count)
                    setFOW(dismissedPlayerID, true);
                else
                    setFOW(dismissedPlayerID, false);
            }

            //save extra details to Extracard
            setExtraCard();
            saveOutEvent(dismissedPlayerID);


            tvTotalRuns.setText(String.valueOf(currentRuns));
            tvPlayer1Runs.setText(String.valueOf(player1Runs));
            tvPlayer1Balls.setText(String.valueOf(player1Balls));
            tvPlayer2Runs.setText(String.valueOf(player2Runs));
            tvPlayer2Balls.setText(String.valueOf(player2Balls));
            tvBowlerRuns.setText(String.valueOf(bwRun));
            tvBowlerOver.setText(String.valueOf(new
                    DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));

            Log.e("outToScoring", "outToScoring, allOUT : " + allOUT);
            Log.e("outToScoring", "outToScoring, retired : " + retired);
            Log.e("outToScoring", "outToScoring, newPartnership : " + newPartnership);
            Log.e("outToScoring", "outToScoring10, dismissedPlayer : " + dismissedPlayer);
            Log.e("outToScoring", "outToScoring10, dismissedPlayerID : " + dismissedPlayerID);

            popupOUT.dismiss();

            dismissedPlayerDetails(dismissedPlayerID);
            resetOutValues();

            dismissedPlayer = null;
            dismissedPlayerID = 0;
            ballType = -1;
//            newBatsman = null;


            Log.e("Partnership", "outToScoring, retired 4 : " + retired);
            Log.e("partnership", "outToScoring, newPartnership 4 : " + newPartnership);
            Log.e("Scoring", "outToScoring, retired : " + retired);
            Log.e("Scoring", "outToScoring, retiredList : " + retiredList);
            Log.e("Scoring", "outToScoring, dismissedList : " + dismissedList);
            Log.e("Scoring", "outToScoring, player_count : " + player_count);
//            Log.e("Scoring", "outToScoring, subst : " + subst);
            Log.e("Scoring", "outToScoring, allOUT : " + allOUT);
            Log.e("newBatsman", "outToScoring, newBatsman : " + newBatsman);

        }
    }


    void resetOutValues() {

        outType = 0;
        oType = "";
        fielderPlayer = "";
        runsOffBat = 0;
        checkedItem = -1;
        bye = false;
        lb = false;
        wide = false;
        noBall = false;
        byeNB = false;
        lbNB = false;
        boundaryNB = false;
        runsOffBatNB = false;
        noneNB = false;
        eType = null;
        extraType = -1;
        ballType = -1;
        extraRun = 0;
        extras = false;
//        out = false;
        penalty = false;
        ballCount = false;
        penaltyBallCount = 0;
        bowball = false;
        batsball = false;
        crossed = false;
        retired = false;

        strike = false;
        endOfOver = false;
    }


    void saveOutEvent(int dismissedPlayerID) {

        Log.d("saveout", "saveOUTEvent21 , : " + so_inninngs1Runs);
        // save the OUT event
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball, 0, preInningsRuns,
                remainingRuns, remainingBalls, remainingOver, leadingRuns, innings1Runs, innings2Runs,
                innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/preBowlerID, preBowlerRun,
                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, (runsOffBat + out_run),
                ballType, extraType, extra, outType, dismissedPlayerID, fielderPlayerID, 0,
                penaltyType, penaltyRun, penaltyRunTeam, ballCount, penaltyBallCount, commentary,
                0, mo, maiden, modified, udisplay, tco, tbo, tpbo, 0, sessionType,
                sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs,
                so_inninngs2Runs, declared, freeHit, false, inning_started, 0,
                0, 0, null, pre_out, callBowlerAlert, wk_id,
                keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team, forfeit_innings,
                CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);


        setExtraSwap(/*extraRun*/);

        if (wheel) {
            setWagonWheelRegion(eventID);
        }
    }


    void setExtra() {

//        Log.d("setExtra", " matchid :"+matchid);
//        Log.d("setExtra", " matchID :"+matchID);
        commentary = "";

        LayoutInflater layoutInflater = (LayoutInflater)
                ScoringActivity.this.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
        View customViewEXTRA = layoutInflater.inflate(R.layout.extra, null);

        btn_extra_back = customViewEXTRA.findViewById(R.id.extra_back);
        btn_extra_type = customViewEXTRA.findViewById(R.id.btn_extras_type);
//        btn_extra_penalty = customViewEXTRA.findViewById(R.id.btn_extras_penalty);
//        btn_extra_change_penalty_run = customViewEXTRA.findViewById(R.id.btn_exrtas_change_penalty_run);
        btn_extra_com = customViewEXTRA.findViewById(R.id.btn_extras_com);
        btn_extra_next = customViewEXTRA.findViewById(R.id.bt_extras_next);
        ll_extra_extra = customViewEXTRA.findViewById(R.id.ll_e_extras);

        tvExtrasType = customViewEXTRA.findViewById(R.id.txt_extras_type);
//        tv_extra_penalty = customViewEXTRA.findViewById(R.id.txt_extras_penalty);
//        tvExtraRuns = customViewEXTRA.findViewById(R.id.txt_extra_runs);
//        tvExtraRunsOffBat = customViewEXTRA.findViewById(R.id.txt_runs_off_bat);
        tvExtrasCom = customViewEXTRA.findViewById(R.id.txt_extras_com);

        et_extra_run_extra = customViewEXTRA.findViewById(R.id.edit_extra_run_extra);
        et_runsOffBat_extra = customViewEXTRA.findViewById(R.id.edit_run_off_bat_extra);
//        tvCom = findViewById(R.id.txt_extras_com);
//        cbExtraPenalty = customViewEXTRA.findViewById(R.id.check_penalty);

        et_extra_run_extra.setVisibility(View.GONE);
        et_runsOffBat_extra.setVisibility(View.GONE);
//        et_extra_run_extra.setVisibility(View.GONE);

        //instantiate EXTRA popup window
        popupExtra = new PopupWindow(customViewEXTRA,
                LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.MATCH_PARENT);
        popupExtra.setFocusable(true);
        popupExtra.setOutsideTouchable(true);//isRestricted());
        popupExtra.update();

        //Added on 18/03/2021
        tvExtrasType.setVisibility(View.INVISIBLE);
//        tv_extra_penalty.setVisibility(View.INVISIBLE);
        ll_extra_extra.setVisibility(View.GONE);
        tvExtrasCom.setVisibility(View.GONE);
        // ==== till here

        /*// Added on 16/03/2021
        tvExtrasType.setVisibility(View.INVISIBLE);*/


        //display the EXTRA popup window
        popupExtra.showAtLocation(linearLayout, Gravity.CENTER, 500, 500);

        Log.d("MODIFIED", "setExtra() 1, modified : " + modified);
        Log.d("MODIFIED", "setExtra() 1, udisplay : " + udisplay);


        btn_extra_back.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                extras = false;

                ballType = -1;
                extraType = -1;
//                modified = modified + ""; COMMENTED ON 01/03/2021
                popupExtra.dismiss();
                Log.d("MODIFIED", "setExtra() 2, modified : " + modified);
                Log.d("MODIFIED", "setExtra() 2, udisplay : " + udisplay);

            }
        });


        btn_extra_type.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                checkExtraType();
            }
        });

//        btn_extra_penalty.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                Log.d("MODIFIED", "setExtra() 3, modified : " + modified);
//                Log.d("MODIFIED", "setExtra() 3, udisplay : " + udisplay);
//                setPenalty();
//            }
//        });


        btn_extra_com.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                editExtraCommentary();
            }
        });


        btn_extra_next.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                Log.d("runsOffBat", "btn_extra_next1, " + runsOffBat);
                Log.d("penalty", "setExtra, penalty, " + penalty);

                runsOffBat = 0;
                extraRun = 0;
                if (et_runsOffBat_extra.isShown()) {
                    String s = et_runsOffBat_extra.getText().toString();
                    if (s.matches(""))
                        runsOffBat = 0;
                    else
                        runsOffBat = Integer.parseInt(s);
                    Log.d("runsOffBat", "btn_extra_next2, " + runsOffBat);
//                    noballAlert("Please enter valid Extra Run");
                } else if (et_extra_run_extra.isShown()) {
                    str = et_extra_run_extra.getText().toString();
                    Log.d("extrarun", "str : " + str);
                    Log.d("extrarun", "bye : " + bye);
                    Log.d("extrarun", "lb : " + lb);
                    Log.d("extrarun", "byeNB : " + byeNB);
                    Log.d("extrarun", "lbNB : " + lbNB);
                    Log.d("extrarun", " extraType : " + extraType);

                    if (str.matches("") && (bye || lb || byeNB || lbNB)) {
//                        noballAlert("Please enter extra run");
                        Log.d("NEXT", "setExtra Please enter extra run");
                    } else {

                        if (str.matches(""))
                            extraRun = 0;
                        else
                            extraRun = Integer.parseInt(str);
                    }
                    Log.d("extrarun", "extraRun : " + extraRun);
                }
                /*else if (str.matches("")) {

//                        extraRun = 0;
                        noballAlert("Please enter extra run");
//                    else {
//                        extraRun = Integer.parseInt(str);
//                    }
                }*/

//                else
                if (extraType == -1) {
//                        outAlert(3); // Commente on 19/04/2021
                    outAlert(3, "Please enter required fields");
                } else if (boundaryNB && (runsOffBat != 4 && runsOffBat != 6)) {
                    noballAlert("Please enter boundary values");
                    Log.d("runsOffBat", "btn_extra_next3, " + runsOffBat);
                    Log.d("runsOffBat", "boundaryNB, " + boundaryNB);
                } else if (runsOffBatNB && (runsOffBat == 0))
                    noballAlert("Please enter valid Extra Run");

                else if ((lb || bye || lbNB || byeNB) && extraRun == 0) {
                    Log.d("extrarun", "2 bye : " + bye);
                    Log.d("extrarun", "2 lb : " + lb);
                    Log.d("extrarun", "2 byeNB : " + byeNB);
                    Log.d("extrarun", "2 lbNB : " + lbNB);
                    Log.d("extrarun", "2 extraRun : " + extraRun);
                    Log.d("extrarun", "2 extraType : " + extraType);
                    noballAlert("Please enter valid Extra Run");
                }

                /*else if (runsOffBatNB && (runsOffBat == 4 || runsOffBat == 6)) {
                    noballAlert("Please enter proper values");
                    Log.d("runsOffBat", "btn_extra_next4, " + runsOffBat);
                }*/


                else {

                    Log.d("runsOffBat", "btn_extra_next5, " + runsOffBat);
                    String str = "";
                    firstbowler = false;
                    just_started = false;
                    if (status.matches("start")) {
                        status = "resume";
                        updateMatch(matchid, false);
                    }

                    /*if (et_extra_run_extra.isShown()) {
                        str = et_extra_run_extra.getText().toString();
                    }
                    if (str.matches(""))
                        extraRun = 0;
                    else {
                        extraRun = Integer.parseInt(str);
                    }*/

                    extraToScoring();

                }
            }
        });


    }


    void checkExtraType() {

//        selectOutType();


        extraTypeBuilder = new AlertDialog.Builder(ScoringActivity.this);
        extraTypeBuilder.setIcon(R.drawable.ball);
        extraTypeBuilder.setCancelable(false);
        extraTypeBuilder.setTitle("Extra Type");
        extraTypeBuilder.setSingleChoiceItems(R.array.extraTypeList, checkedItem, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                switch (which) {

                    case 0:

                        bye = true;
                        lb = false;
                        wide = false;
                        noBall = false;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_extra.setVisibility(View.VISIBLE);
                        et_extra_run_extra.setVisibility(View.VISIBLE);
//                        et_extra_run_extra.setText(0);
                        et_runsOffBat_extra.setVisibility(View.INVISIBLE);
                        break;

                    case 1:

                        bye = false;
                        lb = true;
                        wide = false;
                        noBall = false;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_extra.setVisibility(View.VISIBLE);
                        et_extra_run_extra.setVisibility(View.VISIBLE);
//                        et_extra_run_extra.setText(0);
                        et_runsOffBat_extra.setVisibility(View.INVISIBLE);
                        break;

                    case 2:

                        bye = false;
                        lb = false;
                        wide = true;
                        noBall = false;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_extra.setVisibility(View.VISIBLE);
                        et_extra_run_extra.setVisibility(View.VISIBLE);
//                        et_extra_run_extra.setText(wideRun);
                        et_runsOffBat_extra.setVisibility(View.INVISIBLE);
//                        et_extra_run_extra.setText(String.valueOf(wideRun));
                        break;

                    case 3:

                        bye = false;
                        lb = false;
                        wide = false;
                        noBall = true;
                        byeNB = false;
                        lbNB = false;
                        penalty = false;
                        ll_extra_extra.setVisibility(View.VISIBLE);
                        et_extra_run_extra.setVisibility(View.INVISIBLE);
                        et_runsOffBat_extra.setVisibility(View.VISIBLE);
//                        et_extra_run_extra.setText(String.valueOf(noballRun));
                        break;

                    default:
                        Toast.makeText(getApplicationContext(), "please Select an extra type",
                                Toast.LENGTH_SHORT).show();
                        break;

                }
            }
        });

        extraTypeBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                ballType = 8;

                if (bye) {
                    eType = "Byes";
                    extraType = 0;
                } else if (lb) {
                    eType = "Leg Byes";
                    extraType = 1;
                } else if (wide) {

                    eType = "Wide";
                    runsOffBat = 0;
                    extraType = 4;

                    Log.d("Scoring", "setExtra, wide : " + wide);
                    Log.d("Scoring", "setExtra, eType : " + eType);
                } else if (noBall) {

                    eType = "Noball";
//                    ++bowlerNoBall;
                    setNoball();

                }

                if (extras) {
                    tvExtrasType.setVisibility(View.VISIBLE);
                    tvExtrasType.setText(eType);
                } else if (out) {
                    tv_extraType.setText(eType);
                    tv_extraType.setVisibility(View.VISIBLE);
                }

            }
        });

        extraTypeBuilder.setNegativeButton("Cancel", null);

        // create and show the alert dialog
        AlertDialog dialog = extraTypeBuilder.create();
        dialog.show();

    }


    public void setNoball() {

        noballBuilder = new AlertDialog.Builder(ScoringActivity.this);
        noballBuilder.setIcon(R.drawable.ball);
        noballBuilder.setCancelable(false);
        noballBuilder.setTitle("Noball Type");
        noballBuilder.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                extraType = -1;
                bye = false;
                lb = false;
                wide = false;
                noBall = false;
                byeNB = false;
                lbNB = false;
                noneNB = false;

                if (out) {
                    checkOutExtraType();
                } else {
                    checkExtraType();
                }
            }
        });
        noballBuilder.setSingleChoiceItems(R.array.expandNoBallList, checkedItem, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                switch (which) {

                    case 0:
                        byeNB = true;
                        lbNB = false;
                        runsOffBatNB = false;
                        boundaryNB = false;
                        noneNB = false;
                        penalty = false;

                        if (extras) {
//                            ll_extra_extra.setVisibility(View.VISIBLE);
//                            et_extra_run_extra.setVisibility(View.INVISIBLE);
//                            et_runsOffBat_extra.setVisibility(View.VISIBLE);
                            et_extra_run_extra.setVisibility(View.VISIBLE);
                            et_runsOffBat_extra.setVisibility(View.INVISIBLE);
//                            ballType = 8; Commented on 02/07/2021
                        } else if (out) {
                            ll_extra_runs.setVisibility(View.VISIBLE);
                            et_extra_run_out.setVisibility(View.VISIBLE);
                            et_runsOffBat_out.setVisibility(View.INVISIBLE);
//                            ballType = 3; Commented on 02/07/2021
                        }
                        extraType = 3;
                        eType = "Noball + Byes";
                        break;

                    case 1:
                        lbNB = true;
                        byeNB = false;
                        runsOffBatNB = false;
                        boundaryNB = false;
                        noneNB = false;
                        penalty = false;

                        if (extras) {
                            et_extra_run_extra.setVisibility(View.VISIBLE);
                            et_runsOffBat_extra.setVisibility(View.INVISIBLE);
//                            ballType = 8; Commented on 02/07/2021
                        } else if (out) {
                            ll_extra_runs.setVisibility(View.VISIBLE);
                            et_extra_run_out.setVisibility(View.VISIBLE);
                            et_runsOffBat_out.setVisibility(View.INVISIBLE);
//                            ballType = 3; Commented on 02/07/2021
                        }
                        extraType = 6;
                        eType = "Noball + LegByes";
                        break;

                    case 2:
                        runsOffBatNB = true;
                        byeNB = false;
                        lbNB = false;
                        boundaryNB = false;
                        noneNB = false;
                        penalty = false;

                        if (extras) {
                            et_extra_run_extra.setVisibility(View.INVISIBLE);
                            et_runsOffBat_extra.setVisibility(View.VISIBLE);
//                            ballType = 8; Commented on 02/07/2021
                        } else if (out) {
                            ll_extra_runs.setVisibility(View.VISIBLE);
                            et_extra_run_out.setVisibility(View.INVISIBLE);
                            et_runsOffBat_out.setVisibility(View.VISIBLE);
//                            ballType = 3; Commented on 02/07/2021
                        }
                        extraType = 2;
                        eType = "Noball";
                        break;

                    case 3:
                        boundaryNB = true;
                        byeNB = false;
                        lbNB = false;
                        runsOffBatNB = false;
                        noneNB = false;
                        penalty = false;

                        if (extras) {
                            et_extra_run_extra.setVisibility(View.INVISIBLE);
                            et_runsOffBat_extra.setVisibility(View.VISIBLE);
//                            ballType = 8; Commented on 02/07/2021
                        } else if (out) {
                            ll_extra_runs.setVisibility(View.VISIBLE);
                            et_extra_run_out.setVisibility(View.INVISIBLE);
                            et_runsOffBat_out.setVisibility(View.VISIBLE);
//                            ballType = 3; Commented on 02/07/2021
                        }

                        extraType = 2;
                        eType = "Noball";
                        break;

                    case 4:
                        noneNB = true;
                        byeNB = false;
                        lbNB = false;
                        runsOffBatNB = false;
                        boundaryNB = false;
                        penalty = false;

                        if (extras) {
                            et_extra_run_extra.setVisibility(View.INVISIBLE);
                            et_runsOffBat_extra.setVisibility(View.INVISIBLE);
                            ll_extra_extra.setVisibility(View.GONE);
//                            ballType = 8; Commented on 02/07/2021
                        } else if (out) {

                            ll_extra_runs.setVisibility(View.GONE);
                            ll_extras.setVisibility(View.GONE);
                            et_extra_run_out.setVisibility(View.INVISIBLE);
                            et_runsOffBat_out.setVisibility(View.INVISIBLE);
//                            ballType = 3; Commented on 02/07/2021
                        }

                        extraType = 2;
                        eType = "Noball";
                        break;

                    default:
                        Toast.makeText(getApplicationContext(), "Nothing Selected", Toast.LENGTH_SHORT).show();
                }
            }
        });

        noballBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                Log.e("setNoball", "ok,  out : " + out);
                Log.e("setNoball", "ok,  outtype : " + outType);
                Log.e("setNoball", "ok,  runsOffBatNB : " + runsOffBatNB);
                Log.e("setNoball", "ok,  boundaryNB : " + boundaryNB);


                //if (extras || out) {
//                    tvExtrasType.setText(eType);

                if (byeNB || lbNB) {

                    if (byeNB) {
                        extraType = 3;
                        eType = "Noball + Byes";


                           /* extraType = 3;
                            eType = "Noball + Byes";*/
                    } else if (lbNB) {
                        extraType = 6;
                        eType = "Noball + LegByes";
                    }

                    if (outType == 3 || outType == 5 || outType == 6) {
                        if (byeNB)
                            message = oType + " is not a valid dismissal for Noball + Byes";
                        if (lbNB)
                            message = oType + " is not a valid dismissal for Noball + Legbyes";
                        displayError(message);
                    } else {

                        message = "";

                        if (extras) {

                            et_extra_run_extra.setVisibility(View.VISIBLE);
                            et_runsOffBat_extra.setVisibility(View.INVISIBLE);
//                                ballType = 8; Commented on 02/07/2021
                        } else if (out) {


                            ll_extra_runs.setVisibility(View.VISIBLE);
                            et_extra_run_out.setVisibility(View.VISIBLE);
                            et_runsOffBat_out.setVisibility(View.INVISIBLE);
//                                ballType = 3; Commented on 02/07/2021
                        }


/*
                        Commented on 02/07/2021
                            if (extras) {
                                ballType = 8;
                            }

                            if (out) {
                                ballType = 3;
                            }*/
                    }

                } else if (runsOffBatNB || boundaryNB) {

                    eType = "Noball";


                    if (outType == 6 && (boundaryNB || runsOffBatNB)) {
                        message = oType + " is not a valid dismissal for Noball + RunsOffBat";
                        displayError(message);
                    } else {
                        message = "";
                        extraType = 2;

                        if (extras) {

                            et_extra_run_extra.setVisibility(View.INVISIBLE);
                            et_runsOffBat_extra.setVisibility(View.VISIBLE);
//                                ballType = 8; Commented on 02/07/2021
                        } else if (out) {

                            ll_extra_runs.setVisibility(View.VISIBLE);
                            et_extra_run_out.setVisibility(View.INVISIBLE);
                            et_runsOffBat_out.setVisibility(View.VISIBLE);
//                                ballType = 3; Commented on 02/07/2021
                        }

                        /*if (extras) {
                            ballType = 8;
                        }

                        if (out) {
                            ballType = 3;
                        }*/


                    }

                } else if (noneNB) {
                    message = "";

                    eType = "Noball";
                    extraType = 2;

                    if (extras) {

                        et_extra_run_extra.setVisibility(View.INVISIBLE);
                        et_runsOffBat_extra.setVisibility(View.INVISIBLE);
                        ll_extra_extra.setVisibility(View.GONE);
//                            ballType = 8; Commented on 02/07/2021
                    } else if (out) {

                        ll_extra_runs.setVisibility(View.GONE);
                        ll_extras.setVisibility(View.GONE);
                        et_extra_run_out.setVisibility(View.INVISIBLE);
                        et_runsOffBat_out.setVisibility(View.GONE);
//                            ballType = 3; Commented on 02/07/2021
                    }
                }

                //}
//
//                if (out)
//                    tv_extraType.setText(eType);
//
//                else if (extras)
//                    tvExtrasType.setText(eType);

                if (extras) {
                    tvExtrasType.setVisibility(View.VISIBLE);
                    tvExtrasType.setText(eType);
                } else if (out) {
                    tv_extraType.setText(eType);
                    tv_extraType.setVisibility(View.VISIBLE);
                    ll_extras.setVisibility(View.VISIBLE);
                }

            }
        });

        AlertDialog dialog = noballBuilder.create();
        dialog.show();

    }


//    void getExtraRunsOffBat(){
//
//        Log.d("Test", "inside getRunsOffBat");
//        AlertDialog.Builder builder = new AlertDialog.Builder(ScoringActivity.this);
//        builder.setTitle("Enter the Runs");
//
//        final EditText input = new EditText(this);
//
//        input.setInputType(InputType.TYPE_CLASS_NUMBER);
//        builder.setView(input);
//        Log.d("Test", "inside AddRuns()");
//        builder.setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
//            @Override
//            public void onClick(DialogInterface dialog, int which) {
//                dialog.cancel();
//            }
//        });
//        builder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
//
//            //            @Override
//            public void onClick(DialogInterface dialog, int which) {
//
//                if (input.getText().equals(null)){
//                    Toast.makeText(getApplicationContext(),
//                            "Please enter the Run", Toast.LENGTH_SHORT).show();
//                }
//
//                else {
//
//                    try{
//
//                        runsOffBat = Integer.parseInt(input.getText().toString());
//                        tvExtraRunsOffBat.setText(String.valueOf(runsOffBat));
//                        Log.d("Test", "runsoffBat : " + runsOffBat);
//
//                    }
//                    catch(NumberFormatException ex){
//                        // handle your exception
//                        Log.d("Test" , " Exception is : "+ex);
//                    }
//
//                    if (runsOffBat == 4 || runsOffBat == 6) {
//                        checkExtraBoundary(runsOffBat);
//                    }
//                }
//            }
//        });
//
//
//        AlertDialog alert = builder.create();
//        alert.show();
//
//    }


    void checkExtraBoundary(int run) {

        boundryDialog = new AlertDialog.Builder(this);
        boundryDialog.setIcon(R.drawable.ball);
        boundryDialog.setCancelable(false);
        boundryDialog.setTitle("Boundary");
        boundryDialog.setMessage("This is BOUNDARY ?");
        boundryDialog.setNegativeButton("No", new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int which) {
                boundary = false;
            }
        });
        boundryDialog.setPositiveButton("YES", new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int which) {

                boundary = true;
            }
        });

        boundryDialog.show();

    }


    public void setPenalty() {

        int t = 0;
        String[] teams = {teamA, teamB};

        penaltyDialog = new AlertDialog.Builder(ScoringActivity.this);
        penaltyDialog.setIcon(R.drawable.ball);
        penaltyDialog.setCancelable(false);
//        penaltyDialog.setTitle("Penalty Type");
        penaltyDialog.setTitle("Offence committed by :");//Penalty for team");
        penaltyDialog.setSingleChoiceItems(/*R.array.penaltyTypeList*/ teams, checkedItem, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                str = Arrays.asList(teams).get(which);


                /*switch (which) {

                    case 0:
                        penaltyType = 1;
                        str = "Fielding Penalty";   // penalty run goes to current batting team
//                        penaltyRunTeam = fieldingTeamNo;
                        penaltyRunTeam = battingTeamNo;
                        break;

                    case 1:
                        penaltyType = 2;
                        str = "Batting Penalty";    // penalty run goes to current fielding team
//                        penaltyRunTeam = battingTeamNo;
                        penaltyRunTeam = fieldingTeamNo;

                    default:
//                        Toast.makeText(getApplicationContext(), "please Select one Out Type", Toast.LENGTH_SHORT).show();
                        break;


                }*/
                Toast.makeText(getApplicationContext(), oType + " selected", Toast.LENGTH_SHORT).show();

            }

        });

        penaltyDialog.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                Log.d("MODIFIED", "setExtra() 4, modified : " + modified);
                Log.d("MODIFIED", "setExtra() 4, udisplay : " + udisplay);

                extraType = 5;
                /*bye = false;
                lb = false;
                wide = false;
                runsOffBatNB = false;
                byeNB = false;
                lbNB = false;
                boundaryNB = false;
                noneNB = false;*/
                //commented on 27/05/2020
//                penalty = true;
                penalty = true;
//                checkFreeHit = false;
                eType = "Penalty";

                AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
                alertDialog.setIcon(R.drawable.ball);
                alertDialog.setCancelable(false);
                alertDialog.setTitle("You have selected " + str + " for penalty");
                alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                        new DialogInterface.OnClickListener() {
                            public void onClick(DialogInterface dialog, int which) {
                                dialog.dismiss();

                                Log.d("MODIFIED", "setExtra() 5, modified : " + modified);
                                Log.d("MODIFIED", "setExtra() 5, udisplay : " + udisplay);

                                if (str.matches(fieldingTeam)) {        // runs moves to batting team
                                    penalty = true;
                                    penaltyType = 1;
//                                    penaltyRunTeam = battingTeamNo;
                                } else if (str.matches(battingTeam)) {        // runs goes to fielding team
                                    penaltyType = 2;
//                                    penaltyRunTeam = battingTeamNo;
                                }

                                // added on 26/05/2020
                                if (noBall || wide) {

                                    if (extras) {
//                                        tvExtrasType.setVisibility(View.VISIBLE);
//                                        tvExtrasType.setText(eType); Commented on 18/03/2021
//                                        tv_extra_penalty.setVisibility(View.VISIBLE);    // Added on 18/03/2021
//                                        tv_extra_penalty.setText(eType);    // Added on 18/03/2021
                                        ballCount = false;
                                        batsball = false;
                                        bowball = false;
                                    } else if (out) {
                                        ll_extras.setVisibility(View.VISIBLE);
//                                        tv_out_penalty.setVisibility(View.VISIBLE);    // Added on 18/03/2021
                                        tv_extraType.setVisibility(View.VISIBLE);
//                                        tv_extraType.setText(eType);  Commente don 18/03/2021
//                                        tv_out_penalty.setText(eType);   // Added on 18/03/2021
                                    }
                                } else if (extras) {   // because in out case already bowler ball and striker balls are counting
                                    AlertDialog.Builder alertDialog1 = new AlertDialog.Builder(ScoringActivity.this);
                                    alertDialog1.setIcon(R.drawable.ball);
                                    alertDialog1.setCancelable(false);
                                    alertDialog1.setTitle(str);
//                   alertDialog.setMessage("This is BOUNDARY ?");
                                    alertDialog1.setNegativeButton("Ball Counted", new DialogInterface.OnClickListener() {
                                        public void onClick(DialogInterface dialog, int which) {

                                            ballCount = true;
                                            penaltyBallCounted();

                                           /* // added and commented on 26/05/2020
                                            if (penaltyType == 1) {
                                                bowball = true;
                                                batsball = false;
                                            }

                                            else if (penaltyType == 2) {
                                                bowball = false;
                                                batsball = true;
                                            }*/


                                            if (extras) {
//                                                tvExtrasType.setText(eType);  Commente don 18/03/2021
//                                                tv_extra_penalty.setVisibility(View.VISIBLE); // Added on18/03/2021
//                                                tv_extra_penalty.setText(eType); // Added on18/03/2021
                                            } else if (out) {
                                                ll_extras.setVisibility(View.VISIBLE);
                                                tv_extraType.setVisibility(View.VISIBLE);
//                                                tv_extraType.setText(eType);  Commente don 18/03/2021
//                                                tv_out_penalty.setVisibility(View.VISIBLE); // Added on18/03/2021
//                                                tv_out_penalty.setText(eType); // Added on18/03/2021
                                            }


//                                            if (bye || lb || wide || byeNB || lbNB || runsOffBatNB || boundaryNB || noneNB)


//                        setOver(0);
//                        strikerBalls++;
                                        }
                                    });

                                    if (extras) {
                                        alertDialog1.setPositiveButton("Ball Not Counted", new DialogInterface.OnClickListener() {
                                            public void onClick(DialogInterface dialog, int which) {

                                                ballCount = false;
                                                batsball = false;
                                                bowball = false;
//                                                tvExtrasType.setText(eType);   // Commented  on 18/03/2021
//                                                tv_extra_penalty.setVisibility(View.VISIBLE);   // Added on 18/03/2021
//                                                tv_extra_penalty.setText(eType);   // Added on 18/03/2021
                                            }
                                        });
                                    }

                                    alertDialog1.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                                        @Override
                                        public void onClick(DialogInterface dialog, int which) {
                                            dialog.dismiss();
                                            ballCount = false;
                                            batsball = false;
                                            bowball = false;
//                                            extraType = -1;
                                            penalty = false;
//                        savePenalty(penaltyType, penaltyRunTeam);
//                penaltyRun = 5;

                                            // commented due to codes are saved in toScoring method
                                        /*if (penaltyType == 1) {
                                            totalExtras = totalExtras - penaltyRun;
                                            currentRuns = currentRuns - penaltyRun;
                                            psRuns = psRuns - penaltyRun;
                                        }*/

//                                            setPenalty(); COMMENTED ON 01/03/2021
                                            Log.d("MODIFIED", "setExtra() 6, modified : " + modified);
                                            Log.d("MODIFIED", "setExtra() 6, udisplay : " + udisplay);
                                        }
                                    });
                                    alertDialog1.show();

                                }
                            }
                        });
                alertDialog.show();

/*//                penaltyRun = 5;
                if (penaltyType == 1) {
                    savePenalty(penaltyType, penaltyRunTeam, true);       // didn't removed it when both undo & cancel
                    totalExtras = totalExtras + penaltyRun;

                        currentRuns = currentRuns + penaltyRun;
                    setInningsRuns(currentInnings, currentRuns);

//                        if (currentInnings > 1 && remainingRuns > 0){
//
//                            remainingRuns = remainingRuns - penaltyRun;
//
//
//                        }


                        if (currentInnings > 1 && currentInnings != 99) {
                            ll_remainings.setVisibility(View.VISIBLE);

                            leadingRuns = leadingRuns + penaltyRun;
                            if (remainingRuns > 0) {

                                remainingRuns = remainingRuns - penaltyRun;
                                leadingRuns = leadingRuns + penaltyRun;
                                tvRemainingRuns.setText(String.valueOf(remainingRuns));

                            } *//*else if (remainingRuns < 0) {
                                if (leadingRuns == 0) {

                                    leadingRuns = penaltyRun + (-remainingRuns);
//                                    if (leadingRuns < 0)
//                                        temp = -leadingRuns;
                                    leadingRuns = temp;
                                    remainingRuns = 0;
                                    tvRemainingRuns.setText(String.valueOf(leadingRuns));
//                                }

                            } *//*
//                            else if (leadingRuns >= 0 && totalInnings == 4) {
                            if (leadingRuns > remainingRuns && totalInnings == 4) {
                                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                                tvRemainingRunsText.setText("Leading Runs : ");
                            }


                        }
                        else {
                            ll_remainings.setVisibility(View.GONE);
                        }

                        Log.d("Scoring", "setPenalty, leadingRuns : " + leadingRuns);
                        Log.d("Scoring", "setPenalty, remainingRuns : " + remainingRuns);
                }

                else if (penaltyType == 2) {

                    *//*if (currentInnings >)*//*
                }
//                var = extraCard.getPenalty();
//                extraCard.setPenalty(++var);


                AlertDialog.Builder alertDialog = new AlertDialog.Builder(ScoringActivity.this);
                alertDialog.setIcon(R.drawable.ball);
                alertDialog.setCancelable(false);
                alertDialog.setTitle(str);
//                   alertDialog.setMessage("This is BOUNDARY ?");
                alertDialog.setNegativeButton("Ball Counted", new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        ballCount = true;
                        penaltyBallCounted();
//                        setOver(0);
//                        strikerBalls++;
                    }
                });

                if (extras){
                    alertDialog.setPositiveButton("Ball Not Counted", new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {

                           ballCount = false;
                        }
                    });
                }

                alertDialog.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        ballCount = false;
                        extraType = -1;
                        penalty = false;
//                        savePenalty(penaltyType, penaltyRunTeam);
//                penaltyRun = 5;
                        if (penaltyType == 1) {
                            totalExtras = totalExtras - penaltyRun;
                            currentRuns = currentRuns - penaltyRun;
                        }

                        setPenalty();
                    }
                });

                alertDialog.show();*/
            }
        });

        penaltyDialog.setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                Log.d("MODIFIED", "setExtra() 7, modified : " + modified);
                Log.d("MODIFIED", "setExtra() 7, udisplay : " + udisplay);
            }
        });
//        penaltyDialog.setNegativeButton("Cancel", null);


        // create and show the alert dialog
        AlertDialog dialog = penaltyDialog.create();
        dialog.show();

    }


    private void savePenalty(int penaltyType, int penaltyRunTeam, boolean sync, int benefitTeam,
                             boolean ballcount, boolean bowball, boolean batsball) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {

                    try {

                        Number num = bgRealm.where(Penalty.class).max("id");
                        int nextId = (num == null) ? 1 : num.intValue() + 1;

                        Penalty penalty = bgRealm.createObject(Penalty.class, nextId);

                        penalty.setMatchid(matchid);
                        penalty.setMatchID(matchID);
                        penalty.setInnings(currentInnings);
                        penalty.setType(penaltyType);
                        penalty.setPenaltyRun(penaltyRun);
                        penalty.setForTeam(penaltyRunTeam);
                        penalty.setBenefitTeam(benefitTeam);
                        penalty.setBallCount(ballcount);
                        penalty.setBowball(bowball);
                        penalty.setBatsball(batsball);

//                        if (penaltyType == 1)
                        penalty.setSync(sync);
//                        else if (penaltyType == 2)
//                            penalty.setSync(false);

                        bgRealm.copyToRealm(penalty);
                        Log.d("penalty", "savePenalty : " + penalty);


                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


//    public void setPenaltyOut(){
//
//        AlertDialog.Builder penaltyDialog = new AlertDialog.Builder(ScoringActivity.this);
//        penaltyDialog.setTitle("Penalty Type");
//        penaltyDialog.setSingleChoiceItems(R.array.penaltyTypeList, checkedItem, new DialogInterface.OnClickListener() {
//            @Override
//            public void onClick(DialogInterface dialog, int which) {
//
//                switch (which) {
//
//                    case 0:
//                        penaltyType = 1;
//                        str = "Fielding Penalty";
//                        penaltyRunTeam = fieldingTeamNo;
//                        break;
//
//                    case 1:
//                        penaltyType = 2;
//                        str = "Batting Penalty";
//                        penaltyRunTeam = battingTeamNo;
//
//                    default:
//                        Toast.makeText(getApplicationContext(), "please Select one Out Type", Toast.LENGTH_SHORT).show();
//                        break;
//
//
//                }
//                Toast.makeText(getApplicationContext(), oType + " selected", Toast.LENGTH_SHORT).show();
//
//            }
//
//        });
//
//        penaltyDialog.setPositiveButton("OK", new DialogInterface.OnClickListener() {
//            @Override
//            public void onClick(DialogInterface dialog, int which) {
//
//                penalty = true;
////                penaltyRun = 5;
//                totalExtras = totalExtras + penaltyRun;
////                var = extraCard.getPenalty();
////                extraCard.setPenalty(++var);
//
//
//                AlertDialog.Builder alertDialog = new AlertDialog.Builder(getApplicationContext());
//                alertDialog.setTitle(str);
////                   alertDialog.setMessage("This is BOUNDARY ?");
//                alertDialog.setNegativeButton("Ball Counted", new DialogInterface.OnClickListener() {
//                    public void onClick(DialogInterface dialog, int which) {
//
//                        ballCount = true;
//                        penaltyBallCounted();
////                        setOver(0);
////                        strikerBalls++;
//                    }
//                });
//                alertDialog.setPositiveButton("Ball Not Counted", new DialogInterface.OnClickListener() {
//                    public void onClick(DialogInterface dialog, int which) {
//
//                        ballCount = false;
//                    }
//                });
//
//                alertDialog.show();
//            }
//        });
//
//        penaltyDialog.setNegativeButton("Cancel", null);
//
//        // create and show the alert dialog
//        AlertDialog dialog = penaltyDialog.create();
//        dialog.show();
//
//    }


    public void penaltyBallCounted() {

        penaltyBalllCountDialog = new AlertDialog.Builder(ScoringActivity.this);
        penaltyBalllCountDialog.setIcon(R.drawable.ball);
        penaltyBalllCountDialog.setCancelable(false);
        penaltyBalllCountDialog.setTitle("Penalty Type");
        penaltyBalllCountDialog.setSingleChoiceItems(R.array.penaltyBallCountList, checkedItem, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                switch (which) {

                    case 0:
                        bowball = true;
                        batsball = false;
                        break;

                    case 1:
                        batsball = true;
                        bowball = false;
                        break;
                }
            }
        });


        penaltyBalllCountDialog.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
//                ll_extras.setVisibility(View.VISIBLE);
                if (extras) {
//                    tvExtrasType.setText(eType); Commented on 18/03/2021
//                    tv_extra_penalty.setVisibility(View.VISIBLE); // Added on18/03/2021
//                    tv_extra_penalty.setText(eType);   // Added on 18/03/2021
                } else if (out) {
                    ll_extras.setVisibility(View.VISIBLE);
                    tv_extraType.setVisibility(View.VISIBLE);
                    tv_extraType.setText(eType);
                }

            }
        });

        penaltyBalllCountDialog.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                ballCount = false;
                extraType = -1;
                penalty = false;
                // Added on18/03/2021
//                if (extras)
//                    tv_extra_penalty.setVisibility(View.INVISIBLE);
//                else if (out)
//                    tv_out_penalty.setVisibility(View.INVISIBLE);
                // === till here
//                        savePenalty(penaltyType, penaltyRunTeam);
//                penaltyRun = 5;

                // need to check
                if (penaltyType == 1) {
                    totalExtras = totalExtras - penaltyRun;
                    currentRuns = currentRuns - penaltyRun;
                    psRuns = psRuns - penaltyRun;
                }

                setPenalty();
            }
        });

        penaltyBalllCountDialog.show();

    }


    void editExtraCommentary() {

        comBuilder = new AlertDialog.Builder(ScoringActivity.this);
        comBuilder.setIcon(R.drawable.ball);
        comBuilder.setCancelable(false);
        comBuilder.setTitle("Enter the commentary");

        final EditText input = new EditText(this);

        input.setInputType(InputType.TYPE_CLASS_TEXT);
        input.setText(commentary);
        comBuilder.setView(input);
//        Log.d("Test", "inside setCommentry()");
        comBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {

            //            @Override
            public void onClick(DialogInterface dialog, int which) {

                if (input.getText().toString().equals(null)) {
                    Toast.makeText(getApplicationContext(),
                            "Please enter the Run", Toast.LENGTH_SHORT).show();
                } else {
                    commentary = input.getText().toString();
                    Log.d("Test", "BuilderText : " + commentary);

                    if (!commentary.matches("")) {

                        tvExtrasCom.setVisibility(View.VISIBLE);    // Added on 18/03/2021
                        tvExtrasCom.setText(commentary);

                    } else {
                        Log.d("Test", "buildertext = null");
                    }

                }
            }
        });

        comBuilder.setNegativeButton("Cancel", null);

        AlertDialog alert = comBuilder.create();
        alert.show();

    }


    void extraToScoring() {
        ballType = 8;
        confirm_extras = true;

        Log.d("Scoring", "extraToScoring, noball : " + noBall);
        Log.d("Scoring", "extraToScoring, runsOffBatNB : " + runsOffBatNB);
        Log.d("Scoring", "extraToScoring, runsOffBat : " + runsOffBat);
        Log.d("Scoring", "extraToScoring, wide : " + wide);
        Log.d("Scoring", "extraToScoring, eType : " + eType);
        Log.d("Scoring", "extraToScoring, extra : " + extra);
        Log.d("Scoring", "extraToScoring, extraRun : " + extraRun);
        Log.d("Scoring", "extraToScoring, extraType : " + extraType);
        Log.d("Scoring", "extraToScoring, penalty : " + penalty);

//        Log.d("extraToScoring", " matchid :"+matchid);
//        Log.d("extraToScoring", " matchID :"+matchID);

//        Intent i = new Intent(ExtrasActivity.this, ScoringActivity.class);
//        i.putExtra("extraType", type);
//        i.putExtra("extraRuns", extra);
//        i.putExtra("ballCount", ball);
//        i.putExtra("runsOffBat", runsoffBatExtra);
//        i.putExtra("extraType", extraType);
//        i.putExtra("ballType", ballType);
//        i.putExtra("boundary", boundary);
//        i.putExtra("commentary", commentary);
//
//        startActivity(i);


        if (bye || lb) {
            Log.e("Scoring", "extraToScoring, bye/lb");

//            if (bye) {

            if (strID == player1ID) {
                ++player1Balls;
                strikerBalls = player1Balls;
                tvPlayer1Balls.setText(String.valueOf(player1Balls));
            }
            if (strID == player2ID) {
                ++player2Balls;
                strikerBalls = player2Balls;
                tvPlayer2Balls.setText(String.valueOf(player2Balls));
            }

            if (strID == ps1ID) {
                ++p1CB;
            } else if (strID == ps2ID) {
                ++p2CB;
            }
           /* }

            else if (lb) {


                if (strID ==player1ID) {
                    ++player1Balls;
                    strikerBalls = player1Balls;
                    tvPlayer1Balls.setText(String.valueOf(player1Balls));
                }
                if (strID == player2ID) {
                    ++player2Balls;
                    strikerBalls = player2Balls;
                    tvPlayer2Balls.setText(String.valueOf(player2Balls));
                }

                if (strID == ps1ID) {
                    ++p1CB;
                }
                else if (strID == ps2ID) {
                    ++p2CB;
                }
            }*/
            ++bowlerBalls;
            setOver(extraRun);
        } else if (noBall)
            ++bowlerNoBall;


//        if (extraType == 4)
//            bowlerWide = bowlerWide + extra;

        out = false;
        setExtras();
        Log.e("Scoring", "extraToScoring, noball : " + noBall);


//        displayCurrentOver(runsOffBat, 0, eType, extra);
//        displayCurrentOver();

        Log.d("Scoring", "extra to scoring, balltype: " + ballType);
        Log.d("Scoring", "extra to scoring, extraType: " + extraType);
        Log.d("Scoring", "extra to scoring, extra run : " + extra);
        Log.d("Scoring", "extra to scoring, runsOffBat: " + runsOffBat);
//        Log.d("Scoring", "extra to scoring, runsOffBatNB: "+runsOffBatNB);
       /* if (runsOffBat > 0) {
            wheel = true;
//            bwRun = bwRun + runsOffBat;
        }
        else
            wheel = false;*/


        syncBowler();

        syncBatsmann(strID, 0, null, false, -1, false,
                false, false);
        Log.d("Partnership", "extraToScoring 1, wicket : " + wicket);
        Log.d("Partnership", "extraToScoring 1, psRuns : " + psRuns);
        Log.d("Partnership", "extraToScoring 1, psBalls : " + psBalls);
        Log.d("Partnership", "extraToScoring 1, player1ID : " + player1ID);
        Log.d("Partnership", "extraToScoring 1, ps1ID : " + ps1ID);
        Log.d("Partnership", "extraToScoring 1, p1CR : " + p1CR);
        Log.d("Partnership", "extraToScoring 1, p1CB : " + p1CB);
        Log.d("Partnership", "extraToScoring 1, player2ID: " + player2ID);
        Log.d("Partnership", "extraToScoring 1, ps2ID : " + ps2ID);
        Log.d("Partnership", "extraToScoring 1, p2CR : " + p2CR);
        Log.d("Partnership", "extraToScoring 1, p2CB : " + p2CB);
        syncPartnership(wicket + 1, false, 0, false, false);


        //save extra details to Extracard

        setExtraCard();


        if (penalty && penaltyType == 2)
            setExtraEvent(false);

        else
            setExtraEvent(true);


//        Log.d("xtracard", "object ; "+extraCard);
//        Log.d("xtracard", "b ; "+extraCard.getByes());
//        Log.d("xtracard", "lb ; "+extraCard.getLb());
//        Log.d("xtracard", "nb ; "+extraCard.getNoBall());
//        Log.d("xtracard", "wd ; "+extraCard.getWide());
//        Log.d("xtracard", "p ; "+extraCard.getPenalty());


        // reset all keywords used in Extras

        resetExtra();


        tvTotalRuns.setText(String.valueOf(currentRuns));
        tvPlayer1Runs.setText(String.valueOf(player1Runs));
        tvPlayer1Balls.setText(String.valueOf(player1Balls));
        tvPlayer2Runs.setText(String.valueOf(player2Runs));
        tvPlayer2Balls.setText(String.valueOf(player2Balls));
        tvBowlerRuns.setText(String.valueOf(bwRun));
        tvBowlerOver.setText(String.valueOf(new
                DecimalFormat("##.#").format(setOverDisplay(bowlerOver, bowlerBalls))));


        popupExtra.dismiss();


        if (checkFreeHit)
            checkFreeHitBall();

    }


    void setExtraSwap(/*int extraRun*/) {

        Log.d("extraRun", "setExtraSwap : " + extraRun);

        if (extraRun % 2 != 0)
            swap();

        else if (runsOffBat % 2 != 0)
            swap();

        else if ((out_run % 2) != 0)
            swap();

       /*  commented on 22/10/2020
        else if (crossed) *//*|| ((runsOffBat % 2) != 0)*//*
            swap();*/

        // added on 22/10/2020
        if (crossed)
            swap();
    }


    void setExtraEvent(boolean displayPenalty) {

        Log.d("setExtraEvent", "runsOfbatNB : " + runsOffBatNB);
        Log.d("setExtraEvent", "runsOfbat : " + runsOffBat);

        udisplay = modified;

//        modified = tvCurrentOver.getText().toString();
        if (extraType == 0)
            modified = modified + "\t\tb(" + extra + ")";
        else if (extraType == 1)
            modified = modified + "\t\tlb(" + extra + ")";
        else if (extraType == 2)
            modified = modified + "\t\tnb(" + (extra + runsOffBat) + ")";
        else if (extraType == 3)
            modified = modified + "\t\tnbb(" + extra + ")";
        else if (extraType == 4)
            modified = modified + "\t\twd(" + extra + ")";
        else if (extraType == 5) {
            if (displayPenalty)
                modified = modified + "\t\tp(" + penaltyRun + ")";
        } else if (extraType == 6)
            modified = modified + "\t\tnblb(" + extra + ")";
        else
            modified = modified + "\t\t" + runsOffBat;
        tvCurrentOver.setText(modified);

        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo,
                player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID, nonStrikerRuns,
                nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/
                preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                runsOffBat, ballType, extraType, extra, 0, 0, null,
                0, penaltyType, penaltyRun, penaltyRunTeam, ballCount, penaltyBallCount,
                commentary, 0, mo, maiden, modified, udisplay, tco, tbo, tpbo, 0,
                sessionType, sessionID, wheel, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                so_inninngs1Runs, so_inninngs2Runs, declared, freeHit, false, inning_started,
                0, 0, 0, null, pre_out, callBowlerAlert,
                wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team, forfeit_innings,
                CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);


        setExtraSwap();

        if (wheel) {
            setWagonWheelRegion(eventID);
        }

//        wheel = false;
    }


    void resetExtra() {

        extras = false;
        confirm_extras = false;
        bye = false;
        lb = false;
        wide = false;
        noBall = false;
        eType = "";
        extraType = -1;
        ballType = -1;
        extraRun = 0;
        ballExtra = 0;
        runsOffBat = 0;
        byeNB = false;
        lbNB = false;
        strike = false;
        runsOffBatNB = false;
        boundaryNB = false;
        noneNB = false;
        str = "";
        penalty = false;
        ballCount = false;
        bowball = false;
        batsball = false;
        commentary = "";
//        tvExtraCom.setText(commentary);
        endOfOver = false;
        checkedItem = -1;
    }


    public void setExtras() {
        int t = 0;

        if (noBall) {

            if (totalInnings == 2)
                checkFreeHit = true;

            if (byeNB || lbNB) {

                extra = extraRun + noballRun;
                mo = mo + noballRun + extraRun;
                Log.d("scoring", "setExtras, extraRun : " + extraRun + ", noballRun : " + noballRun);


                if (extras) {
                    if (strID == player1ID) {
                        ++player1Balls;
                        strikerBalls = player1Balls;
                    }
                    if (strID == player2ID) {
                        ++player2Balls;
                        strikerBalls = player2Balls;
                    }

                    if (strID == ps1ID) {
                        ++p1CB;
                    } else if (strID == ps2ID) {
                        ++p2CB;
                    }
                }

                bwRun = bwRun + noballRun;
                mo = mo + noballRun;
//                if (extraRun % 2 != 0)
//                    swap();
                currentRuns = currentRuns + extra;
                psRuns = psRuns + extra;
                setInningsRuns(currentInnings, currentRuns);
                if (currentInnings > 1 && currentInnings != 99) {
                    ll_remainings.setVisibility(View.VISIBLE);
//                    remainingRuns = remainingRuns - extra;

                    remainingRuns = remainingRuns - extra;
                    leadingRuns = leadingRuns + extra;

                    if (remainingRuns > 0) {
                        tvRemainingRuns.setText(String.valueOf(remainingRuns));
                    }

                    if (leadingRuns > remainingRuns && totalInnings == 4) {
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
                        tvRemainingRunsText.setText("Leading Runs : ");
                    }

                    Log.d("Scoring", "setExtras, leadingRuns : " + leadingRuns);
                    Log.d("Scoring", "setExtras, remainingRuns : " + remainingRuns);

                } else
                    ll_remainings.setVisibility(View.GONE);


                if (byeNB)
                    string = "Noball + Byes";

                else
                    string = "Noball +  Leg Byes";
            } else if (runsOffBatNB) {

                strike = true;
                extra = noballRun;
                mo = mo + noballRun + runsOffBat;

                bwRun = bwRun + noballRun;
                Log.d("scoring", "setExtras, runsOffBat : " + runsOffBat + ", noballRun : " + noballRun);
//                mo = mo + runsOffBat + noballRun;
                tvBowlerRuns.setText(String.valueOf(bwRun));

                if (!out) {

                    bwRun = bwRun + runsOffBat;

                    if (strID == player1ID) {
                        ++player1Balls;
                        strikerBalls = player1Balls;
                        player1Runs = player1Runs + runsOffBat;
                        strikerRuns = player1Runs;
//                    tvPlayer1Runs.setText(String.valueOf(player1Runs));
//                    tvPlayer1Balls.setText(String.valueOf(player1Balls));
                    }
                    if (strID == player2ID) {
                        ++player2Balls;
                        strikerBalls = player2Balls;
                        player2Runs = player2Runs + runsOffBat;
                        strikerRuns = player2Runs;
//                    tvPlayer2Runs.setText(String.valueOf(player2Runs));
//                    tvPlayer2Balls.setText(String.valueOf(player2Balls));
                    }

                    if (strID == ps1ID) {
                        ++p1CB;
                        p1CR = p1CR + runsOffBat;
                    } else if (strID == ps2ID) {
                        ++p2CB;
                        p2CR = p2CR + runsOffBat;
                    }

//                    if (runsOffBat % 2 != 0)
//                        swap();

                    if (extras) {
                        if (runsOffBat == 0) {

                            if (strID == player1ID) {
                                ++player1Dots;
                                strikerDots = player1Dots;
                            }
                            if (strID == player2ID) {
                                ++player2Dots;
                                strikerDots = player2Dots;
                            }
                            ++bowlerDots;
                        }
                    }

                    currentRuns = currentRuns + runsOffBat;
                    psRuns = psRuns + runsOffBat;
                }

                currentRuns = currentRuns + noballRun;
                psRuns = psRuns + noballRun;
                setInningsRuns(currentInnings, currentRuns);
                if (currentInnings > 1 && currentInnings != 99) {
                    ll_remainings.setVisibility(View.VISIBLE);

                    remainingRuns = remainingRuns - (runsOffBat + noballRun);
                    leadingRuns = leadingRuns + (runsOffBat + noballRun);

                    if (remainingRuns > 0) {
                        tvRemainingRuns.setText(String.valueOf(remainingRuns));
                    }

                    if (leadingRuns > remainingRuns && totalInnings == 4) {
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
                        tvRemainingRunsText.setText("Leading Runs : ");
                    }

                    Log.d("scoring", "setExtras 2, leadingRuns : " + leadingRuns);
                    Log.d("scoring", "setExtras 2, remainingRuns : " + remainingRuns);

                } else
                    ll_remainings.setVisibility(View.GONE);
//                    remainingRuns = remainingRuns - (runsOffBat + noballRun);
//                tvTotalRuns.setText(String.valueOf(currentRuns));
            } else if (boundaryNB) {

                strike = true;
                extra = noballRun;

                mo = mo + noballRun;

                bwRun = bwRun + noballRun;
                Log.d("scoring", "setExtras, runsOffBat : " + runsOffBat + ", noballRun : " + noballRun + ", out : " + out);
                mo = mo + runsOffBat + noballRun;
                tvBowlerRuns.setText(String.valueOf(bwRun));

                if (!out) {

                    bwRun = bwRun + runsOffBat;

                    if (strID == player1ID) {
                        ++player1Balls;
                        strikerBalls = player1Balls;
                        player1Runs = player1Runs + runsOffBat;
                        strikerRuns = player1Runs;
//                    tvPlayer1Runs.setText(String.valueOf(player1Runs));
//                    tvPlayer1Balls.setText(String.valueOf(player1Balls));
                    }
                    if (strID == player2ID) {
                        ++player2Balls;
                        strikerBalls = player2Balls;
                        player2Runs = player2Runs + runsOffBat;
                        strikerRuns = player2Runs;
//                    tvPlayer2Runs.setText(String.valueOf(player2Runs));
//                    tvPlayer2Balls.setText(String.valueOf(player2Balls));

                    }

                    if (strID == ps1ID) {
                        ++p1CB;
                        p1CR = p1CR + runsOffBat;
                    } else if (strID == ps2ID) {
                        ++p2CB;
                        p2CR = p2CR + runsOffBat;
                    }

                    /*if (runsOffBat == 0) {

                        if (strID == player1ID) {
                            ++player1Dots;
                            strikerDots = player1Dots;
                        }
                        if (strID == player2ID) {
                            ++player2Dots;
                            strikerDots = player2Dots;
                        }
                        ++bowlerDots;
                    }

                    else*/
                    if (runsOffBat == 4) {

                        if (strID == player1ID) {
                            ++player1F4s;
                            strikerF4s = player1F4s;
                        }
                        if (strID == player2ID) {
                            ++player2F4s;
                            strikerF4s = player2F4s;
                        }
                        ++bowlerF4s;
                    } else if (runsOffBat == 6) {

                        if (strID == player1ID) {
                            ++player1S6s;
                            strikerS6s = player1S6s;
                        }
                        if (strID == player2ID) {
                            ++player2S6s;
                            strikerS6s = player2S6s;
                        }
                        ++bowlerS6s;
                    }

                    currentRuns = currentRuns + runsOffBat;
                    psRuns = psRuns + runsOffBat;

                }

                currentRuns = currentRuns + noballRun;
                psRuns = psRuns + noballRun;
                setInningsRuns(currentInnings, currentRuns);
//                tvTotalRuns.setText(String.valueOf(currentRuns));


                if (currentInnings > 1 && currentInnings != 99) {
                    ll_remainings.setVisibility(View.VISIBLE);

                    remainingRuns = remainingRuns - (runsOffBat + noballRun);
                    leadingRuns = leadingRuns + (runsOffBat + noballRun);

                    if (remainingRuns > 0) {
                        tvRemainingRuns.setText(String.valueOf(remainingRuns));
                    }

                    if (leadingRuns > remainingRuns && totalInnings == 4) {
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
                        tvRemainingRunsText.setText("Leading Runs : ");
                    }

                    Log.d("scoring", "setExtras 3, leadingRuns : " + leadingRuns);
                    Log.d("scoring", "setExtras 3, remainingRuns : " + remainingRuns);
                } else
                    ll_remainings.setVisibility(View.GONE);

            } else if (noneNB) {

                strike = false;
                extra = noballRun;

                bwRun = bwRun + noballRun;
                Log.d("scoring", "setExtras, runsOffBat : " + runsOffBat + ", noballRun : " + noballRun + ", out : " + out);
                mo = mo + noballRun;
                tvBowlerRuns.setText(String.valueOf(bwRun));

                if (extras) {
                    if (runsOffBat == 0) {

                        if (strID == player1ID) {
                            ++player1Balls;
                            strikerBalls = player1Balls;
                            ++player1Dots;
                            strikerDots = player1Dots;
                        }
                        if (strID == player2ID) {
                            ++player2Balls;
                            strikerBalls = player2Balls;
                            ++player2Dots;
                            strikerDots = player2Dots;
                        }
                        ++bowlerDots;
                    }
                }

                currentRuns = currentRuns + noballRun;
                psRuns = psRuns + noballRun;
                setInningsRuns(currentInnings, currentRuns);

                if (currentInnings > 1 && currentInnings != 99) {
                    ll_remainings.setVisibility(View.VISIBLE);

                    remainingRuns = remainingRuns - (runsOffBat + noballRun);
                    leadingRuns = leadingRuns + (runsOffBat + noballRun);

                    if (remainingRuns > 0) {
                        tvRemainingRuns.setText(String.valueOf(remainingRuns));
                    }

                    if (leadingRuns > remainingRuns && totalInnings == 4) {
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
                        tvRemainingRunsText.setText("Leading Runs : ");
                    }

                    Log.d("scoring", "setExtras 3, leadingRuns : " + leadingRuns);
                    Log.d("scoring", "setExtras 3, remainingRuns : " + remainingRuns);
                } else
                    ll_remainings.setVisibility(View.GONE);
            }


        } else if (wide) {

            checkFreeHit = false;

            extra = extraRun + wideRun;
            mo = mo + wideRun + extraRun;
            Log.d("Scoring", "setExtra, extraRun : " + extraRun + ", wideRun : " + wideRun);

//            if (extraRun % 2 != 0)
//                swap();
            currentRuns = currentRuns + extra;
            psRuns = psRuns + extra;
            setInningsRuns(currentInnings, currentRuns);
            bwRun = bwRun + extra;
            bowlerWide = bowlerWide + extra;

            if (currentInnings > 1 && currentInnings != 99) {
                ll_remainings.setVisibility(View.VISIBLE);

//                if (currentInnings > 1 && currentInnings != 99){

                leadingRuns = leadingRuns + extra;
                remainingRuns = remainingRuns - extra;

                if (remainingRuns > 0) {
                    tvRemainingRuns.setText(String.valueOf(remainingRuns));
                }

                if (leadingRuns > remainingRuns && totalInnings == 4) {
                    tvRemainingRuns.setText(String.valueOf(leadingRuns));
                    tvRemainingRunsText.setText("Leading Runs : ");
                }

                Log.d("scoring", "setExtras 4, leadingRuns : " + leadingRuns);
                Log.d("scoring", "setExtras 4, remainingRuns : " + remainingRuns);
            } else
                ll_remainings.setVisibility(View.GONE);

            totalExtras = totalExtras + extra;
        } else if (lb || bye) {

            checkFreeHit = false;
            extra = extraRun;
            Log.d("Scoring", "setExtra, extraRun : " + extraRun);
//            if (extraRun % 2 != 0)
//                swap();
            currentRuns = currentRuns + extra;
            psRuns = psRuns + extra;
            remainingRuns = remainingRuns - extra;
            leadingRuns = leadingRuns + extra;
            setInningsRuns(currentInnings, currentRuns);
//            tvTotalRuns.setText(String.valueOf(currentRuns));
            if (currentInnings > 1) { //&& remainingRuns > 0) {

                ll_remainings.setVisibility(View.VISIBLE);

                if (remainingRuns > 0) {
                    tvRemainingRuns.setText(String.valueOf(remainingRuns));
                }

                if (leadingRuns > remainingRuns && totalInnings == 4) {
                    tvRemainingRuns.setText(String.valueOf(leadingRuns));
                    tvRemainingRunsText.setText("Leading Runs : ");
                }

                Log.d("scoring", "setExtras 5, leadingRuns : " + leadingRuns);
                Log.d("scoring", "setExtras 5, remainingRuns : " + remainingRuns);
            } else
                ll_remainings.setVisibility(View.GONE);

            totalExtras = totalExtras + extra;
        }


        Log.d("penalty", "penalty : " + penalty);
        Log.d("penalty", "penaltyType : " + penaltyType);
        Log.d("penalty", "extras : " + extras);
        Log.d("penalty", "ballCount : " + ballCount);
        Log.d("penalty", "bowball : " + bowball);
        Log.d("penalty", "batsball : " + batsball);

        /*else*/
        if (penalty) {

            if (penaltyType == 1) {     // fielding penalty, runs added to batting team

//                savePenalty(penaltyType, penaltyRunTeam, true, battingTeamNo);
                // didn't removed it when both undo & cancel
                extra = penaltyRun;
//                mo = mo + penaltyRun;
                totalExtras = totalExtras + penaltyRun;

                currentRuns = currentRuns + penaltyRun;
                psRuns = psRuns + penaltyRun;
                setInningsRuns(currentInnings, currentRuns);

                if (currentInnings > 1 && currentInnings != 99) {
                    ll_remainings.setVisibility(View.VISIBLE);
//                                        penaltyType = 1;
                    leadingRuns = leadingRuns + penaltyRun;
                    if (remainingRuns > 0) {

                        remainingRuns = remainingRuns - penaltyRun;
//                                            leadingRuns = leadingRuns + penaltyRun;
                        tvRemainingRuns.setText(String.valueOf(remainingRuns));

                    }

                    if (leadingRuns > remainingRuns && totalInnings == 4) {
                        tvRemainingRuns.setText(String.valueOf(leadingRuns));
                        tvRemainingRunsText.setText("Leading Runs : ");
                    }

                } else {
                    ll_remainings.setVisibility(View.GONE);
                }
            } else if (penaltyType == 2) {    //batting penalty, runs added to fielding team

                extra = 0;

                if (totalInnings == currentInnings) {
                    remainingRuns = remainingRuns + penaltyRun;
//                    savePenalty(penaltyType, penaltyRunTeam, true, fieldingTeamNo);
                    if (currentInnings == 2) {
                        innings1Runs = innings1Runs + penaltyRun;
                    } else {
                        if (!followon)
                            innings3Runs = innings3Runs + penaltyRun;
                    }
                    // didn't removed it when both undo & cancel
                } else if (SUPER_OVER) {

                    remainingRuns = remainingRuns + penaltyRun;
//                    savePenalty(penaltyType, penaltyRunTeam, true, fieldingTeamNo);
                    if (currentInnings == 100) {
                        so_inninngs1Runs = so_inninngs1Runs + penaltyRun;
                        Log.d("so_inninngs1Runs", "setPenalty22 , : " + so_inninngs1Runs);
                    }
                }
//                else
//                    savePenalty(penaltyType, penaltyRunTeam, false, fieldingTeamNo);
            }

            if (extras) {
                if (ballCount) {

                    if (bowball) {

                        if (bye || lb || wide || byeNB || lbNB || runsOffBatNB || boundaryNB || noneNB) {

                        } else {
                            ++bowlerBalls;
                            ++bowlerDots;
//                        bowlerOver = bowlerOver + 0.1f;
                            setOver(0);
//                        strikerBalls++;
                            penaltyBallCount = 1;
                            if (striker.matches(player1)) {
                                player1Balls++;
                                strikerBalls = player1Balls;
                                tvPlayer1Balls.setText(String.valueOf(player1Balls));
                                ++player1Dots;
                                strikerDots = player1Dots;
                            }
                            if (striker.matches(player2)) {
                                player2Balls++;
                                strikerBalls = player2Balls;
                                tvPlayer2Balls.setText(String.valueOf(player2Balls));
                                ++player2Dots;
                                strikerDots = player2Dots;
                            }

                            if (strID == ps1ID) {
                                ++p1CB;
                            } else if (strID == ps2ID) {
                                ++p2CB;
                            }
                        }
                    } else if (batsball) {
                        if (striker.matches(player1)) {
                            player1Balls++;
                            strikerBalls = player1Balls;
                            tvPlayer1Balls.setText(String.valueOf(player1Balls));
                            ++player1Dots;
                            strikerDots = player1Dots;
                        }
                        if (striker.matches(player2)) {
                            player2Balls++;
                            strikerBalls = player2Balls;
                            tvPlayer2Balls.setText(String.valueOf(player2Balls));
                            ++player2Dots;
                            strikerDots = player2Dots;
                        }

                        if (strID == ps1ID) {
                            ++p1CB;
                        } else if (strID == ps2ID) {
                            ++p2CB;
                        }
                    }
                }
            }


            if (penaltyType == 1) {
                penaltyTeam = battingTeamNo;
                savePenalty(penaltyType, penaltyRunTeam, true, battingTeamNo, ballCount, bowball, batsball);
            } else if (penaltyType == 2) {
                penaltyTeam = fieldingTeamNo;
                if ((totalInnings == currentInnings) || SUPER_OVER)
                    savePenalty(penaltyType, penaltyRunTeam, true, fieldingTeamNo, ballCount, bowball, batsball);

//                else if (SUPER_OVER)
//                    savePenalty(penaltyType, penaltyRunTeam, true, fieldingTeamNo, ballCount, bowball, batsball);

                else
                    savePenalty(penaltyType, penaltyRunTeam, false, fieldingTeamNo, ballCount, bowball, batsball);
            }
        }


        if (currentInnings == 1 || currentInnings == 99)
            ll_remainings.setVisibility(View.GONE);

        else {

            ll_remainings.setVisibility(View.VISIBLE);

            if (remainingRuns > 0)
                tvRemainingRuns.setText(String.valueOf(remainingRuns));
//            else if (leadingRuns >= 0 && totalInnings == 4) {
            if (leadingRuns > remainingRuns && totalInnings == 4) {
                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                tvRemainingRunsText.setText("Leading Runs : ");
            }


            if (innings.matches("single")) {

                tvRemainingRunsText.setText("Remaining Runs : ");
            } else {

                if (remainingRuns > 0) {
                    if (currentInnings == 4)
                        tvRemainingRunsText.setText("Remaining Runs : ");
                    else
                        tvRemainingRunsText.setText("Trial Runs : ");
                } else
                    tvRemainingRunsText.setText("Lead Runs : ");
            }
        }


        Log.d("setExtra", "ballType : " + ballType);
        Log.d("setExtra", "extras : " + extras + ",extraType : " + extraType +
                ", extra : " + extra + ", extraRun : " + extraRun + ", runsOffBat : " + runsOffBat);
        Log.d("setExtra", "out : " + out + ", outType : " + outType + ", out_run : " + out_run);
        Log.d("setExtra", "strID : " + strID + ", strikerRuns : " + strikerRuns + ", strikerBalls : " + strikerBalls);
        Log.d("setExtra", "nstrID : " + nstrID + ", nonStrikerRuns : " + nonStrikerRuns +
                ", nonStrikerBalls : " + nonStrikerBalls);
        Log.d("setExtra", "player1ID : " + player1ID + ", player1Runs : " + player1Runs + ", player1Balls : " + player1Balls);
        Log.d("setExtra", "player2ID : " + player2ID + ", player2Runs : " + player2Runs + ", player2Balls : " + player2Balls);
        Log.d("setExtra", "psRuns : " + psRuns + ", psBalls : " + psBalls + ", psOver : " + psOver);
        Log.d("setExtra", "ps1ID : " + ps1ID + ", p1CR : " + p1CR + ", p1CB : " + p1CB);
        Log.d("setExtra", "ps2ID : " + ps2ID + ", p2CR : " + p2CR + ", p2CB : " + p2CB);
    }


    public void setExtraCard(/*boolean UNDO_LIMIT*/) {


        Log.d("Scoring", "setExtraCard, inside setExtraCard");
        Log.d("Scoring", "setExtraCard, UNDO_LIMIT : " + UNDO_LIMIT);

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgrealm) {

                    try {

                        ExtraCard extraCard = bgrealm.where(ExtraCard.class).equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).findFirst();

                        Log.d("Scoring", "setExtraCard, ExtraCard : " + extraCard);

                        if (extraCard == null) {

                            extraCard = new ExtraCard();
                            extraCard.setInnings(currentInnings);
                            extraCard.setMatchid(matchid);
                            extraCard.setMatchID(matchID);
                            extraCard.setTeam(battingTeamNo);

//                            newBowler();
                        }

                        ecByes = extraCard.getByes();
                        ecLB = extraCard.getLb();
                        ecNoball = extraCard.getNoBall();
                        ecWide = extraCard.getWide();
                        ecPenlaty = extraCard.getPenalty();
//                    Log.d("scoring", "object ; " + extraCard);
                        Log.d("scoring", "b4 b ; " + ecByes);
                        Log.d("scoring", "b4 lb ; " + ecLB);
                        Log.d("scoring", "b4 nb ; " + ecNoball);
                        Log.d("scoring", "b4 wd ; " + ecWide);
                        Log.d("scoring", "b4 p ; " + ecPenlaty);


                        if (bye) {
                            ecByes = ecByes + extraRun;
                        } else if (lb) {
                            ecLB = ecLB + extraRun;
                        } else if (wide) {
                            ecWide = ecWide + extra;
                        } else if (noBall) {
                            ++ecNoball;

                            if (byeNB) {
                                ecByes = ecByes + extraRun;
                            }

                            if (lbNB) {
                                ecLB = ecLB + extraRun;
                            }
                        } else if (penalty) {
                            if (penaltyType == 1)
                                ++ecPenlaty;
                        }

                        Log.d("scoring", " b ; " + ecByes);
                        Log.d("scoring", " lb ; " + ecLB);
                        Log.d("scoring", " nb ; " + ecNoball);
                        Log.d("scoring", " wd ; " + ecWide);
                        Log.d("scoring", " p ; " + ecPenlaty);

                        // added om 31/07/2020
                        if (UNDO_LIMIT) {
                                /*extraCard.setByes(0);
                                extraCard.setLb(0);
                                extraCard.setWide(0);
                                extraCard.setNoBall(0);
                                extraCard.setPenalty(0);*/
                        } else {  // updated om 31/07/2020
                            extraCard.setByes(ecByes);
                            extraCard.setLb(ecLB);
                            extraCard.setWide(ecWide);
                            extraCard.setNoBall(ecNoball);
                            extraCard.setPenalty(ecPenlaty);
                        }

                        bgrealm.insertOrUpdate(extraCard);

//                        }
//                    }catch(RealmPrimaryKeyConstraintException e){
//                        Toast.makeText(getApplicationContext(),
//                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
//                    }
//                }
//            });

                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });

        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }

    }


    void displayScoreCard(boolean declare, boolean forfeit) {            // for displying scorecard

        displayProgress();
//        Log.d("displayScoreCard", " matchid :"+matchid);
        Log.d("score", "displayScoreCard, score 1 :" + score);
        Log.d("SUPER_OVER", "displayScoreCard, SUPER_OVER :" + SUPER_OVER);

//        if (score){
//
//            score = false;
//            Log.d("Scoring", "displayScoreCard, score 2 :"+score);
//            addsToBatsman();
//        }

        int status = realm.where(Match.class).equalTo("matchid", matchid).findFirst().getMatchStatus();
        Log.d("displayScoreCard", " status :" + status);
//        Log.d("displayScoreCard", " currentInnings :"+currentInnings);
        Intent i = new Intent(ScoringActivity.this, ScoreCardActivity.class);
        i.putExtra("matchid", matchid);
        i.putExtra("endofinnings", endOfInnings);
        i.putExtra("interval", interval);
        i.putExtra("session", session);
        i.putExtra("allout", allOUT);
//        i.putExtra("continue_match", continueMatch);
        i.putExtra("forfeit", forfeit);
        i.putExtra("forfeit_team", forfeit_team);
        i.putExtra("forfeit_innings", forfeit_innings);
        i.putExtra("declare", declare);
        i.putExtra("innings", currentInnings);
        i.putExtra("matchstatus", status);
        i.putExtra("inningsnotstarted", inningsNotStarted);
        i.putExtra("SUPER_OVER", SUPER_OVER);
        Log.d("displayScoreCard", " SUPER_OVER :" + SUPER_OVER);
        if (endOfDay || declare || endOfInnings || endOfMatch || allOUT || forfeit)//SUPER_OVER)
            i.putExtra("back_type", 2);
        else
            i.putExtra("back_type", 1);
        // added on 04/06/2020
        // to free memory
        if (endOfDay || declare || endOfInnings || endOfMatch || allOUT)
            freeMemory();
        ///////======== till here
        startActivity(i);
        finish();
        progress.dismiss();

//        endOfInnings = false;

//        startActivity(new Intent(ScoringActivity.this, Display.class));
    }


    void addsToBatsman(int battingTeamNo, int currentInnings) {
        // for adding all non-substitute players from current batting team to Batsman table

        int i = 0;

        Log.d("Scoring", "addsToBatsman, method, matchid : " + matchid + ", battingTeamNo" + battingTeamNo);

        RealmResults<Player> resultb = realm.where(Player.class).
                equalTo("matchid", matchid).
                equalTo("team", battingTeamNo).
                equalTo("retired", false).
                equalTo("retired_concussion", false).    // added on 27/02/2021
                equalTo("substitute", false).findAll();

        resultb.load();
        for (Player player : resultb) {

             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    Batsman batsmann = realm.where(Batsman.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            equalTo("team", battingTeamNo).
//                            equalTo("retired_concussion", false).    // added on 27/02/2021
        equalTo("batsman_pID", player.getPlayerID()).findFirst();


                    Log.e("Scoring", "addsToBatsman, batsman : " + batsmann);

                    if (batsmann == null) {

                        Number num = realm.where(Batsman.class).max("batsmanID");
                        int batId = (num == null) ? 1 : num.intValue() + 1;
//                        int batId = RandomNumber.generate("Batsman");
                        batsmann = realm.createObject(Batsman.class, batId);
                        batsmann.setBatsman_pID(player.getPlayerID());
                        batsmann.setMatchid(matchid);
                        batsmann.setMatchID(matchID);
//                        batsmann.setBatsmanName(player.getPlayerName());
                        batsmann.setTeam(battingTeamNo);
                        batsmann.setInnings(currentInnings);

                        /*Number pos = realm.where(Batsman.class).
                                equalTo("team", team).
                                equalTo("innings", currentInnings).max("position");
                        int nextPos = (pos == null) ? 1 : pos.intValue() + 1;
                        batsmann.setPosition(nextPos);*/

                        Log.d("Scoring", "addsToBatsman, method, player.getPlayerID() : " + player.getPlayerID());
//                        Log.d("Scoring", "addsToBatsman, method, nextPos : "+nextPos);
                    }

                    Log.d("Scoring", "addsToBatsman, method, player : " + player);

                    realm.insertOrUpdate(batsmann);
                }
            });

        }

    }


    void resetBatsmanTable() {

        RealmResults<Batsman> results = realm.where(Batsman.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                equalTo("team", battingTeamNo).
                equalTo("playing", false).findAll();

        if (!realm.isInTransaction()) {
            realm.beginTransaction();
        }

        if (results.isLoaded()) {
            for (Batsman batsman : results) {
                if (batsman.getBatsman_pID() == strID || batsman.getBatsman_pID() == nstrID)
                    continue;
                batsman.deleteFromRealm();
            }
            realm.commitTransaction();
        } else
            Log.d("Scoring", "resetBatsmanTable, result : " + results);

//        addsToBatsman();

    }


    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.scoring_menu_options, menu);//Menu Resource, Menu
        return true;
    }

    @Override
    public boolean onPrepareOptionsMenu(Menu menu) {
        MenuItem checkable = menu.findItem(R.id.mo_update_wagonwheel);
        checkable.setChecked(wheel);//isChecked);
        return true;
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        switch (item.getItemId()) {

            case R.id.mo_end_over:
                if (SUPER_OVER)
                    displayError("You can not force end the over in super over");
                else
                    forceEndOver();
                return true;

                /*// commented on 30/02/2020
            case R.id.mo_end_day:
                if (totalInnings == 4) {
                    if (session && (sessionID == 7 || sessionID == 9 || sessionID == 11))
                        endOfDay(2, 0);
                    else
                        displayError("End of the day can give only after End Session");
                }
                else {
//                    displayError("You can not give end of day to single innings match");
                    displayError("No end of day for single innings match");
                }
                return true;*/

            case R.id.mo_end_innings:
                if (SUPER_OVER)
                    displayError("You can not force end the super over innings");
                else
                    forceEndInnings(0, 0);
                return true;

            case R.id.mo_forfeit:
                if (innings.matches("multi")) {

                    if (currentInnings == totalInnings) {
                        displayError("Forfeit can not apply on last innings");
                    } else {

                        if (currentOver > 0f) {
                            displayError("Innings already started. Forfeit can not apply.");
                        } else if (currentOver == 0f) {
                            applyForfeit();
                        }
                    }
                } else {
                    displayError("Forfeit can not apply on single innings match");
                }
                return true;

            case R.id.mo_end_match:
                if (SUPER_OVER)
                    displayError("You can not force end the match while playing super over");
                else
                    forceEndMatch();
                return true;

            case R.id.mo_edit_match_officials:
                if (SUPER_OVER)
                    displayError("You can not edit match details while playing super over");
                else
                    addMatchOfficials();
                return true;

            case R.id.mo_add_match_note:
                addMatchNote();
                return true;

            case R.id.mo_change_team_name:
                if (SUPER_OVER)
                    displayError("You can not change Team name at Super Over innings");
                else
                    changeTeamName();
                return true;

            case R.id.mo_change_player_name:
                if (SUPER_OVER)
                    displayError("You can not change players' name at Super Over");
                else
                    playerList();
                return true;

            /*Added on 02/03/2021 & commented on 03/03/2021
            case R.id.mo_absent:
                setAbsent();
                return true;*/

            case R.id.mo_powerplay:
                if (SUPER_OVER)
                    displayError("No Power play can set at Super Over innings");
                else
                    setPowerPlay();
                return true;

            case R.id.mo_change_match_over:
                if (SUPER_OVER)
                    displayError("You can not change the over in Super Over");
                else if (innings.matches("multi"))
                    displayError("You can not change the over in Multi innings match");
                else if (innings.matches("single"))
                    changeMatchOver();
                return true;

            case R.id.mo_apply_substitution:
                if (SUPER_OVER)
                    displayError("Substitution or Concussion can not apply on Super Over innings");
                else
                    applySubstitution();
                return true;

            case R.id.mo_update_wagonwheel:
                wheel = !item.isChecked();
                item.setChecked(wheel);
                updateWagonWheel();
                return true;
            /*default:
                return false;*/

            // ADDED On 27/02/2021
            case R.id.mo_change_wk:
                changeWicketkeeper(1);
                return true;

            case R.id.mo_substitute_wk:
                changeWicketkeeper(2);
                return true;

            default:
                return super.onOptionsItemSelected(item);

        }
    }


    // Added on 01/03/2021
    public void applyForfeit() {

        String message = "";
        if (currentInnings == 1) {
            message = "Apply fofeit on 1st innings ?";
        } else if (currentInnings == 2) {
            message = "Apply fofeit on 2nd innings ?";
        } else if (currentInnings == 3) {
            message = "Apply fofeit on 3rd innings ?";
        }

        AlertDialog.Builder forfeitBuilder = new AlertDialog.Builder(ScoringActivity.this);
        forfeitBuilder.setIcon(R.drawable.ball);
        forfeitBuilder.setCancelable(false);
        forfeitBuilder.setTitle(message);
        forfeitBuilder.setNegativeButton("Ok", new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int which) {

                dialog.dismiss();
                Log.d("FORFEIT", "applyForfeit 1, currentInnings : " + currentInnings);

                final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                        android.R.layout.select_dialog_singlechoice);

                arrayAdapter.add(teamA);
                arrayAdapter.add(teamB);

                AlertDialog.Builder alert1 = new AlertDialog.Builder(ScoringActivity.this);
                alert1.setIcon(R.drawable.ball);
                alert1.setCancelable(false);
                alert1.setTitle("Forfeit is declared by");
                alert1.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                    }
                });
                alert1.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();

                        String strName = arrayAdapter.getItem(which);
                        forfeit_team = which + 1;
                        Log.d("FORFEIT", "applyForfeit 2, forfeit_team : " + forfeit_team);
                        Log.d("FORFEIT", "applyForfeit 3, which : " + which);

                        if (checkForfeit(forfeit_team)) {

                            FORFEIT = true;
                            String str1 = "";
                            if (currentInnings == 1)
                                str1 = "1st innings by ";
                            else if (currentInnings == 2)
                                str1 = "2nd innings by ";
                            else if (currentInnings == 3)
                                str1 = "3rd innings by ";

                            Log.d("FORFEIT", "applyForfeit 9, FORFEIT : " + FORFEIT);

                            AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                            builderInner.setIcon(R.drawable.ball);
                            builderInner.setCancelable(false);
                            dialog.dismiss();
//                            builderInner.setMessage(strName);
                            builderInner.setTitle("Forfeit is applied on " + str1 + strName);

                            builderInner.setPositiveButton("Confirm", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {

                                    // Added on 02/03/2021
                                    dialog.dismiss();
                                    forfeit_innings = currentInnings;
                                    ballType = 26;
                                    declared = false;
                                    Log.d("FORFEIT", "applyForfeit 10, forfeit_innings : " + forfeit_innings);
                                    Log.d("FORFEIT", "applyForfeit 11, ballType : " + ballType);
                                    updateMatch(FORFEIT, forfeit_team, forfeit_innings, CONCEDE, conceded_team);
                                    setEndInnings(false, ballType);
                                    displayScoreCard(false, FORFEIT);
                                }
                            });

                            builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {
                                    dialog.dismiss();
                                    forfeit_team = 0;
                                    FORFEIT = false;
                                    forfeit_innings = 0;
                                    ballType = -1;
                                }
                            });

                            builderInner.show();
                        } else {
                            forfeit_team = 0;
                            FORFEIT = false;
                            forfeit_innings = 0;
                            ballType = -1;
                            displayError("Selected team already done forfeit");
                        }
                    }
                });

                alert1.show();

            }
        });

        forfeitBuilder.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                forfeit_team = 0;
                FORFEIT = false;
                forfeit_innings = 0;
                ballType = -1;
            }
        });
        forfeitBuilder.show();
    }

    // till here =============== 01/03/2021


    //Added on 02/03/2021
    public boolean checkForfeit(int forfeit_team) {

        boolean flag_forfeit = false;

        Log.d("FORFEIT", "checkForfeit 4, flag_forfeit : " + flag_forfeit);
        Log.d("FORFEIT", "checkForfeit 5, forfeit_team : " + forfeit_team);

        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
        if (match != null) {
            Log.d("FORFEIT", "checkForfeit 6, match : " + match);
            if (forfeit_team == 1) {
                if (match.getTeamA_forfeit() == 0) {
                    flag_forfeit = true;
                } else if (match.getTeamA_forfeit() == 1) {
                    flag_forfeit = false;
                }
                Log.d("FORFEIT", "checkForfeit 7.1, flag_forfeit : " + flag_forfeit);
            } else if (forfeit_team == 2) {
                if (match.getTeamB_forfeit() == 0) {
                    flag_forfeit = true;
                } else if (match.getTeamB_forfeit() == 1) {
                    flag_forfeit = false;
                }
                Log.d("FORFEIT", "checkForfeit 7.2, flag_forfeit : " + flag_forfeit);
            }
        }
        Log.d("FORFEIT", "checkForfeit 8, flag_forfeit : " + flag_forfeit);
        return flag_forfeit;
    }


    private void updateMatch(boolean forfeit, int forfeit_team, int innings, boolean concede, int conceded_team) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {

                    Match match = bgRealm.where(Match.class).
                            equalTo("matchid", matchid).findFirst();

                    if (match != null) {

                        if (forfeit) {
                            if (forfeit_team == 1) {
                                match.setTeamA_forfeit(1);
                                match.setTeamA_forfeit_innings(innings);
                            } else if (forfeit_team == 2) {
                                match.setTeamB_forfeit(1);
                                match.setTeamB_forfeit_innings(innings);
                            }

                            bgRealm.copyToRealm(match);
                            Log.d("FORFEIT", "updateMatch 12, innings : " + innings);
                            Log.d("FORFEIT", "updateMatch, match : " + match);
                            Log.d("FORFEIT", "updateMatch, FORFEIT : " + FORFEIT);
                            Log.d("FORFEIT", "updateMatch, forfeit_team : " + forfeit_team);
                            Log.d("FORFEIT", "updateMatch, forfeit_innings : " + forfeit_innings);
                        } else if (concede) {
                            match.setCONCEDE(concede);
                            match.setConceded_team(conceded_team);
                            match.setConceded_innings(innings);
                            bgRealm.copyToRealm(match);
                            Log.d("CONCEDE", "updateMatch 4, match : " + match);
                            Log.d("CONCEDE", "updateMatch 5, concede : " + concede);
                            Log.d("CONCEDE", "updateMatch 6, conceded_team : " + conceded_team);
                            Log.d("CONCEDE", "updateMatch 7, innings : " + innings);
                        }
                    }

                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


    /* Commented on 03/03/2021
    //Added on 02/03/2021
    public void setAbsent() {

        RealmResults<Batsman> results = realm.where(Batsman.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).
                equalTo("toBeBatted", true).
                equalTo("out", false).
                equalTo("playing", false).
                equalTo("retired", false).
                findAll();

        if (results.size() > 0) {

            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                    wicket, ball, 0, preInningsRuns, remainingRuns, remainingBalls,
                    remainingOver, leadingRuns, innings1Runs, innings2Runs, innings3Runs,
                    innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                    strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls,
                    bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket, preBowlerID,
                    preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket,
                    lastPreBowlerID, 0, -1, -1, 0, -1,
                    0, null, 0, 0, 0,
                    0, false, 0, commentary, -1,
                    mo, maiden, modified, udisplay, tco, tbo, tpbo, intervalID, sessionType,
                    sessionID, false, *//*jsonEventArray, jsonUndoArray,*//* endOfDay,
                    SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, declared, freeHit,
                    false, inning_started, 0, 0,
                    0, null, pre_out, callBowlerAlert, wk_id,
                    keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                    forfeit_innings, CONCEDE, conceded_team);

            Intent i = new Intent(ScoringActivity.this, AbsentPlayersActivity.class);
            i.putExtra("matchid", matchid);
            i.putExtra("matchID", matchID);
            i.putExtra("current_innings", currentInnings);
//        i.putExtra("match_type", matchtype);
            i.putExtra("battingteam", battingTeam);
            i.putExtra("eventid", eventID);
            startActivity(i);
        }

        else {
            displayError("No players left to set Absent");
        }
    }*/


    void addMatchOfficials() {

        Intent i = new Intent(ScoringActivity.this, AddMatchOfficials.class);
        i.putExtra("matchid", matchid);
        i.putExtra("matchID", matchID);
        i.putExtra("eventId", eventID);
        i.putExtra("score", score);
        startActivity(i);

    }


    void updateWagonWheel() {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {

//                                try {

                    Match match = bgRealm.where(Match.class).
                            equalTo("matchid", matchid).findFirst();

                    if (match != null) {
                        match.setWagonwheel(wheel);

                        bgRealm.copyToRealm(match);

                        if (wheel)
                            displayError("Display wagonwheel is selected now");
                        else
                            displayError("Display wagonwheel is not selected now");
                    }

//                                } catch (JSONException e) {
//                                    e.printStackTrace();
//                                } catch (RealmPrimaryKeyConstraintException e) {
//                                    Toast.makeText(getApplicationContext(),
//                                            "Primary Key exists, Press Update instead",
//                                            Toast.LENGTH_SHORT).show();
//                                }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


    void endOfMatch() {

        Log.d("endOfMatch", "endOfMatch,");

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Match match = realm.where(Match.class).
                                equalTo("matchid", matchid).findFirst();

                        if (match != null) {
                            match.setMatchStatus(1);    // 1-> end of match
                            match.setScoring(false);
                            match.setScoreCard(true);

                            realm.copyToRealmOrUpdate(match);

                            displayScoreCard();
                        }

                        Log.d("endOfMatch", "endOfMatch, match : " + match);
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }


    }


    void displayScoreCard() {

        Intent i = new Intent(ScoringActivity.this, ScoreCardActivity.class);
        i.putExtra("matchid", matchid);
        i.putExtra("endofinnings", endOfInnings);
        i.putExtra("endofmatch", endOfMatch);
        i.putExtra("innings", currentInnings);
        i.putExtra("matchstatus", status);
        i.putExtra("SUPER_OVER", SUPER_OVER);
        i.putExtra("concede", CONCEDE);
//        i.putExtra("follow_on", followon);
        i.putExtra("back_type", 2);
        startActivity(i);
        finish();
    }


    private void setFOW(int dismissedPlayerID, boolean extras) {         // adding dismissed players to FOW table

        RealmResults<FOW> result = realm.where(FOW.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findAll();

        FOW tfow = new FOW();

        if (result.isEmpty())
            tem = "";

        else {
            tfow = result.last();

            if (tfow == null)
                tem = "";
            else
                tem = tfow.getOver();
        }

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        realm.executeTransaction(new Realm.Transaction() {
            @Override
            public void execute(Realm bgRealm) {

                try {


                    Number num = bgRealm.where(FOW.class).max("fowID");
                    int nextId = (num == null) ? 1 : num.intValue() + 1;

                    FOW fow = bgRealm.createObject(FOW.class, nextId);

//                    fow = realm.createObject(FOW.class);
                    fow.setMatchid(matchid);
                    fow.setMatchID(matchID);
                    fow.setInnings(currentInnings);
                    fow.setTeam(battingTeamNo);
                    fow.setRun(currentRuns);
                    fow.setWicket(wicket);
                    fow.setDismissedPlayerID(dismissedPlayerID);
                    Log.d("scoring", "setFOW, currentOver : " +
                            (String.valueOf(new DecimalFormat("##.#").format(currentOver))));

                    if (extras) {
                        Log.d("scoring", "setFOW, tem : " + tem);
                        Log.d("scoring", "setFOW, extras : " + extras +
                                ", currentOver : " + (String.valueOf(new DecimalFormat("##.#").format(currentOver)) + 0.1));

                        Log.d("scoring", "setFOW, currentOver : " + (new DecimalFormat("##.#").format(currentOver)));
                        Log.d("scoring", "setFOW, currentOver new : " +
                                (new DecimalFormat("##.#").format(currentOver)) + ".1");

                        String xyz1 = (new DecimalFormat("##.#").format(currentOver)) + ".1";
                        String xyz2 = (new DecimalFormat("##.#").format(currentOver)) + ".2";
                        String xyz3 = (new DecimalFormat("##.#").format(currentOver)) + ".3";
                        String xyz4 = (new DecimalFormat("##.#").format(currentOver)) + ".4";
                        String xyz5 = (new DecimalFormat("##.#").format(currentOver)) + ".5";

                        if (tem == null || tem.matches("") || tem.matches(String.valueOf(currentOver)))
                            fow.setOver(xyz1);
                        else if (xyz1.matches(tem))
                            fow.setOver(xyz2);
                        else if (xyz2.matches(tem))
                            fow.setOver(xyz3);
                        else if (xyz3.matches(tem))
                            fow.setOver(xyz4);
                        else if (xyz4.matches(tem))
                            fow.setOver(xyz5);

                    } else
                        fow.setOver(String.valueOf(new DecimalFormat("##.#").format(currentOver)));

//                    fow.setBatsmanName(dismissedPlayer);


                    bgRealm.insertOrUpdate(fow);

                } catch (RealmException e) {

                    Log.d("SynchBowler", "Exception  : " + e);
                }
            }

        });
    }


    private void addMatchNote() {

        Intent intent = new Intent(ScoringActivity.this, MatchNoteListActivity.class);
        intent.putExtra("matchid", matchid);
        intent.putExtra("matchID", matchID);
        intent.putExtra("innings", currentInnings);
        intent.putExtra("over", currentOver);
        startActivity(intent);

        /*addNoteBuilder = new AlertDialog.Builder(ScoringActivity.this);
        addNoteBuilder.setIcon(R.drawable.ball);
        addNoteBuilder.setCancelable(false);
        addNoteBuilder.setTitle("Enter Match Note");

        final EditText input = new EditText(this);

        input.setInputType(InputType.TYPE_CLASS_TEXT);
        addNoteBuilder.setView(input);
//        Log.d("Test", "inside AddRuns()");
        addNoteBuilder.setPositiveButton("OK", new DialogInterface.OnClickListener() {

            //            @Override
            public void onClick(DialogInterface dialog, int which) {

                if (input.getText().equals(null)){
                    Log.d("editResult", "no input ");
                }

                else {

                    displayProgress();
                    matchNote = input.getText().toString();
                    matchnote = true;
                    //saving match result to MATCH table
                    Realm realm = null;
                    try {
                         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                        realm.executeTransaction(new Realm.Transaction() {
                            @Override
                            public void execute(Realm bgrealm) {

                                try {

                                    *//* commented on 19/10/2020
                                    Match match = realm.where(Match.class).
                                            equalTo("matchid", matchid).findFirst();
                                    match.setMatch_note(matchNote);
                                    match.setPost_matchnote(true);
                                    realm.copyToRealmOrUpdate(match);*//*

                                    // added on 09/10/2020
                                    Number num = bgrealm.where(MatchNotes.class).max("note_id");
                                    int nextId = (num == null) ? 1 : num.intValue() + 1;

                                    Number num2 = bgrealm.where(MatchNotes.class).
                                            equalTo("matchid", matchid).max("sequence");
                                    int sequence = (num2 == null) ? 1 : num2.intValue() + 1;

                                    MatchNotes notes = bgrealm.createObject(MatchNotes.class, nextId);
                                    notes.setMatchid(matchid);
                                    notes.setMatchID(matchID);
                                    notes.setOver(currentOver);
                                    notes.setSequence(sequence);
                                    notes.setInnings(currentInnings);
                                    notes.setNote(matchNote);
                                    bgrealm.copyToRealm(notes);

                                    postMatchNote();

                                } catch (RealmPrimaryKeyConstraintException e) {

                                    Log.d("readResult", " Exception : "+e);
                                }
                            }
                        });
                    }

                    catch (RealmException e) {
                        Log.d("test", "Exception : " + e);
                    }

                    finally {
                        if (realm != null) {
                            realm.close();
                        }
                    }

                    // post matchnote
                }
            }
        });

        addNoteBuilder.setNegativeButton("CANCEL", null);
        AlertDialog alert = addNoteBuilder.create();
        alert.show();*/
    }


    private void changeTeamName() {

        String[] players = {teamA, teamB};

//        selectFielder();

        final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                android.R.layout.select_dialog_singlechoice);

        arrayAdapter.add(teamA);
        arrayAdapter.add(teamB);

        teamBuilder = new AlertDialog.Builder(ScoringActivity.this);
        teamBuilder.setIcon(R.drawable.ball);
        teamBuilder.setCancelable(false);
        teamBuilder.setTitle("Select Team");
        teamBuilder.setNegativeButton("CANCEL", null);

        teamBuilder.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                String strName = arrayAdapter.getItem(which);
                int tteam = which /*+ 1*/;

                Log.d("Scoring", "changeTeamName, strName : " + strName + ", which : " + which);
//                dialog.dismiss();
                AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                builderInner.setIcon(R.drawable.ball);
                builderInner.setCancelable(false);
                dialog.dismiss();
                builderInner.setMessage(strName);
                builderInner.setTitle("Your Selected Team is");

                builderInner.setPositiveButton("CONFIRM", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        AlertDialog.Builder tBuilder = new AlertDialog.Builder(ScoringActivity.this);
                        tBuilder.setIcon(R.drawable.ball);
                        tBuilder.setCancelable(false);
                        tBuilder.setTitle("Enter the new Team Name");

                        final EditText input = new EditText(ScoringActivity.this);

//                        input.setInputType(InputType.TYPE_CLASS_TEXT);
                        input.setInputType(InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_FLAG_CAP_WORDS);
                        input.setText(strName);
                        tBuilder.setView(input);
                        tBuilder.setPositiveButton("CONFIRM", new DialogInterface.OnClickListener() {

                            //            @Override
                            public void onClick(DialogInterface dialog, int which) {

                                Log.d("Scoring", "changeTeamName 2 , strName : " + strName + ", which : " + tteam);

                                if (input.getText().toString().equals("")) {
//                                    Toast.makeText(getApplicationContext(),
//                                            "Please enter a valid name", Toast.LENGTH_SHORT).show();
                                    displayWarning("Please enter a valid team name");
                                    changeTeamName();
                                } else {

                                    teamName = input.getText().toString();
                                    Log.d("Scoring", "new team Name : " + teamName);

                                    if (!teamName.matches("")) {
                                        if (tteam == 0) {
                                            if (teamName.matches(teamB)) {
                                                displayWarning("Both team names can not be same");
                                                Log.d("Scoring", "changeTeamName, TeamName = teamB");
                                            } else {
                                                newTeamName(strName, teamName, tteam);
                                                postTeam(tteam + 1, teamName);
                                            }
                                        } else if (tteam == 1) {
                                            if (teamName.matches(teamA)) {
                                                displayWarning("Both team names can not be same");
                                                Log.d("Scoring", "changeTeamName, TeamName = teamA");
                                            } else {
                                                newTeamName(strName, teamName, tteam);
                                                postTeam(tteam + 1, teamName);
                                            }
                                        }
                                    } else {
                                        Log.d("Scoring", "changeTeamName, TeamName = null");
                                    }

                                }
                            }
                        });

                        tBuilder.setNegativeButton("CANCEL", null);

                        AlertDialog alert = tBuilder.create();
                        alert.show();

                        dialog.dismiss();

                    }
                });

                builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        changeTeamName();
                    }
                });
//
                builderInner.show();
//                dialog.dismiss();
            }
        });
        teamBuilder.show();
    }


    void displayWarning(String message) {

        AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
        builderInner.setIcon(R.drawable.ball);
        builderInner.setCancelable(false);
        builderInner.setMessage(message);
        builderInner.setTitle("Warning");

        builderInner.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
            }
        });
        builderInner.show();
    }


    // added on 12/09/2020
    public void postTeam(int team, String newName) {

        if (isNetworkAvailable()) {

            JSONObject json_match = new JSONObject();
            JSONObject json_name = new JSONObject();
            JSONObject temp_json_name = new JSONObject();
            JSONObject json_team = new JSONObject();
//            JSONObject json_teamA = new JSONObject();
//            JSONObject json_teamB = new JSONObject();
            JSONObject json_feed = new JSONObject();
            JSONArray array = new JSONArray();

            try {
                json_match.put("matchID", matchID);

                json_name.put("name", newName);
                temp_json_name.put("name", 0);

                if (team == 1) {
                    json_team.put("TeamA", json_name);
//                    json_teamB.put("TeamB", temp_json_name);
                } else if (team == 2) {
//                    json_teamA.put("TeamA", temp_json_name);
                    json_team.put("TeamB", json_name);
                }

                array.put(json_match);
                array.put(json_team);
//                array.put(json_teamA);
//                array.put(json_teamB);

                json_feed.put("EditTeamName", array);

            } catch (JSONException e) {
                Log.d("EDIT_TEAM", "Scoring, JSONException : " + e);
            }


            JSONObject postparams = new JSONObject();
            try {
                postparams.put("title", "CHASE_POST");
                postparams.put("feed", json_feed);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            Log.e("EDIT_TEAM", "Scoring, postparams : " + postparams);

            JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                    Constants.CHASE_CRICKET_MATCH_API, postparams,
                    new Response.Listener<JSONObject>() {
                        @Override
                        public void onResponse(JSONObject response) {

                            Log.d("EDIT_TEAM", "Scoring, response : " + response);
//                            setTeamA_syn = 1
//                            setTeamB_syn = 1

//                                try {
//                                } catch (JSONException e) {
//                                    e.printStackTrace();
//                                }
//                            startActivity(new Intent(CaptainActivity.this, TossActivity.class));

                        }
                    },
                    new Response.ErrorListener() {
                        @Override
                        public void onErrorResponse(VolleyError error) {

//                                progress.dismiss();
                            Log.e("EDIT_TEAM", "Scoring, Error Message is  : " + error.getMessage());

                        }
                    });

            MyApplicationClass.getInstance(getApplicationContext()).addToRequestQueue(jsonObjReq, "postRequest");
            Log.d("EDIT_TEAM", "Scoring, jsonObjReq  : " + jsonObjReq);
            Log.d("EDIT_TEAM", "Scoring, postparams  : " + postparams);


        } else {
            Log.d("EDIT_TEAM", "Scoring, network not available");
        }
    }


    private void newTeamName(String oldTeamName, String newTeamName, int teamid) {

        Log.d("Scoring", "newTeamName,  oldTeamName : " + oldTeamName +
                ", newTeamName : " + newTeamName + ", teamid : " + teamid +
                ", teamA : " + teamA + ", teamB : " + teamB);

        /*if (oldTeamName.matches(teamA))
            tA = true;

        else if (oldTeamName.matches(teamB))
            tB = true;*/

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgrealm) {

                    try {

                        Match match = bgrealm.where(Match.class).
                                equalTo("matchid", matchid).findFirst();

                        if (match != null) {
                            if (teamid == 0) {
                                teamA = newTeamName;
                                match.setTeamA(teamA);
                                match.setTeamA_sync(0);
                            } else if (teamid == 1) {
                                teamB = newTeamName;
                                match.setTeamB(teamB);
                                match.setTeamB_sync(0);
                            }

                            bgrealm.copyToRealmOrUpdate(match);
                        }
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("scoring", "onclick, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }

        tvTeamA.setText(teamA);
        tvTeamB.setText(teamB);
        if (battingTeamNo == 1) {
            tvBattingTeam.setText(teamA);
            tvFieldingTeam.setText(teamB);
        } else if (battingTeamNo == 2) {
            tvBattingTeam.setText(teamB);
            tvFieldingTeam.setText(teamA);
        }
    }


    private void endOfDay(int flag, int i_flag) {

        AlertDialog endOfDayAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        endOfDayAlert.setIcon(R.drawable.ball);
        endOfDayAlert.setCancelable(false);
        endOfDayAlert.setTitle("End of Day ?");
//        endOfDayAlert.setMessage("OVER COMPLETED");
        endOfDayAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        endOfDay = true;

                        // added on 30/04/2020

                        session = true;
                        sessionID = 11;
                        sessionType = "SE3";
                        disableButtons(1);
                        setMatchStatus(sessionType, sessionID);
                        // till this

                        Log.d("so_inninngs1Runs", "endOfDay23 , : " + so_inninngs1Runs);
                        ballType = 16;
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                                wicket, ball, 0,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                bowlerBalls, bowlerWicket, preBowlerID, preBowlerRun, preBowlerOver,
                                preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                                -1, 0, -1, dismissedPlayrID, null,
                                0, 0, 0, 0, false,
                                0, commentary, -1, mo, maiden, modified,
                                udisplay, tco, tbo, tpbo, 0, sessionType, sessionID, false,
                                /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs,
                                so_inninngs2Runs, declared, freeHit, false, inning_started,
                                0, 0, 0, null, pre_out,
                                callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                                forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType,
                                lunch_flag, tea_flag, dinner_flag);

                        Intent i = new Intent(getBaseContext(), ScheduledService.class);
                        getBaseContext().startService(i);

                        displayScoreCard(false, false);

                    }
                });

        endOfDayAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        if (flag == 1)
                            setInterval(i_flag);
                    }
                });
        endOfDayAlert.show();
    }


    private void forceEndOver() {

        forceEndOverAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        forceEndOverAlert.setIcon(R.drawable.ball);
        forceEndOverAlert.setCancelable(false);
        forceEndOverAlert.setTitle("Force end over ?");
//        forceEndOverAlert.setMessage("OVER COMPLETED");
        forceEndOverAlert.setButton(AlertDialog.BUTTON_POSITIVE, "END OVER",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        force_end_over = true;

                        // added here on 20/04/2021
                        if (mo == 0) {
                            maiden = true;
                            bowlerMO++;
                        } else {
                            maiden = false;
                        }

                        udisplay = modified;

                        syncBowler();

                        endOfOver = true;
                        changeStriker();

                        ballType = 4;
                        final int temp_ball = ball;
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                                wicket, ball, temp_ball,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                bowlerBalls, bowlerWicket, /*nextBowlerID,*/preBowlerID, preBowlerRun,
                                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0,
                                ballType, 0, 0, 0, 0, null,
                                0, 0, 0, 0, false,
                                0, commentary, 0, mo, maiden, modified,
                                udisplay, tco, tbo, tpbo, 0, sessionType, sessionID, false,
                                /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs,
                                so_inninngs2Runs, declared, freeHit, false, inning_started,
                                0, 0, 0, null, pre_out,
                                callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                                forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType,
                                lunch_flag, tea_flag, dinner_flag);

                        // === till here (20/04/2021)

                        udisplay = modified;
                        modified = "";

                        tvCurrentOver.setText(" ");
                        dso = null;
//                        currentOver = currentOver + 1;
//                        bowlerOver = bowlerOver + 1;
                        tco = currentOver;
                        tbo = bowlerOver;
                        tpbo = preBowlerOver;
                        tro = remainingOver;
                        int temp = (int) currentOver;
                        currentOver = (float) temp;
                        ball = 0;
                        ++currentOver;

//                        temp = (int) bowlerOver;
//                        bowlerOver = (float) temp;
//                        ++bowlerOver;

                        temp = (int) remainingOver;
                        remainingOver = (float) temp;
                        --remainingOver;

                        Log.d("forceEndOver", " currentOver : " + currentOver);
                        Log.d("forceEndOver", " bowlerOver : " + bowlerOver);
//                        currentOver = totalBalls / ballsPerOver;
//                        bowlerOver = bowlerBalls / ballsPerOver;
                        tvPlayingOver.setText(String.valueOf(new DecimalFormat("##.#").format(currentOver)));
                        tvBowlerOver.setText(String.valueOf(new
                                DecimalFormat("##.##").format(setOverDisplay(bowlerOver, bowlerBalls))));


                        if (currentInnings == 1 || currentInnings == 99)
                            ll_remainings.setVisibility(View.GONE);

                        else {

                            ll_remainings.setVisibility(View.VISIBLE);

                            if (remainingRuns > 0)
                                tvRemainingRuns.setText(String.valueOf(remainingRuns));
//                            else if (leadingRuns >= 0 && totalInnings == 4) {
                            if (leadingRuns > remainingRuns && totalInnings == 4) {
                                tvRemainingRuns.setText(String.valueOf(leadingRuns));
                                tvRemainingRunsText.setText("Leading Runs : ");
                            }


                            if (tvRemainingOversBallsText.isShown()) {
                                if (remainingBalls > 100) {

                                    tvRemainingOversBallsText.setText(", Overs : ");
                                    tvRemainingOversBalls.setText(String.valueOf(new
                                            DecimalFormat("##.#").format(remainingOver)));
                                } else {

                                    tvRemainingOversBallsText.setText(", Balls : ");
                                    Log.e("Scoring", "forceEndOver, remainingBalls : " + remainingBalls);
                                    tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
                                }
                            }

                            if (innings.matches("single")) {

                                tvRemainingRunsText.setText("Remaining Runs : ");
                            } else {

                                if (remainingRuns > 0) {
                                    if (currentInnings == 4)
                                        tvRemainingRunsText.setText("Remaining Runs : ");
                                    else
                                        tvRemainingRunsText.setText("Trial Runs : ");
                                } else
                                    tvRemainingRunsText.setText("Lead Runs : ");
                            }

                        }


                        if (innings.matches("multi") && totalOver == 1000) {

                            tvRemainingOversBallsText.setVisibility(View.INVISIBLE);
                            tvRemainingOversBalls.setVisibility(View.INVISIBLE);
                        } else {

                            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
                            tvRemainingOversBalls.setVisibility(View.VISIBLE);
                        }


//                bowlerOver++;

                        ball = 0;

//                bowlerBalls = 0;
                        ;
                        /* Commented on 20/04/2021
                        if (mo == 0){
                            maiden = true;
                            bowlerMO ++;
                        }

                        else {
                            maiden = false;
                        }

//                        Log.d("Scoring", "forceEndOver, mo : " + mo);
//                        Log.d("Scoring", "forceEndOver, maiden : " + maiden);

                        syncBowler();

                        endOfOver = true;
                        changeStriker();*/
//                                Toast.makeText(getApplicationContext(),
//                                "Please Select Next Bowler", Toast.LENGTH_SHORT).show();
                        Log.d("so_inninngs1Runs", "forceEndOver24 , : " + so_inninngs1Runs);
                        /* Commented on 20/04/2021
                        ballType = 4;
                        final int temp_ball = ball;
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball, temp_ball,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                bowlerBalls, bowlerWicket, *//*nextBowlerID,*//*preBowlerID, preBowlerRun,
                                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0,
                                ballType, 0, 0, 0, 0, null,
                                0, 0, 0, 0, false,
                                0, commentary, 0, mo, maiden, modified,
                                udisplay, tco, tbo, tpbo, 0, sessionType, sessionID, false,
                                *//*jsonEventArray, jsonUndoArray,*//* endOfDay, SUPER_OVER, so_inninngs1Runs,
                                so_inninngs2Runs, declared, freeHit, false, inning_started,
                                0, 0, 0, null, pre_out,
                                callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                                forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType);*/

                        maiden = false;

//                        if (preBowlerID == 0){
//
//                            callNextBowler();
//                        }
//
//                        else
                        selectBowlerAlertDialog();


                    }
                });

        forceEndOverAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "RETURN",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();
                    }
                });
        forceEndOverAlert.show();

    }


    private void forceEndInnings(int flag, int i_flag) {

        Log.d("forceEndInnings", "endOfMatch : " + endOfMatch);

        forceEndInningsAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        forceEndInningsAlert.setIcon(R.drawable.ball);
        forceEndInningsAlert.setCancelable(false);
        forceEndInningsAlert.setTitle("Force End Innings");
        forceEndInningsAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        ballType = 9;
                        int lastBallType = realm.where(Events.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).findAll().last().getBallType();
                        endOfInnings = true;


                        if (innings.matches("multi") && !allOUT && currentInnings != 4 && !limited_over) {

                            declarationBuilder = new AlertDialog.Builder(ScoringActivity.this);
                            declarationBuilder.setIcon(R.drawable.ball);
                            declarationBuilder.setCancelable(false);
                            declarationBuilder.setTitle("Declare Innings ?");
                            declarationBuilder.setPositiveButton("Confirm",
                                    new DialogInterface.OnClickListener() {
                                        @Override
                                        public void onClick(DialogInterface dialog, int which) {

                                            dialog.dismiss();

                                            // Added on 19/04/2021

                                            if (currentInnings == 3 && remainingRuns > 0) {

                                                endMessage = "Target Achieved";
                                                displayAlert(endMessage, 0);
                                            } else {
                                                // ==till here (19/04/2021

                                                forceEndingType = 3;
                                                declared = true;
                                                setEndInnings(true, ballType);
                                    /*if (endOfMatch)
                                        endOfMatch();
                                    else*/
                                                displayScoreCard(true, false);
                                            }   // Added on 19/04/2021
                                        }
                                    });
                            /* Commented by 01/03/2021
                            if (flag != 1) {
                                declarationBuilder.setNegativeButton("No",  // Added on 01/03/2021
                                        new DialogInterface.OnClickListener() {
                                            @Override
                                            public void onClick(DialogInterface dialog, int which) {

                                                dialog.dismiss();
                                                declared = false;

                                                commentary = forceEndingReason(1);

                                                *//*setEndInnings(true, ballType);
                             *//**//*if (endOfMatch)
                                        endOfMatch();
                                    else*//**//*
                                            displayScoreCard(true);*//*
                                            }
                                        });
                            }*/
                            declarationBuilder.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {
                                    dialog.dismiss();
                                    // added on 27/04/2020
//                                    forceEndInnings(0, 0);    COMMENTED ON 01/03/2021
                                    ballType = -1;
                                    endOfInnings = false;
                                    // commented on 26/04/2020
                                    /*declared = false;
                                    setEndInnings(false, ballType);
                                    displayScoreCard(false);*/
                                }
                            });
                            declarationBuilder.show();
                        }

                        // Added on 03/03/2021
                        else {

//                            applyForfeit();

                            final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                                    android.R.layout.select_dialog_singlechoice);

                            if (limited_over)
                                arrayAdapter.add("Rain rule");
                            else {
                                arrayAdapter.add("Rain rule");
                                arrayAdapter.add("Remaining players absent");
                            }

                            AlertDialog.Builder alert1 = new AlertDialog.Builder(ScoringActivity.this);
                            alert1.setIcon(R.drawable.ball);
                            alert1.setCancelable(false);
                            alert1.setTitle("Force ending reason is ");
                            alert1.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {
                                    dialog.dismiss();
                                    ballType = -1;
                                    endOfInnings = false;
                                }
                            });

                            alert1.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {

                                    dialog.dismiss();

                                    String strName = arrayAdapter.getItem(which);
                                    forceEndingType = which + 1;
                                    Log.d("FORFEIT", "applyForfeit 2, forfeit_team : " + strName);

                                    AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                                    builderInner.setIcon(R.drawable.ball);
                                    builderInner.setCancelable(false);
                                    dialog.dismiss();
                                    builderInner.setTitle("Confirm " + strName);

                                    builderInner.setPositiveButton("Confirm", new DialogInterface.OnClickListener() {
                                        @Override
                                        public void onClick(DialogInterface dialog, int which) {

                                            dialog.dismiss();
                                            declared = false;
                                            if (forceEndingType == 1) {
                                                rain_rule = true;
                                                remaining_absent = false;
                                            } else if (forceEndingType == 2) {
                                                rain_rule = false;
                                                remaining_absent = true;
//                                                    setBatsmanAsAbsent();
                                            }

                                            ballType = 9;
//                                                setEndInnings(false, ballType);

                                            if (currentInnings == totalInnings) {
                                                if (currentRuns == preInningsRuns) {
                                                    if (forceEndingType == 2)
                                                        setBatsmanAsAbsent();
                                                    check_SUPEROVER();
                                                } else
                                                    callEndOfMatch(2, 0);
                                            } else {

                                                if (forceEndingType == 2)
                                                    setBatsmanAsAbsent();

                                                setEndInnings(false, ballType);
                                                displayScoreCard(false, false);
                                            }


                                        }
                                    });

                                    builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                                        @Override
                                        public void onClick(DialogInterface dialog, int which) {
                                            dialog.dismiss();
                                            rain_rule = false;
                                            remaining_absent = false;
                                            ballType = -1;
                                            endOfInnings = false;
                                            forceEndingType = 0;
                                        }
                                    });

                                    builderInner.show();
//                                    }

                                    /*else {
                                        forfeit_team = 0;
                                        FORFEIT = false;
                                        forfeit_innings = 0;
                                        ballType = -1;
                                        displayError("Selected team already done forfeit");
                                    }*/
                                }
                            });

                            alert1.show();
                        }

                        /* Commented on 03/03/2021
                        else  if (currentInnings == totalInnings) {

                            Log.d("Scoring", "callEndOfInnings, currentInnings : " + currentInnings);
                           *//* Commented by 01/03/2021
                            if (flag != 1) {
                                commentary = forceEndingReason(2);  // Added on 01/03/2021
                            }

                            else {*//*
                                setEndInnings(false, ballType);

                                if (currentRuns == preInningsRuns)
                                    check_SUPEROVER();
                                else
                                    callEndOfMatch(2, 0);
//                            }     Commented by 01/03/2021
                        }

                        *//* Commented on 03/03/2021
                        else if (SUPER_OVER) {
                            setEndInnings(false, ballType);

                            if (currentInnings == 99) {
                                preInningsRuns = currentRuns;
                                remainingRuns = currentRuns;
                                displayScoreCard(false, false);
                            }
                            else
                                if (currentInnings == 100) {
                                    callEndOfMatch(2, 0);
                            }
                        }*//*

                        else {
                            *//* Commented by 01/03/2021.
                            if (flag != 1) {
                                commentary = forceEndingReason(3);  // Added on 01/03/2021
                            }

                            else {*//*
                                declared = false;
                                setEndInnings(false, ballType);
                                displayScoreCard(false, false);
                            //}     Commented by 01/03/2021
                        }*/

                    }
                });

        // Added on 02/03/2021
        forceEndInningsAlert.setButton(AlertDialog.BUTTON_NEUTRAL, "CONCEDE",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                                android.R.layout.select_dialog_singlechoice);

                        arrayAdapter.add(teamA);
                        arrayAdapter.add(teamB);

                        AlertDialog.Builder alert2 = new AlertDialog.Builder(ScoringActivity.this);
                        alert2.setIcon(R.drawable.ball);
                        alert2.setCancelable(false);
                        alert2.setTitle("Conceding is declared by");
                        alert2.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
                            @Override
                            public void onClick(DialogInterface dialog, int which) {
                                dialog.dismiss();
                                conceded_team = 0;
                                ballType = -1;
                                CONCEDE = false;
                                endOfMatch = false;
                                forceEndingType = 0;
                                endOfInnings = false;
                            }
                        });

                        alert2.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
                            @Override
                            public void onClick(DialogInterface dialog, int which) {

                                dialog.dismiss();

                                String strName = arrayAdapter.getItem(which);
                                conceded_team = which + 1;
                                Log.d("CONCEDE", "forceEndInnings 1, conceded_team : " + conceded_team);
                                Log.d("CONCEDE", "forceEndInnings 2, which : " + which);

                                CONCEDE = true;
                                String str1 = "Conceding selected by " + strName;
                                Log.d("CONCEDE", "forceEndInnings 3, CONCEDE : " + CONCEDE);

                                AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                                builderInner.setIcon(R.drawable.ball);
                                builderInner.setCancelable(false);
                                dialog.dismiss();
                                builderInner.setTitle(str1);

                                builderInner.setPositiveButton("Confirm", new DialogInterface.OnClickListener() {
                                    @Override
                                    public void onClick(DialogInterface dialog, int which) {

                                        dialog.dismiss();
                                        ballType = 27;
                                        declared = false;

                                        if (currentInnings == 1) {
                                            addsToBatsman(fieldingTeamNo, 2);
                                        }
                                        endOfMatch = true;
                                        updateMatch(FORFEIT, forfeit_team, currentInnings, CONCEDE, conceded_team);
                                        setEndInnings(false, ballType);
                                        callMatchEnd(); // Added on 03/03/2021
                                        endOfMatch();

                                    }
                                });

                                builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                                    @Override
                                    public void onClick(DialogInterface dialog, int which) {
                                        dialog.dismiss();
                                        conceded_team = 0;
                                        ballType = -1;
                                        declared = false;
                                        CONCEDE = false;
                                        endOfMatch = false;
                                        endOfInnings = false;
                                    }
                                });

                                builderInner.show();


                                /*else {
                                    forfeit_team = 0;
                                    FORFEIT = false;
                                    forfeit_innings = 0;
                                    displayError("Selected team already done forfeit");
                                }*/
                            }
                        });

                        alert2.show();

                    }
                });

        //========== till here======================

        forceEndInningsAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();
                        ballType = -1;
                        endOfInnings = false;
                        if (flag == 1)
                            setInterval(i_flag);
                    }
                });
        forceEndInningsAlert.show();
    }


    // Added on 01/03/2021
    /* Commented on 03/03/2021

    public String forceEndingReason(int i) {
//        setInterval();

        String str = "";

        View intervalView = View.inflate(this, R.layout.force_ending_reason, null);
        EditText editText = (EditText) intervalView.findViewById(R.id.et_force_ending_reason);

        AlertDialog.Builder reasonAlert = new AlertDialog.Builder(this);
        reasonAlert.setIcon(R.drawable.ball).
                setTitle("Please enter the reason to force ending innings").
                setView(intervalView).
                setCancelable(false).
                setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        if (editText.getText().toString().matches("") ||
                            editText.getText().toString() == null) {
                            Toast.makeText(ScoringActivity.this, "Invalid reason", Toast.LENGTH_SHORT).show();
                        }
                        else {
                            dialog.cancel();
                            reason = editText.getText().toString();

                            setBatsmanAsAbsent();

                            if (i == 1) {
                                setEndInnings(true, ballType);
                                displayScoreCard(true, false);
                            }

                            else if (i == 2) {
                                setEndInnings(false, ballType);

                                if (currentRuns == preInningsRuns)
                                    check_SUPEROVER();
                                else
                                    callEndOfMatch(2, 0);
                            }

                            else if (i == 3) {
                                declared = false;
                                setEndInnings(false, ballType);
                                displayScoreCard(false, false);
                            }

                        }
                    }
                }).
                setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                            @Override
                            public void onClick(DialogInterface dialog, int i) {
                                dialog.cancel();
                                ballType = -1;
                                endOfInnings = false;
                            }
                        })
                .show();

        return reason;


        *//*AlertDialog.Builder reasonAlert = new AlertDialog.Builder(ScoringActivity.this);
        reasonAlert.setIcon(R.drawable.ball);
        reasonAlert.setCancelable(false);
        reasonAlert.setTitle("Declare Innings ?");*//*
    }*/


    private void setBatsmanAsAbsent() {

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        realm.executeTransaction(new Realm.Transaction() {
            @Override
            public void execute(Realm realm) {

                RealmResults<Batsman> batsman_result = realm.where(Batsman.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("team", battingTeamNo).
                        equalTo("retired", false).
                        equalTo("out", false).
                        equalTo("playing", false).
                        equalTo("toBeBatted", true).
                        findAll();

                for (Batsman batsmann : batsman_result) {

                    if (batsmann != null) {

                        batsmann.setOut(true);
                        batsmann.setPlaying(false);
                        batsmann.setRetired(false);
                        batsmann.setOutType(11);

                        realm.insertOrUpdate(batsmann);
                        Log.d("ABSENT", "setBatsmanAsAbsent(), batsmann : " + batsmann);
                    }
                }
            }
        });
    }

    //======== till here (01/03/2021)


    private void forceEndMatch() {

        if (currentInnings < totalInnings)
            displayError("Force End of Match",
                    "The match have left " + (totalInnings - currentInnings) + " innings. Do you want to proceed?");

        else if (currentInnings == totalInnings) {

            if ((currentOver < totalOver) || (currentRuns < preInningsRuns) || (currentRuns < revisedTarget))
                displayError("Force End of Match",
                        "The match didn't met the target. Do you want to proceed?");
        }


//        AlertDialog.Builder matchBuilder = new AlertDialog.Builder(ScoringActivity.this);
//        matchBuilder.setIcon(R.drawable.ball);
//        matchBuilder.setCancelable(false);
//        matchBuilder.setTitle("Declare Innings ?");
//        matchBuilder.setNeutralButton("Declare",
//                new DialogInterface.OnClickListener() {
//                    @Override
//                    public void onClick(DialogInterface dialog, int which) {
//
//
//                        setEndInnings(true, ballType);
//                    }
//                });
//        matchBuilder.setPositiveButton("Cancel", new DialogInterface.OnClickListener() {
//            @Override
//            public void onClick(DialogInterface dialog, int which) {
//                setEndInnings(false, ballType);
//            }
//        });
//        matchBuilder.show();
    }


    void setEndInnings(boolean declare, int ballType) {

        endOfInnings = true;

//        setMatchStatus("SE3", 11);
        Log.e("Scoring", "setEndInnings, ballType : " + ballType);
        Log.e("Scoring", "setEndInnings, currentInnings : " + currentInnings);
        Log.e("Scoring", "setEndInnings, totalInnings : " + totalInnings);
        Log.e("Scoring", "setEndInnings, endOfInnings : " + endOfInnings);
        Log.e("Scoring", "setEndInnings, FORFEIT : " + FORFEIT);


        if (strID != 0)
            syncBatsmann(strID, 0, null, false, -1, false,
                    false, false);
        if (nstrID != 0)
            syncBatsmann(nstrID, 0, null, false, -1, false,
                    false, false);
        syncBowler();
        if (currentInnings == 1)
            preInningsRuns = currentRuns;


        Log.d("so_inninngs1Runs", "setEndInnings25 , : " + so_inninngs1Runs);
        Log.d("ballType", "setEndInnings 25, : " + ballType);
        Log.d("strID", "setEndInnings 25, : " + strID);
        Log.d("nstrID", "setEndInnings 25, : " + nstrID);
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns,
                remainingRuns, remainingBalls, remainingOver, leadingRuns, innings1Runs, innings2Runs,
                innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/preBowlerID, preBowlerRun,
                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                -1, 0, -1, 0, null, 0,
                penaltyType, 0, 0, false, 0, commentary,
                0, mo, maiden, modified, udisplay, tco, tbo, tpbo, 0, sessionType,
                sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                so_inninngs1Runs, so_inninngs2Runs, declare, freeHit, false,
                inning_started, 0, 0, 0, null,
                pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                tea_flag, dinner_flag);

        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
        setMatchStatus(match.getStatus(), match.getStatusId());

        updateMatch(matchid, endOfInnings);

//        displayScoreCard(declare);

//        ballType = -1;
    }


    private void changeMatchOver() {
//        setCommentry();

        float temp_total_over = realm.where(Match.class).
                equalTo("matchid", matchid).findFirst().getOver();
        matchOverBuilder = new AlertDialog.Builder(ScoringActivity.this);
        matchOverBuilder.setIcon(R.drawable.ball);
        matchOverBuilder.setCancelable(false);
        matchOverBuilder.setTitle("Enter revised Overs");

        final EditText input = new EditText(this);

//        input.setInputType(InputType.TYPE_CLASS_NUMBER);
        input.setInputType(InputType.TYPE_CLASS_NUMBER | InputType.TYPE_NUMBER_FLAG_DECIMAL);
        matchOverBuilder.setView(input);
//        Log.d("Test", "inside AddRuns()");
        matchOverBuilder.setPositiveButton("CONFIRM", new DialogInterface.OnClickListener() {

            @Override
            public void onClick(DialogInterface dialog, int which) {

                if (input.getText().toString() == null) {
                    Toast.makeText(getApplicationContext(),
                            "Please enter valid Over", Toast.LENGTH_SHORT).show();
                } else {

//                    builderText = Integer.parseInt(input.getText().toString());
                    reduced_overs = Float.parseFloat(input.getText().toString());
//                    Log.d("Test", "BuilderText : " + builderText);


                    if (reduced_overs > 0) {

                        Toast.makeText(getApplicationContext(),
                                "Over reduced to " + reduced_overs, Toast.LENGTH_SHORT).show();

                        totalOver = reduced_overs;
                        Log.d("readResult", "ok, totalOver : " + totalOver);
                        Log.d("readResult", "ok, reduced_overs : " + reduced_overs);

                        // updated on 02/05/2020
                        if (currentInnings == 1)
                            readRainRule(reduced_overs, revisedTarget, false, temp_total_over);
//                            saveRevisedRuns(builderText, revisedTarget, false, temp_total_over); // commented on 05/05/2020
                        if (currentInnings > 1) { // && innings.matches("single")) {

//                            saveRevisedRuns(builderText, revisedTarget, false);
//                            commented on 20/04/2020
                            callRevisedRuns(reduced_overs, temp_total_over);
                            //======== till here
                        }
                    } else {

                        Toast.makeText(getApplicationContext(),
                                "Reached out of limits", Toast.LENGTH_SHORT).show();
                    }

                }


            }
        });

        matchOverBuilder.setNegativeButton("CANCEL", null);

        AlertDialog alert = matchOverBuilder.create();
        alert.show();

        builderText = 0;

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
                        match.setOver(totalOver);
                        match.setReducedOver(true);
                        realm.copyToRealmOrUpdate(match);
                    } catch (RealmPrimaryKeyConstraintException e) {

                        Log.d("readResult", " Exception : " + e);
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }

        Log.d("readResult", "after build, totalOver : " + totalOver);

    }



/*
    void updateReducedOvers() {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Match match = realm.where(Match.class).
                                equalTo("matchid", matchid).findFirst();
                        match.setReducedOver(true);

                        realm.copyToRealmOrUpdate(match);

                        Log.d("updateMatch", " match : " + match);
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        }

        catch (RealmException e) {
            Log.d("scoring", "onclick, Exception : " + e);
        }

        finally {
            if (realm != null) {
                realm.close();
            }
        }
    }
*/


    @Override
    public void onBackPressed() {
        /*Log.d("extras", "onBackPressed 10, extras : " + extras);
        if (popupExtra != null) {
            Log.d("extras", "onBackPressed 1, popupExtra, extras : " + extras);
            if (popupExtra.isShowing()) {
                popupExtra.dismiss();
                extras = false;
                ballType = -1;
                extraType = -1;
            }
            Log.d("extras", "onBackPressed 2, popupExtra, extras : " + extras);
        }

        else if (popupOUT != null) {
            Log.d("extras", "onBackPressed 3, popupOUT, out : " + out);
            if (popupOUT.isShowing()) {
                popupOUT.dismiss();
                out = false;
//                confirm_out = false;
                outType = -1;
                ballType = -1;
                dismissedPlayer = "";
                single = false;
                multi = false;
                retired = false;
                popupOUT.dismiss();

                if (ball >= ballsPerOver)
                    callEndOfOverAlert();
            }
            Log.d("extras", "onBackPressed 4, popupOUT, out : " + out);
        }

        else {*/
        startActivity(new Intent(this, HomeActivity.class));
        finish();
//        }


    }


    private void callRevisedRuns(float reducedOver, float temp_total_over) {

        AlertDialog.Builder revisedBuilder = new AlertDialog.Builder(ScoringActivity.this);
        revisedBuilder.setIcon(R.drawable.ball);
        revisedBuilder.setCancelable(false);
        revisedBuilder.setTitle("Enter revised run");

        final EditText input = new EditText(this);

        input.setInputType(InputType.TYPE_CLASS_NUMBER);

        revisedBuilder.setView(input);
//        Log.d("Test", "inside AddRuns()");
        revisedBuilder.setPositiveButton("CONFIRM", new DialogInterface.OnClickListener() {

            @Override
            public void onClick(DialogInterface dialog, int which) {

                if (input.getText().equals(null)) {
                    Toast.makeText(getApplicationContext(),
                            "Please enter the Run", Toast.LENGTH_SHORT).show();
                } else {
                    builderText = Integer.parseInt(input.getText().toString());
//                    Log.d("Test", "BuilderText : " + builderText);


                    if (builderText != 0) {

                        Toast.makeText(getApplicationContext(),
                                "Runs reduced to " + builderText, Toast.LENGTH_SHORT).show();
                        revisedTarget = builderText;
                        Log.d("readResult", "ok, revisedTarget : " + revisedTarget);

//                        if (currentInnings > 1)

                        readRainRule(reducedOver, revisedTarget, true, temp_total_over);
//                            saveRevisedRuns(reducedOver, revisedTarget, true, temp_total_over);   // commented on 05/05/20250

                        /*Realm realm = null;
                        try {
                             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                            realm.executeTransaction(new Realm.Transaction() {
                                @Override

                                public void execute(Realm realm) {
                                    try {

                                        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
                                        match.setRevisedTarget(revisedTarget);
                                        realm.copyToRealmOrUpdate(match);

                                    } catch (RealmPrimaryKeyConstraintException e) {

                                        Log.d("readResult", " Exception : "+e);
                                    }
                                }
                            });
                        }

                        catch (RealmException e) {
                            Log.d("test", "Exception : " + e);
                        }

                        finally {
                            if (realm != null) {
                                realm.close();
                            }
                        }
*/

                    } else {

                        Toast.makeText(getApplicationContext(),
                                "Reached out of limits", Toast.LENGTH_SHORT).show();
                    }

                }


            }
        });

        revisedBuilder.setNegativeButton("CANCEL", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.cancel();
                changeMatchOver();
            }
        });

        AlertDialog alert = revisedBuilder.create();
        alert.show();

        builderText = 0;


        Log.d("readResult", "after build, totalOver : " + totalOver);
    }


    void playerList() {
//        Toast.makeText(getApplicationContext(), "Working progress", Toast.LENGTH_SHORT).show();
        Intent i = new Intent(ScoringActivity.this, PlayerList.class);
        i.putExtra("matchid", matchid);
        i.putExtra("matchID", matchID);
        i.putExtra("eventId", eventID);
        i.putExtra("battingTeamNo", battingTeamNo);
        i.putExtra("currentInnings", currentInnings);
        i.putExtra("SUPER_OVER", SUPER_OVER);
        i.putExtra("score", score);
        startActivity(i);

    }


    void saveRevisedRuns(float reducedOver, int revisedTarget, boolean reducedRuns, float temp_total_over,
                         String rain_rule, String com) {

        Log.d("reducedOver", "reducedOver :  " + reducedOver);
        Log.d("reducedOver", "revisedTarget :  " + revisedTarget);
        Log.d("reducedOver", "reducedRuns :  " + reducedRuns);

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
                        match.setRevisedTarget(revisedTarget);
                        match.setReducedRuns(reducedRuns);
                        match.setOver(reducedOver);
                        match.setAppliedRainRule(rain_rule);

                        realm.copyToRealmOrUpdate(match);

                        // commented on 05/05/2020
                        /*if (reducedRuns) {

                            resetRemainingRuns(reducedOver, revisedTarget, temp_total_over);
                        }*/

                    } catch (RealmPrimaryKeyConstraintException e) {

                        Log.d("readResult", " Exception : " + e);
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }


        ballType = 20;
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket,
                ball, 0, preInningsRuns, remainingRuns, remainingBalls, remainingOver,
                leadingRuns, innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID,
                nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket,
                /*nextBowlerID,*/preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket,
                lastPreBowlerID, 0, ballType, -1, 0, -1, 0,
                null, 0, -1, 0, 0, false,
                0, com, 0, mo, maiden, modified, udisplay, tco,
                tbo, tpbo, 0, sessionType, sessionID, true, /*jsonEventArray,
                     jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs,
                false, freeHit, false, inning_started, 0, reducedOver,
                revisedTarget, rain_rule, pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id,
                pre_wk_position, FORFEIT, forfeit_team, forfeit_innings, CONCEDE, conceded_team,
                forceEndingType, lunch_flag, tea_flag, dinner_flag);

        if (reducedRuns) {

            resetRemainingRuns(reducedOver, revisedTarget, temp_total_over);
        }

    }


    void resetRemainingRuns(float reducedOver, int revisedTarget, float temp_total_over) {
        Log.d("remainingRuns", "resetRemainingRuns, reducedOver 1, : " + reducedOver);
        Log.d("remainingRuns", "resetRemainingRuns, revisedTarget 1, : " + revisedTarget);
        Log.d("remainingRuns", "resetRemainingRuns, temp_total_over 1, : " + temp_total_over);

        // added on 12/05/2020
        Log.d("remainingRuns", "resetRemainingRuns, temp_total_over : " + temp_total_over);
        Log.d("remainingRuns", "resetRemainingRuns, remainingOver : " + remainingOver);
        Log.d("remainingRuns", "resetRemainingRuns, ballsPerOver : " + ballsPerOver);

        if (remainingOver == temp_total_over || (remainingBalls == (temp_total_over * ballsPerOver))) {

            remainingOver = reducedOver;
            Log.d("remainingRuns", "resetRemainingRuns, reducedOver : " + reducedOver);
            Log.d("remainingRuns", "resetRemainingRuns, remainingOver : " + remainingOver);
            int remianining_balls1 = ((int) remainingOver) * ballsPerOver;
            Log.d("remainingRuns", "resetRemainingRuns, remianining_balls1 : " + remianining_balls1);
            int remianining_balls2 = (int) ((remainingOver - ((int) remainingOver)) * 0.1f);
            Log.d("remainingRuns", "resetRemainingRuns, remianining_balls2 : " + remianining_balls2);
            remainingBalls = remianining_balls1 + remianining_balls2;
            Log.d("remainingRuns", "resetRemainingRuns, remainingBalls : " + remainingBalls);
        } else {
            int total_balls1 = (int) temp_total_over * ballsPerOver;
            Log.d("remainingRuns", "resetRemainingRuns, total_balls1 : " + total_balls1);
            float total_balls2 = (temp_total_over - (int) temp_total_over) * 10;
            Log.d("remainingRuns", "resetRemainingRuns, total_balls2 : " + total_balls2);
            int total_balls = total_balls1 + (int) total_balls2;
            Log.d("remainingRuns", "resetRemainingRuns, total_balls : " + total_balls);

            Log.d("remainingRuns", "resetRemainingRuns, reducedOver : " + reducedOver);
            int reduced_balls1 = (int) reducedOver * ballsPerOver;
            Log.d("remainingRuns", "resetRemainingRuns, reduced_balls1 : " + reduced_balls1);
            float reduced_balls2 = (reducedOver - (int) reducedOver) * 10;
            Log.d("remainingRuns", "resetRemainingRuns, reduced_balls2 : " + reduced_balls2);
            int reduced_balls = reduced_balls1 + (int) reduced_balls2;
            Log.d("remainingRuns", "resetRemainingRuns, reduced_balls : " + reduced_balls);


            int ball_difference = total_balls - reduced_balls;
            Log.d("remainingRuns", "resetRemainingRuns, ball_difference : " + ball_difference);


            Log.d("remainingRuns", "resetRemainingRuns, remainingBalls 1, : " + remainingBalls);
            remainingBalls = remainingBalls - ball_difference;
            Log.d("remainingRuns", "resetRemainingRuns, remainingBalls 2, : " + remainingBalls);
            int remaining_over1 = remainingBalls / ballsPerOver;
            Log.d("remainingRuns", "resetRemainingRuns, remaining_over1 : " + remaining_over1);
            int remaining_over2 = remainingBalls % ballsPerOver;
            Log.d("remainingRuns", "resetRemainingRuns, remaining_over2 : " + remaining_over2);
            remainingOver = remaining_over1 + (remaining_over2 * 0.1f);
            Log.d("remainingRuns", "resetRemainingRuns, remainingOver : " + remainingOver);

        }

        // remainingRuns
        Log.d("remainingRuns", "resetRemainingRuns, remainingRuns : " + remainingRuns);
        Log.d("remainingRuns", "resetRemainingRuns, revisedTarget : " + revisedTarget);
        Log.d("remainingRuns", "resetRemainingRuns, currentRuns : " + currentRuns);
        remainingRuns = revisedTarget - currentRuns;
        Log.d("remainingRuns", "resetRemainingRuns, after remainingRuns : " + remainingRuns);

        tvRemainingRuns.setText(String.valueOf(remainingRuns));
        if (remainingBalls >= 100) {
            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
            tvRemainingOversBallsText.setText(", Overs : ");
            tvRemainingOversBalls.setVisibility(View.VISIBLE);
            tvRemainingOversBalls.setText(String.valueOf(new DecimalFormat("##.#").format(remainingOver)));
        } else {
            tvRemainingOversBallsText.setVisibility(View.VISIBLE);
            tvRemainingOversBallsText.setText(", Balls : ");
            tvRemainingOversBalls.setVisibility(View.VISIBLE);
            Log.e("Scoring", "initializaresetRemainingRuns, last remainingBalls : " + remainingBalls);
            tvRemainingOversBalls.setText(String.valueOf(remainingBalls));
        }
    }


    // added on 05/05/2020
    void readRainRule(float reducedOver, int revisedTarget, boolean reducedRuns, float temp_total_over) {

        View rainRuleView = View.inflate(this, R.layout.rain_rule, null);
        RadioGroup radioGroup = (RadioGroup) rainRuleView.findViewById(R.id.rg_rain_rule);
        RadioButton rb_DL = (RadioButton) rainRuleView.findViewById(R.id.rb_rr_dl);
        RadioButton rb_VJD = (RadioButton) rainRuleView.findViewById(R.id.rb_rr_vjd);
        RadioButton rb_others = (RadioButton) rainRuleView.findViewById(R.id.rb_rr_other);
        LinearLayout ll_com = (LinearLayout) rainRuleView.findViewById(R.id.ll_com);
        EditText et_com = (EditText) rainRuleView.findViewById(R.id.et_rr);

        radioGroup.setOnCheckedChangeListener(new RadioGroup.OnCheckedChangeListener() {
            public void onCheckedChanged(RadioGroup rg, int checkedId) {
                for (int i = 0; i < rg.getChildCount(); i++) {
                    RadioButton btn = (RadioButton) rg.getChildAt(i);
                    if (btn.getId() == checkedId) {
                        text = btn.getText().toString();
                        if (text.matches("Other")) {
                            ll_com.setVisibility(View.VISIBLE);
                            other = true;
                        } else {
                            ll_com.setVisibility(View.GONE);
                            other = false;
                        }
                        return;
                    }
                }
            }
        });

        AlertDialog.Builder builder = new AlertDialog.Builder(this);
        builder.setIcon(R.drawable.ball).
                setTitle("Applied Rain rule is ...").
                setView(rainRuleView).
                setCancelable(false).
                setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        if (other) {
                            if (et_com.getText().toString().matches(""))
                                Toast.makeText(ScoringActivity.this, "Please enter remarks", Toast.LENGTH_SHORT).show();

                            else {
                                commentary = et_com.getText().toString();
                            }
                        }

                        saveRevisedRuns(reducedOver, revisedTarget, reducedRuns, temp_total_over, text, commentary);
//                        saveRevisedRuns(reducedOver, revisedTarget, true, temp_total_over);

                    }
                }).
                setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.cancel();
                    }
                }).
                show();

    }


    void setPowerPlay() {

        Log.d("power", "setPowerPlay, matchtype : " + matchtype);
        Log.d("power", "setPowerPlay, innings : " + innings);

        if ((matchtype.matches("Test")) ||
                ((matchtype.matches("Custom")) && (innings.matches("multi")))) {


            powerPlayDialog = new AlertDialog.Builder(ScoringActivity.this).create();
            powerPlayDialog.setIcon(R.drawable.ball);
            powerPlayDialog.setCancelable(false);
            powerPlayDialog.setTitle("Multi innings match can not have any PowerPlay");
            powerPlayDialog.setButton(AlertDialog.BUTTON_POSITIVE, "OK",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {

                            dialog.dismiss();
                        }
                    });

            powerPlayDialog.show();

        } else {


            power = true;

            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                    wicket, ball, 0, preInningsRuns, remainingRuns, remainingBalls,
                    remainingOver, leadingRuns, innings1Runs, innings2Runs, innings3Runs,
                    innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                    strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls,
                    bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket, preBowlerID,
                    preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket,
                    lastPreBowlerID, 0, -1, -1, 0, -1,
                    0, null, 0, 0, 0,
                    0, false, 0, commentary, -1,
                    mo, maiden, modified, udisplay, tco, tbo, tpbo, intervalID, sessionType,
                    sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay,
                    SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, declared, freeHit,
                    false, inning_started, 0, 0,
                    0, null, pre_out, callBowlerAlert, wk_id,
                    keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                    forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                    tea_flag, dinner_flag);


            Intent i = new Intent(ScoringActivity.this, PowerPlay.class);
            i.putExtra("matchid", matchid);
            i.putExtra("matchID", matchID);
            i.putExtra("innings", currentInnings);
            i.putExtra("match_type", matchtype);
            i.putExtra("match_over", totalOver);
            i.putExtra("eventId", eventID);

            //passing JSONArray from 1 activity to another
//            Bundle b = new Bundle();
//            b.putString("Array",jsonEventArray.toString());
//            i.putExtras(b);

            i.putExtra("jsonArray", jsonEventArray.toString());

            startActivity(i);
        }
    }


    public void allOUT() {

        Log.e("Scoring", "allOUT, allOUT : " + allOUT);


        allOutAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        allOutAlert.setIcon(R.drawable.ball);
        allOutAlert.setCancelable(false);
        allOutAlert.setTitle("ALL OUT");
        allOutAlert.setButton(AlertDialog.BUTTON_POSITIVE, "OK",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        endOfInnings = true;
                        ballType = 10;
                        if (ball >= ballsPerOver)
                            currentOver = totalBalls / ballsPerOver;

                        if (strID != 0)
                            syncBatsmann(strID, 0, null, false, -1,
                                    false, false, wk_flag);
                        if (nstrID != 0)
                            syncBatsmann(nstrID, 0, null, false, -1,
                                    false, false, wk_flag);
                        syncBowler();

                        remainingRuns = currentRuns;
                        if (currentInnings == 1)
                            preInningsRuns = currentRuns;

                        if (totalInnings == 4) {

                            if (currentInnings == 2)
                                preInningsRuns = currentRuns;

                            else if (currentInnings == 3)
                                preInningsRuns = currentRuns;
                        }


                        Log.d("so_inninngs1Runs", "allOUT26 , : " + so_inninngs1Runs);
                        Log.d("strID", "allOUT26 , : " + strID);
                        Log.d("nstrID", "allOUT26 , : " + nstrID);
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket,
                                ball, 0, preInningsRuns, remainingRuns, remainingBalls, remainingOver,
                                leadingRuns, innings1Runs, innings2Runs, innings3Runs, innings4Runs,
                                battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID, strikerRuns,
                                strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                                bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/ preBowlerID,
                                preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                                0, ballType, -1, 0, -1, 0,
                                null, 0, penaltyType, 0, 0,
                                false, 0, commentary, 0, mo,
                                maiden, modified, udisplay, tco, tbo, tpbo, 0, sessionType,
                                sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay,
                                SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, declared, freeHit,
                                false, inning_started, 0, 0,
                                0, null, pre_out, callBowlerAlert, wk_id,
                                keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                tea_flag, dinner_flag);

//                                    endOfOver = true;

                            /*if (totalInnings == 2 && currentInnings == totalInnings){

                                inningsAlert = new AlertDialog.Builder(ScoringActivity.this).create();
                                inningsAlert.setIcon(R.drawable.ball);
                                inningsAlert.setCancelable(false);
                                inningsAlert.setTitle("Match is Over");
                                inningsAlert.setMessage("Allotted innings completed");
                                inningsAlert.setButton(AlertDialog.BUTTON_POSITIVE, "OK",
                                        new DialogInterface.OnClickListener() {
                                            public void onClick(DialogInterface dialog, int which) {
                                                dialog.dismiss();

                                                check_SUPEROVER();
                                            }
                                        });

                                inningsAlert.show();

                            }


                            else {

                                endOfInnings = true;
                                displayScoreCard(false);
                            }*/


                        // updated on 26/02/2021
                        if (currentInnings == 1 ||/* currentInnings == 3 || */currentInnings == 99) { // Updayed on 19/04/2021
//                                callEndOfInnings();
                            setEndInnings(false, ballType);
//                                setMatchStatus("SE3", 11);
                            endOfInnings = true;
                            displayScoreCard(false, false);
                        }

/*
                            COMMENTED ON 26/02/2021
                            else if (currentInnings == 3) {

                                Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();

                                if (match != null) {

                                    Log.d("match", "allOUT() 1, onClickListener, currentRuns : " + currentRuns + ", match : " + match);

                                    if (match.isFollowon()) {

                                        if ((match.getInnings2Runs() + currentRuns) <= match.getInnings1Runs()) {
                                            displayAlert("Allotted innings are completed", 0);
                                            setMatchStatus(match.getStatus(), match.getStatusId());
                                            endOfInnings = true;

                                        }

                                    }

                                    else {

                                        if ((match.getInnings1Runs() + currentRuns) <= match.getInnings2Runs()) {
                                            displayAlert("Allotted innings are completed", 0);
                                            setMatchStatus(match.getStatus(), match.getStatusId());
                                            endOfInnings = true;
                                        }
                                    }
                                }

                                else
                                    Log.d("match", "allOUT() 2, onClickListener, currentRuns : " + currentRuns + ", match : " + match);
                            }
*/

                        else {

                            if (currentInnings == totalInnings) {

                                if (currentInnings == 2) {

                                    if (currentRuns == innings1Runs || currentRuns == preInningsRuns) {

                                        check_SUPEROVER();
                                            /*SUPER_OVER = true;
                                            displayScoreCard(false);*/
                                        // alert for asking superover
//                                            check_SUPEROVER();
                                    } else if (currentRuns < innings1Runs) {
                                        endMessage = "Allotted innings are completed";
                                        displayAlert(endMessage, 0);
                                    }
                                } else if (currentInnings == 4) {
                                    endMessage = "Allotted innings are completed";
                                    displayAlert(endMessage, 0);
                                }
                            } else if (currentInnings == 100) {

//                                    if (currentRuns < so_inninngs1Runs)
                                endMessage = "Allotted innings are completed";
                                displayAlert(endMessage, 0);
                            }

                            // Added on 19/04/2021
                            else if (currentInnings == 3) {

                                Log.d("RR", "1, remainingRuns = " + remainingRuns);

                                if (remainingRuns > 0) {
                                    endMessage = "Target Achieved";
                                    displayAlert(endMessage, 0);
                                } else {
                                    setEndInnings(false, ballType);
                                    endOfInnings = true;
                                    displayScoreCard(false, false);
                                }
                            }

                            //=== till here (16/04/2021)
                            else {
                                /*displayAlert("Allotted innings are completed");*/
                                setEndInnings(false, ballType);
//                                setMatchStatus("SE3", 11);
                                endOfInnings = true;
                                displayScoreCard(false, false);
                            }
                        }

//                            setMatchStatus("SE3", 11);
                        Match match = realm.where(Match.class).equalTo("matchid", matchid).findFirst();
                        setMatchStatus(match.getStatus(), match.getStatusId());
                        endOfInnings = true;
//                            displayScoreCard(false);

                    }
                });

        allOutAlert.setButton(AlertDialog.BUTTON_NEUTRAL, "Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                endOfInnings = true;

                // disabling all buttons in Scoring
//                    btnUndo.setEnabled(false);
                btnSwap.setEnabled(false);
                btnScore.setEnabled(false);
                btnOut.setEnabled(false);
                btnExtras.setEnabled(false);
                btnHash.setEnabled(false);
//                    btnCom.setEnabled(false);
                btnP.setEnabled(false);
                btn0.setEnabled(false);
                btn1.setEnabled(false);
                btn2.setEnabled(false);
                btn3.setEnabled(false);
                btn4.setEnabled(false);
                btn6.setEnabled(false);
                btnInterval.setEnabled(false);
                btnChangeBatsman.setEnabled(false);
                btnChangeBowler.setEnabled(false);

            }
        });
        allOutAlert.show();

//        }
    }


    public void setWagonWheelRegion(int eventId) {
        Log.e("setWagonWheelRegion", " method, eventId : " + eventId);

//        displayProgress();

        Intent i = new Intent(ScoringActivity.this, WagonWheel.class);
        i.putExtra("eventId", eventId);
        i.putExtra("score", score);
        i.putExtra("post_array", String.valueOf(jsonEventArray));
        i.putExtra("efo", efo);
//        i.putExtra("mo", mo);
        startActivity(i);
//        progress.dismiss();

    }


    public void savePreInningsRuns(int preInningsRuns) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Events events = realm.where(Events.class).equalTo("eventID", eventID).findFirst();
                        Log.d("WagonWheel", "saveDetails, eventId  : " + eventID);
                        if (currentInnings == 1)
                            events.setInnings1Runs(preInningsRuns);
                        else if (currentInnings == 2)
                            events.setInnings2Runs(preInningsRuns);
                        else if (currentInnings == 3)
                            events.setInnings3Runs(preInningsRuns);
                        realm.copyToRealmOrUpdate(events);
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(), "Primary Key exists, Press Update instead",
                                Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("scoring", "onclick, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }

    }


    public void callSuperOver() {

        matchTieAlert = new AlertDialog.Builder(ScoringActivity.this).create();
        matchTieAlert.setIcon(R.drawable.ball);
        matchTieAlert.setCancelable(false);
        matchTieAlert.setTitle("Match is tie. Do you want to start Super Over?");
        matchTieAlert.setButton(AlertDialog.BUTTON_POSITIVE, "Ok", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                AlertDialog SOConfirmAlert = new AlertDialog.Builder(ScoringActivity.this).create();
                SOConfirmAlert.setIcon(R.drawable.ball);

            }
        });
        matchTieAlert.setButton(AlertDialog.BUTTON_NEGATIVE, "Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                dialog.cancel();
            }
        });
    }


    public void check_SUPEROVER() {

        Log.d("Scoring", "check_SUPEROVER,");

        if (ballType == 10 && !SUPER_OVER && !allOUT)
            setEndInnings(declared, ballType);


        AlertDialog superOverAlert = new AlertDialog.
                Builder(ScoringActivity.this).create();
        superOverAlert.setIcon(R.drawable.ball);
        superOverAlert.setCancelable(false);
        superOverAlert.setTitle("Do you want to start super over");
//        superOverAlert.setMessage("Allotted innings completed");
        superOverAlert.setButton(AlertDialog.BUTTON_POSITIVE, "CONFIRM",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();


                        SUPER_OVER = true;
                        saveSuperOver(SUPER_OVER);
                        Log.d("SUPER_OVER", "" + SUPER_OVER);

//                    callSuperOver();

                    }

                });


        superOverAlert.setButton(AlertDialog.BUTTON_NEUTRAL, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();
                        endOfMatch = true;
                        callMatchEnd(); // Added on 03/03/2021
                        endOfMatch();

                    }

                });


        superOverAlert.show();


       /* if (currentInnings == 1){

            preInningsRuns = currentRuns;
            savePreInningsRuns(preInningsRuns);
        }

        else if (currentInnings == 2) {

            if ((matchtype.matches("ODI")) ||
                matchtype.matches("T20")) {

                if (preInningsRuns == currentRuns){

                    SUPER_OVER = true;
                    displayScoreCard(false);
//                    callSuperOver();
                }

                else
                    endOfMatch();
            }

            else if (innings.matches("multi")) {
                savePreInningsRuns(currentRuns);
            }
        }

        else if (currentInnings == 3){
                savePreInningsRuns(currentRuns);
        }

        else
            endOfMatch();*/


    }


    void saveSuperOver(boolean superover) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Match match = realm.where(Match.class).
                                equalTo("matchid", matchid).findFirst();

                        if (match != null) {
                            match.setSUPER_OVER(superover);    // 1-> end of match
//                            match.setScoring(false);

                            realm.copyToRealmOrUpdate(match);

//                            displayScoreCard();
                            displayScoreCard(false, false);
                        }

                        Log.d("endOfMatch", "endOfMatch, match : " + match);
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


    void applySubstitution() {


//        selectOutType();
//        selectFielder();


        final ArrayAdapter<String> teamAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                android.R.layout.select_dialog_singlechoice);

        teamAdapter.add(teamA);
        teamAdapter.add(teamB);

        substitutionBuilder = new AlertDialog.Builder(ScoringActivity.this);
        substitutionBuilder.setIcon(R.drawable.ball);
        substitutionBuilder.setCancelable(false);
        substitutionBuilder.setTitle("Apply substitution for :");
//        substitutionBuilder.setNeutralButton("cancel", new DialogInterface.OnClickListener() {
//            @Override
//            public void onClick(DialogInterface dialog, int which) {
//                dialog.cancel();
//            }
//        });
        substitutionBuilder.setAdapter(teamAdapter, new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                String strName = teamAdapter.getItem(which);

                if (which == 0)
                    team = 1;

                else if (which == 1)
                    team = 2;

                if (team == battingTeamNo) {
                    batting = true;
                    fielding = false;
                } else if (team == fieldingTeamNo) {
                    fielding = true;
                    batting = false;
                }

                AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                builderInner.setIcon(R.drawable.ball);
                builderInner.setCancelable(false);
                dialog.dismiss();
                builderInner.setMessage(strName);
                builderInner.setTitle("Selected team is ");

                builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        Log.e("Scoring", "applySubstitution, team : " + team + ", team name : " + strName);
                        displaySubstituteList(team, batting, fielding);
                        dialog.dismiss();

                    }
                });
//
                builderInner.show();
            }
        });

        substitutionBuilder.setNeutralButton("Cancel", null);

        substitutionBuilder.show();
    }


    void displaySubstituteList(int team, boolean batting, boolean fielding) {

//        ballType = 18;
        ballType = -1;
        substitution = true;
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo,
                player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID, nonStrikerRuns,
                nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                bowlerBalls, bowlerWicket, preBowlerID, preBowlerRun, preBowlerOver,
                preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                -1, 0, -1, 0, null,
                0, 0, 0, 0, false,
                0, commentary, -1, mo, maiden, modified,
                udisplay, tco, tbo, tpbo, 0, sessionType, sessionID, false,
                /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs,
                so_inninngs2Runs, declared, freeHit, false, inning_started,
                0, 0, 0, null, pre_out,
                callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                tea_flag, dinner_flag);


        Intent intent = new Intent(ScoringActivity.this, SubstitutionActivity.class);
        intent.putExtra("team", team);
        intent.putExtra("batting", batting);
        intent.putExtra("fielding", fielding);
        intent.putExtra("innings", currentInnings);
        intent.putExtra("bowler_id", bowlerID);
        intent.putExtra("pre_bowler_id", preBowlerID);
//        intent.putExtra("event_id", eventID + 1);
        intent.putExtra("eventId", eventID);
        intent.putExtra("strID", strID);
        intent.putExtra("nstrID", nstrID);
//        ===============================================
        // for saving event


//        intent.putExtra("currentInnings", currentInnings);
//        intent.putExtra("currentRuns", currentRuns);
//        intent.putExtra("currentOver", currentOver);
//        intent.putExtra("totalBalls", totalBalls);
//        intent.putExtra("wicket", wicket);
//        intent.putExtra("ball", ball);
//        intent.putExtra("preInningsRuns", preInningsRuns);
//        intent.putExtra("remainingRuns", remainingRuns);
//        intent.putExtra("remainingBalls", remainingBalls);
//        intent.putExtra("remainingOver", remainingOver);
//        intent.putExtra("leadingRuns", leadingRuns);
//        intent.putExtra("innings1Runs", innings1Runs);
//        intent.putExtra("innings2Runs", innings2Runs);
//        intent.putExtra("innings3Runs", innings3Runs);
//        intent.putExtra("innings4Runs", innings4Runs);
//        intent.putExtra("battingTeamNo", battingTeamNo);
//        intent.putExtra("fieldingTeamNo", fieldingTeamNo);
//        intent.putExtra("player1ID", player1ID);
//        intent.putExtra("player2ID", player2ID);
//        intent.putExtra("strID", strID);
//        intent.putExtra("strikerRuns", strikerRuns);
//        intent.putExtra("strikerBalls", strikerBalls);
//        intent.putExtra("nstrID", nstrID);
//        intent.putExtra("nonStrikerRuns", nonStrikerRuns);
//        intent.putExtra("nonStrikerBalls", nonStrikerBalls);
//        intent.putExtra("bowlerID", bowlerID);
//        intent.putExtra("bwRun", bwRun);
//        intent.putExtra("bowlerOver", bowlerOver);
//        intent.putExtra("bowlerBalls", bowlerBalls);
//        intent.putExtra("bowlerWicket", bowlerWicket);
//        intent.putExtra("preBowlerID", preBowlerID);
//        intent.putExtra("preBowlerRun", preBowlerRun);
//        intent.putExtra("preBowlerOver", preBowlerOver);
//        intent.putExtra("preBowlerBalls", preBowlerBalls);
//        intent.putExtra("preBowlerWicket", preBowlerWicket);
//        intent.putExtra("lastPreBowlerID", lastPreBowlerID);
//        intent.putExtra("mo", mo);
//        intent.putExtra("maiden", maiden);
//        intent.putExtra("modified", modified);
//        intent.putExtra("udisplay", udisplay);
//        intent.putExtra("tco", tco);
//        intent.putExtra("tbo", tbo);
//        intent.putExtra("tpbo", tpbo);
//        intent.putExtra("sessionType", sessionType);
//        intent.putExtra("sessionID", sessionID);
//        intent.putExtra("endOfDay", endOfDay);
//        intent.putExtra("SUPER_OVER", SUPER_OVER);
//        intent.putExtra("so_inninngs1Runs", so_inninngs1Runs);
//        intent.putExtra("so_inninngs2Runs", so_inninngs2Runs);
//        intent.putExtra("freeHit", freeHit);
//        intent.putExtra("inning_started", inning_started);
//        intent.putExtra("intervalID", intervalID);
        startActivity(intent);
    }


    float setRemainingOver(float rOver) {

        float tr = 0.1f * ballsPerOver;

        if (ball == 1) {

            --rOver;
            rOver = rOver + tr;
        }
        return rOver;

    }


    void enableButtons(int flag) {

        //if flag = 0 ==> canceling interval alert box
        //if flag = 1 ==> interval button click from scoring page
        //if flag = 2 ==> end of day
        //if flag = 3 ==> undoing while interval

        Log.d("enable", "enableButtons, flag : " + flag + ", pre_out : " + pre_out);
        Log.d("enable", "enableButtons, dismissedPlayrID : " + dismissedPlayrID);
        Log.d("enable", "enableButtons, strID : " + strID + ", nstrID : " + nstrID);
        Log.d("enable", "enableButtons, ball : " + ball + ", ballsPerOver : " + ballsPerOver);
        Log.d("enable", "enableButtons, flag : " + flag + ",i_flag 1, : " + i_flag);
        Log.d("enable", "enableButtons, bowlerID : " + bowlerID + ",lastBowler , : " + lastBowler);

        interval = false;
        endOfDay = false;

        btnUndo.setEnabled(true);
        btnSwap.setEnabled(true);
        btnOut.setEnabled(true);
        btnExtras.setEnabled(true);
        btnHash.setEnabled(true);
        btn1.setEnabled(true);
        btn2.setEnabled(true);
        btn3.setEnabled(true);
        btn4.setEnabled(true);
        btn6.setEnabled(true);
        btn0.setEnabled(true);
//        btnSession.setEnabled(true);
        btnChangeBatsman.setEnabled(true);
        btnChangeBowler.setEnabled(true);

        btnInterval.setText("START INTERVAL");

        if (flag == 1) {
            ballType = 12;
            intervalID = 7;

            if ((ball >= 0 && ball < ballsPerOver) || (lastBallType == 6))
                i_flag = 0;
            else {
//                if (ball == 0 && bowlerID == lastBowler)
                i_flag = 1;

            }
//            Toast.makeText(this, "ball : " + ball + ",  ballsPerOver : " + ballsPerOver + ", i_flag : " + i_flag,
//                    Toast.LENGTH_SHORT).show();

            Log.d("enable", "enableButtons, flag : " + flag + ", lastBallType : " + lastBallType);
            Log.d("enable", "enableButtons, ball : " + ball + ", ballsPerOver : " + ballsPerOver);

            // Added on 22/04/2021 (B)
            if (sessionID == 7) {
                sessionID = 8;
                sessionType = "SS2";
            } else if (sessionID == 9) {
                sessionID = 10;
                sessionType = "SS3";
            }
            //==== till here (B)

            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                    0, preInningsRuns,
                    remainingRuns, remainingBalls, remainingOver, leadingRuns, innings1Runs, innings2Runs,
                    innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                    strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                    bowlerOver, bowlerBalls, bowlerWicket,/* nextBowlerID,*/preBowlerID, preBowlerRun,
                    preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                    0, 0, 0, 0, null, 0,
                    0, 0, 0, false, 0, commentary,
                    0, mo, maiden, modified, udisplay, tco, tbo, tpbo, intervalID, sessionType,
                    sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                    so_inninngs1Runs, so_inninngs2Runs, declared, freeHit, false,
                    inning_started, 0, 0, 0, null,
                    pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position, FORFEIT,
                    forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                    tea_flag, dinner_flag);
        } else if (flag == 2) {

            ballType = 17;
            sessionID = 12;
            sessionType = "SS1";
            Log.d("ball", "enableButtons, ball : " + ball);
            if ((ball >= 0 && ball < ballsPerOver) || lastBallType == 6)
                i_flag = 0;
            else
                i_flag = 1;

            // Added on 28/04/2021
            lunch_flag = 0;
            tea_flag = 0;
            dinner_flag = 0;
            // ==== till here
            newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                    0, preInningsRuns,
                    remainingRuns, remainingBalls, remainingOver, leadingRuns, innings1Runs, innings2Runs,
                    innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                    strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                    bowlerOver, bowlerBalls, bowlerWicket,/* nextBowlerID,*/preBowlerID, preBowlerRun,
                    preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                    0, 0, 0, 0, null, 0,
                    0, 0, 0, false, 0, commentary,
                    0, mo, maiden, modified, udisplay, tco, tbo, tpbo, intervalID, sessionType,
                    sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                    so_inninngs1Runs, so_inninngs2Runs, declared, freeHit, false,
                    inning_started, 0, 0, 0, null,
                    pre_out, callBowlerAlert, wk_id, keeper_position, pre_wk_id, pre_wk_position,
                    FORFEIT, forfeit_team, forfeit_innings, CONCEDE, conceded_team, forceEndingType,
                    lunch_flag, tea_flag, dinner_flag);
        }

        if (flag != 3) { // added on 07/07/2021
            if (/*pre_out && */(dismissedPlayrID > 0) && (strID == dismissedPlayrID || nstrID == dismissedPlayrID)) {

                out = true;
//            confirm_out = true;
                pre_out = false;
                Log.d("enable", "enableButtons, i_flag 2, : " + i_flag + ", ball : " + ball);
                Log.d("enable", "enableButtons, bowlerID : " + bowlerID + ", lastBowler : " + lastBowler);
                if (ball == 0 && bowlerID == lastBowler) {
                    Log.d("CHANGEBATSMAN", "enableButtons, 1 ");

                    changeBatsman(dismissedPlayrID, null, true, true);
                } else {
                    Log.d("CHANGEBATSMAN", "enableButtons, 2 ");

                    changeBatsman(dismissedPlayrID, null, true, false);

                }
            }
        }
    }


    void disableButtons(int id) {

        if (id == 0)
            interval = true;
//        btnUndo.setEnabled(false);
        btnUndo.setEnabled(true);
        btnSwap.setEnabled(false);
        btnOut.setEnabled(false);
        btnExtras.setEnabled(false);
        btnHash.setEnabled(false);
        btn1.setEnabled(false);
        btn2.setEnabled(false);
        btn3.setEnabled(false);
        btn4.setEnabled(false);
        btn6.setEnabled(false);
        btn0.setEnabled(false);
//        btnSession.setEnabled(false);
        btnChangeBatsman.setEnabled(false);
        btnChangeBowler.setEnabled(false);

        // updated on 30/04/2020
        if (sessionID == 11 && id == 1) {
            btnInterval.setText("END OF DAY");
            btnInterval.setEnabled(false);
        } else {
            btnInterval.setText("END INTERVAL");
            btnInterval.setEnabled(true);
        }

        if (id == 2) {
            btnInterval.setText("START DAY");
            btnInterval.setEnabled(true);
        }
    }


    /*// updated on 22/10/2020*/
    void setInterval(int flag) {

        // flag = 0 ==> from OnClick()
        // flag = 1 ==> from selectBowlerAlertDialog()
        // flag = 3 ==> from changeBatsman()

        View intervalView = View.inflate(this, R.layout.session_interval, null);
        Spinner spinner = (Spinner) intervalView.findViewById(R.id.sp_session_interval);
        LinearLayout ll_remarks = (LinearLayout) intervalView.findViewById(R.id.ll_interval_remarks);
        TextView tv_required_symbol = (TextView) intervalView.findViewById(R.id.tv_required_symbol);
        EditText editText = (EditText) intervalView.findViewById(R.id.et_session_interval);

        /*//added on 22/10/2020
        if (totalInnings == 2)
            ll_remarks.setVisibility(View.GONE);
        else
            ll_remarks.setVisibility(View.VISIBLE);*/

        tv_required_symbol.setVisibility(View.INVISIBLE);

        intervalList.clear();
        intervalList.add("--Select--");
        intervalList.add(" Drinks ");
        intervalList.add(" Lunch ");
        intervalList.add(" Tea ");
        intervalList.add(" Dinner ");
        intervalList.add(" Rain ");
        //added on 30/04/2020
        intervalList.add(" End Of Day ");
        intervalList.add(" End Innings ");
        intervalList.add(" Others ");

        ArrayAdapter<String> adapterIntervals = new ArrayAdapter<String>(this,
                android.R.layout.simple_spinner_item, intervalList);
        adapterIntervals.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item); // The drop down view
        spinner.setAdapter(adapterIntervals);

        // === (a) added on 22/10/2020


//        if (totalInnings == 2)
//            ll_remarks.setVisibility(View.GONE);
//        else
//            ll_remarks.setVisibility(View.VISIBLE);
        spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {
            @Override
            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {
                Object item = parent.getItemAtPosition(position);
                if (item != null) {
                    Log.d("setInterval00", "item.toString() : " + item.toString());
                    String spinner_value = item.toString();
                    if (spinner_value.matches(" Others "))
                        tv_required_symbol.setVisibility(View.VISIBLE);
                    else
                        tv_required_symbol.setVisibility(View.INVISIBLE);

                }
            }

            @Override
            public void onNothingSelected(AdapterView<?> parent) {

            }
        });

        // === (a) till here


        Log.d("selected_interval", "spinner.getSelectedItem() : " + ((String) spinner.getSelectedItem()));

        AlertDialog.Builder builder = new AlertDialog.Builder(this);
        builder.setIcon(R.drawable.ball).
                setTitle("Select Interval Type").
                setView(intervalView).
                setCancelable(false).
                setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialogInterface, int i) {

                        dialogInterface.cancel();
                        text = (String) spinner.getSelectedItem();
                        final int x = spinner.getSelectedItemPosition();

                        Log.d("selected_interval", "i : " + i);
                        Log.d("selected_interval", "text : " + text);
                        Log.d("selected_interval", "x : " + x);
                        Log.d("selected_interval", "s pinner.getSelectedItem() : " + spinner.getSelectedItem());
                        Log.d("selected_interval", "spinner.getSelectedItem().equals(--select--) : " + spinner.getSelectedItem().equals("--select--"));
                        if (i == 0)
                            Log.d("selected_interval", " 2, i : " + i + ", spinner.getSelectedItem() : " + spinner.getSelectedItem());
                        else
                            Log.d("selected_interval", " 3,  i : " + i + ", spinner.getSelectedItem() : " + spinner.getSelectedItem());


                        if (x == -1 || x == 0) {//text.matches("--Select--")) {//i == -1 || i == 0) {//spinner.getSelectedItem().equals("--select--"))
                            displayError("Please select one interval type", 1, flag);

                        } else {

                            Log.d("selected_interval", "else 4,  i : " + i
                                    + ", spinner.getSelectedItem() : " + spinner.getSelectedItem());


                            i_flag = flag;

                            intervalID = spinner.getSelectedItemPosition();
                            if (intervalID == 8)//7)
                                intervalID = 6;
                            Log.d("Scoring", "setIntervalID, : " + intervalID);

//                            text = (String) spinner.getSelectedItem();

                            commentary = editText.getText().toString();
                            Log.d("Test", "remarks : " + commentary);

                            if (x == 8/*7*//*text.matches(" Others ")*/ && commentary.matches("")) {   // Others

                                Log.e("Scoring", "setInterval, com : null");
                                tv_required_symbol.setVisibility(View.VISIBLE);
                                displayError("Please enter remarks if interval type is 'other'", 1, flag);
//                                setInterval(flag);
                            } else if (x == 7) {  // End Innings
                                if (commentary.matches("")) {
//                                forceEndInnings();
                                    tv_required_symbol.setVisibility(View.VISIBLE);
                                    displayError("Please Specify the reason", 1, flag);
                                } else {
                                    tv_required_symbol.setVisibility(View.VISIBLE);
                                    forceEndInnings(1, flag);
                                }
                            }

                            // Added on 22/04/2021
                            else if (x == 5) {
                                tv_required_symbol.setVisibility(View.VISIBLE);
                                displayError("Please Specify the reason", 1, flag);
                            }
                            // ===== till here

                            else if ((x == 6 && innings.matches("single")) /* lunch, tea and dinner */) {   //  End Of Day

                                displayError("No end of day for single innings match", 1, flag);
                            } else {

//                                dialogInterface.cancel();
                                //commented on 30/04/2020
                                disableButtons(0);
                                tv_required_symbol.setVisibility(View.INVISIBLE);

                                Toast.makeText(getApplicationContext(), "You have selected interval " + text,
                                        Toast.LENGTH_SHORT).show();

                                Log.d("so_inninngs1Runs", "setInterval27 , : " + so_inninngs1Runs);

                                //added on 30/04/2020
                                if (x == 6) {

//                                    endOfDay = true;

                                    endOfDay(1, flag);
//                                    setSession();
                                } else {

                                    //
                                    disableButtons(0);

                                    if (x == 2) {   // lunch
                                        if (lunch_flag == 0) {  // Added on 28/04/2021
                                            session = true;
                                            sessionID = 7;
                                            sessionType = "SE1";

                                            lunch_flag = 1;// Added on 28/04/2021

                                            setMatchStatus(sessionType, sessionID);
                                            checkBowler(bowlerID);
                                        } else
                                            displayError("Invalid interval selection", 1, flag);

                                    } else if (x == 3) {  // tea
                                        if (tea_flag == 0) {    // Added on 28/04/2021
                                            session = true;
                                        /* Commented on 22/04/2021
                                        sessionID = 9;
                                        sessionType = "SE2";*/
                                            // Updated on 22/04/2021 (A)
                                            if (sessionID == 12) {
                                                sessionID = 7;
                                                sessionType = "SE1";
                                            } else if (sessionID == 8) {
                                                sessionID = 9;
                                                sessionType = "SE2";
                                            }
                                            // till here (A)
                                            tea_flag = 1;// Added on 28/04/2021
                                            setMatchStatus(sessionType, sessionID);
                                        } else
                                            displayError("Invalid interval selection", 1, flag);
                                    }
                                    ///============  till here

                                    // Added on 22/04/2021 (1)
                                    else if (x == 4) {  // dinner
                                        // Updated on 28/04/2021 (2)
                                        if (dinner_flag == 0) {
                                            if (lunch_flag == 0) {
                                                session = true;
                                                sessionID = 9;
                                                sessionType = "SE2";
                                                dinner_flag = 1;
                                                setMatchStatus(sessionType, sessionID);
                                            } else
                                                displayError("Invalid interval selection", 1, flag);
                                        } else
                                            displayError("Invalid interval selection", 1, flag);
                                        // till here (2)

                                    }
                                    // ===== till here(1)


                                    endOfDay = false;
                                    ballType = 12;
                                    newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket,
                                            ball, 0,
                                            preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                            innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                            fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                            nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                            bowlerBalls, bowlerWicket,/* nextBowlerID,*/preBowlerID, preBowlerRun,
                                            preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                                            0, ballType, 0, 0, 0, dismissedPlayrID,
                                            null, 0, 0, 0, 0,
                                            false, 0, commentary, 0, mo, maiden,
                                            modified, udisplay, tco, tbo, tpbo, intervalID, sessionType, sessionID,
                                            false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                                            so_inninngs1Runs, so_inninngs2Runs, declared, freeHit, false,
                                            inning_started, 0, 0, 0,
                                            null, pre_out, callBowlerAlert, wk_id, keeper_position,
                                            pre_wk_id, pre_wk_position, FORFEIT, forfeit_team, forfeit_innings,
                                            CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);
                                    pre_out = false;
                                }

                            }
                        }

//                        else
//                            displayError("Please select one interval type");

                    }
                }).
                setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialogInterface, int i) {
                        dialogInterface.cancel();
                        pre_out = false;

                        if (flag == 1) {
                            enableButtons(0);
                            selectBowlerAlertDialog();
                        } else if (flag == 3) {

                            Log.d("CHANGEBATSMAN", "setInterval, Cancel");
                            changeBatsman(dismissedPlayrID, null, newPartnership, false);
                        }
                    }
                }).
                show();


//        ==================================================================================================
//==========================================================================================================

/*        LayoutInflater layoutInflater = (LayoutInflater)
                ScoringActivity.this.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
        View customViewINTERVAL = layoutInflater.inflate(R.layout.interval,null);

        interval_ok = customViewINTERVAL.findViewById(R.id.btn_interval);
        interval_cancel = customViewINTERVAL.findViewById(R.id.btn_interval_cancel);
        interval_et = customViewINTERVAL.findViewById(R.id.et_interval);
        interval_sp = customViewINTERVAL.findViewById(R.id.sp_interval);
//        interval_sp = popupInterval.getContentView().findViewById(R.id.sp_interval);

        //instantiate OUT popup window
        popupInterval = new PopupWindow(customViewINTERVAL,
                LinearLayout.LayoutParams.WRAP_CONTENT,
                LinearLayout.LayoutParams.WRAP_CONTENT);
        popupInterval.setFocusable(true);
        popupInterval.setOutsideTouchable(isRestricted());
        popupInterval.update();

        //display the OUT popup window
        popupInterval.showAtLocation(linearLayout,
                Gravity.CENTER_VERTICAL, 0, 0);

        intervalList.clear();
        intervalList.add("--Select--");
        intervalList.add(" Drinks ");
        intervalList.add(" Lunch ");
        intervalList.add(" Tea ");
        intervalList.add(" Dinner ");
        intervalList.add(" Rain ");
        intervalList.add(" others ");

        interval_et.setSingleLine(false);

//        sessionList.add("--Select--");

        ArrayAdapter<String> adapterInterval = new ArrayAdapter<String>(this,
                android.R.layout.simple_spinner_item, intervalList);
        adapterInterval.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item); // The drop down view
        interval_sp.setAdapter(adapterInterval);

//        playerOUT();
//        btn_out_next
//
        interval_ok.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                if (!interval_sp.getSelectedItem().equals("--select--")) {

                    i_flag = flag;

                    intervalID = interval_sp.getSelectedItemPosition();
                    Log.d("Scoring", "setIntervalID, : " + intervalID);

                    text = (String) interval_sp.getSelectedItem();

                    commentary = interval_et.getText().toString();
                    Log.d("Test", "remarks : " + commentary);

                    if (text.matches("others") && commentary.matches("")) {

                        Log.e("Scoring", "setInterval, com : null");
                        displayError("Please enter the commentary");
                    }

                    else {

                       disableButtons(0);

                            Toast.makeText(getApplicationContext(), "You have selected interval " + text,
                                    Toast.LENGTH_SHORT).show();

                            popupInterval.dismiss();



                        Log.d("so_inninngs1Runs","setInterval27 , : "+so_inninngs1Runs);

                        ballType = 12;
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                bowlerBalls, bowlerWicket,/* nextBowlerID,*//*preBowlerID, preBowlerRun,
                                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                                0, ballType, 0, 0, 0, 0,
                                null, 0, 0, 0, 0,
                                false, 0, commentary, 0, mo, maiden,
                                modified, udisplay, tco, tbo, tpbo, intervalID, sessionType, sessionID,
                                false, /*jsonEventArray, jsonUndoArray,*//* endOfDay, SUPER_OVER,
                                so_inninngs1Runs, so_inninngs2Runs, declared, freeHit, false,
                                inning_started, 0);

                    }
                }
            }
        });


        interval_cancel.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                popupInterval.dismiss();
                if (flag == 1) {
                    selectBowlerAlertDialog();
                }
            }
        });*/
    }


    void sessionEnable(boolean sessions) {

        if (sessions) {

            // disabling all buttons in Scoring
//                            btnUndo.setEnabled(false);
            btnSwap.setEnabled(false);
            btnScore.setEnabled(false);
            btnOut.setEnabled(false);
            btnExtras.setEnabled(false);
            btnHash.setEnabled(false);
//                            btnCom.setEnabled(false);
            btn0.setEnabled(false);
            btn1.setEnabled(false);
            btn2.setEnabled(false);
            btn3.setEnabled(false);
            btn4.setEnabled(false);
            btn6.setEnabled(false);
            btnInterval.setEnabled(false);
            btnChangeBatsman.setEnabled(false);
            btnChangeBowler.setEnabled(false);

        } else {

            // disabling all buttons in Scoring
//                            btnUndo.setEnabled(false);
            btnSwap.setEnabled(true);
            btnScore.setEnabled(true);
            btnOut.setEnabled(true);
            btnExtras.setEnabled(true);
            btnHash.setEnabled(true);
//                            btnCom.setEnabled(false);
            btn0.setEnabled(true);
            btn1.setEnabled(true);
            btn2.setEnabled(true);
            btn3.setEnabled(true);
            btn4.setEnabled(true);
            btn6.setEnabled(true);
            btnInterval.setEnabled(true);
            btnChangeBatsman.setEnabled(true);
            btnChangeBowler.setEnabled(true);

        }
    }


    void setSession() {

        View sessionView = View.inflate(this, R.layout.session_interval, null);
        Spinner spinner = (Spinner) sessionView.findViewById(R.id.sp_session_interval);
        EditText editText = (EditText) sessionView.findViewById(R.id.et_session_interval);

        sessionList.clear();
        sessionList.add("--Select--");
        sessionList.add("Session 1");
        sessionList.add("Session 2");
        sessionList.add("Session 3");

        ArrayAdapter<String> adapterSessions = new ArrayAdapter<String>(this,
                android.R.layout.simple_spinner_item, sessionList);
        adapterSessions.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item); // The drop down view
        spinner.setAdapter(adapterSessions);

        AlertDialog.Builder builder = new AlertDialog.Builder(this);
        builder.setIcon(R.drawable.ball).
                setTitle("Select Session Type").
                setView(sessionView).
                setCancelable(false).
                setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialogInterface, int i) {

                        dialogInterface.cancel();
                        final int x = spinner.getSelectedItemPosition();
                        if (x > 0) {//!spinner.getSelectedItem().equals("--select--")) {

                            commentary = editText.getText().toString();
                            Log.d("Test", "BuilderText : " + commentary);

                            if (commentary.matches("")) {

                                displayError("Please enter remarks", 2, 0);
//                                setSession();
//                                Toast.makeText(getApplicationContext(),
//                                        "Please enter the remarks", Toast.LENGTH_SHORT).show();
                            } else {

//                        if (!commentary.matches("")) {
                                /*sessionID = interval_sp.getSelectedItemPosition() + 1;*/

                                ++session_click;

//                                text = (String) btnSession.getText();
                                Toast.makeText(getApplicationContext(), "You have selected interval " + text,
                                        Toast.LENGTH_SHORT).show();

                                //change text in button
                                //change text in button


                                if (session_click == 0) {
//                                    btnSession.setText("END SESSION1");
                                    endOfDay = false;
                                    session = false;
                                    sessionID = 12;
                                    sessionType = "SS1";
                                    setMatchStatus(sessionType, sessionID);
                                } else if (session_click == 1) {
//                                    btnSession.setText("START SESSION2");
                                    session = true;
                                    sessionID = 7;
                                    sessionType = "SE1";
                                    setMatchStatus(sessionType, sessionID);
                                    checkBowler(bowlerID);
                                } else if (session_click == 2) {
//                                    btnSession.setText("END SESSION2");
                                    session = false;
                                    sessionID = 8;
                                    sessionType = "SS2";
                                    setMatchStatus(sessionType, sessionID);
                                } else if (session_click == 3) {
//                                    btnSession.setText("START SESSION3");
                                    session = true;
                                    sessionID = 9;
                                    sessionType = "SE2";
                                    setMatchStatus(sessionType, sessionID);
                                } else if (session_click == 4) {
//                                    btnSession.setText("END SESSION3");
                                    session = false;
                                    sessionID = 10;
                                    sessionType = "SS3";
                                    setMatchStatus(sessionType, sessionID);
                                } else if (session_click == 5) {
//                                    btnSession.setText("END OF INNINGS");
                                    session = true;
                                    sessionID = 11;
                                    sessionType = "SE3";
                                    setMatchStatus(sessionType, sessionID);
                                }

                                sessionEnable(session);
//                                popupSession.dismiss();

                                Log.d("so_inninngs1Runs", "setSession28 , : " + so_inninngs1Runs);
                                Log.d("sessionID", "setSession28 , : " + sessionID);
                                ballType = 13;
                                newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                                        wicket, ball, 0,
                                        preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                        innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                        fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                        nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                        bowlerBalls, bowlerWicket,/* nextBowlerID,*/preBowlerID, preBowlerRun,
                                        preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0,
                                        ballType, 0, 0, 0, dismissedPlayrID,
                                        null, 0, 0, 0, 0,
                                        false, 0, commentary, 0, mo,
                                        maiden, modified, udisplay, tco, tbo, tpbo, intervalID, sessionType,
                                        sessionID, false, /*jsonEventArray, jsonUndoArray,*/ endOfDay,
                                        SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, declared, freeHit,
                                        false, inning_started, 0, 0,
                                        0, null, pre_out, callBowlerAlert, wk_id,
                                        keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                        forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                        tea_flag, dinner_flag);
                            }

                        } else {
                            displayError("Please select session", 2, 0);
//                            setSession();
                        }
                    }
                }).
                setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialogInterface, int i) {
                        dialogInterface.cancel();
                    }
                }).
                show();


//==================================================================================================================
//==================================================================================================================
/*        LayoutInflater layoutInflater = (LayoutInflater)
                ScoringActivity.this.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
        View customViewINTERVAL = layoutInflater.inflate(R.layout.interval,null);

        session_ok = customViewINTERVAL.findViewById(R.id.btn_interval);
        session_cancel = customViewINTERVAL.findViewById(R.id.btn_interval_cancel);
        session_et = customViewINTERVAL.findViewById(R.id.et_interval);
        session_sp = customViewINTERVAL.findViewById(R.id.sp_interval);

        //instantiate OUT popup window
        popupSession = new PopupWindow(customViewINTERVAL,
                LinearLayout.LayoutParams.WRAP_CONTENT,
                LinearLayout.LayoutParams.WRAP_CONTENT);
        popupSession.setFocusable(true);
        popupSession.setOutsideTouchable(isRestricted());
        popupSession.update();


        //display the OUT popup window
        popupSession.showAtLocation(linearLayout, Gravity.CENTER_VERTICAL, 0, 0);

        sessionList.clear();
        sessionList.add("--Select--");
        sessionList.add("Session 1");
        sessionList.add("Session 2");
        sessionList.add("Session 3");

        session_et.setSingleLine(false);

//        sessionList.add("--Select--");

        ArrayAdapter<String> adapterSession = new ArrayAdapter<String>(this,
                android.R.layout.simple_spinner_item, sessionList);
        adapterSession.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item); // The drop down view
        session_sp.setAdapter(adapterSession);

        session_ok.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                if (!session_sp.getSelectedItem().equals("--select--")) {

                    commentary = session_et.getText().toString();
                    Log.d("Test", "BuilderText : " + commentary);

                    if (commentary.matches("")) {

                        Toast.makeText(getApplicationContext(),
                                "Please enter the remarks", Toast.LENGTH_SHORT).show();
                    }

                    else {

//                        if (!commentary.matches("")) {

                        /*sessionID = interval_sp.getSelectedItemPosition() + 1;*//*

                            ++session_click;

                            text = (String) btnSession.getText();
                            Toast.makeText(getApplicationContext(), "You have selected interval " + text,
                                    Toast.LENGTH_SHORT).show();

                            //change text in button
                            //change text in button

                            if (session_click == 0) {
                                btnSession.setText("END SESSION1");
                                endOfDay = false;
                                session = false;
                                sessionID = 12;
                                sessionType = "SS1";
                                setMatchStatus(sessionType, sessionID);
                            }

                            else if (session_click == 1) {
                                btnSession.setText("START SESSION2");
                                session = true;
                                sessionID = 7;
                                sessionType = "SE1";
                                setMatchStatus(sessionType, sessionID);
                                checkBowler(bowlerID);
                            }

                            else if (session_click == 2) {
                                btnSession.setText("END SESSION2");
                                session = false;
                                sessionID = 8;
                                sessionType = "SS2";
                                setMatchStatus(sessionType, sessionID);
                            }

                            else if (session_click == 3) {
                                btnSession.setText("START SESSION3");
                                session = true;
                                sessionID = 9;
                                sessionType = "SE2";
                                setMatchStatus(sessionType, sessionID);
                            }

                            else if (session_click == 4) {
                                btnSession.setText("END SESSION3");
                                session = false;
                                sessionID = 10;
                                sessionType = "SS3";
                                setMatchStatus(sessionType, sessionID);
                            }

                            else if (session_click == 5) {
                                btnSession.setText("END OF INNINGS");
                                session = true;
                                sessionID = 11;
                                sessionType = "SE3";
                                setMatchStatus(sessionType, sessionID);
                            }

                            sessionEnable(session);
                            popupSession.dismiss();

                        Log.d("so_inninngs1Runs","setSession28 , : "+so_inninngs1Runs);
                        Log.d("sessionID","setSession28 , : "+sessionID);
                        ballType = 13;
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                bowlerBalls, bowlerWicket,/* nextBowlerID,*//*preBowlerID, preBowlerRun,
                                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0,
                                ballType, 0, 0, 0, 0,
                                null, 0, 0, 0, 0,
                                false, 0, commentary, 0, mo,
                                maiden, modified, udisplay, tco, tbo, tpbo, intervalID, sessionType,
                                sessionID, false, /*jsonEventArray, jsonUndoArray,*//* endOfDay,
                                SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, declared, freeHit,
                                false, inning_started, 0);
                    }
                }

                else
                    Toast.makeText(getApplicationContext(), "Please select session", Toast.LENGTH_SHORT).show();
            }
        });


        session_cancel.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                popupSession.dismiss();
            }
        });*/
    }


    void setMatchStatus(String status, int id) {
        Log.d("setMatchStatus", "setMatchStatus starting ");
        Log.d("session", "setMatchStatus 1, session : " + status);
        Log.d("session", "setMatchStatus 1, sessionType : " + id);

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm bgRealm) {

                    try {

                        Match match1 = bgRealm.where(Match.class).
                                equalTo("matchid", matchid).
                                findFirst();

//                        match1.setMatchSync(1);
                        match1.setStatus(status);
                        match1.setStatusId(id);
                        match1.setPlayingInnings(currentInnings);
                        if (currentInnings == 1)
                            match1.setInnings1Runs(currentRuns);
                        else if (currentInnings == 2)
                            match1.setInnings2Runs(currentRuns);
                        else if (currentInnings == 3)
                            match1.setInnings3Runs(currentRuns);
                        else if (currentInnings == 4)
                            match1.setInnings4Runs(currentRuns);

                        // Added on 28/04/2021
                        match1.setLunch_flag(lunch_flag);
                        match1.setTea_flag(tea_flag);
                        match1.setDinner_flag(dinner_flag);
                        // === till here (28/04/2021
                        bgRealm.copyToRealm(match1);
                        Log.d("setMatchStatus", " match1 : " + match1);

//                    } catch (JSONException e) {
//                        e.printStackTrace();
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead",
                                Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("test", "Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }


        ballType = 13;
        Log.d("so_inninngs1Runs", "setMatchStatus29 , : " + so_inninngs1Runs);
        Log.d("scoring", "setMatchStatus : ballType " + ballType);
        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket, ball,
                0, preInningsRuns,
                remainingRuns, remainingBalls, remainingOver, leadingRuns, innings1Runs, innings2Runs,
                innings3Runs, innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun,
                bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/preBowlerID, preBowlerRun,
                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, 0, ballType,
                0, 0, 0, dismissedPlayrID, null, 0,
                0, 0, 0, false, 0, commentary,
                0, mo, maiden, modified, udisplay, tco, tbo, tpbo, 0, status, id,
                false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs,
                so_inninngs2Runs, declared, freeHit, false, inning_started, 0,
                0, 0, null, pre_out, callBowlerAlert, wk_id,
                keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team, forfeit_innings,
                CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);
    }


    public void checkBowler(int pbType) {

//        undo();

//        int pbId = 0, pbType = 0;
        Events lastEvent = realm.where(Events.class).
                equalTo("matchid", matchid).
                equalTo("innings", currentInnings).findAll().last();

        if (pbType == 0)
            pbType = lastEvent.getBallType();

        if (pbType == 4 || pbType == 5)     // if end of over or force end of over then call method to select next bowler
            selectBowlerAlertDialog();

        else if (pbType == 1 || pbType == 2 || pbType == 3 || pbType == 6 || pbType == 8)
            Log.e("scoring", "Next bowler is already selected");
            // if last ball id run or boundary or out or extra or next bowler is already selected
        else if (pbType == 7) {

            pbType = realm.where(Events.class).
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    equalTo("eventID", (lastEventID - 1)).findFirst().getBallType();
            checkBowler(pbType);
        }


    }


    public float setOverDisplay(int over, int balls) {

        float result = 0f;

//        result = ((over * 10) + balls)/ 10;
        result = over + (balls / 10f);

        return result;
    }


    private void saveWagonWheelRegion(int eventId, String wwRegion, int stroke_direction) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

//                        Events events = realm.where(Events.class).equalTo("eventID", eventId).findFirst();
                        Events events = realm.where(Events.class).
                                equalTo("matchid", matchid).
                                equalTo("innings", currentInnings).findAll().last();
                        Log.d("WagonWheel", "saveDetails, eventId  : " + eventId);
                        events.setWagonWheelRegion(wwRegion);
                        events.setStrokeDirection(stroke_direction);
                        realm.copyToRealmOrUpdate(events);
                        Log.d("wheel", "saveDetails, events  : " + events);

                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("toss", "onclick, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


    private void updateSubstitution(int eventId, boolean substitution, boolean powers, int subID, int pp_id, int ballType) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {
                @Override
                public void execute(Realm realm) {

                    try {

                        Events events = realm.where(Events.class).equalTo("eventID", eventId).findFirst();
                        Log.d("eventId", "updateSubstitution,   : " + eventId);
                        Log.d("subID", "updateSubstitution,   : " + subID);
                        events.setBallType(ballType);
                        // commented on 29/04/20
                        /*if (substitution)
                            events.setSubstitutionID(subID);
                        else*/
                        if (powers) {
                            events.setPower_id(pp_id);
                        }
//                        events.setStrokeDirection(stroke_direction);
                        realm.copyToRealmOrUpdate(events);


                        Log.d("power", "eventId : " + eventId);
                        Log.d("power", "events : " + events);
                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("toss", "onclick, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }
    }


    // new custom alertbox to display dismissed player details

    public void dismissedPlayerDetails(int dismissedId) {

        Log.d("Scoring", "dpd, dismissedId : " + dismissedId);
        Log.d("Scoring", "dpd, retired 5 : " + retired);
        Log.d("Scoring", "dpd, newPartnership 5 : " + newPartnership);

//        progress.dismiss();
        String name = realm.where(Player.class).
                equalTo("matchid", matchid).
//                equalTo("team", battingTeamNo).
        equalTo("playerID", dismissedId).findFirst().getPlayerName();
        Log.d("Scoring", "dpd, dismissedplayer : " + name);

        Batsman batsman = realm.where(Batsman.class).
                equalTo("matchid", matchid).
//                equalTo("team", battingTeamNo).
        equalTo("innings", currentInnings).
                        equalTo("batsman_pID", dismissedId).findFirst();


        // custom alert box

        View dismissedDetailsView = View.inflate(this, R.layout.dismissed_player_details, null);
        TextView tv_dismissedPlayer = (TextView) dismissedDetailsView.findViewById(R.id.tv_dis_name);
        TextView tv_boundaries = (TextView) dismissedDetailsView.findViewById(R.id.tv_boundaries);
        tv_dismissedPlayer.setText(name + "\t\t\t\t\t\t\t" + batsman.getRuns() + "(" + batsman.getBalls() + ")");
        tv_boundaries.setText("Fours " + batsman.getF4s() + "\t\t\t\t\t Sixes " + batsman.getS6s());


        AlertDialog.Builder builder = new AlertDialog.Builder(this);
//        builder.setIcon(R.drawable.ball);
//        builder.setTitle("Last Wicket");
        builder.setView(dismissedDetailsView)
                .setTitle("Last Wicket")
                .setIcon(R.drawable.ball)
                .setCancelable(false)
                .setPositiveButton("OK", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();

                        fieldersList.clear();
                        fielderPlayerID = null;
                        fielderPlayer = "";
                        dismissedPlayrID = dismissedId;

                        Log.d("endOver", "endOver : " + endOver);
                        Log.d("endOver", "ball : " + ball);
                        Log.d("endOver", "ballsPerOver : " + ballsPerOver);

                        /*if (!allOUT) {

                            if (ball == ballsPerOver) {
                                int tempOver = (int) currentOver;
                                if (tempOver < (totalOver - 1)) {
                                    if (endOver)
                                        callEndOfOverAlert();
                                    else
                                        changeBatsman(dismissedId, null, newPartnership, false);
                                }
                                else if (tempOver == (totalOver - 1))
//                                        if (ball == ballsPerOver){
                                    callEndOfOverAlert();
//                                        }
                            }
                            else {
                                if (endOver)
                                    callEndOfOverAlert();
                                else
                                    changeBatsman(dismissedId, null, newPartnership, false);
                            }
                        }
                        else {
                            if (strID == dismissedId) {
                                strID = 0;
                                striker = "";
                                strikerRuns = 0;
                                strikerBalls = 0;
                                strikerDots = 0;
                                strikerF4s = 0;
                                strikerS6s = 0;
                            }
                            else if (nstrID == dismissedId) {
                                nstrID = 0;
                                nonStriker = "";
                                nonStrikerRuns = 0;
                                nonStrikerBalls = 0;
                                nonStrikerDots = 0;
                                nonStrikerF4s = 0;
                                nonStrikerS6s = 0;
                            }

                            if ( player1ID == dismissedId) {
                                player1 = "";
                                player1ID = 0;
                                player1Runs = 0;
                                player1Balls = 0;
                                player1Dots = 0;
                                player1F4s = 0;
                                player1S6s = 0;
                            }
                            else if ( player2ID == dismissedId) {
                                player2 = "";
                                player2ID = 0;
                                player2Runs = 0;
                                player2Balls = 0;
                                player2Dots = 0;
                                player2F4s = 0;
                                player2S6s = 0;
                            }
                            allOUT();

                        }*/

                        if (allOUT) {

                            if (strID == dismissedId) {
                                strID = 0;
                                striker = "";
                                strikerRuns = 0;
                                strikerBalls = 0;
                                strikerDots = 0;
                                strikerF4s = 0;
                                strikerS6s = 0;
                            } else if (nstrID == dismissedId) {
                                nstrID = 0;
                                nonStriker = "";
                                nonStrikerRuns = 0;
                                nonStrikerBalls = 0;
                                nonStrikerDots = 0;
                                nonStrikerF4s = 0;
                                nonStrikerS6s = 0;
                            }

                            if (player1ID == dismissedId) {
                                player1 = "";
                                player1ID = 0;
                                player1Runs = 0;
                                player1Balls = 0;
                                player1Dots = 0;
                                player1F4s = 0;
                                player1S6s = 0;
                            } else if (player2ID == dismissedId) {
                                player2 = "";
                                player2ID = 0;
                                player2Runs = 0;
                                player2Balls = 0;
                                player2Dots = 0;
                                player2F4s = 0;
                                player2S6s = 0;
                            }
                            allOUT();

                        } else {

                            if (ball == ballsPerOver) {
                                int tempOver = (int) currentOver;
                                if (tempOver < (totalOver - 1)) {
                                    if (endOver)
                                        callEndOfOverAlert();
                                    else {
                                        Log.d("CHANGEBATSMAN", "dismissedPlayerDetails, 1 ");
                                        changeBatsman(dismissedId, null, newPartnership, false);
                                    }
                                } else if (tempOver == (totalOver - 1))
//                                        if (ball == ballsPerOver){
                                    callEndOfOverAlert();
//                                        }
                            } else {
                                if (endOver)
                                    callEndOfOverAlert();
                                else {
                                    Log.d("CHANGEBATSMAN", "dismissedPlayerDetails, 2 ");
                                    changeBatsman(dismissedId, null, newPartnership, false);
                                }
                            }
                        }

                    }
                }).show();


//        if (player != null) {


/*            AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
            alertDialog.setIcon(R.drawable.ball);
            alertDialog.setCancelable(false);
            alertDialog.setTitle("Last Wicket");
            alertDialog.setMessage(name+"\t\t\t\t\t\t\t"+batsman.getRuns()+"("+batsman.getBalls()+")");
            alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "OK",
                    new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int which) {
                            dialog.dismiss();

                            fieldersList.clear();
                            fielderPlayerID = null;
                            fielderPlayer = "";

                            if (!allOUT) {
                                if (ball == ballsPerOver) {
                                    int tempOver = (int) currentOver;
                                    if (tempOver < (totalOver - 1))
                                        changeBatsman(dismissedId, null, newPartnership);
                                    else if (tempOver == (totalOver - 1))
//                                        if (ball == ballsPerOver){
                                            callEndOfOverAlert();
//                                        }
                                }
                                else
                                    changeBatsman(dismissedId, null, newPartnership);
                            }
                            else {
                                if (strID == dismissedId) {
                                    strID = 0;
                                    striker = "";
                                    strikerRuns = 0;
                                    strikerBalls = 0;
                                    strikerDots = 0;
                                    strikerF4s = 0;
                                    strikerS6s = 0;
                                }
                                else if (nstrID == dismissedId) {
                                    nstrID = 0;
                                    nonStriker = "";
                                    nonStrikerRuns = 0;
                                    nonStrikerBalls = 0;
                                    nonStrikerDots = 0;
                                    nonStrikerF4s = 0;
                                    nonStrikerS6s = 0;
                                }

                                if ( player1ID == dismissedId) {
                                    player1 = "";
                                    player1ID = 0;
                                    player1Runs = 0;
                                    player1Balls = 0;
                                    player1Dots = 0;
                                    player1F4s = 0;
                                    player1S6s = 0;
                                }
                                else if ( player2ID == dismissedId) {
                                    player2 = "";
                                    player2ID = 0;
                                    player2Runs = 0;
                                    player2Balls = 0;
                                    player2Dots = 0;
                                    player2F4s = 0;
                                    player2S6s = 0;
                                }
                                allOUT();

                            }
                        }
                    });
            alertDialog.show();*/
//        }

    }


    @Override
    public void onResume() {
        super.onResume();
        // put your code here...

//        if (just_started)
//        Log.e("SCoring", "onResume");
//        initializeVariables();

    }


    void checkFreeHitBall() {

        Log.d("checkFreeHit", "checkFreeHitBall 1, : " + checkFreeHit);
        Log.d("freeHit", "checkFreeHitBall 1, : " + freeHit);

        AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
        alertDialog.setIcon(R.drawable.ball);
        alertDialog.setCancelable(false);
        alertDialog.setTitle("Next ball is Freehit ball  ");
        alertDialog.setButton(AlertDialog.BUTTON_POSITIVE, "Confirm",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        freeHit = true;
                        checkFreeHit = false;
                    }
                });

        alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "Cancel",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        freeHit = false;
                        checkFreeHit = false;
                    }
                });
        alertDialog.show();
    }


    void displayError(String messages, int interval, int flag) {

        AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
        alertDialog.setIcon(R.drawable.ball);
        alertDialog.setCancelable(false);
        alertDialog.setTitle(messages);
        alertDialog.setButton(AlertDialog.BUTTON_POSITIVE, "OK",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        if (interval == 1)
                            setInterval(flag);
                        else if (interval == 2)
                            setSession();
                    }
                });
        alertDialog.show();
    }


    void displayError(String messages) {

        AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
        alertDialog.setIcon(R.drawable.ball);
        alertDialog.setCancelable(false);
        alertDialog.setTitle(messages);
        alertDialog.setButton(AlertDialog.BUTTON_POSITIVE, "OK",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        if (out) {
                            bye = false;
                            lb = false;
                            wide = false;
                            runsOffBatNB = false;
                            byeNB = false;
                            lbNB = false;
                            boundaryNB = false;
                            noneNB = false;
                            penalty = false;
                            checkFreeHit = false;
                            tv_extraType.setVisibility(View.INVISIBLE);
                            tv_extraType.setText("");
                            et_runsOffBat_out.setText("");
                            et_extra_run_out.setText("");
                            ll_extras.setVisibility(View.GONE);
                            message = "";

                        }
                    }
                });
        alertDialog.show();
    }


    void displayError(String title, String message) {

        AlertDialog alertDialog = new AlertDialog.Builder(ScoringActivity.this).create();
        alertDialog.setIcon(R.drawable.ball);
        alertDialog.setCancelable(false);
        alertDialog.setTitle(title);
        alertDialog.setMessage(message);
        alertDialog.setButton(AlertDialog.BUTTON_POSITIVE, "OK",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();

                        if (currentInnings == 1) {

                            addsToBatsman(fieldingTeamNo, 2);
                        }
                        endOfMatch = true;
                        ballType = 14;
                        Log.d("so_inninngs1Runs", "displayError30 , : " + so_inninngs1Runs);
                        Log.e("Scoring", "setOver, matchOverAlert, ballType : " + ballType);
                        Log.e("strID", "setOver, matchOverAlert, ballType : " + strID);
                        Log.e("nstrID", "setOver, matchOverAlert, ballType : " + nstrID);
                        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                                wicket, ball, 0,
                                preInningsRuns, remainingRuns, remainingBalls, remainingOver, leadingRuns,
                                innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls,
                                nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver,
                                bowlerBalls, bowlerWicket, /*nextBowlerID,*/ preBowlerID, preBowlerRun,
                                preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID, runs,
                                ballType, 0, 0, 0, 0,
                                null, 0, 0, 0, 0,
                                false, 0, commentary, 0, 0,
                                false, modified, udisplay, tco, tbo, tpbo, 0,
                                sessionType, sessionID, false, /*jsonEventArray, jsonUndoArray,*/
                                endOfDay, SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs, declared,
                                freeHit, false, inning_started, 0, 0,
                                0, null, pre_out, callBowlerAlert, wk_id,
                                keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                                forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                                tea_flag, dinner_flag);

                        /*syncBatsmann(strID, 0, null, false, -1, false, false);
                        syncBatsmann(nstrID, 0, null, false, -1, false, false);
                        syncBowler();*/
                        setEndInnings(false, ballType);
                        endOfMatch();

                    }
                });
//        alertDialog.show();

        alertDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "CANCEL",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        endOfMatch = false;
                        ballType = -1;

                    }
                });
        alertDialog.show();
    }


    public void displayProgress() {

        progress = new ProgressDialog(this);
        progress.setMessage("Please wait...");
        progress.setProgressStyle(ProgressDialog.STYLE_SPINNER);
        progress.setIndeterminate(true);
        progress.setProgress(0);
        progress.show();
    }


    void syncPartnership(int wicket, boolean out, int dismissedPlayerID, boolean retired, boolean undoWicket) {


        Log.d("Partnership", "syncPartnership, newPartnership : " + retired);
        // add new variable for new partnership when retiredHurt

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);

        realm.executeTransaction(new Realm.Transaction() {
            @Override
            public void execute(Realm realm) {

                /*Partnership partnership = realm.where(Partnership.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("wicket", wicket).findAll().last();



                if (partnership == null || retired) {

                    Number num = realm.where(Partnership.class).max("partnershipID");
                    int psId = (num == null) ? 1 : num.intValue() + 1;

                    partnership = realm.createObject(Partnership.class, psId);
                    partnership.setMatchid(matchid);
                    partnership.setMatchID(matchID);
                    partnership.setInnings(currentInnings);
                    partnership.setSUPER_OVER(SUPER_OVER);
                    partnership.setWicket(wicket);
                    partnership.setPlayer1ID(ps1ID);
                    partnership.setPlayer2ID(ps2ID);
                }

//                else if ((partnership)  // need to work
//
                partnership.setPartnershipRuns(psRuns);
                partnership.setPartnershipBalls(psBalls);
                partnership.setPartnershipOver(psOver);

                if (ps1ID == player1ID && ps2ID == player2ID) {

                    partnership.setPlayer1Runs(player1Runs);
                    partnership.setPlayer1Balls(player1Balls);
                    partnership.setPlayer1ContributionBalls(p1CB);
                    partnership.setPlayer1ContributionRuns(p1CR);

                    partnership.setPlayer2Runs(player2Runs);
                    partnership.setPlayer2Balls(player2Balls);
                    partnership.setPlayer2ContributionBalls(p2CB);
                    partnership.setPlayer2ContributionRuns(p2CR);

                } else if (ps1ID == player2ID && ps2ID == player1ID) {

                    partnership.setPlayer1Runs(player2Runs);
                    partnership.setPlayer1Balls(player2Balls);
                    partnership.setPlayer1ContributionBalls(p2CB);
                    partnership.setPlayer1ContributionRuns(p2CR);

                    partnership.setPlayer2Runs(player1Runs);
                    partnership.setPlayer2Balls(player1Balls);
                    partnership.setPlayer2ContributionBalls(p1CB);
                    partnership.setPlayer2ContributionRuns(p1CR);

                }

                if (out) {

                    partnership.setDismissedPlayerID(dismissedPlayerID);
                }

                realm.copyToRealmOrUpdate(partnership);
                Log.d("partnership", "" + partnership);*/

                Partnership partnership;

                RealmResults<Partnership> result_partnership = realm.where(Partnership.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).
                        equalTo("wicket", wicket).findAll();

                if (result_partnership.isEmpty() || retired) {

//                    newPartnership = false;

                    Number num = realm.where(Partnership.class).max("partnershipID");
                    int psId = (num == null) ? 1 : num.intValue() + 1;

                    Number ps = realm.where(Partnership.class).
                            equalTo("matchid", matchid).
                            equalTo("innings", currentInnings).
                            max("partnershipSequence");

                    int pseq = (ps == null) ? 1 : ps.intValue() + 1;

                    Log.d("Partnership", "psId : " + psId);
                    Log.d("Partnership", "sequence : " + pseq);
                    partnership = realm.createObject(Partnership.class, psId);
                    partnership.setPartnershipSequence(pseq);
                    partnership.setMatchid(matchid);
                    partnership.setMatchID(matchID);
                    partnership.setInnings(currentInnings);
                    partnership.setSUPER_OVER(SUPER_OVER);
                    partnership.setWicket(wicket);
                    partnership.setPlayer1ID(ps1ID);
                    partnership.setPlayer2ID(ps2ID);
                }

//                else {

//                    newPartnership = false;
                partnership = result_partnership.last();
                partnership.setPartnershipRuns(psRuns);
                partnership.setPartnershipBalls(psBalls);
                partnership.setPartnershipOver(psOver);
                partnership.setDismissedPlayerID(dismissedPlayerID);

                if (ps1ID == player1ID && ps2ID == player2ID) {

                    partnership.setPlayer1Runs(player1Runs);
                    partnership.setPlayer1Balls(player1Balls);
                    partnership.setPlayer1ContributionBalls(p1CB);
                    partnership.setPlayer1ContributionRuns(p1CR);

                    partnership.setPlayer2Runs(player2Runs);
                    partnership.setPlayer2Balls(player2Balls);
                    partnership.setPlayer2ContributionBalls(p2CB);
                    partnership.setPlayer2ContributionRuns(p2CR);

                } else if (ps1ID == player2ID && ps2ID == player1ID) {

                    partnership.setPlayer1Runs(player2Runs);
                    partnership.setPlayer1Balls(player2Balls);
                    partnership.setPlayer1ContributionBalls(p2CB);
                    partnership.setPlayer1ContributionRuns(p2CR);

                    partnership.setPlayer2Runs(player1Runs);
                    partnership.setPlayer2Balls(player1Balls);
                    partnership.setPlayer2ContributionBalls(p1CB);
                    partnership.setPlayer2ContributionRuns(p1CR);

                }


                if (undoWicket) //{
                    partnership.setDismissedPlayerID(0);
//

                realm.copyToRealmOrUpdate(partnership);
                Log.d("partnership", "syncPartnership : " + partnership);
//                }
            }
        });
    }


    void serverSync() {

        Log.d("sync", "serverSync, serverSync 3, : " + serverSync);

        RealmResults<Events> results1 = realm.where(Events.class).
                equalTo("matchid", matchid).
                findAll();
        if (results1.isEmpty()) {

        } else {

            RealmResults<Events> results2 = realm.where(Events.class).
                    equalTo("matchid", matchid).
                    equalTo("syncstatus", 1).
                    findAll();

            RealmResults<Undo> resultsundo = realm.where(Undo.class).
                    equalTo("matchid", matchid).
                    equalTo("innings", currentInnings).
                    findAll();
            /*if (results2.isEmpty())
//                serverSync = 0f;
                Log.d("sync", "serverSync, results2 1, : " + results2);
            else {*/

            float total_events = (float) (results1.size() + resultsundo.size());
//                int synced = results2.size();  Commented on 06/07/2021
            int synced = results2.size();
            int synced1 = results2.size() + resultsundo.size();

            Log.d("sync", "serverSync, total_events : " + total_events);
            Log.d("sync", "serverSync, synced : " + synced);

            if (total_events > 0) {

                Log.d("sync", "serverSync, total_events > 0 : " + (total_events > 0));
                Log.d("sync", "serverSync, (synced / total_events) : " + (float) (synced / total_events));
                Log.d("sync", "serverSync, (total_events / synced) : " + (float) (total_events / synced));
                Log.d("sync", "serverSync, serverSync 4, : " + serverSync);

//                    serverSync = ((float) (synced / total_events)) * 100;
                serverSync = (synced * 100.0f) / total_events;
                double serverSync1 = (synced1 * 100.0f) / total_events;
                Log.d("sync", "serverSync, serverSync 5, : " + serverSync);
                Log.d("sync", "serverSync, serverSync1 5, : " + serverSync1);
//                    serverSync = ((float) (total_events / 100)) * synced;


            }

//            }
        }

        Log.d("sync", "serverSync, serverSync 1, : " + serverSync);
        Log.d("sync", "serverSync, serverSync 2, : " + new DecimalFormat("##.##").format(serverSync));
        tvServerSync.setText(String.valueOf(new DecimalFormat("##.##").format(serverSync)));
    }


    // added on 04/06/2020
    // to free memory
    public void freeMemory() {
        System.runFinalization();
        Runtime.getRuntime().gc();
        System.gc();
    }


    // added on 08/07/2020
    public void post(int i) {
        Log.d("post()", "i : " + i);
        Log.d("post", "post() 3: ");
        if (i == 1)
            Log.d("post()", "wheel = true");
        else if (i == 2)
            Log.d("post()", "substitution = true");
        else if (i == 3)
            Log.d("post()", "power = true");
        else if (i == 4)
            Log.d("post()", "saveUndo");
        else if (i == 5)
            Log.d("post()", "newEvent");


        jsonUndoArray = new JSONArray();
        undo_count = 0;
         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        RealmResults<Undo> result1 = realm.where(Undo.class).
                equalTo("matchid", matchid).
//                equalTo("innings", currentInnings).   Commented on 16/04/2021
        sort("undoID", Sort.ASCENDING).
                /*equalTo("sync", 1).*/findAll();


        if (result1.isEmpty()) {
           /* if (isNetworkAvailable()) {
                resetJSONEventArray();*/
            // commented on 08/07/2020
//                postJSON(matchid, matchID, false);
//            }
//            jsonEventArray = new JSONArray();
        } else {

//            if (isNetworkAvailable()) {
                /*RealmResults<Undo> result11 = realm.where(Undo.class).
                        equalTo("matchid", matchid).
                        equalTo("innings", currentInnings).findAll();*/

//
            Log.d("jsonUndoArray", "post() 4 : " + result1);

            for (Undo undoObject : result1) {

//                    if (undo_count <= 50) {//10) {  // commented on 0/07/2021
                if (undo_count <= 1) {
                    if (undoObject.getPost() != 1) {    // Added on 21/04/2021
                        ++undo_count;
                        Log.d("jsonUndoArray", "post() 1 : " + undoObject);
//                        if (undo.getSync() == 0) {
                        // added on 21/04/2021
//                            updateUndo(undoObject.getEventID());
                        undoObject.setPost(1);
                        realm.insertOrUpdate(undoObject);

                        jsonUndoArray.put(setUndo(undoObject));
                            /*// added on 04/07/2020
                        jsonUndoArray.put(setUndo(undoObject)); // moved inside on UpdateUndo on 21/04/2021*/
//                            jsonUndoArray.put(setUndo(undoObject));

                        // commented on 04/07/2020
//                            setUndoArray(undo.getUndoID(), undo.getEventID(), undo.getInnings(), false, undo.isPreOut());
                        Log.d("jsonUndoArray", "post() 2 : " + jsonUndoArray);
//                        }
                    }
                }

//                    else
//                        break;

            }

            // commnted on 08/07/2020
//                postUndoJSON();
//            }
        }

//        if (isNetworkAvailable()) {

        Log.d("jsonUndoArray", "post() 5 , isNetworkAvailable : " + isNetworkAvailable());
        Log.d("jsonUndoArray", "post() 5 , jsonUndoArray : " + jsonUndoArray);

//            if (undo) { // added only to check the undo posting and event posting
//
//                undo = false;
        if (jsonUndoArray.length() > 0) {

            Log.d("jsonUndoArray", "post() 6 , jsonUndoArray.length() : " + jsonUndoArray.length());
            Log.d("jsonUndoArray", "post() 7 , jsonUndoArray : " + jsonUndoArray);
            postUndoJSON();

        } else {
            resetJSONEventArray();
            if (jsonEventArray.length() > 0) {

                // added on 19/10/2020
                Match match = realm.where(Match.class).
                        equalTo("matchid", matchid).
                        findFirst();

                if (match != null) {

                    if (match.getMatchSync() != 1) {

                        postMatch(match);
                    }
                }

                // adding players (team A)
                RealmResults<Player> resultsA = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", 1).findAll();

                int count_A = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", 1).
                        equalTo("sync", 1).findAll().size();

                Log.d("POST()", "scoring 1, resultsA.size() : " + resultsA.size());
                Log.d("POST()", "scoring 1, count_A : " + count_A);

                if (resultsA.size() > count_A) {

                    RealmResults<Player> results1 = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", 1).
                            equalTo("edit", false).
                            equalTo("sync", 0).findAll();

                    for (Player player : results1) {

                        checkPlayers(player, /*matchid,*/ matchID, 1, false);
                    }

                    RealmResults<Player> results2 = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", 1).
                            equalTo("edit", true).
                            equalTo("sync", 0).findAll();

                    for (Player player : results2) {

                        checkPlayers(player,/* matchid, */matchID, 1, true);
                    }
                }

                // adding players (team B)
                RealmResults<Player> resultsB = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", 2).findAll();

                int count_B = realm.where(Player.class).
                        equalTo("matchid", matchid).
                        equalTo("team", 2).
                        equalTo("sync", 1).findAll().size();

                Log.d("POST()", "scoring 2, resultsB.size() : " + resultsB.size());
                Log.d("POST()", "scoring 2, count_B : " + count_B);

                if (resultsB.size() > count_B) {

                    RealmResults<Player> results1 = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", 2).
                            equalTo("edit", false).
                            equalTo("sync", 0).findAll();

                    for (Player player : results1) {

                        checkPlayers(player,/* matchid, */matchID, 2, false);
                    }

                    RealmResults<Player> results2 = realm.where(Player.class).
                            equalTo("matchid", matchid).
                            equalTo("team", 2).
                            equalTo("edit", true).
                            equalTo("sync", 0).findAll();

                    for (Player player : results2) {

                        checkPlayers(player, /*matchid,*/ matchID, 2, true);
                    }
                }

                // for checking whether team name is edited or not (14/09/2020)
                Match match1 = realm.where(Match.class).
                        equalTo("matchid", matchid).findFirst();

                if (match1 != null) {

                    if (match1.getTeamA_sync() == 0)
                        postTeam(1, match1.getTeamA());

                    if (match1.getTeamB_sync() == 0)
                        postTeam(2, match1.getTeamB());
                }


                // for checking MatchOfficials
                RealmResults<MatchOfficials> result_officials = realm.where(MatchOfficials.class).
                        equalTo("matchid", matchid).
                        equalTo("sync", 0).findAll();

                if (result_officials.size() > 0) {
                    postOfficialDetails();
                }

                    /* Commented on 18/03/2021 == match note entry is not clarified yet
                    // for checking MatchNotes
                    RealmResults<MatchNotes> result_notes = realm.where(MatchNotes.class).
                            equalTo("matchid", matchid).
                            equalTo("sync", 0).findAll();

                    if (result_notes.size() > 0) {
                        postMatchNote();
                    }*/

                postJSON(matchid, matchID/*, false*/);
            }
        }
//        }
    }


    public void checkPlayers(Player player, /*int matchid, */String matchID, int team, boolean edit) {

        // added on 14/09/2020

        String captain = null, vice_captain = null, wicketkeeper = null;

        if (isNetworkAvailable()) {

   /*         Player player = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("playerID", player_id).findFirst();*/

            if (player != null) {
                Log.d("ADD", "player : " + player.toString());

                JSONArray arrayPlayerB = new JSONArray();
                JSONObject jsonPlayerB = new JSONObject();

                try {
                    jsonPlayerB.put("name", player.getPlayerName());
                    jsonPlayerB.put("player_id", player.getPlayerID());
                    jsonPlayerB.put("d4s_playerid", player.getD4s_playerid());
//                    if (edit) {
//
//                    }
//
//                    else {
                    if (player.isCaptain())
                        jsonPlayerB.put("captain", "y");
                    else
                        jsonPlayerB.put("captain", "n");
                    if (player.isViceCaptain())
                        jsonPlayerB.put("vice_captain", "y");
                    else
                        jsonPlayerB.put("vice_captain", "n");
                    if (player.isWicketKeeper())
                        jsonPlayerB.put("wicketkeeper", "y");
                    else
                        jsonPlayerB.put("wicketkeeper", "n");
//                    }
                    arrayPlayerB.put(jsonPlayerB);
                } catch (JSONException e) {
                    e.printStackTrace();
                }

                JSONArray subarray = new JSONArray();
                JSONArray subarray1 = new JSONArray();
                JSONArray parray = new JSONArray();
                JSONArray sarray = new JSONArray();

                JSONObject teampsobject = new JSONObject();
                JSONObject teamobject = new JSONObject();


                JSONObject jsonTeamB = new JSONObject();
                try {

                    if (edit) {
                        if (player.isSubstitute()) {
                            jsonTeamB.put("players", subarray);
                            jsonTeamB.put("substitutes", arrayPlayerB);
                        } else {
                            jsonTeamB.put("substitutes", subarray);
                            jsonTeamB.put("players", arrayPlayerB);
                        }
                    } else {

                        if (player.isSubstitute()) {
                            jsonTeamB.put("substitutes", arrayPlayerB);
                        } else {
                            jsonTeamB.put("players", arrayPlayerB);
                        }
                    }

                    // edited

                    RealmResults<Player> players_list = realm.where(Player.class).
                            equalTo("matchID", matchID).
                            equalTo("team", player.getTeam()).findAll();

                    for (Player player111 : players_list) {

                        if (player111.isCaptain())
                            captain = player111.getPlayerName();
                        else if (player111.isViceCaptain())
                            vice_captain = player111.getPlayerName();

                        if (player111.isWicketKeeper())
                            wicketkeeper = player111.getPlayerName();
                    }

                    jsonTeamB.put("captain", captain);
                    jsonTeamB.put("vice captain", vice_captain);
                    jsonTeamB.put("wicketkeeper", wicketkeeper);


                    /*if (player.isCaptain())
                        jsonTeamB.put("captain", player.getPlayerName());
                    else
                        jsonTeamB.put("captain", "");

                    if (player.isViceCaptain())
                        jsonTeamB.put("vice captain", player.getPlayerName());
                    else
                        jsonTeamB.put("vice captain", "");

                    if (player.isWicketKeeper())
                        jsonTeamB.put("wicketkeeper", player.getPlayerName());
                    else
                        jsonTeamB.put("wicketkeeper", "");*/

                    // added on 08/09/2020
                    teamobject.put("players", parray);
                    teamobject.put("substitutes", sarray);

                } catch (JSONException e) {
                    e.printStackTrace();
                }

                JSONObject jsonA = new JSONObject();
                JSONObject jsonB = new JSONObject();
                JSONObject json_temp = new JSONObject();
                try {

                    JSONObject json_p = new JSONObject();
                    json_p.put("player_id", 0);

                    subarray1.put(json_p);

                    json_temp.put("players", subarray1);
                    if (edit)
                        json_temp.put("substitutes", subarray1);//subarray);    // commented on 28/09/2020

                    jsonA.put("matchID", matchID);

                    /*if (player.getTeam() == 1) {
                        jsonB.put("TeamA", jsonTeamB);
                    }
                    else {
                        jsonB.put("TeamB", jsonTeamB);
                    }*/

                    // updated (put edit cndition) on 12/09/2020
                    if (edit) {
                        if (player.getTeam() == 1) {
                            jsonB.put("TeamA", jsonTeamB);
                            jsonB.put("TeamB", json_temp);
//                        jsonB.put("TeamB", teamobject);
                        } else {
//                        jsonB.put("TeamA", teamobject);
                            jsonB.put("TeamA", json_temp);
                            jsonB.put("TeamB", jsonTeamB);
                        }
                    } else {
                        if (player.getTeam() == 1) {
                            jsonB.put("TeamA", jsonTeamB);
                        } else {
                            jsonB.put("TeamB", jsonTeamB);
                        }
                    }
                } catch (JSONException e) {
                    e.printStackTrace();
                }

                JSONArray array = new JSONArray();
                array.put(jsonA);
                array.put(jsonB);

                JSONObject jsonfeed = new JSONObject();
                try {
                    if (edit)
                        jsonfeed.put("EditPlayers", array);
                    else {
                        // commented om 12/09/2020
//                        jsonfeed.put("AddPlayers", array);
                        // updated on 12/09/2020
                        if (team == 1) {
                            if (player.isSubstitute())
                                jsonfeed.put("AddTeamAPlayerSubstitute", array);
                            else
                                jsonfeed.put("AddNewTeamAPlayers", array);
                        } else if (team == 2) {
                            if (player.isSubstitute())
                                jsonfeed.put("AddTeamBPlayerSubstitute", array);
                            else
                                jsonfeed.put("AddNewTeamBPlayers", array);
                        }

                    }
                } catch (JSONException e) {
                    e.printStackTrace();
                }

                //adding values to postparams
                JSONObject postparams = new JSONObject();
                try {
                    postparams.put("title", "CHASE_POST");
                    postparams.put("feed", jsonfeed);
                } catch (JSONException e) {
                    e.printStackTrace();
                }

                Log.e("Scoring", "postparams : " + postparams);

                JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                        Constants.CHASE_CRICKET_MATCH_API, postparams,
                        new Response.Listener<JSONObject>() {
                            @Override
                            public void onResponse(JSONObject response) {

                                Log.d("Scoring", "response : " + response);
                                try {

                                    if (!response.getBoolean("error") && response.getInt("status") == 200) {

                                        JSONObject jsonMatch = response.getJSONObject("match");

                                        Realm realm = null;
                                        try {
                                             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                                            realm.executeTransaction(new Realm.Transaction() {
                                                @Override
                                                public void execute(Realm bgRealm) {

                                                    try {

                                                        Player player1 = bgRealm.where(Player.class).
                                                                equalTo("matchID", jsonMatch.getString("app_matchID")).
                                                                equalTo("playerID", response.getInt("playerid")).
                                                                findFirst();

                                                        if (player1 != null) {
                                                            player1.setSync(1);
                                                            if (player1.isEdit())
                                                                player1.setEdit(false);
                                                            bgRealm.copyFromRealm(player1);
                                                        } else {
                                                            Log.d("Scoring", "player not found, playerid : " +
                                                                    response.getInt("playerid"));
                                                        }

                                                    } catch (JSONException e) {
                                                        e.printStackTrace();
                                                    } catch (RealmPrimaryKeyConstraintException e) {
                                                        progress.dismiss();
                                                        Toast.makeText(getApplicationContext(),
                                                                "Primary Key exists, Press Update instead",
                                                                Toast.LENGTH_SHORT).show();
                                                    }
                                                }

                                            });
                                        } catch (RealmException e) {
                                            Log.d("Scoring", "CheckPlayers, Exception : " + e);
                                        } finally {
                                            if (realm != null) {
                                                realm.close();
                                            }
                                        }
                                    }
                                } catch (JSONException e) {
                                    e.printStackTrace();
                                }
                            }
                        },
                        new Response.ErrorListener() {
                            @Override
                            public void onErrorResponse(VolleyError error) {

//                                progress.dismiss();
                                Log.e("Scoring", "Error Message is  : " + error.getMessage());

                            }
                        });

                MyApplicationClass.getInstance(getApplicationContext()).addToRequestQueue(jsonObjReq, "postRequest");
                Log.d("Scoring", "jsonObjReq  : " + jsonObjReq);
                Log.d("Scoring", "postparams  : " + postparams);
            } else {
                Log.d("Scoring", "player : " + player);
            }
        }


/*
        String cap = null, vc = null, wk = null;

            // add post


            JSONArray array_p = new JSONArray();
            JSONArray array_temp = new JSONArray();
            JSONArray array_temp1 = new JSONArray();
            JSONObject object = new JSONObject();

            try {

                object.put("name", player.getPlayerName());
                object.put("player_id", player.getPlayerID());
                object.put("d4s_playerid", player.getD4s_playerid());

//                if (edit) {
//
//                }
//                else {
                    if (player.isCaptain())
                        object.put("captain", "y");
                    else
                        object.put("captain", "n");
                    if (player.isViceCaptain())
                        object.put("vice_captain", "y");
                    else
                        object.put("vice_captain", "n");
                    if (player.isWicketKeeper())
                        object.put("wicketkeeper", "y");
                    else
                        object.put("wicketkeeper", "n");
//                }


                    array_p.put(object);
//                }
            }

            catch (JSONException e) {

            }

           JSONObject object_t = new JSONObject();
           JSONObject object_matchID = new JSONObject();
           JSONObject json_temp = new JSONObject();
            try {
                object_matchID.put("matchID", matchID);
//                if (edit) {
//
//                    if (team == 1)
//                        object_t.put("TeamA", array_p);
//                    else
//                        object_t.put("TeamB", array_p);
//
//                }
//
//                else {

                    JSONObject object_ps = new JSONObject();
                    if (edit) {
                        if (player.isSubstitute()) {
                            object_ps.put("players", array_temp);
                            object_ps.put("substitutes", array_p);
                        } else {
                            object_ps.put("players", array_p);
                            object_ps.put("substitutes", array_temp);
                        }
                    }

                    else {
                        if (player.isSubstitute()) {
                            object_ps.put("substitutes", array_p);
                        }
                        else {
                            object_ps.put("players", array_p);
                        }
                    }

                    RealmResults<Player> players_list = realm.where(Player.class).
                            equalTo("matchID", matchID).
                            equalTo("team", player.getTeam()).findAll();

                    for (Player player111 : players_list) {

                        if (player111.isCaptain())
                            cap = player111.getPlayerName();
                        else
                        if (player111.isViceCaptain())
                            vc = player111.getPlayerName();

                        if (player111.isWicketKeeper())
                            wk = player111.getPlayerName();
                    }

                    object_ps.put("captain", cap);
                    object_ps.put("vice captain", vc);
                    object_ps.put("wicketkeeper", wk);

                    JSONObject json_p = new JSONObject();
                    json_p.put("player_id", 0);

                    array_temp1.put(json_p);

                    json_temp.put("players", array_temp1);
                    json_temp.put("substitutes", array_temp);

//                    object_t.put("matchID", object_matchID);
                    if (team == 1) {
                        object_t.put("TeamA", object_ps);
                        object_t.put("TeamB", json_temp);
                    }
                    else {
                        object_t.put("TeamA", json_temp);
                        object_t.put("TeamB", object_ps);
                    }
//                }

            }
            catch (JSONException e) {
            }

            JSONArray arrayfeed = new JSONArray();
            arrayfeed.put(object_matchID);
            arrayfeed.put(object_t);

            JSONObject jsonfeed = new JSONObject();
            try {

                if (edit)
                    jsonfeed.put("EditPlayers", arrayfeed);

                else
                    jsonfeed.put("AddPlayers", arrayfeed);

            }
            catch (JSONException e) {

            }

        //adding values to postparams
        JSONObject postparams = new JSONObject();
        try {
            postparams.put("title", "CHASE_POST");
            postparams.put("feed", jsonfeed);
        } catch (JSONException e) {
            e.printStackTrace();
        }

        Log.e("captain", "postparams : "+postparams);

        JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                Constants.CHASE_CRICKET_MATCH_API, postparams,
                new Response.Listener<JSONObject>() {
                    @Override
                    public void onResponse(JSONObject response) {

                        Log.d("newplayer", "response : " + response);
//                                try {
//                                } catch (JSONException e) {
//                                    e.printStackTrace();
//                                }
//                            startActivity(new Intent(CaptainActivity.this, TossActivity.class));

                    }
                },
                new Response.ErrorListener() {
                    @Override
                    public void onErrorResponse(VolleyError error) {

//                                progress.dismiss();
                        Log.e("captain", "Error Message is  : " + error.getMessage());

                    }
                });

        MyApplicationClass.getInstance(getApplicationContext()).addToRequestQueue(jsonObjReq, "postRequest");
        Log.d("captain", "jsonObjReq  : " + jsonObjReq);
        Log.d("captain", "postparams  : " + postparams);


//        }
*/
    }


    // posting official details
    private void postOfficialDetails() {

         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
        if (isNetworkAvailable()) {

            RealmResults<MatchOfficials> results = realm.where(MatchOfficials.class).
                    equalTo("matchid", matchid).
                    equalTo("sync", 0).findAll();

            Log.d("ADD_OFFICIALS", "Scoring, results 1 : " + results);
            if (results.isEmpty()) {

                Log.d("ADD_OFFICIALS", "Scoring, results : " + results);
            } else {

                JSONArray arrayOfficials = new JSONArray();

                Log.d("ADD_OFFICIALS", "Scoring, matchID : " + matchID);


//                arrayOfficials.put(jsonObject);

                for (MatchOfficials officials : results) {

                    JSONObject jsonOfficials = new JSONObject();


                    try {
                        if (!officials.getOfficialName().matches("")) {
                            jsonOfficials.put("name", officials.getOfficialName());
//                        else
//                            jsonOfficials.put("name", "");

                            if (officials.getStatus().matches("u1") || officials.getStatus().matches("u2"))
                                jsonOfficials.put("type", "u");
                            else
                                jsonOfficials.put("type", officials.getStatus());

                            if (officials.getD4s_id() == 0)
                                jsonOfficials.put("d4s_playerid", 0);
                            else
                                jsonOfficials.put("d4s_playerid", officials.getD4s_id());

                            arrayOfficials.put(jsonOfficials);
                        }

                    } catch (JSONException e) {
                        e.printStackTrace();
                    }

                }

                JSONObject jsonObject = new JSONObject();
                try {
                    jsonObject.put("matchID", matchID);
                    jsonObject.put("officials", arrayOfficials);
                } catch (JSONException e) {
                    e.printStackTrace();
                }


                JSONObject jsonfeed = new JSONObject();

                try {
                    jsonfeed.put("AddMatchOfficials", jsonObject);
                } catch (JSONException e) {
                    e.printStackTrace();
                }


                JSONObject postparams = new JSONObject();
                try {
                    postparams.put("title", "CHASE_POST");
                    postparams.put("feed", jsonfeed);
                } catch (JSONException e) {
                    e.printStackTrace();
                }

                JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                        Constants.CHASE_CRICKET_MATCH_API, postparams,
                        new Response.Listener<JSONObject>() {
                            @Override
                            public void onResponse(JSONObject response) {

                                try {

                                    Log.d("ADD_OFFICIALS", "Scoring, response : " + response);

                                    if (!response.getBoolean("error") && response.getInt("status") == 200) {

                                        JSONObject jsonMatch = response.getJSONObject("match");

                                        RealmResults<MatchOfficials> results1 = realm.where(MatchOfficials.class).
                                                equalTo("matchid", matchid).
                                                equalTo("sync", 0).findAll();

                                        try {
                                             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                                            realm.executeTransaction(new Realm.Transaction() {
                                                @Override
                                                public void execute(Realm bgRealm) {

                                                    try {

                                                        RealmResults<MatchOfficials> result_officials1 = bgRealm.where(MatchOfficials.class).
                                                                equalTo("matchID",
                                                                        jsonMatch.getString("app_matchID")).
                                                                equalTo("sync", 0).findAll();

                                                        if (result_officials1.size() > 0) {
                                                            for (MatchOfficials officials : result_officials1) {
                                                                officials.setSync(1);
                                                                bgRealm.copyToRealm(officials);
                                                            }
                                                        }
                                                    } catch (JSONException e) {
                                                        e.printStackTrace();
                                                    } catch (RealmPrimaryKeyConstraintException e) {
                                                        progress.dismiss();
                                                        Toast.makeText(getApplicationContext(),
                                                                "Primary Key exists, Press Update instead",
                                                                Toast.LENGTH_SHORT).show();
                                                    }
                                                }
                                            });
                                        } catch (RealmException e) {
                                            Log.d("test", "Exception : " + e);
                                        } finally {
                                            if (realm != null) {
                                                realm.close();
                                            }
                                        }
                                    } else {
                                        progress.dismiss();
//                                        Toast.makeText(getApplicationContext(),
//                                                response.getString("message"), Toast.LENGTH_SHORT).show();
                                    }

                                    //if no error in response

 /*                               if (!response.getBoolean("error") && response.getInt("status") == 200) {

                                    JSONObject jsonMatch = response.getJSONObject("match");
                                    Log.d("create", "login(u,p), jsonMatch : " + jsonMatch);
                                    Realm realm = null;
                                    try {
                                         config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
                                        realm.executeTransaction(new Realm.Transaction() {
                                            @Override
                                            public void execute(Realm bgRealm) {

                                                try {

                                                    Match match1 = bgRealm.where(Match.class).
                                                            equalTo("matchID",
                                                                    jsonMatch.getString("app_matchID")).
                                                            findFirst();

                                                    match1.setMatchSync(1);
                                                    match1.setStatus("MC");
                                                    match1.setStatusId(1);
                                                    bgRealm.copyToRealm(match1);

                                                } catch (JSONException e) {
                                                    e.printStackTrace();
                                                } catch (RealmPrimaryKeyConstraintException e) {
                                                    progress.dismiss();
                                                    Toast.makeText(getApplicationContext(),
                                                            "Primary Key exists, Press Update instead",
                                                            Toast.LENGTH_SHORT).show();
                                                }
                                            }
                                        });
                                    } catch (RealmException e) {
                                        Log.d("test", "Exception : " + e);
                                    } finally {
                                        if (realm != null) {
                                            realm.close();
                                        }
                                    }


//                                    progress.dismiss();
                                    Toast.makeText(getApplicationContext(),
                                            response.getString("message"), Toast.LENGTH_SHORT).show();


                                    *///starting the profile activity

//                                        startActivity(new Intent(CreateMatchActivity.this, AddPlayers.class));
//                                        finish();*/
/*
                                } else {
//                                    progress.dismiss();
                                    Toast.makeText(getApplicationContext(),
                                            response.getString("message"), Toast.LENGTH_SHORT).show();
                                }*/

                                } catch (JSONException e) {
                                    e.printStackTrace();
                                }
                            }

                        },
                        new Response.ErrorListener() {
                            @Override
                            public void onErrorResponse(VolleyError error) {

//
//                                  Toast.makeText(getApplicationContext(), error.getMessage(), Toast.LENGTH_SHORT).show();
                                Log.d("ADD_OFFICIALS", "Scoring, Error Message is  : " + error);

                            }
                        });

                MyApplicationClass.getInstance(getApplicationContext()).
                        addToRequestQueue(jsonObjReq, "postRequest");
                Log.d("ADD_OFFICIALS", "Scoring, jsonObjReq  : " + jsonObjReq);
                Log.d("ADD_OFFICIALS", "Scoring, postparams  : " + postparams);

            }
        }
    }


    // updated on on 20/10/2020
    public void postMatchNote() {

        if (isNetworkAvailable()) {

            // updated on 20/10/2020

            Match match = realm.where(Match.class).
                    equalTo("matchid", matchid).findFirst();

            if (match.getMatchSync() == 0) {
                postJSON(matchid, matchID/*, false*/);    // need to check
            }

            RealmResults<MatchNotes> notes_result = realm.where(MatchNotes.class).
                    equalTo("matchid", matchid).
                    equalTo("sync", 0).findAll();

//            JSONObject json_matchID = new JSONObject();

            JSONArray array_notes = new JSONArray();

            if (notes_result.size() > 0) {


                /*try {
                    json_matchID.put("matchID", matchID);
                } catch (JSONException e) {
                    Log.d("MATCH_NOTE", "Scoring, JSONException : " + e);
                }
                */
                for (MatchNotes matchNotes : notes_result) {

                    Log.d("MNOte", "Scoring, postMatchnote, matchNotes : " + matchNotes);

                    JSONObject json_notes = new JSONObject();
                    try {
                        json_notes.put("sequence", matchNotes.getSequence());
                        json_notes.put("innings", matchNotes.getInnings());
                        json_notes.put("over", (new DecimalFormat("##.#").format(matchNotes.getOver())));
//                        json_notes.put("over", (int) matchNotes.getOver());
//                        json_notes.put("balls", ((matchNotes.getOver()) % ((int) matchNotes.getOver())));
                        json_notes.put("note", matchNotes.getNote());

                        array_notes.put(json_notes);

                    } catch (JSONException e) {
                        Log.d("MATCH_NOTE", "Scoring, JSONException : " + e);
                    }
                }

                JSONObject jsonObject = new JSONObject();
                try {
                    jsonObject.put("matchID", matchID);
                    jsonObject.put("matchnotes", array_notes);
                } catch (JSONException e) {
                    e.printStackTrace();
                }

                JSONObject jsonfeed = new JSONObject();

                try {
                    jsonfeed.put("AddMatchNote", jsonObject);
                } catch (JSONException e) {
                    e.printStackTrace();
                }


                JSONObject postparams = new JSONObject();
                try {
                    postparams.put("title", "CHASE_POST");
                    postparams.put("feed", jsonfeed);
                } catch (JSONException e) {
                    e.printStackTrace();
                }





            /*Match match = realm.where(Match.class).
                    equalTo("matchID", matchID).findFirst();

            if (match != null) {

                if (match.getMatch_note() == null) {
                    Log.d("MATCH_NOTE", "Scoring, no match note found");
                }

                else {

                    JSONObject json_match = new JSONObject();
                    JSONObject json_note = new JSONObject();
                    JSONObject json_feed = new JSONObject();
                    JSONArray array = new JSONArray();

                    try {
                        json_match.put("matchID", matchID);

                        json_note.put("note", match.getMatch_note());

                        array.put(json_match);
                        array.put(json_note);

                        json_feed.put("AddMatchNote", array);

                    } catch (JSONException e) {
                        Log.d("MATCH_NOTE", "Scoring, JSONException : " + e);
                    }


                    JSONObject postparams = new JSONObject();
                    try {
                        postparams.put("title", "CHASE_POST");
                        postparams.put("feed", json_feed);
                    } catch (JSONException e) {
                        e.printStackTrace();
                    }*/

                Log.e("MATCH_NOTE", "Scoring, postparams : " + postparams);

                JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                        Constants.CHASE_CRICKET_MATCH_NOTE, postparams,
                        new Response.Listener<JSONObject>() {
                            @Override
                            public void onResponse(JSONObject response) {

                                Log.d("MATCH_NOTE", "Scoring, response : " + response);


                            }
                        },
                        new Response.ErrorListener() {
                            @Override
                            public void onErrorResponse(VolleyError error) {
                                Log.e("MATCH_NOTE", "Scoring, Error Message is  : " + error.getMessage());
                            }
                        });

                MyApplicationClass.getInstance(getApplicationContext()).addToRequestQueue(jsonObjReq, "postRequest");
                Log.d("MATCH_NOTE", "Scoring, jsonObjReq  : " + jsonObjReq);
                Log.d("MATCH_NOTE", "Scoring, postparams  : " + postparams);
            } else {
                Log.d("MATCH_NOTE", "Scoring, no matchnote to sync");
            }
        } else {
            Log.d("MATCH_NOTE", "Scoring, network not available");
        }
    }


    //added on 19/10/2020
    public void postMatch(Match match) {

        if (isNetworkAvailable()) {
            // posting match details if not synced
            JSONObject jsonMatch = new JSONObject();

            try {
                jsonMatch.put("d4s_gameid", match.getD4s_matchid());
                jsonMatch.put("d4s_userid", match.getD4s_userid());

                jsonMatch.put("matchID", match.getMatchID());
                jsonMatch.put("teamA", match.getTeamA());
                jsonMatch.put("d4s_teamA_id", match.getTeamAId());
                jsonMatch.put("teamB", match.getTeamB());
                jsonMatch.put("d4s_teamB_id", match.getTeamBId());
                jsonMatch.put("venue", match.getVenue());
                jsonMatch.put("d4s_venue_id", match.getVenueId());
                if (match.getEnd1() == null)
                    jsonMatch.put("end1", "");
                else
                    jsonMatch.put("end1", match.getEnd1());
                if (match.getEnd2() == null)
                    jsonMatch.put("end2", "");
                else
                    jsonMatch.put("end2", match.getEnd2());
                jsonMatch.put("event", match.getEvent());
                jsonMatch.put("d4s_event_id", match.getEventId());
                jsonMatch.put("phase", match.getPhase());
                jsonMatch.put("match_type", match.getMatchType());
                jsonMatch.put("innings", match.getInnings());
                jsonMatch.put("playersA", match.getPlayerA());
                jsonMatch.put("playersB", match.getPlayerB());
                jsonMatch.put("overs_per_bowler", match.getMax_opb());
//                jsonMatch.put("players", match.getPlayer());
//                jsonMatch.put("substitute_players", match.getSubst());
                jsonMatch.put("over", match.getActual_over());
                jsonMatch.put("balls_per_over", match.getBalls());
                jsonMatch.put("wide_value", match.getWiderun());
                jsonMatch.put("noball_value", match.getNoballrun());
                jsonMatch.put("penalty_value", match.getPenaltyrun());
                jsonMatch.put("rainruleused", "n");

            } catch (JSONException e) {
                e.printStackTrace();
            }


            JSONObject jsonfeed = new JSONObject();
            try {
                jsonfeed.put("AddMatch", jsonMatch);
            } catch (JSONException e) {
                e.printStackTrace();
            }


            JSONObject postparams = new JSONObject();
            try {
                postparams.put("title", "CHASE_POST");
                postparams.put("feed", jsonfeed);
            } catch (JSONException e) {
                e.printStackTrace();
            }

            JsonObjectRequest jsonObjReq = new JsonObjectRequest(Request.Method.POST,
                    Constants.CHASE_CRICKET_MATCH_API, postparams,
                    new Response.Listener<JSONObject>() {
                        @Override
                        public void onResponse(JSONObject response) {

                            Log.d("EDIT_TEAM", "Scoring, response : " + response);


                        }
                    },
                    new Response.ErrorListener() {
                        @Override
                        public void onErrorResponse(VolleyError error) {

//                                progress.dismiss();
                            Log.e("EDIT_TEAM", "Scoring, Error Message is  : " + error.getMessage());

                        }
                    });

            MyApplicationClass.getInstance(getApplicationContext()).addToRequestQueue(jsonObjReq, "postRequest");
            Log.d("EDIT_TEAM", "Scoring, jsonObjReq  : " + jsonObjReq);
            Log.d("EDIT_TEAM", "Scoring, postparams  : " + postparams);

        } else {
            Log.d("EDIT_TEAM", "Scoring, network not available");
        }
    }


    // ADDED ON 27/02/2021
    private void changeWicketkeeper(int i) {

        AlertDialog wkDialog = new AlertDialog.Builder(ScoringActivity.this).create();
        wkDialog.setIcon(R.drawable.ball);
        wkDialog.setCancelable(false);
        wkDialog.setTitle(wicketkeeper);
        wkDialog.setMessage("is wicketkeeper. Do you want to change it?");
        wkDialog.setButton(AlertDialog.BUTTON_POSITIVE, "Ok",
                new DialogInterface.OnClickListener() {
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        if (i == 1)
                            selectNewWicketkeeper(wk_id);
                        else if (i == 2)
                            setSubstituteAsNewWicketkeeper(wk_id);
                    }
                });
        wkDialog.setButton(AlertDialog.BUTTON_NEUTRAL, "Cancel",
                new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                    }
                });

        wkDialog.show();
    }


    private void selectNewWicketkeeper(int wkID) {

        String old_wk = wicketkeeper;

        if (wkID > 0) {

            RealmResults<Player> results = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", fieldingTeamNo).
                    equalTo("substitute", false).
                    equalTo("playing", true).
                    equalTo("retired_concussion", false).
                    equalTo("retired", false).findAll();

            final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                    android.R.layout.select_dialog_singlechoice);

            for (Player player : results) {
                if (player.getPlayerID() != wkID)
                    arrayAdapter.add(player.getPlayerName());
            }

            fielderBuilder = new AlertDialog.Builder(ScoringActivity.this);
            fielderBuilder.setIcon(R.drawable.ball);
            fielderBuilder.setCancelable(false);
            fielderBuilder.setTitle("Select Wicketkeeper");
            fielderBuilder.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    dialog.dismiss();
                }
            });
            fielderBuilder.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    String strName = arrayAdapter.getItem(which);
                    AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                    builderInner.setIcon(R.drawable.ball);
                    builderInner.setCancelable(false);
                    dialog.dismiss();
                    builderInner.setMessage(strName);
                    builderInner.setTitle("Selected Wicketkeeper is ");

                    builderInner.setPositiveButton("Confirm", new DialogInterface.OnClickListener() {
                        @Override
                        public void onClick(DialogInterface dialog, int which) {

                            wicketkeeper = strName;
                            saveWk(strName, wkID/*old_wk*/, 1);
                            dialog.dismiss();

                        }
                    });
                    builderInner.show();
                }
            });

            fielderBuilder.setNegativeButton("Cancel", null);
            fielderBuilder.show();
        } else {

            Player wk_player = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", fieldingTeamNo).
                    equalTo("playerName", wicketkeeper).
                    equalTo("new_wk", true).
                    equalTo("wicketKeeper", true).findFirst();

            if (wk_player != null) {
                if (wk_player.getPlayerID() > 0) {
                    selectNewWicketkeeper(wk_player.getPlayerID());
                }
            }

        }


    }


    private void setSubstituteAsNewWicketkeeper(int wkID) {

        String old_wk = wicketkeeper;

        if (wkID > 0) {

            RealmResults<Player> results = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", fieldingTeamNo).
                    equalTo("substitute", true).
                    equalTo("playing", false).
                    equalTo("retired_concussion", false).
                    equalTo("retired", false).findAll();

            Log.d("substitute", "setSubstituteAsNewWicketkeeper, results : " + results);

            final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(ScoringActivity.this,
                    android.R.layout.select_dialog_singlechoice);

            if (results.size() > 0) {

                for (Player player : results) {
                    if (player.getPlayerID() != wkID)
                        arrayAdapter.add(player.getPlayerName());
                }

                fielderBuilder = new AlertDialog.Builder(ScoringActivity.this);
                fielderBuilder.setIcon(R.drawable.ball);
                fielderBuilder.setCancelable(false);
                fielderBuilder.setTitle("Select Substitute Wicketkeeper");
                fielderBuilder.setNegativeButton("cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                    }
                });
                fielderBuilder.setAdapter(arrayAdapter, new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        String strName = arrayAdapter.getItem(which);
                        AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                        builderInner.setIcon(R.drawable.ball);
                        builderInner.setCancelable(false);
                        dialog.dismiss();
                        builderInner.setMessage(strName);
                        builderInner.setTitle("Selected Substitute Wicketkeeper is ");

                        builderInner.setPositiveButton("Confirm", new DialogInterface.OnClickListener() {
                            @Override
                            public void onClick(DialogInterface dialog, int which) {

                                wicketkeeper = strName;
                                saveWk(strName, wkID /*old_wk*/, 2);
                                dialog.dismiss();

                            }
                        });
                        builderInner.show();
                    }
                });

                fielderBuilder.setNegativeButton("Cancel", null);
                fielderBuilder.show();
            } else {

                AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
                builderInner.setIcon(R.drawable.ball);
                builderInner.setCancelable(false);
//                builderInner.setMessage(strName);
                builderInner.setTitle("Please add substitute players first");

                builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                        dialog.dismiss();
                        playerList();

                    }
                });
                builderInner.show();
            }

        } else {

            Player wk_player = realm.where(Player.class).
                    equalTo("matchid", matchid).
                    equalTo("team", fieldingTeamNo).
                    equalTo("playerName", wicketkeeper).
                    equalTo("new_wk", true).
                    equalTo("wicketKeeper", true).findFirst();

            if (wk_player != null) {
                if (wk_player.getPlayerID() > 0) {
                    setSubstituteAsNewWicketkeeper(wk_player.getPlayerID());
                }
            }

        }


    }


    private void saveWk(String wicketkeeper, int old_wicketkeeper_id, int i) {


        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {

                @Override
                public void execute(Realm bgrealm) {

                    try {

                        // new wicketkeeper
                        Player new_wk = bgrealm.where(Player.class).
                                equalTo("matchid", matchid).
                                equalTo("team", fieldingTeamNo).
                                equalTo("retired", false).
                                equalTo("retired_concussion", false).
                                equalTo("playerName", wicketkeeper).findFirst();

                        if (new_wk != null) {

                            pre_wk_id = wk_id;
                            pre_wk_position = keeper_position;

                            wk_id = new_wk.getPlayerID();

                            Number num1 = bgrealm.where(Player.class).
                                    equalTo("matchid", matchid).
                                    equalTo("team", fieldingTeamNo).
                                    max("wicketkeeping_position");
                            int nextId1 = (num1 == null) ? 1 : num1.intValue() + 1;
                            keeper_position = nextId1;
                            new_wk.setNew_wk(true);
                            new_wk.setOld_wk(false);
                            new_wk.setWicketKeeper(true);
                            new_wk.setWicketkeeping_position(nextId1);

                            bgrealm.insertOrUpdate(new_wk);
                            Log.e("Scoring", "saveWk, new_wk : " + new_wk);
                        }

                        // old wicketkeeper
                        Player old_wk = bgrealm.where(Player.class).
                                equalTo("matchid", matchid).
                                equalTo("team", fieldingTeamNo).
                                equalTo("retired", false).
                                equalTo("retired_concussion", false).
                                equalTo("playerID", old_wicketkeeper_id).findFirst();

                        if (old_wk != null) {

                            /*Number num1 = bgrealm.where(Player.class).
                                    equalTo("matchid", matchid).
                                    equalTo("team", fieldingTeamNo).
                                    max("wicketkeeping_position");
                            int nextId1 = (num1 == null) ? 1 : num1.intValue() + 1;*/
                            old_wk.setNew_wk(false);
                            old_wk.setOld_wk(true);

//                            old_wk.setWicketkeeping_position(nextId1);

                            bgrealm.insertOrUpdate(old_wk);
                            Log.e("Scoring", "saveWk, old_wk : " + old_wk);
                        }

                        if (i == 1)
                            ballType = 24;
                        if (i == 2)
                            ballType = 25;


                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("openers", "checkSpinnerValues, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }

        newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls, wicket,
                ball, 0, preInningsRuns, remainingRuns, remainingBalls, remainingOver,
                leadingRuns, innings1Runs, innings2Runs, innings3Runs, innings4Runs, battingTeamNo,
                fieldingTeamNo, player1ID, player2ID, strID, strikerRuns, strikerBalls, nstrID,
                nonStrikerRuns, nonStrikerBalls, bowlerID, bwRun, bowlerOver, bowlerBalls, bowlerWicket,
                /*nextBowlerID,*/preBowlerID, preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket,
                lastPreBowlerID, 0, ballType, -1, 0, -1, 0,
                null, 0, -1, 0, 0, false,
                0, commentary, 0, mo, maiden, modified, udisplay, tco,
                tbo, tpbo, 0, sessionType, sessionID, true, /*jsonEventArray,
                     jsonUndoArray,*/ endOfDay, SUPER_OVER, so_inninngs1Runs, so_inninngs2Runs,
                false, freeHit, false, inning_started, 0,
                0, 0, null, pre_out, callBowlerAlert, wk_id,
                keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team, forfeit_innings,
                CONCEDE, conceded_team, forceEndingType, lunch_flag, tea_flag, dinner_flag);
    }


    // Added on 21/04/2021
    private void updateUndo(int eventid) {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {

                @Override
                public void execute(Realm bgrealm) {

                    try {

                        Undo undo = bgrealm.where(Undo.class).
                                equalTo("matchid", matchid).
                                equalTo("eventID", eventid).
                                findAll().
                                first();

                        if (undo != null) {
                            undo.setPost(1);
                            bgrealm.insertOrUpdate(undo);

                            Undo undo1 = bgrealm.where(Undo.class).
                                    equalTo("matchid", matchid).
                                    equalTo("eventID", eventid).
                                    findAll().
                                    first();

                            jsonUndoArray.put(setUndo(undo1));
                        }


                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("openers", "checkSpinnerValues, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }

    }


    private void updateUndo2() {

        Realm realm = null;
        try {
             config = new RealmConfiguration.Builder()
                .name(AppConstants.GAME_ID + ".realm")
                .deleteRealmIfMigrationNeeded()
                .build();
        realm = Realm.getInstance(config);
            realm.executeTransaction(new Realm.Transaction() {

                @Override
                public void execute(Realm bgrealm) {

                    try {

                        RealmResults<Undo> results = bgrealm.where(Undo.class).
                                equalTo("matchid", matchid).
                                findAll();

                        if (results.size() > 0) {
                            for (Undo undo : results) {
                                if (undo != null) {
                                    undo.setPost(0);
                                    bgrealm.insertOrUpdate(undo);
                                }
                            }
                        }

                        jsonUndoArray = new JSONArray();

                    } catch (RealmPrimaryKeyConstraintException e) {
                        Toast.makeText(getApplicationContext(),
                                "Primary Key exists, Press Update instead", Toast.LENGTH_SHORT).show();
                    }
                }
            });
        } catch (RealmException e) {
            Log.d("openers", "checkSpinnerValues, Exception : " + e);
        } finally {
            if (realm != null) {
                realm.close();
            }
        }

    }


    // Added on 28/04/2021
    private void checkUndoLimit() {

        if (UNDO_LIMIT) {
            UNDO_LIMIT = false;
            if (innings.matches("single")) {

                if (sessionID == 6) {
                    sessionID = 12;
                    sessionType = "SS1";
                } else if (sessionID == 7) {
                    sessionID = 8;
                    sessionType = "SS2";
                } else if (sessionID == 9) {
                    sessionID = 10;
                    sessionType = "SS3";
                }

            } else {

                if (currentInnings == 1) {

                    if (sessionID == 6) {
                        sessionID = 12;
                        sessionType = "SS1";
                    }
                }
            }

            Log.d("session", " runOnce 1, sessionType : " + sessionType);
            Log.d("session", " runOnce 1, sessionID : " + sessionID);
            setMatchStatus(sessionType, sessionID);
        }
    }


    private void setSessionFlags() {

        Match match = realm.where(Match.class).
                equalTo("matchid", matchid).
                findFirst();
        if (match != null) {
            lunch_flag = match.getLunch_flag();
            tea_flag = match.getTea_flag();
            dinner_flag = match.getDinner_flag();
        }
    }


    // Added on 01/07/2021
    private String setUndoOutType(int id) {
        String outType = "no";
       /* if (id == -1) {
            outType = "no";
        } else */
        if (id == 0) {
            outType = "b";//"Bowled";
        } else if (id == 1) {
            outType = "c";//Caught";
        } else if (id == 2) {
            outType = "ro";//Runout";
        } else if (id == 3) {
            outType = "st";//Stumped";
        } else if (id == 4) {
            outType = "lb";//LBW";
        } else if (id == 5) {
            outType = "hw";//Hit Wicket";
        } else if (id == 6) {
            outType = "ht";//Hit the Ball Twice";
        } else if (id == 7) {
            outType = "ob";//Obstructing Field";
        } else if (id == 8) {
            outType = "hb";//Handled the Ball";
        } else if (id == 9) {
            outType = "to";//Timed Out";
        } else if (id == 10) {
            outType = "rh";//Retired Hurt";
        } else if (id == 11) {
            outType = "a";//Absent";
        } else if (id == 12) {
            outType = "ro";//Retired Out";
        } else {
            outType = "no";
        }
        return outType;
    }


    // Added on 08/07/2021
    void displayWarningBowler(/*String message,*/ String strName, int type, int rtype) {

        AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
        builderInner.setIcon(R.drawable.ball);
        builderInner.setCancelable(false);
        builderInner.setMessage("Allotted bowler overs completed. Do you want to continue ?");
        builderInner.setTitle("Warning");

        builderInner.setPositiveButton("Continue", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                confirmExceededOver(strName, type, rtype);
            }
        });

        builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                /*if (rtype == 1)
                    changeBowler(type);
                else if (rtype == 2) {*/
                selectBowlerAlertDialog();
//                }
            }
        });
        builderInner.show();
    }


    // moved from another function
    private void confirmBowler(int type, String strName) {

        AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
        builderInner.setIcon(R.drawable.ball);
        builderInner.setCancelable(false);
        builderInner.setMessage(strName);
        builderInner.setTitle("Selected Bowler is");

        builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                if (replacedBowler == null) { //.matches("")) {

                    if (preBowlerID != 0) {
                        if (!strName.matches(preBowler)) {

                            replaceNextBowler(strName);

                        } else {

                            AlertDialog.Builder builderInners = new AlertDialog.Builder(ScoringActivity.this);
                            builderInners.setIcon(R.drawable.ball);
                            builderInners.setCancelable(false);
                            dialog.dismiss();
                            builderInners.setMessage("Selected bowler " + strName + " just bowled the previous over");
                            builderInners.setTitle("OK to change selection");

                            builderInners.setPositiveButton("OK", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {
                                    dialog.dismiss();
                                    changeBowler(type);
                                }
                            });
                            builderInners.show();
                        }
                    } else {
                        replaceNextBowler(strName);
                    }
                } else if (replacedBowler != null) {

                    if (preBowlerID != 0) {

                        if (!(strName.matches(preBowler)) && !(strName.matches(replacedBowler))) {

                            replaceNextBowler(strName);

                        } else {

                            AlertDialog.Builder builderInners = new AlertDialog.Builder(ScoringActivity.this);
                            builderInners.setIcon(R.drawable.ball);
                            builderInners.setCancelable(false);
                            dialog.dismiss();
                            builderInners.setMessage("Selected bowler " + strName + " just bowled the previous over");
                            builderInners.setTitle("OK to change selection");

                            builderInners.setPositiveButton("OK", new DialogInterface.OnClickListener() {
                                @Override
                                public void onClick(DialogInterface dialog, int which) {

                                    dialog.dismiss();
                                    changeBowler(type);

                                }
                            });
//
                            builderInners.show();
                        }
                    } else {

                        replaceNextBowler(strName);
                    }
                }
            }
        });

        builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                changeBowler(type);
            }
        });
        builderInner.show();
    }


    // moved from top
    private void confirmReturnBowler() {

        //ADDED ON 26/02/2021 (only alert box)
        AlertDialog.Builder builderInner = new AlertDialog.Builder(ScoringActivity.this);
        builderInner.setIcon(R.drawable.ball);
        builderInner.setCancelable(false);
//        dialog.dismiss();
        builderInner.setMessage(preBowler);
        builderInner.setTitle("Selected Bowler is");

        builderInner.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

                tco = currentOver;
                tbo = bowlerOver;
                tpbo = preBowlerOver;

                Log.d("so_inninngs1Runs", "selectBowlerAlertDialog13 , : " + so_inninngs1Runs);
                ballType = 6;
                int tempID = bowlerID;
                lastPreBowlerID = preBowlerID;
                bowlerID = preBowlerID;
                preBowlerID = tempID;
                preBowler = bowler;
                Log.e("Scoring", "selectBowlerAlertDialog, bowlerAlert, RETURN, ballType : " + ballType);
                newEvent(matchid, matchID, currentInnings, currentRuns, currentOver, totalBalls,
                        wicket, ball, 0, preInningsRuns, remainingRuns, remainingBalls,
                        remainingOver, leadingRuns, innings1Runs, innings2Runs, innings3Runs,
                        innings4Runs, battingTeamNo, fieldingTeamNo, player1ID, player2ID, strID,
                        strikerRuns, strikerBalls, nstrID, nonStrikerRuns, nonStrikerBalls, bowlerID,
                        bwRun, bowlerOver, bowlerBalls, bowlerWicket, /*nextBowlerID,*/preBowlerID,
                        preBowlerRun, preBowlerOver, preBowlerBalls, preBowlerWicket, lastPreBowlerID,
                        0, ballType, -1, 0, -1, 0,
                        null, 0, 0, 0, 0,
                        false, 0, commentary, preBowlerID, mo, maiden,
                        modified, udisplay, tco, tbo, tpbo, 0, sessionType, sessionID,
                        false, /*jsonEventArray, jsonUndoArray,*/ endOfDay, SUPER_OVER,
                        so_inninngs1Runs, so_inninngs2Runs, false, freeHit,
                        false, inning_started, 0, 0,
                        0, null, pre_out, callBowlerAlert, wk_id,
                        keeper_position, pre_wk_id, pre_wk_position, FORFEIT, forfeit_team,
                        forfeit_innings, CONCEDE, conceded_team, forceEndingType, lunch_flag,
                        tea_flag, dinner_flag);

                newBowler(bowlerID, preBowlerID);
            }
        });

        builderInner.setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                selectBowlerAlertDialog();
            }
        });
        builderInner.show();
    }


    // Added on 09/07/2021
    public void confirmExceededOver(String strName, int type, int rtype) {
        AlertDialog.Builder alert = new AlertDialog.Builder(this);
        alert.setIcon(R.drawable.ball).
                setTitle("Confirm").
                setMessage("Selected bowler is " + strName).
                setCancelable(false).
                setPositiveButton("CORFIRM", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        if (rtype == 1)
                            confirmBowler(type, strName);
                        else if (rtype == 2) {
                            confirmReturnBowler();
                        }
                    }
                }).
                setNeutralButton("Cancel", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss();
                        /*if (rtype == 1)
                            changeBowler(type);
                        else if (rtype == 2) {*/
                        selectBowlerAlertDialog();
//                        }
                    }
                }).
                show();
    }
}




